# –ö—É—Ä—Å: –°–æ–∑–¥–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –¢–ó –∏–∑ –≥–æ–ª–æ—Å–∞

---

## –ù–ï–†–ï–ê–õ–ò–ó–û–í–ê–ù–ù–´–ï –ó–ê–î–ê–ß–ò

> –ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –Ω–µ—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π –≤—ã–Ω–µ—Å–µ–Ω –≤ [BACKLOG.md](./BACKLOG.md)

---

## –†–ï–ê–õ–ò–ó–û–í–ê–ù–ù–´–ï –ß–ê–°–¢–ò

- ‚úÖ –ß–∞—Å—Ç—å 1 ‚Äî –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ (backend + frontend + Prisma)
- ‚úÖ –ß–∞—Å—Ç—å 2 ‚Äî –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è, JWT, middleware)
- ‚úÖ –ß–∞—Å—Ç—å 3 ‚Äî –ì–æ–ª–æ—Å–æ–≤–æ–π –≤–≤–æ–¥ (Web Speech API)
- ‚úÖ –ß–∞—Å—Ç—å 4 ‚Äî CRUD –ø—Ä–æ–µ–∫—Ç–æ–≤
- ‚úÖ –ß–∞—Å—Ç—å 5 ‚Äî CRUD —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –∑–∞–¥–∞–Ω–∏–π
- ‚úÖ –ß–∞—Å—Ç—å 6 ‚Äî –ó–∞–≥–æ—Ç–æ–≤–∫–∞ –¥–ª—è AI
- ‚úÖ –ß–∞—Å—Ç—å 8 ‚Äî –ù–∞–¥—ë–∂–Ω–∞—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è
- ‚úÖ –ß–∞—Å—Ç—å 9 ‚Äî Vue Router –∏ –Ω–∞–≤–∏–≥–∞—Ü–∏—è
- ‚úÖ –ß–∞—Å—Ç—å 10 ‚Äî UI –ø—Ä–æ–µ–∫—Ç–æ–≤
- ‚úÖ –ß–∞—Å—Ç—å 11 ‚Äî UI —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –∑–∞–¥–∞–Ω–∏–π (–∫—Ä–æ–º–µ 11.6 –°—Ç–∞—Ç—É—Å)
- ‚úÖ –ß–∞—Å—Ç—å 12 ‚Äî AI-—Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ Ollama
- ‚úÖ –ß–∞—Å—Ç—å 17 ‚Äî –£–¥–∞–ª—ë–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø —á–µ—Ä–µ–∑ ngrok
- ‚úÖ –ß–∞—Å—Ç—å 18 ‚Äî –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
- ‚úÖ –ß–∞—Å—Ç—å 19 ‚Äî –ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –¢–ó
- ‚úÖ –ß–∞—Å—Ç—å 20 ‚Äî –í—ã–±–æ—Ä CRM-—Å–∏—Å—Ç–µ–º—ã –¥–ª—è –æ—Ü–µ–Ω–∫–∏ –¢–ó
- ‚úÖ –ß–∞—Å—Ç—å 21 ‚Äî –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞–º–∏ –∏ –∫–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è AI
- ‚úÖ –ß–∞—Å—Ç—å 22 ‚Äî –≠–∫—Å–ø–æ—Ä—Ç –≤ DOC
- ‚úÖ –ß–∞—Å—Ç—å 23 ‚Äî –ü—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–∏–µ —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤ –∫ –ø—É–Ω–∫—Ç–∞–º –¢–ó

---

## –í–≤–µ–¥–µ–Ω–∏–µ

–ú—ã —Å–æ–∑–¥–∞–¥–∏–º –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≥–¥–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:
1. –ì–æ–≤–æ—Ä–∏—Ç –≤ –º–∏–∫—Ä–æ—Ñ–æ–Ω
2. –†–µ—á—å –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç—Å—è –≤ —Ç–µ–∫—Å—Ç
3. –¢–µ–∫—Å—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä—É–µ—Ç—Å—è –≤ –ø—É–Ω–∫—Ç—ã –¢–ó
4. –¢–ó –º–æ–∂–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∏ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ PDF

**–°—Ç–µ–∫:**
- Frontend: Vue 3 + JavaScript + TailwindCSS + DaisyUI
- Backend: Node.js + Express + JavaScript
- –ë–î: MySQL + Prisma ORM
- –ì–æ–ª–æ—Å: Web Speech API (–≤—Å—Ç—Ä–æ–µ–Ω –≤ –±—Ä–∞—É–∑–µ—Ä)

---

# –ß–ê–°–¢–¨ 1: –ù–ê–°–¢–†–û–ô–ö–ê –ü–†–û–ï–ö–¢–ê ‚úÖ

## –£—Ä–æ–∫ 1.1: –°–æ–∑–¥–∞–Ω–∏–µ Backend ‚úÖ

### –®–∞–≥ 1: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞

```bash
mkdir backend
cd backend
npm init -y
```

### –®–∞–≥ 2: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
npm install express cors dotenv bcryptjs jsonwebtoken
npm install -D nodemon prisma
```

**–ß—Ç–æ —Å—Ç–∞–≤–∏–º:**
- `express` ‚Äî –≤–µ–±-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫
- `cors` ‚Äî —Ä–∞–∑—Ä–µ—à–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã —Å frontend
- `dotenv` ‚Äî —á–∏—Ç–∞–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ .env —Ñ–∞–π–ª–∞
- `bcryptjs` ‚Äî —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π
- `jsonwebtoken` ‚Äî JWT —Ç–æ–∫–µ–Ω—ã –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- `nodemon` ‚Äî –∞–≤—Ç–æ–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö
- `prisma` ‚Äî ORM –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö

### –®–∞–≥ 3: –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–ø–æ–∫

–°–æ–∑–¥–∞–π —Ç–∞–∫—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É:

```
backend/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ routes/          # –†–æ—É—Ç—ã API
‚îÇ   ‚îú‚îÄ‚îÄ controllers/     # –õ–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ middleware/      # –ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ services/        # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îî‚îÄ‚îÄ index.js         # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îú‚îÄ‚îÄ prisma/
‚îÇ   ‚îî‚îÄ‚îÄ schema.prisma    # –°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ .env                 # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îî‚îÄ‚îÄ package.json
```

### –®–∞–≥ 4: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ package.json

–û—Ç–∫—Ä–æ–π `package.json` –∏ –¥–æ–±–∞–≤—å —Å–∫—Ä–∏–ø—Ç—ã:

```json
{
  "scripts": {
    "dev": "nodemon src/index.js",
    "start": "node src/index.js"
  }
}
```

### –®–∞–≥ 5: –°–æ–∑–¥–∞–Ω–∏–µ .env —Ñ–∞–π–ª–∞

–°–æ–∑–¥–∞–π —Ñ–∞–π–ª `.env` –≤ –ø–∞–ø–∫–µ backend:

```env
PORT=3000
DATABASE_URL="mysql://root:@localhost:3306/task_generator"
JWT_SECRET="—Ç–≤–æ–π-—Å–µ–∫—Ä–µ—Ç–Ω—ã–π-–∫–ª—é—á-–∑–∞–º–µ–Ω–∏-—ç—Ç–æ"
```

### –®–∞–≥ 6: –ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª —Å–µ—Ä–≤–µ—Ä–∞

–°–æ–∑–¥–∞–π —Ñ–∞–π–ª `src/index.js`:

```javascript
const express = require('express')
const cors = require('cors')
require('dotenv').config()

const app = express()
const PORT = process.env.PORT || 3000

// Middleware
app.use(cors({
  origin: 'http://localhost:5173', // –ê–¥—Ä–µ—Å Vue dev —Å–µ—Ä–≤–µ—Ä–∞
  credentials: true
}))
app.use(express.json())

// –¢–µ—Å—Ç–æ–≤—ã–π —Ä–æ—É—Ç
app.get('/api/health', (req, res) => {
  res.json({ status: 'ok', message: '–°–µ—Ä–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç!' })
})

// –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
app.listen(PORT, () => {
  console.log(`–°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω: http://localhost:${PORT}`)
})
```

### –®–∞–≥ 7: –ü—Ä–æ–≤–µ—Ä–∫–∞

```bash
npm run dev
```

–û—Ç–∫—Ä–æ–π –≤ –±—Ä–∞—É–∑–µ—Ä–µ: http://localhost:3000/api/health

–î–æ–ª–∂–µ–Ω —É–≤–∏–¥–µ—Ç—å: `{"status":"ok","message":"–°–µ—Ä–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç!"}`

---

## –£—Ä–æ–∫ 1.2: –°–æ–∑–¥–∞–Ω–∏–µ Frontend ‚úÖ

### –®–∞–≥ 1: –°–æ–∑–¥–∞–Ω–∏–µ Vue –ø—Ä–æ–µ–∫—Ç–∞

```bash
cd ..
npm create vite@latest frontend -- --template vue
cd frontend
npm install
```

### –®–∞–≥ 2: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ TailwindCSS

```bash
npm install -D tailwindcss @tailwindcss/postcss postcss autoprefixer
```

### –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ PostCSS

–°–æ–∑–¥–∞–π —Ñ–∞–π–ª `postcss.config.js`:

```javascript
export default {
  plugins: {
    '@tailwindcss/postcss': {},
    autoprefixer: {}
  }
}
```

### –®–∞–≥ 4: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Tailwind

–°–æ–∑–¥–∞–π —Ñ–∞–π–ª `tailwind.config.js`:

```javascript
export default {
  content: [
    "./index.html",
    "./src/**/*.{vue,js}"
  ],
  theme: {
    extend: {}
  },
  plugins: []
}
```

### –®–∞–≥ 5: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Å—Ç–∏–ª–µ–π

–ó–∞–º–µ–Ω–∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ `src/style.css`:

```css
@import "tailwindcss";
```

### –®–∞–≥ 6: –ü—Ä–æ–≤–µ—Ä–∫–∞

```bash
npm run dev
```

–û—Ç–∫—Ä–æ–π http://localhost:5173 ‚Äî –¥–æ–ª–∂–Ω–∞ –æ—Ç–∫—Ä—ã—Ç—å—Å—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ Vue.

---

## –£—Ä–æ–∫ 1.3: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (Prisma) ‚úÖ

### –®–∞–≥ 1: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Prisma

```bash
cd backend
npx prisma init
```

### –®–∞–≥ 2: –°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–û—Ç–∫—Ä–æ–π —Ñ–∞–π–ª `prisma/schema.prisma` –∏ –∑–∞–º–µ–Ω–∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ:

```prisma
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

// –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  password  String
  name      String
  role      String   @default("manager") // admin, manager, executor
  createdAt DateTime @default(now())

  projects       Project[]
  specifications Specification[]
}

// –ü—Ä–æ–µ–∫—Ç—ã
model Project {
  id          Int      @id @default(autoincrement())
  name        String
  description String?  @db.Text
  createdAt   DateTime @default(now())

  userId         Int
  user           User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  specifications Specification[]
}

// –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞–Ω–∏—è
model Specification {
  id        Int      @id @default(autoincrement())
  title     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  projectId Int
  project   Project @relation(fields: [projectId], references: [id], onDelete: Cascade)

  userId Int
  user   User @relation(fields: [userId], references: [id], onDelete: Cascade)

  sections Section[]
}

// –†–∞–∑–¥–µ–ª—ã –¢–ó
model Section {
  id       Int    @id @default(autoincrement())
  title    String
  position Int    @default(0)

  specificationId Int
  specification   Specification @relation(fields: [specificationId], references: [id], onDelete: Cascade)

  items Item[]
}

// –ü—É–Ω–∫—Ç—ã –¢–ó
model Item {
  id           Int     @id @default(autoincrement())
  content      String  @db.Text
  position     Int     @default(0)
  timeEstimate Int?    // –û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –≤ –º–∏–Ω—É—Ç–∞—Ö

  sectionId Int
  section   Section @relation(fields: [sectionId], references: [id], onDelete: Cascade)

  attachments Attachment[]
}

// –í–ª–æ–∂–µ–Ω–∏—è
model Attachment {
  id        Int      @id @default(autoincrement())
  filename  String
  path      String
  mimetype  String
  size      Int
  createdAt DateTime @default(now())

  itemId Int
  item   Item @relation(fields: [itemId], references: [id], onDelete: Cascade)
}
```

### –®–∞–≥ 3: –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–£–±–µ–¥–∏—Å—å —á—Ç–æ MySQL –∑–∞–ø—É—â–µ–Ω, –∑–∞—Ç–µ–º:

```bash
npx prisma db push
```

–≠—Ç–æ —Å–æ–∑–¥–∞—Å—Ç –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.

### –®–∞–≥ 4: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–ª–∏–µ–Ω—Ç–∞ Prisma

```bash
npm install @prisma/client
```

### –®–∞–≥ 5: –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ë–î

–°–æ–∑–¥–∞–π —Ñ–∞–π–ª `src/db.js`:

```javascript
const { PrismaClient } = require('@prisma/client')

const prisma = new PrismaClient()

module.exports = prisma
```

---

# –ß–ê–°–¢–¨ 2: –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø ‚úÖ

## –£—Ä–æ–∫ 2.1: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (Backend) ‚úÖ

### –®–∞–≥ 1: –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞

–°–æ–∑–¥–∞–π —Ñ–∞–π–ª `src/controllers/authController.js`:

```javascript
const bcrypt = require('bcryptjs')
const jwt = require('jsonwebtoken')
const prisma = require('../db')

// –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
async function register(req, res) {
  try {
    const { email, password, name } = req.body

    // –ü—Ä–æ–≤–µ—Ä–∫–∞: –≤—Å–µ –ø–æ–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω—ã?
    if (!email || !password || !name) {
      return res.status(400).json({
        error: '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è'
      })
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞: email —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç?
    const existingUser = await prisma.user.findUnique({
      where: { email }
    })

    if (existingUser) {
      return res.status(400).json({
        error: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º email —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç'
      })
    }

    // –•–µ—à–∏—Ä—É–µ–º –ø–∞—Ä–æ–ª—å
    const hashedPassword = await bcrypt.hash(password, 10)

    // –°–æ–∑–¥–∞—ë–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    const user = await prisma.user.create({
      data: {
        email,
        password: hashedPassword,
        name
      }
    })

    // –°–æ–∑–¥–∞—ë–º JWT —Ç–æ–∫–µ–Ω
    const token = jwt.sign(
      { userId: user.id, role: user.role },
      process.env.JWT_SECRET,
      { expiresIn: '7d' }
    )

    res.status(201).json({
      message: '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞',
      token,
      user: {
        id: user.id,
        email: user.email,
        name: user.name,
        role: user.role
      }
    })

  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:', error)
    res.status(500).json({ error: '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞' })
  }
}

// –í—Ö–æ–¥
async function login(req, res) {
  try {
    const { email, password } = req.body

    // –ü—Ä–æ–≤–µ—Ä–∫–∞: –≤—Å–µ –ø–æ–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω—ã?
    if (!email || !password) {
      return res.status(400).json({
        error: '–í–≤–µ–¥–∏—Ç–µ email –∏ –ø–∞—Ä–æ–ª—å'
      })
    }

    // –ò—â–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    const user = await prisma.user.findUnique({
      where: { email }
    })

    if (!user) {
      return res.status(401).json({
        error: '–ù–µ–≤–µ—Ä–Ω—ã–π email –∏–ª–∏ –ø–∞—Ä–æ–ª—å'
      })
    }

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–∞—Ä–æ–ª—å
    const isValidPassword = await bcrypt.compare(password, user.password)

    if (!isValidPassword) {
      return res.status(401).json({
        error: '–ù–µ–≤–µ—Ä–Ω—ã–π email –∏–ª–∏ –ø–∞—Ä–æ–ª—å'
      })
    }

    // –°–æ–∑–¥–∞—ë–º —Ç–æ–∫–µ–Ω
    const token = jwt.sign(
      { userId: user.id, role: user.role },
      process.env.JWT_SECRET,
      { expiresIn: '7d' }
    )

    res.json({
      message: '–í—Ö–æ–¥ —É—Å–ø–µ—à–µ–Ω',
      token,
      user: {
        id: user.id,
        email: user.email,
        name: user.name,
        role: user.role
      }
    })

  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞:', error)
    res.status(500).json({ error: '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞' })
  }
}

module.exports = { register, login }
```

### –®–∞–≥ 2: –°–æ–∑–¥–∞–Ω–∏–µ —Ä–æ—É—Ç–∞

–°–æ–∑–¥–∞–π —Ñ–∞–π–ª `src/routes/auth.js`:

```javascript
const express = require('express')
const { register, login } = require('../controllers/authController')

const router = express.Router()

router.post('/register', register)
router.post('/login', login)

module.exports = router
```

### –®–∞–≥ 3: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ä–æ—É—Ç–∞

–û–±–Ω–æ–≤–∏ `src/index.js`:

```javascript
const express = require('express')
const cors = require('cors')
require('dotenv').config()

const authRoutes = require('./routes/auth')

const app = express()
const PORT = process.env.PORT || 3000

app.use(cors({
  origin: 'http://localhost:5173',
  credentials: true
}))
app.use(express.json())

// –†–æ—É—Ç—ã
app.use('/api/auth', authRoutes)

app.get('/api/health', (req, res) => {
  res.json({ status: 'ok' })
})

app.listen(PORT, () => {
  console.log(`–°–µ—Ä–≤–µ—Ä: http://localhost:${PORT}`)
})
```

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ curl –∏–ª–∏ Postman

```bash
# –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
curl -X POST http://localhost:3000/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{"email":"test@test.com","password":"123456","name":"–¢–µ—Å—Ç"}'

# –í—Ö–æ–¥
curl -X POST http://localhost:3000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"test@test.com","password":"123456"}'
```

---

## –£—Ä–æ–∫ 2.2: Middleware –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ ‚úÖ

### –®–∞–≥ 1: –°–æ–∑–¥–∞–Ω–∏–µ middleware

–°–æ–∑–¥–∞–π —Ñ–∞–π–ª `src/middleware/auth.js`:

```javascript
const jwt = require('jsonwebtoken')

function authenticate(req, res, next) {
  // –ü–æ–ª—É—á–∞–µ–º —Ç–æ–∫–µ–Ω –∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞
  const authHeader = req.headers.authorization

  if (!authHeader || !authHeader.startsWith('Bearer ')) {
    return res.status(401).json({ error: '–¢–æ–∫–µ–Ω –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω' })
  }

  const token = authHeader.split(' ')[1]

  try {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–∫–µ–Ω
    const decoded = jwt.verify(token, process.env.JWT_SECRET)

    // –î–æ–±–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –∑–∞–ø—Ä–æ—Å
    req.userId = decoded.userId
    req.userRole = decoded.role

    next()
  } catch (error) {
    return res.status(401).json({ error: '–ù–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–π —Ç–æ–∫–µ–Ω' })
  }
}

// –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–∏
function requireRole(...roles) {
  return (req, res, next) => {
    if (!roles.includes(req.userRole)) {
      return res.status(403).json({ error: '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤' })
    }
    next()
  }
}

module.exports = { authenticate, requireRole }
```

### –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:

```javascript
const { authenticate, requireRole } = require('./middleware/auth')

// –ó–∞—â–∏—â—ë–Ω–Ω—ã–π —Ä–æ—É—Ç (–Ω—É–∂–µ–Ω —Ç–æ–∫–µ–Ω)
router.get('/profile', authenticate, (req, res) => {
  // req.userId –¥–æ—Å—Ç—É–ø–µ–Ω –∑–¥–µ—Å—å
})

// –¢–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤
router.delete('/users/:id', authenticate, requireRole('admin'), (req, res) => {
  // –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω –º–æ–∂–µ—Ç —É–¥–∞–ª—è—Ç—å
})
```

---

## –£—Ä–æ–∫ 2.3: –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –Ω–∞ Frontend ‚úÖ

### –®–∞–≥ 1: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ axios

```bash
cd frontend
npm install axios
```

### –®–∞–≥ 2: –°–æ–∑–¥–∞–Ω–∏–µ API –∫–ª–∏–µ–Ω—Ç–∞

–°–æ–∑–¥–∞–π —Ñ–∞–π–ª `src/api/index.js`:

```javascript
import axios from 'axios'

const api = axios.create({
  baseURL: 'http://localhost:3000/api',
  headers: {
    'Content-Type': 'application/json'
  }
})

// –î–æ–±–∞–≤–ª—è–µ–º —Ç–æ–∫–µ–Ω –∫ –∫–∞–∂–¥–æ–º—É –∑–∞–ø—Ä–æ—Å—É
api.interceptors.request.use(config => {
  const token = localStorage.getItem('token')
  if (token) {
    config.headers.Authorization = `Bearer ${token}`
  }
  return config
})

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
api.interceptors.response.use(
  response => response,
  error => {
    if (error.response?.status === 401) {
      // –¢–æ–∫–µ–Ω –∏—Å—Ç—ë–∫ - —Ä–∞–∑–ª–æ–≥–∏–Ω–∏–≤–∞–µ–º
      localStorage.removeItem('token')
      localStorage.removeItem('user')
      window.location.href = '/login'
    }
    return Promise.reject(error)
  }
)

export default api
```

### –®–∞–≥ 3: –°–æ–∑–¥–∞–Ω–∏–µ store –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

–°–æ–∑–¥–∞–π —Ñ–∞–π–ª `src/stores/auth.js`:

```javascript
import { reactive } from 'vue'
import api from '../api'

export const authStore = reactive({
  user: JSON.parse(localStorage.getItem('user')) || null,
  token: localStorage.getItem('token') || null,

  get isAuthenticated() {
    return !!this.token
  },

  async register(email, password, name) {
    const response = await api.post('/auth/register', {
      email, password, name
    })

    this.setAuth(response.data.token, response.data.user)
    return response.data
  },

  async login(email, password) {
    const response = await api.post('/auth/login', {
      email, password
    })

    this.setAuth(response.data.token, response.data.user)
    return response.data
  },

  setAuth(token, user) {
    this.token = token
    this.user = user
    localStorage.setItem('token', token)
    localStorage.setItem('user', JSON.stringify(user))
  },

  logout() {
    this.token = null
    this.user = null
    localStorage.removeItem('token')
    localStorage.removeItem('user')
  }
})
```

### –®–∞–≥ 4: –ö–æ–º–ø–æ–Ω–µ–Ω—Ç —Ñ–æ—Ä–º—ã –≤—Ö–æ–¥–∞

–°–æ–∑–¥–∞–π —Ñ–∞–π–ª `src/components/LoginForm.vue`:

```vue
<script setup>
import { ref } from 'vue'
import { authStore } from '../stores/auth'

const email = ref('')
const password = ref('')
const error = ref('')
const loading = ref(false)

const emit = defineEmits(['success'])

async function handleSubmit() {
  error.value = ''
  loading.value = true

  try {
    await authStore.login(email.value, password.value)
    emit('success')
  } catch (e) {
    error.value = e.response?.data?.error || '–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞'
  } finally {
    loading.value = false
  }
}
</script>

<template>
  <form @submit.prevent="handleSubmit" class="space-y-4">
    <h2 class="text-2xl font-bold">–í—Ö–æ–¥</h2>

    <div v-if="error" class="bg-red-100 text-red-700 p-3 rounded">
      {{ error }}
    </div>

    <div>
      <label class="block text-sm font-medium mb-1">Email</label>
      <input
        v-model="email"
        type="email"
        required
        class="w-full border rounded px-3 py-2"
      />
    </div>

    <div>
      <label class="block text-sm font-medium mb-1">–ü–∞—Ä–æ–ª—å</label>
      <input
        v-model="password"
        type="password"
        required
        class="w-full border rounded px-3 py-2"
      />
    </div>

    <button
      type="submit"
      :disabled="loading"
      class="w-full bg-blue-500 text-white py-2 rounded hover:bg-blue-600 disabled:opacity-50"
    >
      {{ loading ? '–í—Ö–æ–¥...' : '–í–æ–π—Ç–∏' }}
    </button>
  </form>
</template>
```

---

# –ß–ê–°–¢–¨ 3: –ì–û–õ–û–°–û–í–û–ô –í–í–û–î ‚úÖ

## –£—Ä–æ–∫ 3.1: Web Speech API ‚úÖ

### –¢–µ–æ—Ä–∏—è

Web Speech API ‚Äî –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –≤ –±—Ä–∞—É–∑–µ—Ä API –¥–ª—è —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è —Ä–µ—á–∏.

**–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**
- –†–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –≤ Chrome –∏ Edge
- –¢—Ä–µ–±—É–µ—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç (–∞—É–¥–∏–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ã Google)
- –¢—Ä–µ–±—É–µ—Ç HTTPS –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ (–Ω–∞ localhost —Ä–∞–±–æ—Ç–∞–µ—Ç)

### –®–∞–≥ 1: –°–æ–∑–¥–∞–Ω–∏–µ composable

–°–æ–∑–¥–∞–π —Ñ–∞–π–ª `src/composables/useSpeechRecognition.js`:

```javascript
import { ref, onUnmounted } from 'vue'

export function useSpeechRecognition() {
  const isListening = ref(false)
  const transcript = ref('')
  const interimTranscript = ref('')
  const error = ref(null)

  // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É
  const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition
  const isSupported = !!SpeechRecognition

  let recognition = null

  if (isSupported) {
    recognition = new SpeechRecognition()

    // –ù–∞—Å—Ç—Ä–æ–π–∫–∏
    recognition.continuous = true        // –ù–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ
    recognition.interimResults = true    // –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
    recognition.lang = 'ru-RU'           // –†—É—Å—Å–∫–∏–π —è–∑—ã–∫

    // –ù–∞—á–∞–ª–æ –∑–∞–ø–∏—Å–∏
    recognition.onstart = () => {
      isListening.value = true
      error.value = null
    }

    // –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è
    recognition.onresult = (event) => {
      let interim = ''
      let final = ''

      for (let i = event.resultIndex; i < event.results.length; i++) {
        const result = event.results[i]
        if (result.isFinal) {
          final += result[0].transcript + ' '
        } else {
          interim += result[0].transcript
        }
      }

      if (final) {
        transcript.value += final
      }
      interimTranscript.value = interim
    }

    // –û—à–∏–±–∫–∏
    recognition.onerror = (event) => {
      const errors = {
        'no-speech': '–†–µ—á—å –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∞',
        'audio-capture': '–ú–∏–∫—Ä–æ—Ñ–æ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω',
        'not-allowed': '–î–æ—Å—Ç—É–ø –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É –∑–∞–ø—Ä–µ—â—ë–Ω'
      }
      error.value = errors[event.error] || event.error
      isListening.value = false
    }

    // –ö–æ–Ω–µ—Ü –∑–∞–ø–∏—Å–∏
    recognition.onend = () => {
      isListening.value = false
    }
  }

  // –ú–µ—Ç–æ–¥—ã
  function start() {
    if (!recognition) {
      error.value = '–ë—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ä–µ—á–∏'
      return
    }
    error.value = null
    recognition.start()
  }

  function stop() {
    if (recognition && isListening.value) {
      recognition.stop()
    }
  }

  function clear() {
    transcript.value = ''
    interimTranscript.value = ''
  }

  // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–∏ —É–Ω–∏—á—Ç–æ–∂–µ–Ω–∏–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
  onUnmounted(() => {
    if (recognition) {
      recognition.abort()
    }
  })

  return {
    isSupported,
    isListening,
    transcript,
    interimTranscript,
    error,
    start,
    stop,
    clear
  }
}
```

### –®–∞–≥ 2: –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –∑–∞–ø–∏—Å–∏

–°–æ–∑–¥–∞–π —Ñ–∞–π–ª `src/components/SpeechRecorder.vue`:

```vue
<script setup>
import { useSpeechRecognition } from '../composables/useSpeechRecognition'

const {
  isSupported,
  isListening,
  transcript,
  interimTranscript,
  error,
  start,
  stop,
  clear
} = useSpeechRecognition()

function toggle() {
  if (isListening.value) {
    stop()
  } else {
    start()
  }
}
</script>

<template>
  <div class="p-6 max-w-2xl mx-auto">
    <h1 class="text-2xl font-bold mb-6">–ì–æ–ª–æ—Å–æ–≤–æ–π –≤–≤–æ–¥</h1>

    <!-- –ë—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç -->
    <div v-if="!isSupported" class="bg-red-100 text-red-700 p-4 rounded mb-4">
      –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ä–µ—á–∏. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Chrome –∏–ª–∏ Edge.
    </div>

    <!-- –û—à–∏–±–∫–∞ -->
    <div v-if="error" class="bg-yellow-100 text-yellow-700 p-4 rounded mb-4">
      {{ error }}
    </div>

    <!-- –ö–Ω–æ–ø–∫–∏ -->
    <div class="flex gap-4 mb-6">
      <button
        @click="toggle"
        :disabled="!isSupported"
        :class="[
          'px-6 py-3 rounded font-medium',
          isListening
            ? 'bg-red-500 hover:bg-red-600 text-white'
            : 'bg-blue-500 hover:bg-blue-600 text-white',
          !isSupported && 'opacity-50 cursor-not-allowed'
        ]"
      >
        {{ isListening ? '‚èπ –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å' : 'üé§ –ù–∞—á–∞—Ç—å –∑–∞–ø–∏—Å—å' }}
      </button>

      <button
        v-if="transcript"
        @click="clear"
        class="px-6 py-3 rounded bg-gray-200 hover:bg-gray-300"
      >
        –û—á–∏—Å—Ç–∏—Ç—å
      </button>
    </div>

    <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–ø–∏—Å–∏ -->
    <div v-if="isListening" class="flex items-center gap-2 text-red-500 mb-4">
      <span class="w-3 h-3 bg-red-500 rounded-full animate-pulse"></span>
      –ó–∞–ø–∏—Å—å...
    </div>

    <!-- –¢–µ–∫—Å—Ç -->
    <div class="border rounded p-4 min-h-[200px] bg-white">
      <template v-if="transcript || interimTranscript">
        {{ transcript }}<span class="text-gray-400">{{ interimTranscript }}</span>
      </template>
      <span v-else class="text-gray-400">
        –ù–∞–∂–º–∏—Ç–µ "–ù–∞—á–∞—Ç—å –∑–∞–ø–∏—Å—å" –∏ –≥–æ–≤–æ—Ä–∏—Ç–µ...
      </span>
    </div>

    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
    <div v-if="transcript" class="mt-4 text-sm text-gray-500">
      –°–∏–º–≤–æ–ª–æ–≤: {{ transcript.length }}
    </div>
  </div>
</template>
```

### –®–∞–≥ 3: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

–í `App.vue`:

```vue
<script setup>
import SpeechRecorder from './components/SpeechRecorder.vue'
</script>

<template>
  <div class="min-h-screen bg-gray-100">
    <SpeechRecorder />
  </div>
</template>
```

---

# –ß–ê–°–¢–¨ 4: CRUD –ü–†–û–ï–ö–¢–û–í ‚úÖ

## –£—Ä–æ–∫ 4.1: API –¥–ª—è –ø—Ä–æ–µ–∫—Ç–æ–≤ (Backend) ‚úÖ

### –®–∞–≥ 1: –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä

–°–æ–∑–¥–∞–π —Ñ–∞–π–ª `src/controllers/projectController.js`:

```javascript
const prisma = require('../db')

// –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –ø—Ä–æ–µ–∫—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
async function getAll(req, res) {
  try {
    const projects = await prisma.project.findMany({
      where: { userId: req.userId },
      orderBy: { createdAt: 'desc' }
    })
    res.json(projects)
  } catch (error) {
    res.status(500).json({ error: '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞' })
  }
}

// –ü–æ–ª—É—á–∏—Ç—å –æ–¥–∏–Ω –ø—Ä–æ–µ–∫—Ç
async function getOne(req, res) {
  try {
    const project = await prisma.project.findFirst({
      where: {
        id: parseInt(req.params.id),
        userId: req.userId
      }
    })

    if (!project) {
      return res.status(404).json({ error: '–ü—Ä–æ–µ–∫—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω' })
    }

    res.json(project)
  } catch (error) {
    res.status(500).json({ error: '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞' })
  }
}

// –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–µ–∫—Ç
async function create(req, res) {
  try {
    const { name, description } = req.body

    if (!name) {
      return res.status(400).json({ error: '–ù–∞–∑–≤–∞–Ω–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ' })
    }

    const project = await prisma.project.create({
      data: {
        name,
        description,
        userId: req.userId
      }
    })

    res.status(201).json(project)
  } catch (error) {
    res.status(500).json({ error: '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞' })
  }
}

// –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ–µ–∫—Ç
async function update(req, res) {
  try {
    const { name, description } = req.body

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –ø—Ä–æ–µ–∫—Ç –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
    const existing = await prisma.project.findFirst({
      where: {
        id: parseInt(req.params.id),
        userId: req.userId
      }
    })

    if (!existing) {
      return res.status(404).json({ error: '–ü—Ä–æ–µ–∫—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω' })
    }

    const project = await prisma.project.update({
      where: { id: parseInt(req.params.id) },
      data: { name, description }
    })

    res.json(project)
  } catch (error) {
    res.status(500).json({ error: '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞' })
  }
}

// –£–¥–∞–ª–∏—Ç—å –ø—Ä–æ–µ–∫—Ç
async function remove(req, res) {
  try {
    const existing = await prisma.project.findFirst({
      where: {
        id: parseInt(req.params.id),
        userId: req.userId
      }
    })

    if (!existing) {
      return res.status(404).json({ error: '–ü—Ä–æ–µ–∫—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω' })
    }

    await prisma.project.delete({
      where: { id: parseInt(req.params.id) }
    })

    res.json({ message: '–ü—Ä–æ–µ–∫—Ç —É–¥–∞–ª—ë–Ω' })
  } catch (error) {
    res.status(500).json({ error: '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞' })
  }
}

module.exports = { getAll, getOne, create, update, remove }
```

### –®–∞–≥ 2: –†–æ—É—Ç—ã

–°–æ–∑–¥–∞–π —Ñ–∞–π–ª `src/routes/projects.js`:

```javascript
const express = require('express')
const { authenticate } = require('../middleware/auth')
const {
  getAll,
  getOne,
  create,
  update,
  remove
} = require('../controllers/projectController')

const router = express.Router()

// –í—Å–µ —Ä–æ—É—Ç—ã –∑–∞—â–∏—â–µ–Ω—ã
router.use(authenticate)

router.get('/', getAll)
router.get('/:id', getOne)
router.post('/', create)
router.put('/:id', update)
router.delete('/:id', remove)

module.exports = router
```

### –®–∞–≥ 3: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –≤ index.js

```javascript
const projectRoutes = require('./routes/projects')

// –ü–æ—Å–ª–µ app.use('/api/auth', authRoutes)
app.use('/api/projects', projectRoutes)
```

---

# –ß–ê–°–¢–¨ 5: CRUD –¢–ï–•–ù–ò–ß–ï–°–ö–ò–• –ó–ê–î–ê–ù–ò–ô ‚úÖ

## –£—Ä–æ–∫ 5.1: API –¥–ª—è –¢–ó ‚úÖ

–ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –ø—Ä–æ–µ–∫—Ç–∞–º, –Ω–æ —Å–æ –≤–ª–æ–∂–µ–Ω–Ω—ã–º–∏ —Å–µ–∫—Ü–∏—è–º–∏ –∏ –ø—É–Ω–∫—Ç–∞–º–∏.

–°–æ–∑–¥–∞–π `src/controllers/specificationController.js`:

```javascript
const prisma = require('../db')

// –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –¢–ó –ø—Ä–æ–µ–∫—Ç–∞
async function getAll(req, res) {
  try {
    const { projectId } = req.query

    const specs = await prisma.specification.findMany({
      where: {
        userId: req.userId,
        ...(projectId && { projectId: parseInt(projectId) })
      },
      include: {
        project: true,
        sections: {
          orderBy: { position: 'asc' },
          include: {
            items: {
              orderBy: { position: 'asc' }
            }
          }
        }
      },
      orderBy: { createdAt: 'desc' }
    })

    res.json(specs)
  } catch (error) {
    res.status(500).json({ error: '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞' })
  }
}

// –°–æ–∑–¥–∞—Ç—å –¢–ó
async function create(req, res) {
  try {
    const { title, projectId, sections } = req.body

    if (!title || !projectId) {
      return res.status(400).json({
        error: '–ù–∞–∑–≤–∞–Ω–∏–µ –∏ –ø—Ä–æ–µ–∫—Ç –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã'
      })
    }

    const spec = await prisma.specification.create({
      data: {
        title,
        projectId: parseInt(projectId),
        userId: req.userId,
        sections: sections ? {
          create: sections.map((section, idx) => ({
            title: section.title,
            position: idx,
            items: section.items ? {
              create: section.items.map((item, itemIdx) => ({
                content: item.content,
                position: itemIdx,
                timeEstimate: item.timeEstimate
              }))
            } : undefined
          }))
        } : undefined
      },
      include: {
        sections: {
          include: { items: true }
        }
      }
    })

    res.status(201).json(spec)
  } catch (error) {
    console.error(error)
    res.status(500).json({ error: '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞' })
  }
}

module.exports = { getAll, create }
```

---

# –ß–ê–°–¢–¨ 6: –ó–ê–ì–û–¢–û–í–ö–ê –î–õ–Ø AI ‚úÖ

## –£—Ä–æ–∫ 6.1: –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å AI —Å–µ—Ä–≤–∏—Å–∞ ‚úÖ

–°–æ–∑–¥–∞–π —Ñ–∞–π–ª `src/services/aiService.js`:

```javascript
// –ó–∞–≥–ª—É—à–∫–∞ –¥–ª—è AI —Å–µ—Ä–≤–∏—Å–∞
// –ü–æ–∑–∂–µ –∑–¥–µ—Å—å –±—É–¥–µ—Ç —Ä–µ–∞–ª—å–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Ollama (–ß–∞—Å—Ç—å 12)

async function structureText(text) {
  // –ü–æ–∫–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –ø—Ä–æ—Å—Ç—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É
  // –í –±—É–¥—É—â–µ–º –∑–¥–µ—Å—å –±—É–¥–µ—Ç –≤—ã–∑–æ–≤ AI API

  const lines = text.split(/[.!?]/).filter(line => line.trim())

  return {
    sections: [
      {
        title: '–û—Å–Ω–æ–≤–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è',
        items: lines.map(line => ({
          content: line.trim(),
          timeEstimate: null
        }))
      }
    ]
  }
}

module.exports = { structureText }
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:

```javascript
const { structureText } = require('../services/aiService')

// –í –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ:
router.post('/structure', authenticate, async (req, res) => {
  const { text } = req.body
  const structured = await structureText(text)
  res.json(structured)
})
```

---

# –ß–ê–°–¢–¨ 7: –≠–ö–°–ü–û–†–¢ –í PDF ‚¨ú

## –£—Ä–æ–∫ 7.1: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è PDF ‚¨ú

### –®–∞–≥ 1: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏

```bash
npm install puppeteer
```

### –®–∞–≥ 2: –°–µ—Ä–≤–∏—Å PDF

–°–æ–∑–¥–∞–π —Ñ–∞–π–ª `src/services/pdfService.js`:

```javascript
const puppeteer = require('puppeteer')

async function generatePdf(specification) {
  const browser = await puppeteer.launch()
  const page = await browser.newPage()

  // HTML —à–∞–±–ª–æ–Ω
  const html = `
    <!DOCTYPE html>
    <html>
    <head>
      <meta charset="utf-8">
      <style>
        body { font-family: Arial, sans-serif; padding: 40px; }
        h1 { color: #333; }
        h2 { color: #666; margin-top: 30px; }
        .item { margin: 10px 0; padding: 10px; background: #f5f5f5; }
        .time { color: #888; font-size: 12px; }
      </style>
    </head>
    <body>
      <h1>${specification.title}</h1>
      ${specification.sections.map(section => `
        <h2>${section.title}</h2>
        ${section.items.map(item => `
          <div class="item">
            ${item.content}
            ${item.timeEstimate ? `<div class="time">–û—Ü–µ–Ω–∫–∞: ${item.timeEstimate} –º–∏–Ω</div>` : ''}
          </div>
        `).join('')}
      `).join('')}
    </body>
    </html>
  `

  await page.setContent(html)
  const pdf = await page.pdf({ format: 'A4' })

  await browser.close()

  return pdf
}

module.exports = { generatePdf }
```

---

# –ß–ê–°–¢–¨ 8: –ù–ê–î–Å–ñ–ù–ê–Ø –¢–†–ê–ù–°–ö–†–ò–ë–ê–¶–ò–Ø ‚úÖ

## –ü—Ä–æ–±–ª–µ–º–∞ Web Speech API

Web Speech API –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –ø—Ä–∏:
- –î–ª–∏–Ω–Ω—ã—Ö –ø–∞—É–∑–∞—Ö (>5 —Å–µ–∫ –±–µ–∑ —Ä–µ—á–∏)
- –î–ª–∏—Ç–µ–ª—å–Ω–æ–π –∑–∞–ø–∏—Å–∏ (–±—Ä–∞—É–∑–µ—Ä –æ–±—Ä—ã–≤–∞–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ)
- –ü–æ—Ç–µ—Ä–µ —Å–µ—Ç–∏ (–∞—É–¥–∏–æ –∏–¥—ë—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ã Google)

–≠—Ç–æ –¥–µ–ª–∞–µ—Ç –µ–≥–æ –Ω–µ–ø—Ä–∏–≥–æ–¥–Ω—ã–º –¥–ª—è –∑–∞–ø–∏—Å–∏ –¥–ª–∏–Ω–Ω—ã—Ö –¢–ó. –†–µ—à–µ–Ω–∏–µ ‚Äî –∞–≤—Ç–æ-–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫: –±–µ—Å–ø–ª–∞—Ç–Ω–æ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –±—Ä–∞—É–∑–µ—Ä–µ.

---

## –£—Ä–æ–∫ 8.1: –ê–≤—Ç–æ-–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ Web Speech API ‚úÖ

### –¢–µ–æ—Ä–∏—è

–ò–¥–µ—è –ø—Ä–æ—Å—Ç–∞—è: –∫–æ–≥–¥–∞ `onend` —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç, –∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å **–Ω–µ –Ω–∞–∂–∏–º–∞–ª "–°—Ç–æ–ø"** ‚Äî –º—ã –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º –∑–∞–ø–∏—Å—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–∞–∂–µ –Ω–µ –∑–∞–º–µ—Ç–∏—Ç –æ—Å—Ç–∞–Ω–æ–≤–∫—É.

### –®–∞–≥ 1: –û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π composable

–ó–∞–º–µ–Ω–∏ —Ñ–∞–π–ª `src/composables/useSpeechRecognition.js`:

```javascript
import { ref, onUnmounted } from 'vue'

export function useSpeechRecognition() {
  const isListening = ref(false)
  const transcript = ref('')
  const interimTranscript = ref('')
  const error = ref(null)

  // ========================================
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É –±—Ä–∞—É–∑–µ—Ä–∞
  // SpeechRecognition ‚Äî —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ API
  // webkitSpeechRecognition ‚Äî –¥–ª—è Chrome
  // ========================================
  const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition
  const isSupported = !!SpeechRecognition

  let recognition = null

  // –§–ª–∞–≥: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–∞–º –æ—Å—Ç–∞–Ω–æ–≤–∏–ª –∑–∞–ø–∏—Å—å?
  // –ù—É–∂–µ–Ω —á—Ç–æ–±—ã –æ—Ç–ª–∏—á–∏—Ç—å "–±—Ä–∞—É–∑–µ—Ä –æ–±–æ—Ä–≤–∞–ª" –æ—Ç "–Ω–∞–∂–∞–ª–∏ –°—Ç–æ–ø"
  let manualStop = false

  if (isSupported) {
    recognition = new SpeechRecognition()

    // ========================================
    // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è
    // ========================================
    recognition.continuous = true       // –ù–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å—Å—è –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–π —Ñ—Ä–∞–∑—ã
    recognition.interimResults = true   // –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ç–µ–∫—Å—Ç –ø–æ–∫–∞ –≥–æ–≤–æ—Ä—è—Ç
    recognition.lang = 'ru-RU'         // –†—É—Å—Å–∫–∏–π —è–∑—ã–∫
    recognition.maxAlternatives = 1     // –û–¥–∏–Ω –≤–∞—Ä–∏–∞–Ω—Ç —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è (–±—ã—Å—Ç—Ä–µ–µ)

    // ========================================
    // –°–æ–±—ã—Ç–∏–µ: –∑–∞–ø–∏—Å—å –Ω–∞—á–∞–ª–∞—Å—å
    // ========================================
    recognition.onstart = () => {
      isListening.value = true
      error.value = null
    }

    // ========================================
    // –°–æ–±—ã—Ç–∏–µ: –ø–æ–ª—É—á–µ–Ω—ã —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è
    //
    // event.results ‚Äî –º–∞—Å—Å–∏–≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
    // event.resultIndex ‚Äî –∏–Ω–¥–µ–∫—Å –ø–µ—Ä–≤–æ–≥–æ –Ω–æ–≤–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
    // result.isFinal ‚Äî true –µ—Å–ª–∏ —Ñ—Ä–∞–∑–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–∞ –æ–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω–æ
    // result[0].transcript ‚Äî —Ç–µ–∫—Å—Ç —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è
    // ========================================
    recognition.onresult = (event) => {
      let interim = ''
      let final = ''

      for (let i = event.resultIndex; i < event.results.length; i++) {
        const result = event.results[i]
        if (result.isFinal) {
          final += result[0].transcript + ' '
        } else {
          interim += result[0].transcript
        }
      }

      if (final) {
        transcript.value += final
      }
      interimTranscript.value = interim
    }

    // ========================================
    // –°–æ–±—ã—Ç–∏–µ: –æ—à–∏–±–∫–∞
    //
    // –¢–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏:
    // - no-speech: –º–æ–ª—á–∞–Ω–∏–µ –¥–æ–ª—å—à–µ ~5 —Å–µ–∫
    // - audio-capture: –Ω–µ—Ç –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞
    // - not-allowed: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ø—Ä–µ—Ç–∏–ª –¥–æ—Å—Ç—É–ø
    // - network: –ø—Ä–æ–±–ª–µ–º—ã —Å —Å–µ—Ç—å—é
    // ========================================
    recognition.onerror = (event) => {
      const errors = {
        'no-speech': '–†–µ—á—å –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∞',
        'audio-capture': '–ú–∏–∫—Ä–æ—Ñ–æ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω',
        'not-allowed': '–î–æ—Å—Ç—É–ø –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É –∑–∞–ø—Ä–µ—â—ë–Ω',
        'network': '–û—à–∏–±–∫–∞ —Å–µ—Ç–∏'
      }

      // no-speech ‚Äî –Ω–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞, –∞–≤—Ç–æ-–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–ø—Ä–∞–≤–∏—Ç—Å—è
      if (event.error === 'no-speech') {
        return
      }

      error.value = errors[event.error] || event.error
      isListening.value = false
    }

    // ========================================
    // –°–æ–±—ã—Ç–∏–µ: –∑–∞–ø–∏—Å—å –æ—Å—Ç–∞–Ω–æ–≤–∏–ª–∞—Å—å
    //
    // –ö–õ–Æ–ß–ï–í–û–ô –ú–û–ú–ï–ù–¢: –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ù–ï –Ω–∞–∂–∏–º–∞–ª –°—Ç–æ–ø,
    // –∑–Ω–∞—á–∏—Ç –±—Ä–∞—É–∑–µ—Ä —Å–∞–º –æ–±–æ—Ä–≤–∞–ª –∑–∞–ø–∏—Å—å ‚Äî –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º!
    // ========================================
    recognition.onend = () => {
      if (!manualStop && isListening.value) {
        // –ë—Ä–∞—É–∑–µ—Ä –æ–±–æ—Ä–≤–∞–ª ‚Äî –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º —á–µ—Ä–µ–∑ 100–º—Å
        // –ó–∞–¥–µ—Ä–∂–∫–∞ –Ω—É–∂–Ω–∞ —á—Ç–æ–±—ã –±—Ä–∞—É–∑–µ—Ä —É—Å–ø–µ–ª –æ—Å–≤–æ–±–æ–¥–∏—Ç—å —Ä–µ—Å—É—Ä—Å—ã
        setTimeout(() => {
          try {
            recognition.start()
          } catch (e) {
            isListening.value = false
          }
        }, 100)
      } else {
        isListening.value = false
      }
    }
  }

  // ========================================
  // –ü—É–±–ª–∏—á–Ω—ã–µ –º–µ—Ç–æ–¥—ã
  // ========================================

  function start() {
    if (!recognition) {
      error.value = '–ë—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ä–µ—á–∏'
      return
    }
    manualStop = false  // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥
    error.value = null
    transcript.value = ''
    interimTranscript.value = ''
    recognition.start()
  }

  function stop() {
    if (recognition && isListening.value) {
      manualStop = true  // –°—Ç–∞–≤–∏–º —Ñ–ª–∞–≥ ‚Äî –Ω–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—Ç—å!
      recognition.stop()
    }
  }

  function clear() {
    transcript.value = ''
    interimTranscript.value = ''
  }

  // –û—á–∏—Å—Ç–∫–∞ –ø—Ä–∏ —É–Ω–∏—á—Ç–æ–∂–µ–Ω–∏–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
  onUnmounted(() => {
    if (recognition) {
      manualStop = true
      recognition.abort()
    }
  })

  return {
    isSupported,
    isListening,
    transcript,
    interimTranscript,
    error,
    start,
    stop,
    clear
  }
}
```

**–ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å:**
- –î–æ–±–∞–≤–ª–µ–Ω —Ñ–ª–∞–≥ `manualStop` ‚Äî –æ—Ç–ª–∏—á–∞–µ—Ç "–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∞–ª –°—Ç–æ–ø" –æ—Ç "–±—Ä–∞—É–∑–µ—Ä –æ–±–æ—Ä–≤–∞–ª"
- –í `onend` ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ 100–º—Å –µ—Å–ª–∏ –∑–∞–ø–∏—Å—å –±—ã–ª–∞ –ø—Ä–µ—Ä–≤–∞–Ω–∞ –±—Ä–∞—É–∑–µ—Ä–æ–º
- –û—à–∏–±–∫–∞ `no-speech` –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è (–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–∞—è, –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–ø—Ä–∞–≤–∏—Ç—Å—è)
- `start()` –æ—á–∏—â–∞–µ—Ç –ø—Ä–µ–¥—ã–¥—É—â–∏–π —Ç–µ–∫—Å—Ç
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –±–∞–≥: `window.SpeechRecognition` –≤–º–µ—Å—Ç–æ `window.SpeechRecognitionResult`

---

# –ß–ê–°–¢–¨ 9: VUE ROUTER –ò –ù–ê–í–ò–ì–ê–¶–ò–Ø ‚úÖ

## –£—Ä–æ–∫ 9.1: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ ‚úÖ

### –¢–µ–æ—Ä–∏—è

–°–µ–π—á–∞—Å –≤—Å—ë –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ ‚Äî –æ–¥–Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞. Vue Router –ø–æ–∑–≤–æ–ª—è–µ—Ç:
- –°–æ–∑–¥–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å—Ç—Ä–∞–Ω–∏—Ü (login, dashboard, projects)
- –ó–∞—â–∏—Ç–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—ã –æ—Ç –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ü–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –º–µ–∂–¥—É —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏ –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ (SPA)

### –®–∞–≥ 1: –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
cd frontend
npm install vue-router@4
```

### –®–∞–≥ 2: –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü

–°–æ–∑–¥–∞–π –ø–∞–ø–∫—É `src/pages/` –∏ —Ñ–∞–π–ª—ã:

**`src/pages/LoginPage.vue`** ‚Äî —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –≤—Ö–æ–¥–∞:

```vue
<script setup>
import { useRouter } from 'vue-router'
import LoginForm from '../components/LoginForm.vue'

const router = useRouter()

// –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—Ö–æ–¥–∞ ‚Äî –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –¥–∞—à–±–æ—Ä–¥
function onSuccess() {
  router.push('/dashboard')
}
</script>

<template>
  <div class="min-h-screen flex items-center justify-center bg-gray-100">
    <div class="bg-white p-8 rounded-lg shadow-md w-full max-w-md">
      <LoginForm @success="onSuccess" />

      <p class="mt-4 text-center text-sm text-gray-500">
        –ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞?
        <router-link to="/register" class="text-blue-500 hover:underline">
          –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è
        </router-link>
      </p>
    </div>
  </div>
</template>
```

**`src/pages/RegisterPage.vue`** ‚Äî —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:

```vue
<script setup>
import { ref } from 'vue'
import { useRouter } from 'vue-router'
import { authStore } from '../stores/auth'

const router = useRouter()

const name = ref('')
const email = ref('')
const password = ref('')
const passwordConfirm = ref('')
const error = ref('')
const loading = ref(false)

async function handleSubmit() {
  error.value = ''

  if (password.value !== passwordConfirm.value) {
    error.value = '–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç'
    return
  }

  if (password.value.length < 6) {
    error.value = '–ü–∞—Ä–æ–ª—å –º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤'
    return
  }

  loading.value = true
  try {
    await authStore.register(email.value, password.value, name.value)
    router.push('/dashboard')
  } catch (e) {
    error.value = e.response?.data?.error || '–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏'
  } finally {
    loading.value = false
  }
}
</script>

<template>
  <div class="min-h-screen flex items-center justify-center bg-gray-100">
    <div class="bg-white p-8 rounded-lg shadow-md w-full max-w-md">
      <form @submit.prevent="handleSubmit" class="space-y-4">
        <h2 class="text-2xl font-bold">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>

        <div v-if="error" class="bg-red-100 text-red-700 p-3 rounded">
          {{ error }}
        </div>

        <div>
          <label class="block text-sm font-medium mb-1">–ò–º—è</label>
          <input v-model="name" type="text" required
            class="w-full border rounded px-3 py-2" />
        </div>

        <div>
          <label class="block text-sm font-medium mb-1">Email</label>
          <input v-model="email" type="email" required
            class="w-full border rounded px-3 py-2" />
        </div>

        <div>
          <label class="block text-sm font-medium mb-1">–ü–∞—Ä–æ–ª—å</label>
          <input v-model="password" type="password" required
            class="w-full border rounded px-3 py-2" />
        </div>

        <div>
          <label class="block text-sm font-medium mb-1">–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å</label>
          <input v-model="passwordConfirm" type="password" required
            class="w-full border rounded px-3 py-2" />
        </div>

        <button type="submit" :disabled="loading"
          class="w-full bg-blue-500 text-white py-2 rounded hover:bg-blue-600 disabled:opacity-50">
          {{ loading ? '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è...' : '–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è' }}
        </button>
      </form>

      <p class="mt-4 text-center text-sm text-gray-500">
        –£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç?
        <router-link to="/login" class="text-blue-500 hover:underline">
          –í–æ–π—Ç–∏
        </router-link>
      </p>
    </div>
  </div>
</template>
```

**`src/pages/DashboardPage.vue`** ‚Äî –¥–∞—à–±–æ—Ä–¥:

```vue
<script setup>
import { authStore } from '../stores/auth'
</script>

<template>
  <div>
    <h1 class="text-2xl font-bold mb-6">
      –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {{ authStore.user?.name }}!
    </h1>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
      <router-link to="/projects"
        class="bg-white p-6 rounded-lg shadow hover:shadow-md transition-shadow">
        <h2 class="text-lg font-semibold mb-2">–ü—Ä–æ–µ–∫—Ç—ã</h2>
        <p class="text-gray-500 text-sm">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞–º–∏ –∏ –∫–ª–∏–µ–Ω—Ç–∞–º–∏</p>
      </router-link>

      <router-link to="/record"
        class="bg-white p-6 rounded-lg shadow hover:shadow-md transition-shadow">
        <h2 class="text-lg font-semibold mb-2">–ó–∞–ø–∏—Å–∞—Ç—å –¢–ó</h2>
        <p class="text-gray-500 text-sm">–ì–æ–ª–æ—Å–æ–≤–æ–π –≤–≤–æ–¥ –Ω–æ–≤–æ–≥–æ –¢–ó</p>
      </router-link>
    </div>
  </div>
</template>
```

**`src/pages/RecordPage.vue`** ‚Äî —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–ø–∏—Å–∏:

```vue
<script setup>
import { useRouter } from 'vue-router'
import SpeechRecorder from '../components/SpeechRecorder.vue'

const router = useRouter()

// –ö–æ–≥–¥–∞ —Ç–µ–∫—Å—Ç –∑–∞–ø–∏—Å–∞–Ω ‚Äî –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–æ–∑–¥–∞–Ω–∏—é –¢–ó
function onTranscriptReady(text) {
  // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—Å—Ç –≤ sessionStorage –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
  sessionStorage.setItem('voiceText', text)
  router.push('/specifications/new')
}
</script>

<template>
  <div>
    <SpeechRecorder @transcriptReady="onTranscriptReady" />
  </div>
</template>
```

### –®–∞–≥ 3: Layout —Å –Ω–∞–≤–∏–≥–∞—Ü–∏–µ–π

–°–æ–∑–¥–∞–π `src/components/AppLayout.vue`:

```vue
<script setup>
import { useRouter } from 'vue-router'
import { authStore } from '../stores/auth'

const router = useRouter()

function logout() {
  authStore.logout()
  router.push('/login')
}
</script>

<template>
  <div class="min-h-screen bg-gray-100">
    <!-- –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ -->
    <nav class="bg-white shadow">
      <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
        <div class="flex items-center gap-6">
          <router-link to="/dashboard" class="text-lg font-bold text-blue-600">
            –¢–ó-–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä
          </router-link>

          <div class="flex gap-4">
            <router-link to="/dashboard"
              class="text-gray-600 hover:text-blue-500 text-sm">
              –î–∞—à–±–æ—Ä–¥
            </router-link>
            <router-link to="/projects"
              class="text-gray-600 hover:text-blue-500 text-sm">
              –ü—Ä–æ–µ–∫—Ç—ã
            </router-link>
            <router-link to="/record"
              class="text-gray-600 hover:text-blue-500 text-sm">
              –ó–∞–ø–∏—Å–∞—Ç—å
            </router-link>
          </div>
        </div>

        <div class="flex items-center gap-4">
          <span class="text-sm text-gray-500">{{ authStore.user?.name }}</span>
          <button @click="logout"
            class="text-sm text-red-500 hover:text-red-700">
            –í—ã–π—Ç–∏
          </button>
        </div>
      </div>
    </nav>

    <!-- –ö–æ–Ω—Ç–µ–Ω—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
    <main class="max-w-6xl mx-auto px-4 py-8">
      <router-view />
    </main>
  </div>
</template>
```

### –®–∞–≥ 4: –§–∞–π–ª —Ä–æ—É—Ç–µ—Ä–∞

–°–æ–∑–¥–∞–π `src/router/index.js`:

```javascript
import { createRouter, createWebHistory } from 'vue-router'
import { authStore } from '../stores/auth'

// ========================================
// –õ–µ–Ω–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü
//
// () => import(...) ‚Äî —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞
// –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞ –Ω–µ—ë –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç (—É–º–µ–Ω—å—à–∞–µ—Ç –Ω–∞—á–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä JS)
// ========================================
const routes = [
  {
    path: '/login',
    component: () => import('../pages/LoginPage.vue'),
    meta: { guest: true }  // –¢–æ–ª—å–∫–æ –¥–ª—è –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö
  },
  {
    path: '/register',
    component: () => import('../pages/RegisterPage.vue'),
    meta: { guest: true }
  },
  {
    // ========================================
    // Layout-–æ–±—ë—Ä—Ç–∫–∞: –≤—Å–µ –≤–ª–æ–∂–µ–Ω–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    // –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ AppLayout (–Ω–∞–≤–∏–≥–∞—Ü–∏—è + –∫–æ–Ω—Ç–µ–Ω—Ç)
    // ========================================
    path: '/',
    component: () => import('../components/AppLayout.vue'),
    meta: { auth: true },  // –¢–æ–ª—å–∫–æ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö
    children: [
      {
        path: '',
        redirect: '/dashboard'
      },
      {
        path: 'dashboard',
        component: () => import('../pages/DashboardPage.vue')
      },
      {
        path: 'projects',
        component: () => import('../pages/ProjectsPage.vue')
      },
      {
        path: 'record',
        component: () => import('../pages/RecordPage.vue')
      },
      {
        path: 'specifications/new',
        component: () => import('../pages/NewSpecificationPage.vue')
      },
      {
        path: 'specifications/:id',
        component: () => import('../pages/SpecificationPage.vue')
      }
    ]
  }
]

const router = createRouter({
  history: createWebHistory(),
  routes
})

// ========================================
// Navigation Guard ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
//
// –ü–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º –ø–µ—Ä–µ—Ö–æ–¥–æ–º –ø—Ä–æ–≤–µ—Ä—è–µ–º:
// - –ï—Å–ª–∏ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Ç—Ä–µ–±—É–µ—Ç auth –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω ‚Üí /login
// - –ï—Å–ª–∏ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–ª—è –≥–æ—Å—Ç–µ–π –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω ‚Üí /dashboard
// ========================================
router.beforeEach((to, from, next) => {
  const isAuth = authStore.isAuthenticated

  if (to.meta.auth && !isAuth) {
    // –¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è, –Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –≤–æ—à—ë–ª
    next('/login')
  } else if (to.meta.guest && isAuth) {
    // –°—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–ª—è –≥–æ—Å—Ç–µ–π, –Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –≤–æ—à—ë–ª
    next('/dashboard')
  } else {
    next()
  }
})

export default router
```

### –®–∞–≥ 5: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ main.js

–ó–∞–º–µ–Ω–∏ `src/main.js`:

```javascript
import { createApp } from 'vue'
import './style.css'
import App from './App.vue'
import router from './router'

// ========================================
// createApp ‚Äî —Å–æ–∑–¥–∞—ë—Ç —ç–∫–∑–µ–º–ø–ª—è—Ä Vue
// .use(router) ‚Äî –ø–æ–¥–∫–ª—é—á–∞–µ—Ç Vue Router
// .mount('#app') ‚Äî –º–æ–Ω—Ç–∏—Ä—É–µ—Ç –≤ DOM
// ========================================
createApp(App)
  .use(router)
  .mount('#app')
```

### –®–∞–≥ 6: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ App.vue

–ó–∞–º–µ–Ω–∏ `src/App.vue`:

```vue
<template>
  <!-- router-view –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —Ç–µ–∫—É—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ URL -->
  <router-view />
</template>
```

---

# –ß–ê–°–¢–¨ 10: UI –ü–†–û–ï–ö–¢–û–í ‚úÖ

## –£—Ä–æ–∫ 10.1: –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø—Ä–æ–µ–∫—Ç–æ–≤ (Frontend) ‚úÖ

### –¢–µ–æ—Ä–∏—è

–ù—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –≥–¥–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç:
- –í–∏–¥–µ—Ç—å —Å–ø–∏—Å–æ–∫ —Å–≤–æ–∏—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤
- –°–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—ã–µ –ø—Ä–æ–µ–∫—Ç—ã
- –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ
- –£–¥–∞–ª—è—Ç—å –ø—Ä–æ–µ–∫—Ç—ã

**–í–∞–∂–Ω–æ:** –ü–µ—Ä–µ–¥ —ç—Ç–∏–º —É—Ä–æ–∫–æ–º —É–±–µ–¥–∏—Å—å —á—Ç–æ backend-—Ä–æ—É—Ç—ã –∏–∑ –ß–∞—Å—Ç–∏ 4 (CRUD –ø—Ä–æ–µ–∫—Ç–æ–≤) —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∏ –ø–æ–¥–∫–ª—é—á–µ–Ω—ã –≤ `index.js`.

### –®–∞–≥ 1: –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã

–°–æ–∑–¥–∞–π `src/pages/ProjectsPage.vue`:

```vue
<script setup>
import { ref, onMounted } from 'vue'
import api from '../api'

// ========================================
// –†–µ–∞–∫—Ç–∏–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
// ========================================
const projects = ref([])        // –°–ø–∏—Å–æ–∫ –ø—Ä–æ–µ–∫—Ç–æ–≤
const loading = ref(true)       // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞
const showForm = ref(false)     // –ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å —Ñ–æ—Ä–º—É
const editingId = ref(null)     // ID —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ (null = —Å–æ–∑–¥–∞–Ω–∏–µ)
const formData = ref({          // –î–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã
  name: '',
  description: ''
})
const formError = ref('')

// ========================================
// –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–µ–∫—Ç–æ–≤ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
//
// onMounted ‚Äî –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∫–æ–≥–¥–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –ø–æ—è–≤–∏–ª—Å—è –≤ DOM
// ========================================
onMounted(async () => {
  await loadProjects()
})

async function loadProjects() {
  loading.value = true
  try {
    const response = await api.get('/projects')
    projects.value = response.data
  } catch (e) {
    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ–µ–∫—Ç–æ–≤:', e)
  } finally {
    loading.value = false
  }
}

// ========================================
// –û—Ç–∫—Ä—ã—Ç—å —Ñ–æ—Ä–º—É –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è
// ========================================
function openCreate() {
  editingId.value = null
  formData.value = { name: '', description: '' }
  formError.value = ''
  showForm.value = true
}

// ========================================
// –û—Ç–∫—Ä—ã—Ç—å —Ñ–æ—Ä–º—É –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
// –ó–∞–ø–æ–ª–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞
// ========================================
function openEdit(project) {
  editingId.value = project.id
  formData.value = {
    name: project.name,
    description: project.description || ''
  }
  formError.value = ''
  showForm.value = true
}

// ========================================
// –°–æ—Ö—Ä–∞–Ω–∏—Ç—å (—Å–æ–∑–¥–∞–Ω–∏–µ –∏–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ)
//
// –ï—Å–ª–∏ editingId == null ‚Üí POST (—Å–æ–∑–¥–∞–Ω–∏–µ)
// –ï—Å–ª–∏ editingId != null ‚Üí PUT (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ)
// ========================================
async function saveProject() {
  if (!formData.value.name.trim()) {
    formError.value = '–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞'
    return
  }

  try {
    if (editingId.value) {
      await api.put(`/projects/${editingId.value}`, formData.value)
    } else {
      await api.post('/projects', formData.value)
    }

    showForm.value = false
    await loadProjects()  // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫
  } catch (e) {
    formError.value = e.response?.data?.error || '–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è'
  }
}

// ========================================
// –£–¥–∞–ª–µ–Ω–∏–µ —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º
// ========================================
async function deleteProject(id) {
  if (!confirm('–£–¥–∞–ª–∏—Ç—å –ø—Ä–æ–µ–∫—Ç –∏ –≤—Å–µ –µ–≥–æ –¢–ó?')) return

  try {
    await api.delete(`/projects/${id}`)
    await loadProjects()
  } catch (e) {
    alert('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è')
  }
}
</script>

<template>
  <div>
    <div class="flex justify-between items-center mb-6">
      <h1 class="text-2xl font-bold">–ü—Ä–æ–µ–∫—Ç—ã</h1>
      <button @click="openCreate"
        class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
        + –ù–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç
      </button>
    </div>

    <!-- –§–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (–º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ) -->
    <div v-if="showForm" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50">
      <div class="bg-white rounded-lg p-6 w-full max-w-md">
        <h2 class="text-xl font-bold mb-4">
          {{ editingId ? '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–µ–∫—Ç' : '–ù–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç' }}
        </h2>

        <div v-if="formError" class="bg-red-100 text-red-700 p-3 rounded mb-4">
          {{ formError }}
        </div>

        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium mb-1">–ù–∞–∑–≤–∞–Ω–∏–µ</label>
            <input v-model="formData.name" type="text"
              class="w-full border rounded px-3 py-2"
              placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞" />
          </div>

          <div>
            <label class="block text-sm font-medium mb-1">–û–ø–∏—Å–∞–Ω–∏–µ</label>
            <textarea v-model="formData.description" rows="3"
              class="w-full border rounded px-3 py-2"
              placeholder="–û–ø–∏—Å–∞–Ω–∏–µ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)"></textarea>
          </div>
        </div>

        <div class="flex gap-3 mt-6">
          <button @click="saveProject"
            class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
            –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
          </button>
          <button @click="showForm = false"
            class="bg-gray-200 px-4 py-2 rounded hover:bg-gray-300">
            –û—Ç–º–µ–Ω–∞
          </button>
        </div>
      </div>
    </div>

    <!-- –ó–∞–≥—Ä—É–∑–∫–∞ -->
    <div v-if="loading" class="text-gray-500">–ó–∞–≥—Ä—É–∑–∫–∞...</div>

    <!-- –ü—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫ -->
    <div v-else-if="projects.length === 0" class="text-center py-12 text-gray-500">
      <p class="text-lg mb-2">–ü—Ä–æ–µ–∫—Ç–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</p>
      <p class="text-sm">–ù–∞–∂–º–∏—Ç–µ "–ù–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç" —á—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤—ã–π</p>
    </div>

    <!-- –°–ø–∏—Å–æ–∫ –ø—Ä–æ–µ–∫—Ç–æ–≤ -->
    <div v-else class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
      <div v-for="project in projects" :key="project.id"
        class="bg-white rounded-lg shadow p-5 hover:shadow-md transition-shadow">
        <h3 class="font-semibold text-lg mb-1">{{ project.name }}</h3>
        <p v-if="project.description" class="text-gray-500 text-sm mb-4">
          {{ project.description }}
        </p>
        <p class="text-xs text-gray-400 mb-4">
          –°–æ–∑–¥–∞–Ω: {{ new Date(project.createdAt).toLocaleDateString('ru') }}
        </p>

        <div class="flex gap-2">
          <router-link :to="`/projects/${project.id}`"
            class="text-blue-500 hover:text-blue-700 text-sm">
            –û—Ç–∫—Ä—ã—Ç—å
          </router-link>
          <button @click="openEdit(project)"
            class="text-gray-500 hover:text-gray-700 text-sm">
            –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
          </button>
          <button @click="deleteProject(project.id)"
            class="text-red-500 hover:text-red-700 text-sm">
            –£–¥–∞–ª–∏—Ç—å
          </button>
        </div>
      </div>
    </div>
  </div>
</template>
```

## –£—Ä–æ–∫ 10.2: –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø—Ä–æ–µ–∫—Ç–∞ ‚úÖ

### –¢–µ–æ—Ä–∏—è

–°–µ–π—á–∞—Å –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –ø—Ä–æ–µ–∫—Ç–æ–≤ –µ—Å—Ç—å —Å—Å—ã–ª–∫–∞ "–û—Ç–∫—Ä—ã—Ç—å", –Ω–æ –æ–Ω–∞ –≤–µ–¥—ë—Ç –≤ –Ω–∏–∫—É–¥–∞. –ù—É–∂–Ω–æ:
1. –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É `ProjectPage.vue` ‚Äî –¥–µ—Ç–∞–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä –ø—Ä–æ–µ–∫—Ç–∞ —Å–æ —Å–ø–∏—Å–∫–æ–º –µ–≥–æ –¢–ó
2. –î–æ–±–∞–≤–∏—Ç—å —Ä–æ—É—Ç `projects/:id` –≤ —Ä–æ—É—Ç–µ—Ä
3. –û–±–Ω–æ–≤–∏—Ç—å `projectController.getOne` ‚Äî —á—Ç–æ–±—ã –≤–æ–∑–≤—Ä–∞—â–∞–ª –ø—Ä–æ–µ–∫—Ç –≤–º–µ—Å—Ç–µ —Å–æ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è–º–∏

### –®–∞–≥ 1: –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –ø—Ä–æ–µ–∫—Ç–æ–≤ (Backend)

–í `src/controllers/projectController.js` –æ–±–Ω–æ–≤–∏ —Ñ—É–Ω–∫—Ü–∏—é `getOne` ‚Äî –¥–æ–±–∞–≤—å `include` —á—Ç–æ–±—ã Prisma –ø–æ–¥—Ç—è–≥–∏–≤–∞–ª–∞ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Å —Å–µ–∫—Ü–∏—è–º–∏ –∏ –ø—É–Ω–∫—Ç–∞–º–∏:

```javascript
// –ü–æ–ª—É—á–∏—Ç—å –æ–¥–∏–Ω –ø—Ä–æ–µ–∫—Ç
async function getOne(req, res) {
    try {
        const project = await prisma.project.findFirst({
            where: {
                id: parseInt(req.params.id),
                userId: req.userId
            },
            // ========================================
            // include ‚Äî –ø–æ–¥—Ç—è–≥–∏–≤–∞–µ–º —Å–≤—è–∑–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
            //
            // –ë–µ–∑ include: { id, name, description }
            // –° include: { id, name, description, specifications: [...] }
            //
            // –í–ª–æ–∂–µ–Ω–Ω—ã–π include ‚Äî –ø–æ–¥—Ç—è–≥–∏–≤–∞–µ–º —Å–µ–∫—Ü–∏–∏ –≤–Ω—É—Ç—Ä–∏ –¢–ó,
            // –∞ –≤–Ω—É—Ç—Ä–∏ —Å–µ–∫—Ü–∏–π ‚Äî –ø—É–Ω–∫—Ç—ã
            // ========================================
            include: {
                specifications: {
                    orderBy: { createdAt: 'desc' },
                    include: {
                        sections: {
                            orderBy: { position: 'asc' },
                            include: {
                                items: { orderBy: { position: 'asc' } }
                            }
                        }
                    }
                }
            }
        })

        if (!project) {
            return res.status(404).json({ error: '–ü—Ä–æ–µ–∫—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω' })
        }

        res.json(project)
    } catch (error) {
        res.status(500).json({ error: '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞' })
    }
}
```

### –®–∞–≥ 2: –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø—Ä–æ–µ–∫—Ç–∞ (Frontend)

–°–æ–∑–¥–∞–π —Ñ–∞–π–ª `src/pages/ProjectPage.vue`:

```vue
<script setup>
import { ref, onMounted } from 'vue'
import { useRoute } from 'vue-router'
import api from '../api'

const route = useRoute()
const project = ref(null)
const loading = ref(true)
const error = ref('')

// ========================================
// –ü—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ ‚Äî –∑–∞–≥—Ä—É–∂–∞–µ–º –ø—Ä–æ–µ–∫—Ç –ø–æ ID –∏–∑ URL
//
// route.params.id ‚Äî –±–µ—Ä—ë–º :id –∏–∑ –∞–¥—Ä–µ—Å–∞ /projects/5
// ========================================
onMounted(async () => {
  try {
    const response = await api.get(`/projects/${route.params.id}`)
    project.value = response.data
  } catch (e) {
    error.value = e.response?.data?.error || '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞'
  } finally {
    loading.value = false
  }
})

// –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–∏–Ω—É—Ç –≤ "X —á Y –º–∏–Ω"
function formatTime(minutes) {
  if (!minutes) return ''
  if (minutes < 60) return `${minutes} –º–∏–Ω`
  const h = Math.floor(minutes / 60)
  const m = minutes % 60
  return m ? `${h} —á ${m} –º–∏–Ω` : `${h} —á`
}
</script>

<template>
  <div class="max-w-4xl mx-auto">
    <div v-if="loading" class="text-center py-12 text-gray-500">–ó–∞–≥—Ä—É–∑–∫–∞...</div>

    <div v-else-if="error" class="bg-red-100 text-red-700 p-4 rounded">{{ error }}</div>

    <div v-else-if="project">
      <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è –Ω–∞–∑–∞–¥ -->
      <div class="mb-6">
        <router-link to="/projects" class="text-blue-500 hover:text-blue-700 text-sm">
          &larr; –í—Å–µ –ø—Ä–æ–µ–∫—Ç—ã
        </router-link>
      </div>

      <h1 class="text-2xl font-bold mb-2">{{ project.name }}</h1>
      <p v-if="project.description" class="text-gray-500 mb-6">{{ project.description }}</p>

      <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å–µ–∫—Ü–∏–∏ –¢–ó + –∫–Ω–æ–ø–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è -->
      <div class="flex items-center justify-between mb-4">
        <h2 class="text-lg font-semibold">–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞–Ω–∏—è</h2>
        <router-link to="/record"
          class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 text-sm">
          + –°–æ–∑–¥–∞—Ç—å –¢–ó
        </router-link>
      </div>

      <!-- –ü—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫ -->
      <div v-if="project.specifications.length === 0"
        class="text-center py-8 text-gray-500 bg-white rounded-lg shadow">
        <p>–¢–ó –ø–æ–∫–∞ –Ω–µ—Ç</p>
        <p class="text-sm mt-1">–ó–∞–ø–∏—à–∏—Ç–µ –≥–æ–ª–æ—Å –∏ —Å–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤–æ–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ</p>
      </div>

      <!-- –°–ø–∏—Å–æ–∫ –¢–ó –ø—Ä–æ–µ–∫—Ç–∞ -->
      <div v-else class="space-y-4">
        <router-link v-for="spec in project.specifications" :key="spec.id"
          :to="`/specifications/${spec.id}`"
          class="block bg-white rounded-lg shadow p-5 hover:shadow-md transition-shadow">
          <div class="flex justify-between items-start">
            <div>
              <h3 class="font-semibold">{{ spec.title }}</h3>
              <p class="text-sm text-gray-400 mt-1">
                {{ spec.sections.length }} —Ä–∞–∑–¥–µ–ª–æ–≤ &middot;
                {{ new Date(spec.createdAt).toLocaleDateString('ru') }}
              </p>
            </div>
            <span class="text-sm text-gray-500">
              {{ formatTime(spec.sections.reduce((sum, s) =>
                sum + s.items.reduce((iSum, item) => iSum + (item.timeEstimate || 0), 0), 0)) }}
            </span>
          </div>
        </router-link>
      </div>
    </div>
  </div>
</template>
```

### –®–∞–≥ 3: –î–æ–±–∞–≤–∏—Ç—å —Ä–æ—É—Ç

–í `src/router/index.js` –¥–æ–±–∞–≤—å –ø–æ—Å–ª–µ —Ä–æ—É—Ç–∞ `projects`:

```javascript
{
    path: 'projects/:id',
    component: () => import('../pages/ProjectPage.vue')
},
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞

1. –ü–µ—Ä–µ–π–¥–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø—Ä–æ–µ–∫—Ç–æ–≤
2. –ù–∞–∂–º–∏ "–û—Ç–∫—Ä—ã—Ç—å" —É –ª—é–±–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞
3. –î–æ–ª–∂–Ω–∞ –æ—Ç–∫—Ä—ã—Ç—å—Å—è –¥–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º, –æ–ø–∏—Å–∞–Ω–∏–µ–º –∏ —Å–ø–∏—Å–∫–æ–º –¢–ó

---

# –ß–ê–°–¢–¨ 11: UI –¢–ï–•–ù–ò–ß–ï–°–ö–ò–• –ó–ê–î–ê–ù–ò–ô ‚úÖ

## –£—Ä–æ–∫ 11.1: –ö–Ω–æ–ø–∫–∞ "–°–æ–∑–¥–∞—Ç—å –¢–ó" –≤ –≥–æ–ª–æ—Å–æ–≤–æ–º –≤–≤–æ–¥–µ ‚úÖ

### –¢–µ–æ—Ä–∏—è

–°–µ–π—á–∞—Å `SpeechRecorder` —É–º–µ–µ—Ç –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å —Ä–µ—á—å –∏ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ç–µ–∫—Å—Ç, –Ω–æ –Ω–µ —É–º–µ–µ—Ç –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å —ç—Ç–æ—Ç —Ç–µ–∫—Å—Ç –¥–∞–ª—å—à–µ. –ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å:
1. –ö–Ω–æ–ø–∫—É "–°–æ–∑–¥–∞—Ç—å –¢–ó" ‚Äî –ø–æ—è–≤–ª—è–µ—Ç—Å—è –∫–æ–≥–¥–∞ –µ—Å—Ç—å –∑–∞–ø–∏—Å–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç
2. `emit('transcriptReady', text)` ‚Äî —Å–æ–±—ã—Ç–∏–µ –¥–ª—è —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
3. `RecordPage` –ª–æ–≤–∏—Ç —ç—Ç–æ —Å–æ–±—ã—Ç–∏–µ, —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ç–µ–∫—Å—Ç –≤ `sessionStorage` –∏ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞ `NewSpecificationPage`

### –®–∞–≥ 1: –û–±–Ω–æ–≤–∏—Ç—å SpeechRecorder.vue

–í `src/components/SpeechRecorder.vue` –¥–æ–±–∞–≤—å:

**–í `<script setup>` ‚Äî –æ–±—ä—è–≤–ª–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è –∏ —Ñ—É–Ω–∫—Ü–∏—è:**

```javascript
// ========================================
// defineEmits ‚Äî –æ–±—ä—è–≤–ª—è–µ–º —Å–æ–±—ã—Ç–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
//
// –†–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç (RecordPage) —Å–º–æ–∂–µ—Ç —Å–ª—É—à–∞—Ç—å:
// <SpeechRecorder @transcriptReady="onTranscriptReady" />
// ========================================
const emit = defineEmits(['transcriptReady'])

// –ü–µ—Ä–µ–¥–∞—Ç—å —Ç–µ–∫—Å—Ç —Ä–æ–¥–∏—Ç–µ–ª—é –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –¢–ó
function useTranscript() {
  if (transcript.value) {
    emit('transcriptReady', transcript.value)
  }
}
```

**–í `<template>` ‚Äî –∫–Ω–æ–ø–∫–∞ –º–µ–∂–¥—É "–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å" –∏ "–û—á–∏—Å—Ç–∏—Ç—å":**

```html
<button
    v-if="transcript"
    @click="useTranscript"
    class="px-6 py-3 rounded bg-green-500 hover:bg-green-600 text-white font-medium"
>
  –°–æ–∑–¥–∞—Ç—å –¢–ó
</button>
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞

1. –ó–∞–ø–∏—à–∏ –≥–æ–ª–æ—Å
2. –ü–æ—è–≤–∏—Ç—Å—è –∑–µ–ª—ë–Ω–∞—è –∫–Ω–æ–ø–∫–∞ "–°–æ–∑–¥–∞—Ç—å –¢–ó"
3. –ù–∞–∂–º–∏ ‚Äî —Ç–µ–±—è –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å–æ–∑–¥–∞–Ω–∏—è –¢–ó —Å —Ç–µ–∫—Å—Ç–æ–º

---

## –£—Ä–æ–∫ 11.2: –°–æ–∑–¥–∞–Ω–∏–µ –¢–ó –∏–∑ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ ‚úÖ

### –¢–µ–æ—Ä–∏—è

–ü–æ—Ç–æ–∫ —Ä–∞–±–æ—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
1. –ó–∞–ø–∏—Å–∞–ª –≥–æ–ª–æ—Å ‚Üí –ø–æ–ª—É—á–∏–ª —Ç–µ–∫—Å—Ç (RecordPage)
2. –¢–µ–∫—Å—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `sessionStorage`
3. –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ NewSpecificationPage
4. –ù–∞–∂–∏–º–∞–µ—Ç "–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ AI"
5. –ü–æ–ª—É—á–∞–µ—Ç —Ä–∞–∑–¥–µ–ª—ã –∏ –ø—É–Ω–∫—Ç—ã
6. –ú–æ–∂–µ—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Ä—É—á–Ω—É—é
7. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –¢–ó

### –®–∞–≥ 1: –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–æ–∑–¥–∞–Ω–∏—è –¢–ó

–°–æ–∑–¥–∞–π `src/pages/NewSpecificationPage.vue`:

```vue
<script setup>
import { ref, onMounted } from 'vue'
import { useRouter } from 'vue-router'
import api from '../api'

const router = useRouter()

// ========================================
// –°–æ—Å—Ç–æ—è–Ω–∏–µ
// ========================================
const voiceText = ref('')           // –ò—Å—Ö–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç –∏–∑ –≥–æ–ª–æ—Å–∞
const title = ref('')               // –ù–∞–∑–≤–∞–Ω–∏–µ –¢–ó
const projectId = ref(null)         // –í—ã–±—Ä–∞–Ω–Ω—ã–π –ø—Ä–æ–µ–∫—Ç
const projects = ref([])            // –°–ø–∏—Å–æ–∫ –ø—Ä–æ–µ–∫—Ç–æ–≤ –¥–ª—è –≤—ã–±–æ—Ä–∞
const sections = ref([])            // –†–∞–∑–¥–µ–ª—ã –¢–ó (—Ä–µ–∑—É–ª—å—Ç–∞—Ç AI)
const isStructuring = ref(false)    // AI –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ç–µ–∫—Å—Ç
const isSaving = ref(false)
const error = ref('')

// ========================================
// –ü—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã:
// 1. –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—Å—Ç –∏–∑ sessionStorage (–∑–∞–ø–∏—Å–∞–Ω –Ω–∞ RecordPage)
// 2. –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ –ø—Ä–æ–µ–∫—Ç–æ–≤
// ========================================
onMounted(async () => {
  voiceText.value = sessionStorage.getItem('voiceText') || ''

  try {
    const response = await api.get('/projects')
    projects.value = response.data
  } catch (e) {
    console.error(e)
  }
})

// ========================================
// –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ–∫—Å—Ç –Ω–∞ AI-—Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ
//
// POST /api/ai/structure ‚Äî –ø—Ä–∏–Ω–∏–º–∞–µ—Ç { text }
// –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç { sections: [{ title, items: [{ content }] }] }
// ========================================
async function structureWithAI() {
  if (!voiceText.value.trim()) {
    error.value = '–í–≤–µ–¥–∏—Ç–µ –∏–ª–∏ –∑–∞–ø–∏—à–∏—Ç–µ —Ç–µ–∫—Å—Ç'
    return
  }

  isStructuring.value = true
  error.value = ''

  try {
    const response = await api.post('/ai/structure', {
      text: voiceText.value
    })
    sections.value = response.data.sections
  } catch (e) {
    error.value = e.response?.data?.error || '–û—à–∏–±–∫–∞ AI-—Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–∏—è'
  } finally {
    isStructuring.value = false
  }
}

// ========================================
// –†—É—á–Ω–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–∞
// ========================================
function addSection() {
  sections.value.push({
    title: '–ù–æ–≤—ã–π —Ä–∞–∑–¥–µ–ª',
    items: [{ content: '', timeEstimate: null }]
  })
}

// ========================================
// –î–æ–±–∞–≤–∏—Ç—å –ø—É–Ω–∫—Ç –≤ —Ä–∞–∑–¥–µ–ª
// ========================================
function addItem(sectionIndex) {
  sections.value[sectionIndex].items.push({
    content: '',
    timeEstimate: null
  })
}

// ========================================
// –£–¥–∞–ª–∏—Ç—å –ø—É–Ω–∫—Ç –∏–∑ —Ä–∞–∑–¥–µ–ª–∞
// ========================================
function removeItem(sectionIndex, itemIndex) {
  sections.value[sectionIndex].items.splice(itemIndex, 1)
}

// ========================================
// –£–¥–∞–ª–∏—Ç—å —Ä–∞–∑–¥–µ–ª —Ü–µ–ª–∏–∫–æ–º
// ========================================
function removeSection(index) {
  sections.value.splice(index, 1)
}

// ========================================
// –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –¢–ó
//
// POST /api/specifications ‚Äî —Å–æ–∑–¥–∞—ë—Ç –¢–ó —Å–æ –≤–ª–æ–∂–µ–Ω–Ω—ã–º–∏
// —Å–µ–∫—Ü–∏—è–º–∏ –∏ –ø—É–Ω–∫—Ç–∞–º–∏ (Prisma nested create)
// ========================================
async function save() {
  if (!title.value.trim()) {
    error.value = '–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –¢–ó'
    return
  }
  if (!projectId.value) {
    error.value = '–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç'
    return
  }

  isSaving.value = true
  try {
    const response = await api.post('/specifications', {
      title: title.value,
      projectId: projectId.value,
      sections: sections.value
    })

    // –û—á–∏—â–∞–µ–º sessionStorage –∏ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ –¢–ó
    sessionStorage.removeItem('voiceText')
    router.push(`/specifications/${response.data.id}`)
  } catch (e) {
    error.value = e.response?.data?.error || '–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è'
  } finally {
    isSaving.value = false
  }
}
</script>

<template>
  <div class="max-w-4xl mx-auto">
    <h1 class="text-2xl font-bold mb-6">–ù–æ–≤–æ–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ</h1>

    <div v-if="error" class="bg-red-100 text-red-700 p-3 rounded mb-4">
      {{ error }}
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–ª—è -->
    <div class="bg-white rounded-lg shadow p-6 mb-6 space-y-4">
      <div>
        <label class="block text-sm font-medium mb-1">–ù–∞–∑–≤–∞–Ω–∏–µ –¢–ó</label>
        <input v-model="title" type="text" class="w-full border rounded px-3 py-2"
          placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω–∞" />
      </div>

      <div>
        <label class="block text-sm font-medium mb-1">–ü—Ä–æ–µ–∫—Ç</label>
        <select v-model="projectId" class="w-full border rounded px-3 py-2">
          <option :value="null" disabled>–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç</option>
          <option v-for="p in projects" :key="p.id" :value="p.id">
            {{ p.name }}
          </option>
        </select>
      </div>
    </div>

    <!-- –ì–æ–ª–æ—Å–æ–≤–æ–π —Ç–µ–∫—Å—Ç -->
    <div class="bg-white rounded-lg shadow p-6 mb-6">
      <label class="block text-sm font-medium mb-2">–¢–µ–∫—Å—Ç –∏–∑ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ –≤–≤–æ–¥–∞</label>
      <textarea v-model="voiceText" rows="6" class="w-full border rounded px-3 py-2"
        placeholder="–í—Å—Ç–∞–≤—å—Ç–µ —Ç–µ–∫—Å—Ç –∏–ª–∏ –∑–∞–ø–∏—à–∏—Ç–µ –≥–æ–ª–æ—Å –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ '–ó–∞–ø–∏—Å–∞—Ç—å'"></textarea>

      <button @click="structureWithAI" :disabled="isStructuring"
        class="mt-3 bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-600 disabled:opacity-50">
        {{ isStructuring ? 'AI –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç...' : '–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ AI' }}
      </button>
    </div>

    <!-- –†–∞–∑–¥–µ–ª—ã –∏ –ø—É–Ω–∫—Ç—ã -->
    <div class="space-y-4 mb-6">
      <div v-for="(section, sIdx) in sections" :key="sIdx"
        class="bg-white rounded-lg shadow p-6">
        <div class="flex items-center justify-between mb-4">
          <input v-model="section.title" type="text"
            class="text-lg font-semibold border-b border-transparent hover:border-gray-300 focus:border-blue-500 outline-none flex-1"
            placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–∞" />
          <button @click="removeSection(sIdx)"
            class="text-red-400 hover:text-red-600 ml-4 text-sm">
            –£–¥–∞–ª–∏—Ç—å —Ä–∞–∑–¥–µ–ª
          </button>
        </div>

        <!-- –ü—É–Ω–∫—Ç—ã —Ä–∞–∑–¥–µ–ª–∞ -->
        <div v-for="(item, iIdx) in section.items" :key="iIdx"
          class="flex gap-3 mb-3 items-start">
          <span class="text-gray-400 mt-2 text-sm">{{ sIdx + 1 }}.{{ iIdx + 1 }}</span>

          <textarea v-model="item.content" rows="2"
            class="flex-1 border rounded px-3 py-2 text-sm"
            placeholder="–û–ø–∏—Å–∞–Ω–∏–µ –ø—É–Ω–∫—Ç–∞"></textarea>

          <input v-model.number="item.timeEstimate" type="number" min="0"
            class="w-20 border rounded px-2 py-2 text-sm"
            placeholder="–º–∏–Ω" title="–û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ (–º–∏–Ω—É—Ç—ã)" />

          <button @click="removeItem(sIdx, iIdx)"
            class="text-red-400 hover:text-red-600 mt-2">
            &times;
          </button>
        </div>

        <button @click="addItem(sIdx)"
          class="text-blue-500 hover:text-blue-700 text-sm">
          + –î–æ–±–∞–≤–∏—Ç—å –ø—É–Ω–∫—Ç
        </button>
      </div>
    </div>

    <!-- –ö–Ω–æ–ø–∫–∏ -->
    <div class="flex gap-4">
      <button @click="addSection"
        class="bg-gray-200 px-4 py-2 rounded hover:bg-gray-300">
        + –î–æ–±–∞–≤–∏—Ç—å —Ä–∞–∑–¥–µ–ª
      </button>

      <button @click="save" :disabled="isSaving"
        class="bg-green-500 text-white px-6 py-2 rounded hover:bg-green-600 disabled:opacity-50">
        {{ isSaving ? '–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...' : '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –¢–ó' }}
      </button>
    </div>
  </div>
</template>
```

## –£—Ä–æ–∫ 11.3: –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¢–ó ‚úÖ

### –¢–µ–æ—Ä–∏—è

–ü–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¢–ó –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ `/specifications/:id`. –°–µ–π—á–∞—Å `SpecificationPage.vue` –ø—É—Å—Ç–∞—è ‚Äî –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≥–æ—Ç–æ–≤–æ–≥–æ –¢–ó —Å —Ä–∞–∑–¥–µ–ª–∞–º–∏, –ø—É–Ω–∫—Ç–∞–º–∏ –∏ –æ—Ü–µ–Ω–∫–∞–º–∏ –≤—Ä–µ–º–µ–Ω–∏.

### –®–∞–≥ 1: –°–æ–∑–¥–∞—Ç—å SpecificationPage.vue

–ó–∞–º–µ–Ω–∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ `src/pages/SpecificationPage.vue`:

```vue
<script setup>
import { ref, onMounted } from 'vue'
import { useRoute } from 'vue-router'
import api from '../api'

const route = useRoute()
const spec = ref(null)
const loading = ref(true)
const error = ref('')

// ========================================
// –ó–∞–≥—Ä—É–∂–∞–µ–º –¢–ó –ø–æ ID –∏–∑ URL
//
// GET /api/specifications/:id
// –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: { title, sections: [{ title, items: [...] }] }
// ========================================
onMounted(async () => {
  try {
    const response = await api.get(`/specifications/${route.params.id}`)
    spec.value = response.data
  } catch (e) {
    error.value = e.response?.data?.error || '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¢–ó'
  } finally {
    loading.value = false
  }
})

// –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–∏–Ω—É—Ç –≤ "X —á Y –º–∏–Ω"
function formatTime(minutes) {
  if (!minutes) return ''
  if (minutes < 60) return `${minutes} –º–∏–Ω`
  const h = Math.floor(minutes / 60)
  const m = minutes % 60
  return m ? `${h} —á ${m} –º–∏–Ω` : `${h} —á`
}

// –°—É–º–º–∞—Ä–Ω–æ–µ –≤—Ä–µ–º—è –≤—Å–µ—Ö –ø—É–Ω–∫—Ç–æ–≤
function totalTime() {
  if (!spec.value) return 0
  return spec.value.sections.reduce((sum, s) =>
    sum + s.items.reduce((iSum, item) => iSum + (item.timeEstimate || 0), 0), 0)
}
</script>

<template>
  <div class="max-w-4xl mx-auto">
    <div v-if="loading" class="text-center py-12 text-gray-500">–ó–∞–≥—Ä—É–∑–∫–∞...</div>

    <div v-else-if="error" class="bg-red-100 text-red-700 p-4 rounded">{{ error }}</div>

    <div v-else-if="spec">
      <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ + –æ–±—â–µ–µ –≤—Ä–µ–º—è -->
      <div class="flex items-center justify-between mb-6">
        <h1 class="text-2xl font-bold">{{ spec.title }}</h1>
        <span class="text-sm text-gray-500">
          –û–±—â–µ–µ –≤—Ä–µ–º—è: {{ formatTime(totalTime()) }}
        </span>
      </div>

      <!-- –†–∞–∑–¥–µ–ª—ã -->
      <div v-for="(section, sIdx) in spec.sections" :key="section.id"
        class="bg-white rounded-lg shadow p-6 mb-4">
        <h2 class="text-lg font-semibold mb-4">{{ sIdx + 1 }}. {{ section.title }}</h2>

        <!-- –ü—É–Ω–∫—Ç—ã —Ä–∞–∑–¥–µ–ª–∞ -->
        <div v-for="(item, iIdx) in section.items" :key="item.id"
          class="flex justify-between items-start py-2 border-b last:border-0">
          <span class="text-sm">
            <span class="text-gray-400 mr-2">{{ sIdx + 1 }}.{{ iIdx + 1 }}</span>
            {{ item.content }}
          </span>
          <span v-if="item.timeEstimate" class="text-xs text-gray-500 whitespace-nowrap ml-4">
            {{ formatTime(item.timeEstimate) }}
          </span>
        </div>
      </div>

      <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
      <router-link to="/dashboard"
        class="inline-block mt-4 text-blue-500 hover:text-blue-700">
        &larr; –ù–∞ –≥–ª–∞–≤–Ω—É—é
      </router-link>
    </div>
  </div>
</template>
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞

1. –°–æ–∑–¥–∞–π –¢–ó —á–µ—Ä–µ–∑ AI (–∑–∞–ø–∏—à–∏ –≥–æ–ª–æ—Å ‚Üí —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä—É–π ‚Üí —Å–æ—Ö—Ä–∞–Ω–∏)
2. –ü–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–µ–±—è –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
3. –î–æ–ª–∂–Ω—ã –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å—Å—è: –Ω–∞–∑–≤–∞–Ω–∏–µ, —Ä–∞–∑–¥–µ–ª—ã —Å –ø—É–Ω–∫—Ç–∞–º–∏, –æ—Ü–µ–Ω–∫–∏ –≤—Ä–µ–º–µ–Ω–∏, –æ–±—â–µ–µ –≤—Ä–µ–º—è

---

## –£—Ä–æ–∫ 11.4: –£–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞ –¥–ª—è AI ‚úÖ

### –¢–µ–æ—Ä–∏—è

–ë–∞–∑–æ–≤—ã–π –ø—Ä–æ–º–ø—Ç –º–æ–∂–µ—Ç –¥–∞–≤–∞—Ç—å –Ω–µ—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã ‚Äî AI –æ–ø–∏—Å—ã–≤–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å –∞–Ω–∞–ª–∏–∑–∞ –≤–º–µ—Å—Ç–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞, –∏–ª–∏ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–µ –Ω–∞ —Ä—É—Å—Å–∫–æ–º. –ù—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –ø—Ä–æ–º–ø—Ç –±–æ–ª–µ–µ —Ç–æ—á–Ω—ã–º.

### –®–∞–≥ 1: –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ–º–ø—Ç –≤ aiService.js

–ó–∞–º–µ–Ω–∏ –ø—Ä–æ–º–ø—Ç –≤ `src/services/aiService.js`:

```javascript
const prompt = `–¢—ã ‚Äî –æ–ø—ã—Ç–Ω—ã–π —Å–∏—Å—Ç–µ–º–Ω—ã–π –∞–Ω–∞–ª–∏—Ç–∏–∫. –¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî –ø—Ä–µ–≤—Ä–∞—Ç–∏—Ç—å —Å—ã—Ä–æ–π —Ç–µ–∫—Å—Ç (–∑–∞–ø–∏—Å—å —Ä–µ—á–∏ –∑–∞–∫–∞–∑—á–∏–∫–∞) –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ –Ω–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É.

–ü–†–ê–í–ò–õ–ê:
- –†–∞–∑–±–µ–π —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∑–∞–∫–∞–∑—á–∏–∫–∞ –Ω–∞ –ª–æ–≥–∏—á–µ—Å–∫–∏–µ —Ä–∞–∑–¥–µ–ª—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä: "–ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤", "–ö–æ—Ä–∑–∏–Ω–∞", "–û–ø–ª–∞—Ç–∞", "–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç")
- –í –∫–∞–∂–¥–æ–º —Ä–∞–∑–¥–µ–ª–µ –≤—ã–¥–µ–ª–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∑–∞–¥–∞—á–∏ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞
- –ö–∞–∂–¥–æ–π –∑–∞–¥–∞—á–µ –¥–∞–π –æ—Ü–µ–Ω–∫—É –≤—Ä–µ–º–µ–Ω–∏ –≤ –º–∏–Ω—É—Ç–∞—Ö (—Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—É—é –¥–ª—è junior/middle —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞)
- –ü—Ä–∏–¥—É–º–∞–π –∫–æ—Ä–æ—Ç–∫–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –¢–ó, –æ—Ç—Ä–∞–∂–∞—é—â–µ–µ —Å—É—Ç—å –ø—Ä–æ–µ–∫—Ç–∞
- –ù–ï –æ–ø–∏—Å—ã–≤–∞–π –ø—Ä–æ—Ü–µ—Å—Å –∞–Ω–∞–ª–∏–∑–∞, –æ–ø–∏—Å—ã–≤–∞–π –†–ï–ó–£–õ–¨–¢–ê–¢ ‚Äî —á—Ç–æ –Ω—É–∂–Ω–æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å
- –û—Ç–≤–µ—á–∞–π –¢–û–õ–¨–ö–û –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ

–í–µ—Ä–Ω–∏ –¢–û–õ–¨–ö–û –≤–∞–ª–∏–¥–Ω—ã–π JSON, –±–µ–∑ markdown-–æ–±—ë—Ä—Ç–∫–∏, –±–µ–∑ –ø–æ—è—Å–Ω–µ–Ω–∏–π –¥–æ –∏–ª–∏ –ø–æ—Å–ª–µ, —Å—Ç—Ä–æ–≥–æ –≤ —Ñ–æ—Ä–º–∞—Ç–µ:
{
  "title": "–ù–∞–∑–≤–∞–Ω–∏–µ –¢–ó",
  "sections": [
    {
      "title": "–ù–∞–∑–≤–∞–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–∞",
      "items": [
        {
          "content": "–û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞",
          "timeEstimate": 60
        }
      ]
    }
  ]
}

–¢–µ–∫—Å—Ç –æ—Ç –∑–∞–∫–∞–∑—á–∏–∫–∞:
${text}`
```

**–ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å:**
- –†–æ–ª—å "—Å–∏—Å—Ç–µ–º–Ω—ã–π –∞–Ω–∞–ª–∏—Ç–∏–∫" ‚Äî –º–æ–¥–µ–ª—å –ª—É—á—à–µ –ø–æ–Ω–∏–º–∞–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç
- –ü—Ä–∏–º–µ—Ä—ã —Ä–∞–∑–¥–µ–ª–æ–≤ ‚Äî –ø–æ–¥—Å–∫–∞–∑–∫–∞ –¥–ª—è –º–æ–¥–µ–ª–∏
- "–ù–ï –æ–ø–∏—Å—ã–≤–∞–π –ø—Ä–æ—Ü–µ—Å—Å –∞–Ω–∞–ª–∏–∑–∞" ‚Äî AI –Ω–µ –±—É–¥–µ—Ç –æ–ø–∏—Å—ã–≤–∞—Ç—å –∫–∞–∫ –æ–Ω –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç
- "–û—Ç–≤–µ—á–∞–π –¢–û–õ–¨–ö–û –Ω–∞ —Ä—É—Å—Å–∫–æ–º" ‚Äî qwen2.5 –∏–Ω–æ–≥–¥–∞ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –∫–∏—Ç–∞–π—Å–∫–æ–º

### –ü—Ä–æ–≤–µ—Ä–∫–∞

–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏ –±—ç–∫–µ–Ω–¥ –∏ –æ—Ç–ø—Ä–∞–≤—å —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å. –°—Ä–∞–≤–Ω–∏ –∫–∞—á–µ—Å—Ç–≤–æ –æ—Ç–≤–µ—Ç–∞ –¥–æ –∏ –ø–æ—Å–ª–µ.

## –£—Ä–æ–∫ 11.5: –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¢–ó ‚úÖ

### –¢–µ–æ—Ä–∏—è

–ü–æ—Å–ª–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ AI –º–æ–∂–µ—Ç –æ—à–∏–±–∏—Ç—å—Å—è: –Ω–µ—Ç–æ—á–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ, –ª–∏—à–Ω–∏–π –ø—É–Ω–∫—Ç, –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –¢–ó –ø—Ä—è–º–æ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞.

–ß—Ç–æ –Ω—É–∂–Ω–æ:
1. **Backend** ‚Äî —ç–Ω–¥–ø–æ–∏–Ω—Ç `PUT /api/specifications/:id` –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¢–ó
2. **Frontend** ‚Äî —Ä–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ `SpecificationPage.vue`

### –®–∞–≥ 1: –≠–Ω–¥–ø–æ–∏–Ω—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (Backend)

–î–æ–±–∞–≤—å —Ñ—É–Ω–∫—Ü–∏—é `update` –≤ `src/controllers/specificationController.js`:

```javascript
/**
 * PUT /api/specifications/:id
 *
 * –û–±–Ω–æ–≤–∏—Ç—å –¢–ó: –Ω–∞–∑–≤–∞–Ω–∏–µ, —Å–µ–∫—Ü–∏–∏ –∏ –ø—É–Ω–∫—Ç—ã
 *
 * –°—Ç—Ä–∞—Ç–µ–≥–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:
 * 1. –£–¥–∞–ª—è–µ–º –≤—Å–µ —Å—Ç–∞—Ä—ã–µ —Å–µ–∫—Ü–∏–∏ (–∫–∞—Å–∫–∞–¥–Ω–æ —É–¥–∞–ª—è—Ç—Å—è –ø—É–Ω–∫—Ç—ã)
 * 2. –°–æ–∑–¥–∞—ë–º –Ω–æ–≤—ã–µ —Å–µ–∫—Ü–∏–∏ –∏ –ø—É–Ω–∫—Ç—ã –∏–∑ —Ç–µ–ª–∞ –∑–∞–ø—Ä–æ—Å–∞
 *
 * –ü–æ—á–µ–º—É —É–¥–∞–ª—è–µ–º –∏ —Å–æ–∑–¥–∞—ë–º –∑–∞–Ω–æ–≤–æ, –∞ –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ–º –ø–æ –æ–¥–Ω–æ–º—É?
 * - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–≥ –¥–æ–±–∞–≤–∏—Ç—å/—É–¥–∞–ª–∏—Ç—å —Å–µ–∫—Ü–∏–∏ –∏ –ø—É–Ω–∫—Ç—ã
 * - –ú–æ–≥ –ø–æ–º–µ–Ω—è—Ç—å –ø–æ—Ä—è–¥–æ–∫
 * - –ü—Ä–æ—â–µ –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å, —á–µ–º –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –∫–∞–∂–¥–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ
 * - Prisma –¥–µ–ª–∞–µ—Ç –≤—Å—ë –≤ –æ–¥–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ ‚Äî –±–µ–∑–æ–ø–∞—Å–Ω–æ
 */
async function update(req, res) {
  try {
    const id = parseInt(req.params.id)
    const { title, sections } = req.body

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –¢–ó —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
    const existing = await prisma.specification.findFirst({
      where: { id, userId: req.userId }
    })
    if (!existing) {
      return res.status(404).json({ error: '–¢–ó –Ω–µ –Ω–∞–π–¥–µ–Ω–æ' })
    }

    // ========================================
    // –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è: —É–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ —Å–µ–∫—Ü–∏–∏ + –æ–±–Ω–æ–≤–ª—è–µ–º –¢–ó
    //
    // prisma.$transaction ‚Äî –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —á—Ç–æ –ª–∏–±–æ –í–°–ï
    // –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—Ç—Å—è, –ª–∏–±–æ –ù–ò –û–î–ù–ê (–∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å)
    // ========================================
    const updated = await prisma.$transaction(async (tx) => {
      // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ —Å–µ–∫—Ü–∏–∏ (items —É–¥–∞–ª—è—Ç—Å—è –∫–∞—Å–∫–∞–¥–Ω–æ)
      await tx.section.deleteMany({
        where: { specificationId: id }
      })

      // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏ —Å–æ–∑–¥–∞—ë–º –Ω–æ–≤—ã–µ —Å–µ–∫—Ü–∏–∏
      return tx.specification.update({
        where: { id },
        data: {
          title,
          sections: {
            create: sections.map((section, sIdx) => ({
              title: section.title,
              position: sIdx,
              items: {
                create: section.items.map((item, iIdx) => ({
                  content: item.content,
                  timeEstimate: item.timeEstimate || null,
                  position: iIdx
                }))
              }
            }))
          }
        },
        include: {
          sections: {
            orderBy: { position: 'asc' },
            include: {
              items: { orderBy: { position: 'asc' } }
            }
          }
        }
      })
    })

    res.json(updated)
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¢–ó:', error)
    res.status(500).json({ error: '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞' })
  }
}
```

–ù–µ –∑–∞–±—É–¥—å –¥–æ–±–∞–≤–∏—Ç—å `update` –≤ `module.exports`:

```javascript
module.exports = { generate, getById, getAll, update }
```

### –®–∞–≥ 2: –ü–æ–¥–∫–ª—é—á–∏—Ç—å —Ä–æ—É—Ç

–í `src/routes/specifications.js` –¥–æ–±–∞–≤—å:

```javascript
const { generate, getById, getAll, update } = require('../controllers/specificationController')

// ... –ø–æ—Å–ª–µ –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Ä–æ—É—Ç–æ–≤
router.put('/:id', update)
```

### –®–∞–≥ 3: –†–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ

–û–±–Ω–æ–≤–∏ `src/pages/SpecificationPage.vue` ‚Äî –¥–æ–±–∞–≤—å –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–º –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º:

**–í `<script setup>` –¥–æ–±–∞–≤—å:**

```javascript
// ========================================
// –†–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
//
// isEditing ‚Äî –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –ø—Ä–æ—Å–º–æ—Ç—Ä/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
// editTitle ‚Äî —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫
// editSections ‚Äî —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º—ã–µ —Å–µ–∫—Ü–∏–∏ (–∫–æ–ø–∏—è –¥–∞–Ω–Ω—ã—Ö)
//
// –†–∞–±–æ—Ç–∞–µ–º —Å –∫–æ–ø–∏–µ–π, —á—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ –æ—Ç–º–µ–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
// ========================================
const isEditing = ref(false)
const editTitle = ref('')
const editSections = ref([])
const isSaving = ref(false)

// –í–∫–ª—é—á–∏—Ç—å —Ä–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
// JSON.parse(JSON.stringify(...)) ‚Äî –≥–ª—É–±–æ–∫–∞—è –∫–æ–ø–∏—è –æ–±—ä–µ–∫—Ç–∞
function startEditing() {
  editTitle.value = spec.value.title
  editSections.value = JSON.parse(JSON.stringify(spec.value.sections))
  isEditing.value = true
}

// –û—Ç–º–µ–Ω–∏—Ç—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
function cancelEditing() {
  isEditing.value = false
}

// –î–æ–±–∞–≤–∏—Ç—å —Ä–∞–∑–¥–µ–ª
function addSection() {
  editSections.value.push({
    title: '–ù–æ–≤—ã–π —Ä–∞–∑–¥–µ–ª',
    items: [{ content: '', timeEstimate: null }]
  })
}

// –î–æ–±–∞–≤–∏—Ç—å –ø—É–Ω–∫—Ç –≤ —Ä–∞–∑–¥–µ–ª
function addItem(sIdx) {
  editSections.value[sIdx].items.push({
    content: '',
    timeEstimate: null
  })
}

// –£–¥–∞–ª–∏—Ç—å –ø—É–Ω–∫—Ç
function removeItem(sIdx, iIdx) {
  editSections.value[sIdx].items.splice(iIdx, 1)
}

// –£–¥–∞–ª–∏—Ç—å —Ä–∞–∑–¥–µ–ª
function removeSection(sIdx) {
  editSections.value.splice(sIdx, 1)
}

// –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
async function saveChanges() {
  isSaving.value = true
  try {
    const response = await api.put(`/specifications/${route.params.id}`, {
      title: editTitle.value,
      sections: editSections.value
    })
    spec.value = response.data
    isEditing.value = false
  } catch (e) {
    error.value = e.response?.data?.error || '–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è'
  } finally {
    isSaving.value = false
  }
}
```

**–í `<template>` –¥–æ–±–∞–≤—å –∫–Ω–æ–ø–∫—É "–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å" –∏ —Ñ–æ—Ä–º—É —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**

```html
<!-- –ö–Ω–æ–ø–∫–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (–≤ —Ä–µ–∂–∏–º–µ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞) -->
<button v-if="!isEditing" @click="startEditing"
  class="mb-6 bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 text-sm">
  –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
</button>

<!-- –†–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
<div v-if="isEditing">
  <!-- –ù–∞–∑–≤–∞–Ω–∏–µ -->
  <div class="bg-white rounded-lg shadow p-6 mb-4">
    <label class="block text-sm font-medium mb-1">–ù–∞–∑–≤–∞–Ω–∏–µ –¢–ó</label>
    <input v-model="editTitle" type="text" class="w-full border rounded px-3 py-2" />
  </div>

  <!-- –°–µ–∫—Ü–∏–∏ -->
  <div v-for="(section, sIdx) in editSections" :key="sIdx"
    class="bg-white rounded-lg shadow p-6 mb-4">
    <div class="flex items-center justify-between mb-4">
      <input v-model="section.title" type="text"
        class="text-lg font-semibold border-b border-transparent hover:border-gray-300 focus:border-blue-500 outline-none flex-1"
        placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–∞" />
      <button @click="removeSection(sIdx)"
        class="text-red-400 hover:text-red-600 ml-4 text-sm">
        –£–¥–∞–ª–∏—Ç—å —Ä–∞–∑–¥–µ–ª
      </button>
    </div>

    <div v-for="(item, iIdx) in section.items" :key="iIdx"
      class="flex gap-3 mb-3 items-start">
      <span class="text-gray-400 mt-2 text-sm">{{ sIdx + 1 }}.{{ iIdx + 1 }}</span>
      <textarea v-model="item.content" rows="2"
        class="flex-1 border rounded px-3 py-2 text-sm"
        placeholder="–û–ø–∏—Å–∞–Ω–∏–µ –ø—É–Ω–∫—Ç–∞"></textarea>
      <input v-model.number="item.timeEstimate" type="number" min="0"
        class="w-20 border rounded px-2 py-2 text-sm"
        placeholder="–º–∏–Ω" />
      <button @click="removeItem(sIdx, iIdx)"
        class="text-red-400 hover:text-red-600 mt-2">&times;</button>
    </div>

    <button @click="addItem(sIdx)"
      class="text-blue-500 hover:text-blue-700 text-sm">
      + –î–æ–±–∞–≤–∏—Ç—å –ø—É–Ω–∫—Ç
    </button>
  </div>

  <!-- –ö–Ω–æ–ø–∫–∏ -->
  <div class="flex gap-4">
    <button @click="addSection"
      class="bg-gray-200 px-4 py-2 rounded hover:bg-gray-300">
      + –î–æ–±–∞–≤–∏—Ç—å —Ä–∞–∑–¥–µ–ª
    </button>
    <button @click="saveChanges" :disabled="isSaving"
      class="bg-green-500 text-white px-6 py-2 rounded hover:bg-green-600 disabled:opacity-50">
      {{ isSaving ? '–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...' : '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å' }}
    </button>
    <button @click="cancelEditing"
      class="bg-gray-200 px-4 py-2 rounded hover:bg-gray-300">
      –û—Ç–º–µ–Ω–∞
    </button>
  </div>
</div>
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞

1. –û—Ç–∫—Ä–æ–π –ª—é–±–æ–µ –¢–ó
2. –ù–∞–∂–º–∏ "–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å"
3. –ò–∑–º–µ–Ω–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ, –¥–æ–±–∞–≤—å/—É–¥–∞–ª–∏ –ø—É–Ω–∫—Ç—ã, –ø–æ–º–µ–Ω—è–π –æ—Ü–µ–Ω–∫–∏
4. –ù–∞–∂–º–∏ "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å" ‚Äî –¥–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤—è—Ç—Å—è –≤ –ë–î
5. –ù–∞–∂–º–∏ "–û—Ç–º–µ–Ω–∞" ‚Äî –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ—Ç–∫–∞—Ç—è—Ç—Å—è

---

## –£—Ä–æ–∫ 11.6: –°—Ç–∞—Ç—É—Å –¢–ó ‚¨ú

### –¢–µ–æ—Ä–∏—è

–î–æ–±–∞–≤–∏–º –ø–æ–ª–µ `status` –≤ –º–æ–¥–µ–ª—å `Specification`, —á—Ç–æ–±—ã –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¢–ó: —á–µ—Ä–Ω–æ–≤–∏–∫, –≤ —Ä–∞–±–æ—Ç–µ, –≤—ã–ø–æ–ª–Ω–µ–Ω–æ.

–°—Ç–∞—Ç—É—Å—ã:
- `draft` ‚Äî —á–µ—Ä–Ω–æ–≤–∏–∫ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- `in_progress` ‚Äî –≤ —Ä–∞–±–æ—Ç–µ
- `completed` ‚Äî –≤—ã–ø–æ–ª–Ω–µ–Ω–æ

### –®–∞–≥ 1: –û–±–Ω–æ–≤–∏ —Å—Ö–µ–º—É Prisma

–í —Ñ–∞–π–ª–µ `backend/prisma/schema.prisma` –¥–æ–±–∞–≤—å –ø–æ–ª–µ `status` –≤ –º–æ–¥–µ–ª—å `Specification`:

```prisma
model Specification{
  id Int @id @default(autoincrement())
  title String
  status String @default("draft") // draft, in_progress, completed
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  projectId Int
  project Project @relation(fields: [projectId], references: [id], onDelete: Cascade)

  userId Int
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  sections Section[]
}
```

–ó–∞—Ç–µ–º –ø—Ä–∏–º–µ–Ω–∏ –º–∏–≥—Ä–∞—Ü–∏—é:

```bash
cd backend
npx prisma migrate dev --name add-spec-status
```

### –®–∞–≥ 2: –ë—ç–∫–µ–Ω–¥ ‚Äî —ç–Ω–¥–ø–æ–∏–Ω—Ç —Å–º–µ–Ω—ã —Å—Ç–∞—Ç—É—Å–∞

–í —Ñ–∞–π–ª–µ `backend/src/controllers/specificationController.js` –¥–æ–±–∞–≤—å —Ñ—É–Ω–∫—Ü–∏—é `updateStatus`:

```javascript
/**
 * PATCH /api/specifications/:id/status
 *
 * –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å –¢–ó
 * Body: { status: "draft" | "in_progress" | "completed" }
 */
async function updateStatus(req, res) {
  try {
    const id = parseInt(req.params.id)
    const { status } = req.body

    // –í–∞–ª–∏–¥–∞—Ü–∏—è —Å—Ç–∞—Ç—É—Å–∞
    const validStatuses = ['draft', 'in_progress', 'completed']
    if (!validStatuses.includes(status)) {
      return res.status(400).json({
        error: `–ù–µ–≤–∞–ª–∏–¥–Ω—ã–π —Å—Ç–∞—Ç—É—Å. –î–æ–ø—É—Å—Ç–∏–º—ã–µ: ${validStatuses.join(', ')}`
      })
    }

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –¢–ó —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
    const existing = await prisma.specification.findFirst({
      where: { id, userId: req.userId }
    })
    if (!existing) {
      return res.status(404).json({ error: '–¢–ó –Ω–µ –Ω–∞–π–¥–µ–Ω–æ' })
    }

    const updated = await prisma.specification.update({
      where: { id },
      data: { status },
      include: {
        sections: {
          orderBy: { position: 'asc' },
          include: {
            items: { orderBy: { position: 'asc' } }
          }
        }
      }
    })

    res.json(updated)
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞:', error)
    res.status(500).json({ error: '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞' })
  }
}
```

–ù–µ –∑–∞–±—É–¥—å –¥–æ–±–∞–≤–∏—Ç—å `updateStatus` –≤ `module.exports`:

```javascript
module.exports = { generate, getById, getAll, update, updateStatus }
```

### –®–∞–≥ 3: –ë—ç–∫–µ–Ω–¥ ‚Äî —Ä–æ—É—Ç

–í —Ñ–∞–π–ª–µ `backend/src/routes/specifications.js` –¥–æ–±–∞–≤—å —Ä–æ—É—Ç:

```javascript
const { generate, getById, getAll, update, updateStatus } = require('../controllers/specificationController')

// ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ä–æ—É—Ç—ã ...
router.patch('/:id/status', updateStatus)
```

> **–ü–æ—á–µ–º—É PATCH, –∞ –Ω–µ PUT?** `PUT` –æ–±–Ω–æ–≤–ª—è–µ—Ç –≤–µ—Å—å —Ä–µ—Å—É—Ä—Å —Ü–µ–ª–∏–∫–æ–º, –∞ `PATCH` ‚Äî —Ç–æ–ª—å–∫–æ —á–∞—Å—Ç—å (–≤ –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ —Ç–æ–ª—å–∫–æ –ø–æ–ª–µ `status`).

### –®–∞–≥ 4: –§—Ä–æ–Ω—Ç–µ–Ω–¥ ‚Äî –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏ —Å–º–µ–Ω–∞ —Å—Ç–∞—Ç—É—Å–∞

–í —Ñ–∞–π–ª–µ `frontend/src/pages/SpecificationPage.vue` –¥–æ–±–∞–≤—å –ª–æ–≥–∏–∫—É —Å—Ç–∞—Ç—É—Å–æ–≤.

**–í `<script setup>`** –¥–æ–±–∞–≤—å:

```javascript
// –ú–∞–ø–ø–∏–Ω–≥ —Å—Ç–∞—Ç—É—Å–æ–≤ –Ω–∞ —Ä—É—Å—Å–∫–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è –∏ —Ü–≤–µ—Ç–∞
const statusMap = {
  draft: { label: '–ß–µ—Ä–Ω–æ–≤–∏–∫', color: 'bg-gray-200 text-gray-700' },
  in_progress: { label: '–í —Ä–∞–±–æ—Ç–µ', color: 'bg-blue-100 text-blue-700' },
  completed: { label: '–í—ã–ø–æ–ª–Ω–µ–Ω–æ', color: 'bg-green-100 text-green-700' }
}

// –°–º–µ–Ω–∞ —Å—Ç–∞—Ç—É—Å–∞
async function changeStatus(newStatus) {
  try {
    const response = await api.patch(`/specifications/${route.params.id}/status`, {
      status: newStatus
    })
    spec.value = response.data
  } catch (e) {
    error.value = e.response?.data?.error || '–û—à–∏–±–∫–∞ —Å–º–µ–Ω—ã —Å—Ç–∞—Ç—É—Å–∞'
  }
}
```

**–í `<template>`** ‚Äî –¥–æ–±–∞–≤—å –±–µ–π–¥–∂ —Å—Ç–∞—Ç—É—Å–∞ —Ä—è–¥–æ–º —Å –∑–∞–≥–æ–ª–æ–≤–∫–æ–º –∏ –∫–Ω–æ–ø–∫–∏ —Å–º–µ–Ω—ã:

```html
<!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ + —Å—Ç–∞—Ç—É—Å + –æ–±—â–µ–µ –≤—Ä–µ–º—è -->
<div class="flex items-center justify-between mb-6">
  <div class="flex items-center gap-3">
    <h1 class="text-2xl font-bold">{{ spec.title }}</h1>
    <span :class="['text-xs px-2 py-1 rounded-full font-medium',
      statusMap[spec.status]?.color || 'bg-gray-200']">
      {{ statusMap[spec.status]?.label || spec.status }}
    </span>
  </div>
  <span class="text-sm text-gray-500">
    –û–±—â–µ–µ –≤—Ä–µ–º—è: {{ formatTime(totalTime()) }}
  </span>
</div>

<!-- –ö–Ω–æ–ø–∫–∏ —Å–º–µ–Ω—ã —Å—Ç–∞—Ç—É—Å–∞ (–≤ —Ä–µ–∂–∏–º–µ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞) -->
<div v-if="!isEditing" class="flex gap-2 mb-6">
  <button v-if="spec.status !== 'draft'" @click="changeStatus('draft')"
    class="text-sm px-3 py-1 rounded bg-gray-200 hover:bg-gray-300">
    –ß–µ—Ä–Ω–æ–≤–∏–∫
  </button>
  <button v-if="spec.status !== 'in_progress'" @click="changeStatus('in_progress')"
    class="text-sm px-3 py-1 rounded bg-blue-100 text-blue-700 hover:bg-blue-200">
    –í —Ä–∞–±–æ—Ç–µ
  </button>
  <button v-if="spec.status !== 'completed'" @click="changeStatus('completed')"
    class="text-sm px-3 py-1 rounded bg-green-100 text-green-700 hover:bg-green-200">
    –í—ã–ø–æ–ª–Ω–µ–Ω–æ
  </button>
</div>
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞

1. –ü—Ä–∏–º–µ–Ω–∏ –º–∏–≥—Ä–∞—Ü–∏—é (`npx prisma migrate dev --name add-spec-status`)
2. –û—Ç–∫—Ä–æ–π –¢–ó ‚Äî –¥–æ–ª–∂–µ–Ω –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –±–µ–π–¥–∂ "–ß–µ—Ä–Ω–æ–≤–∏–∫"
3. –ù–∞–∂–º–∏ "–í —Ä–∞–±–æ—Ç–µ" ‚Äî —Å—Ç–∞—Ç—É—Å –∏–∑–º–µ–Ω–∏—Ç—Å—è –Ω–∞ —Å–∏–Ω–∏–π
4. –ù–∞–∂–º–∏ "–í—ã–ø–æ–ª–Ω–µ–Ω–æ" ‚Äî —Å—Ç–∞—Ç—É—Å —Å—Ç–∞–Ω–µ—Ç –∑–µ–ª—ë–Ω—ã–º
5. –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ —Å—Ç–∞—Ç—É—Å —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã

---

## –£—Ä–æ–∫ 11.7: –£–¥–∞–ª–µ–Ω–∏–µ –¢–ó ‚úÖ

### –¢–µ–æ—Ä–∏—è

–î–æ–±–∞–≤–∏–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —É–¥–∞–ª—è—Ç—å –¢–ó. –ë–ª–∞–≥–æ–¥–∞—Ä—è `onDelete: Cascade` –≤ —Å—Ö–µ–º–µ Prisma, –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ Specification –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è—Ç—Å—è –≤—Å–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ Section –∏ Item.

–í–∞–∂–Ω–æ: –ø–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–∏–∞–ª–æ–≥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è, —á—Ç–æ–±—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ —É–¥–∞–ª–∏–ª –¢–ó —Å–ª—É—á–∞–π–Ω–æ.

### –®–∞–≥ 1: –ë—ç–∫–µ–Ω–¥ ‚Äî –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä

–í —Ñ–∞–π–ª–µ `backend/src/controllers/specificationController.js` –¥–æ–±–∞–≤—å —Ñ—É–Ω–∫—Ü–∏—é `remove`:

```javascript
/**
 * DELETE /api/specifications/:id
 *
 * –£–¥–∞–ª–∏—Ç—å –¢–ó (–∫–∞—Å–∫–∞–¥–Ω–æ —É–¥–∞–ª—è—Ç—Å—è —Å–µ–∫—Ü–∏–∏ –∏ –ø—É–Ω–∫—Ç—ã)
 */
async function remove(req, res) {
  try {
    const id = parseInt(req.params.id)

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –¢–ó —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
    const existing = await prisma.specification.findFirst({
      where: { id, userId: req.userId }
    })
    if (!existing) {
      return res.status(404).json({ error: '–¢–ó –Ω–µ –Ω–∞–π–¥–µ–Ω–æ' })
    }

    await prisma.specification.delete({
      where: { id }
    })

    res.json({ message: '–¢–ó —É–¥–∞–ª–µ–Ω–æ' })
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –¢–ó:', error)
    res.status(500).json({ error: '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞' })
  }
}
```

–û–±–Ω–æ–≤–∏ `module.exports`:

```javascript
module.exports = { generate, getById, getAll, update, updateStatus, remove }
```

### –®–∞–≥ 2: –ë—ç–∫–µ–Ω–¥ ‚Äî —Ä–æ—É—Ç

–í —Ñ–∞–π–ª–µ `backend/src/routes/specifications.js`:

```javascript
const { generate, getById, getAll, update, updateStatus, remove } = require('../controllers/specificationController')

// ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ä–æ—É—Ç—ã ...
router.delete('/:id', remove)
```

### –®–∞–≥ 3: –§—Ä–æ–Ω—Ç–µ–Ω–¥ ‚Äî –∫–Ω–æ–ø–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è

–í —Ñ–∞–π–ª–µ `frontend/src/pages/SpecificationPage.vue` –¥–æ–±–∞–≤—å –ª–æ–≥–∏–∫—É —É–¥–∞–ª–µ–Ω–∏—è.

**–í `<script setup>`** –¥–æ–±–∞–≤—å:

```javascript
import { useRouter } from 'vue-router'

const router = useRouter()

// –£–¥–∞–ª–µ–Ω–∏–µ –¢–ó —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º
async function deleteSpec() {
  if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ –¢–ó? –í—Å–µ —Å–µ–∫—Ü–∏–∏ –∏ –ø—É–Ω–∫—Ç—ã –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã –±–µ–∑–≤–æ–∑–≤—Ä–∞—Ç–Ω–æ.')) {
    return
  }

  try {
    await api.delete(`/specifications/${route.params.id}`)
    router.push('/dashboard')
  } catch (e) {
    error.value = e.response?.data?.error || '–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è'
  }
}
```

> **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** `useRoute` –¥–ª—è —á—Ç–µ–Ω–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ URL —É —Ç–µ–±—è —É–∂–µ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω. –¢–µ–ø–µ—Ä—å –Ω—É–∂–µ–Ω –µ—â—ë `useRouter` –¥–ª—è –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ (`router.push`). –≠—Ç–æ —Ä–∞–∑–Ω—ã–µ –≤–µ—â–∏: `route` ‚Äî —Ç–µ–∫—É—â–∏–π –º–∞—Ä—à—Ä—É—Ç, `router` ‚Äî –Ω–∞–≤–∏–≥–∞—Ç–æ—Ä.

**–í `<template>`** ‚Äî –¥–æ–±–∞–≤—å –∫–Ω–æ–ø–∫—É —É–¥–∞–ª–µ–Ω–∏—è —Ä—è–¥–æ–º —Å –∫–Ω–æ–ø–∫–æ–π "–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å":

```html
<!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π (–≤ —Ä–µ–∂–∏–º–µ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞) -->
<div v-if="!isEditing" class="flex gap-2 mb-6">
  <button @click="startEditing"
    class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 text-sm">
    –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
  </button>
  <button @click="deleteSpec"
    class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600 text-sm">
    –£–¥–∞–ª–∏—Ç—å
  </button>
</div>
```

> –ó–∞–º–µ–Ω–∏ —Å—Ç–∞—Ä—É—é –æ–¥–∏–Ω–æ—á–Ω—É—é –∫–Ω–æ–ø–∫—É "–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å" –Ω–∞ —ç—Ç–æ—Ç –±–ª–æ–∫ —Å –¥–≤—É–º—è –∫–Ω–æ–ø–∫–∞–º–∏.

### –ü—Ä–æ–≤–µ—Ä–∫–∞

1. –û—Ç–∫—Ä–æ–π –ª—é–±–æ–µ –¢–ó
2. –ù–∞–∂–º–∏ "–£–¥–∞–ª–∏—Ç—å"
3. –í –¥–∏–∞–ª–æ–≥–µ –Ω–∞–∂–º–∏ "OK" ‚Äî –¢–ó —É–¥–∞–ª–∏—Ç—Å—è, —Ç–µ–±—è –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç –Ω–∞ –≥–ª–∞–≤–Ω—É—é
4. –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ –¢–ó –ø—Ä–æ–ø–∞–ª–æ –∏–∑ —Å–ø–∏—Å–∫–∞
5. –ù–∞–∂–º–∏ "–û—Ç–º–µ–Ω–∞" –≤ –¥–∏–∞–ª–æ–≥–µ ‚Äî –Ω–∏—á–µ–≥–æ –Ω–µ –ø—Ä–æ–∏–∑–æ–π–¥—ë—Ç

---

# –ß–ê–°–¢–¨ 12: AI-–°–¢–†–£–ö–¢–£–†–ò–†–û–í–ê–ù–ò–ï –ß–ï–†–ï–ó OLLAMA ‚úÖ

## –£—Ä–æ–∫ 12.1: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ Ollama ‚úÖ

### –¢–µ–æ—Ä–∏—è

Ollama ‚Äî –ª–æ–∫–∞–ª—å–Ω—ã–π AI, –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä—è–º–æ –Ω–∞ —Ç–≤–æ—ë–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ.
- –ü–æ–ª–Ω–æ—Å—Ç—å—é –±–µ—Å–ø–ª–∞—Ç–µ–Ω ‚Äî –Ω–∏–∫–∞–∫–∏—Ö API-–∫–ª—é—á–µ–π –∏ –ª–∏–º–∏—Ç–æ–≤
- –†–∞–±–æ—Ç–∞–µ—Ç –æ—Ñ–ª–∞–π–Ω –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–∏
- –•–æ—Ä–æ—à–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å —Ä—É—Å—Å–∫–∏–º —è–∑—ã–∫–æ–º (–º–æ–¥–µ–ª—å qwen2.5)
- –û—Ç–¥–∞—ë—Ç –æ—Ç–≤–µ—Ç—ã —á–µ—Ä–µ–∑ REST API –Ω–∞ `localhost:11434`

### –®–∞–≥ 1: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Ollama

1. –ü–µ—Ä–µ–π–¥–∏ –Ω–∞ https://ollama.com –∏ —Å–∫–∞—á–∞–π —É—Å—Ç–∞–Ω–æ–≤—â–∏–∫ –¥–ª—è —Å–≤–æ–µ–π –û–°
2. –£—Å—Ç–∞–Ω–æ–≤–∏ –∏ –∑–∞–ø—É—Å—Ç–∏ Ollama
3. –°–∫–∞—á–∞–π –º–æ–¥–µ–ª—å (–≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ):

```bash
ollama pull qwen2.5:7b
```

> –ú–æ–¥–µ–ª—å –≤–µ—Å–∏—Ç ~4.5 –ì–ë. –ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–π–º—ë—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç.
> –ï—Å–ª–∏ —É —Ç–µ–±—è –º–∞–ª–æ RAM (–º–µ–Ω—å—à–µ 8 –ì–ë), –∏—Å–ø–æ–ª—å–∑—É–π `qwen2.5:3b` ‚Äî –æ–Ω–∞ –ª–µ–≥—á–µ.

4. –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç:

```bash
ollama run qwen2.5:7b "–ü—Ä–∏–≤–µ—Ç, –æ—Ç–≤–µ—Ç—å –æ–¥–Ω–∏–º —Å–ª–æ–≤–æ–º"
```

### –®–∞–≥ 2: –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–î–æ–±–∞–≤—å –≤ `backend/.env`:

```env
OLLAMA_URL=http://localhost:11434
OLLAMA_MODEL=qwen2.5:7b
```

## –£—Ä–æ–∫ 12.2: –°–µ—Ä–≤–∏—Å Ollama (Backend) ‚úÖ

### –¢–µ–æ—Ä–∏—è

Ollama –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç REST API. –ú—ã –±—É–¥–µ–º –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å POST-–∑–∞–ø—Ä–æ—Å –Ω–∞ `/api/generate` —Å –ø—Ä–æ–º–ø—Ç–æ–º –∏ –ø–æ–ª—É—á–∞—Ç—å –æ—Ç–≤–µ—Ç –æ—Ç –º–æ–¥–µ–ª–∏.

–ö–ª—é—á–µ–≤–æ–π –º–æ–º–µ–Ω—Ç: –º—ã –ø—Ä–æ—Å–∏–º –º–æ–¥–µ–ª—å –≤–µ—Ä–Ω—É—Ç—å JSON, –Ω–æ AI –∏–Ω–æ–≥–¥–∞ –¥–æ–±–∞–≤–ª—è–µ—Ç —Ç–µ–∫—Å—Ç –¥–æ/–ø–æ—Å–ª–µ JSON. –ü–æ—ç—Ç–æ–º—É –Ω—É–∂–Ω–∞ –Ω–∞–¥—ë–∂–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–∞.

### –®–∞–≥ 1: –û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π AI-—Å–µ—Ä–≤–∏—Å

–ó–∞–º–µ–Ω–∏ `src/services/aiService.js` (—Ç–æ—Ç, —á—Ç–æ —Å–æ–∑–¥–∞–ª–∏ –≤ –ß–∞—Å—Ç–∏ 6):

```javascript
// ========================================
// –°–µ—Ä–≤–∏—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Ollama
//
// Ollama ‚Äî –ª–æ–∫–∞–ª—å–Ω—ã–π AI-—Å–µ—Ä–≤–µ—Ä
// –û–±—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑ HTTP API (REST)
// –≠–Ω–¥–ø–æ–∏–Ω—Ç: POST /api/generate
// ========================================

const OLLAMA_URL = process.env.OLLAMA_URL || 'http://localhost:11434'
const OLLAMA_MODEL = process.env.OLLAMA_MODEL || 'qwen2.5:7b'

/**
 * –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ —á–µ—Ä–µ–∑ Ollama
 *
 * @param {string} text ‚Äî —Å—ã—Ä–æ–π —Ç–µ–∫—Å—Ç –∏–∑ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ –≤–≤–æ–¥–∞
 * @returns {Object} ‚Äî { title, sections: [{ title, items: [{ content, timeEstimate }] }] }
 *
 * –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:
 * 1. –§–æ—Ä–º–∏—Ä—É–µ–º –ø—Ä–æ–º–ø—Ç —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–µ–π –¥–ª—è AI
 * 2. –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –≤ Ollama —á–µ—Ä–µ–∑ fetch
 * 3. Ollama –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ –Ω–∞ —Ç–≤–æ—ë–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ
 * 4. –ü–∞—Ä—Å–∏–º JSON –∏–∑ –æ—Ç–≤–µ—Ç–∞
 */
async function structureText(text) {
  // ========================================
  // –ü—Ä–æ–º–ø—Ç ‚Äî –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è AI
  //
  // –ö–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã:
  // - –ü—Ä–æ—Å–∏–º –≤–µ—Ä–Ω—É—Ç—å –¢–û–õ–¨–ö–û JSON (–±–µ–∑ markdown)
  // - –£–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ—á–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –æ–∂–∏–¥–∞–µ–º–æ–≥–æ –æ—Ç–≤–µ—Ç–∞
  // - –ü—Ä–æ—Å–∏–º –æ—Ü–µ–Ω–∏—Ç—å –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–∞–∂–¥–æ–≥–æ –ø—É–Ω–∫—Ç–∞
  // - –ü—Ä–æ—Å–∏–º –ø—Ä–∏–¥—É–º–∞—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ –¥–ª—è –¢–ó
  // ========================================
  const prompt = `–¢—ã ‚Äî –ø–æ–º–æ—â–Ω–∏–∫ –ø–æ —Å–æ–∑–¥–∞–Ω–∏—é —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –∑–∞–¥–∞–Ω–∏–π.

–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —Ç–µ–∫—Å—Ç –Ω–∏–∂–µ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä—É–π –µ–≥–æ –≤ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ.
–†–∞–∑–¥–µ–ª–∏ –Ω–∞ –ª–æ–≥–∏—á–µ—Å–∫–∏–µ —Ä–∞–∑–¥–µ–ª—ã, –∫–∞–∂–¥—ã–π —Ä–∞–∑–¥–µ–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –ø—É–Ω–∫—Ç—ã.
–î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—É–Ω–∫—Ç–∞ –¥–∞–π –æ—Ü–µ–Ω–∫—É –≤—Ä–µ–º–µ–Ω–∏ –≤ –º–∏–Ω—É—Ç–∞—Ö.
–ü—Ä–∏–¥—É–º–∞–π –∫—Ä–∞—Ç–∫–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –¥–ª—è –¢–ó.

–í–µ—Ä–Ω–∏ –¢–û–õ–¨–ö–û JSON –±–µ–∑ markdown-–æ–±—ë—Ä—Ç–∫–∏, —Å—Ç—Ä–æ–≥–æ –≤ —Ñ–æ—Ä–º–∞—Ç–µ:
{
  "title": "–ù–∞–∑–≤–∞–Ω–∏–µ –¢–ó",
  "sections": [
    {
      "title": "–ù–∞–∑–≤–∞–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–∞",
      "items": [
        {
          "content": "–û–ø–∏—Å–∞–Ω–∏–µ –ø—É–Ω–∫—Ç–∞",
          "timeEstimate": 60
        }
      ]
    }
  ]
}

–¢–µ–∫—Å—Ç –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞:
${text}`

  // ========================================
  // –ó–∞–ø—Ä–æ—Å –∫ Ollama
  //
  // fetch ‚Äî –≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è HTTP-–∑–∞–ø—Ä–æ—Å–æ–≤ (Node 18+)
  // stream: false ‚Äî –ø–æ–ª—É—á–∞–µ–º –≤–µ—Å—å –æ—Ç–≤–µ—Ç —Å—Ä–∞–∑—É (–Ω–µ –ø–æ —á–∞—Å—Ç—è–º)
  // signal + AbortController ‚Äî —Ç–∞–π–º–∞—É—Ç 60 —Å–µ–∫ (AI –º–æ–∂–µ—Ç –¥—É–º–∞—Ç—å –¥–æ–ª–≥–æ)
  // ========================================
  const controller = new AbortController()
  const timeout = setTimeout(() => controller.abort(), 60000)

  try {
    const response = await fetch(`${OLLAMA_URL}/api/generate`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        model: OLLAMA_MODEL,
        prompt,
        stream: false
      }),
      signal: controller.signal
    })

    clearTimeout(timeout)

    if (!response.ok) {
      throw new Error(`Ollama –≤–µ—Ä–Ω—É–ª–∞ –æ—à–∏–±–∫—É: ${response.status}`)
    }

    const data = await response.json()

    // ========================================
    // –ü–∞—Ä—Å–∏–Ω–≥ –æ—Ç–≤–µ—Ç–∞
    //
    // data.response ‚Äî —Ç–µ–∫—Å—Ç –æ—Ç AI
    // AI –º–æ–∂–µ—Ç –æ–±–µ—Ä–Ω—É—Ç—å JSON –≤ ```json ... ```
    // –£–±–∏—Ä–∞–µ–º markdown-–æ–±—ë—Ä—Ç–∫—É –µ—Å–ª–∏ –µ—Å—Ç—å
    // ========================================
    const jsonStr = data.response
      .replace(/```json\n?/g, '')
      .replace(/```\n?/g, '')
      .trim()

    return JSON.parse(jsonStr)
  } catch (error) {
    clearTimeout(timeout)

    // –ü–æ–Ω—è—Ç–Ω—ã–µ –æ—à–∏–±–∫–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    if (error.name === 'AbortError') {
      throw new Error('–¢–∞–π–º–∞—É—Ç: Ollama –Ω–µ –æ—Ç–≤–µ—Ç–∏–ª–∞ –∑–∞ 60 —Å–µ–∫—É–Ω–¥')
    }
    if (error.cause?.code === 'ECONNREFUSED') {
      throw new Error('Ollama –Ω–µ –∑–∞–ø—É—â–µ–Ω–∞. –í—ã–ø–æ–ª–Ω–∏: ollama serve')
    }

    console.error('–û—à–∏–±–∫–∞ AI:', error)
    throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç —á–µ—Ä–µ–∑ AI')
  }
}

module.exports = { structureText }
```

> **–û–±—Ä–∞—Ç–∏ –≤–Ω–∏–º–∞–Ω–∏–µ:** –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π `fetch` (–¥–æ—Å—Ç—É–ø–µ–Ω –≤ Node.js 18+).
> –ù–∏–∫–∞–∫–∏—Ö –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–∞–∫–µ—Ç–æ–≤ –¥–ª—è HTTP-–∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–µ –Ω—É–∂–Ω–æ!

### –®–∞–≥ 2: –†–æ—É—Ç –¥–ª—è AI

–°–æ–∑–¥–∞–π `src/routes/ai.js`:

```javascript
const express = require('express')
const { authenticate } = require('../middleware/auth')
const { structureText } = require('../services/aiService')

const router = express.Router()

/**
 * POST /api/ai/structure
 *
 * –¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞: { text: "—Å—ã—Ä–æ–π —Ç–µ–∫—Å—Ç" }
 * –û—Ç–≤–µ—Ç: { title, sections: [...] }
 *
 * –ü–æ—Ç–æ–∫: —Ç–µ–∫—Å—Ç ‚Üí –ø—Ä–æ–º–ø—Ç –¥–ª—è Ollama ‚Üí JSON-—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¢–ó
 */
router.post('/structure', authenticate, async (req, res) => {
  try {
    const { text } = req.body

    if (!text || !text.trim()) {
      return res.status(400).json({ error: '–¢–µ–∫—Å—Ç –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º' })
    }

    const structured = await structureText(text)
    res.json(structured)
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ AI-—Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–∏—è:', error)
    res.status(500).json({ error: error.message })
  }
})

module.exports = router
```

### –®–∞–≥ 3: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –≤ index.js

–î–æ–±–∞–≤—å –≤ `src/index.js` —Ä—è–¥–æ–º —Å –¥—Ä—É–≥–∏–º–∏ —Ä–æ—É—Ç–∞–º–∏:

```javascript
const aiRoutes = require('./routes/ai')

app.use('/api/ai', aiRoutes)
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞

1. –£–±–µ–¥–∏—Å—å —á—Ç–æ Ollama –∑–∞–ø—É—â–µ–Ω–∞ (`ollama serve`)
2. –ó–∞–ø—É—Å—Ç–∏ –±—ç–∫–µ–Ω–¥: `npm run dev`
3. –ü—Ä–æ–≤–µ—Ä—å —á–µ—Ä–µ–∑ curl –∏–ª–∏ Postman:

```bash
curl -X POST http://localhost:3000/api/ai/structure \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer –¢–í–û–ô_–¢–û–ö–ï–ù" \
  -d '{"text": "–ù—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω —Å –∫–∞—Ç–∞–ª–æ–≥–æ–º —Ç–æ–≤–∞—Ä–æ–≤, –∫–æ—Ä–∑–∏–Ω–æ–π –∏ –æ–ø–ª–∞—Ç–æ–π"}'
```

–û—Ç–≤–µ—Ç –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å JSON —Å —Ä–∞–∑–¥–µ–ª–∞–º–∏ –∏ –ø—É–Ω–∫—Ç–∞–º–∏ –¢–ó.

> **–í–∞–∂–Ω–æ:** –ø–µ—Ä–≤—ã–π –∑–∞–ø—Ä–æ—Å –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å 10-30 —Å–µ–∫—É–Ω–¥ ‚Äî –º–æ–¥–µ–ª—å –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –≤ –ø–∞–º—è—Ç—å.
> –ü–æ—Å–ª–µ–¥—É—é—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã –±—É–¥—É—Ç –±—ã—Å—Ç—Ä–µ–µ (3-10 —Å–µ–∫).

## –£—Ä–æ–∫ 12.3: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¢–ó (Backend) ‚úÖ

### –¢–µ–æ—Ä–∏—è

–°–µ–π—á–∞—Å AI –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É, –Ω–æ –º—ã –µ—ë –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –ë–î. –í —ç—Ç–æ–º —É—Ä–æ–∫–µ —Å–æ–∑–¥–∞–¥–∏–º –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π:
1. –ü—Ä–∏–Ω–∏–º–∞–µ—Ç —Ç–µ–∫—Å—Ç –∏ ID –ø—Ä–æ–µ–∫—Ç–∞
2. –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä—É–µ—Ç —Ç–µ–∫—Å—Ç —á–µ—Ä–µ–∑ Ollama
3. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –ë–î (Specification ‚Üí Section ‚Üí Item)
4. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≥–æ—Ç–æ–≤–æ–µ –¢–ó

### –®–∞–≥ 1: –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–π

–°–æ–∑–¥–∞–π `src/controllers/specificationController.js`:

```javascript
const prisma = require('../db')
const { structureText } = require('../services/aiService')

/**
 * POST /api/specifications/generate
 *
 * –ü—Ä–∏–Ω–∏–º–∞–µ—Ç —Å—ã—Ä–æ–π —Ç–µ–∫—Å—Ç, —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä—É–µ—Ç —á–µ—Ä–µ–∑ AI,
 * —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ –ë–î –∫–∞–∫ Specification ‚Üí Section ‚Üí Item
 */
async function generate(req, res) {
  try {
    const { text, projectId } = req.body

    // –í–∞–ª–∏–¥–∞—Ü–∏—è
    if (!text || !text.trim()) {
      return res.status(400).json({ error: '–¢–µ–∫—Å—Ç –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º' })
    }
    if (!projectId) {
      return res.status(400).json({ error: 'projectId –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω' })
    }

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –ø—Ä–æ–µ–∫—Ç —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
    const project = await prisma.project.findFirst({
      where: { id: projectId, userId: req.userId }
    })
    if (!project) {
      return res.status(404).json({ error: '–ü—Ä–æ–µ–∫—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω' })
    }

    // ========================================
    // –í—ã–∑–æ–≤ AI
    //
    // structureText –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–µ–∫—Å—Ç –≤ Ollama
    // –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç { title, sections: [...] }
    // ========================================
    const structured = await structureText(text)

    // ========================================
    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î
    //
    // prisma.specification.create —Å nested create:
    // - –°–æ–∑–¥–∞—ë–º Specification
    // - –í–Ω—É—Ç—Ä–∏ —Å–æ–∑–¥–∞—ë–º Section[]
    // - –í–Ω—É—Ç—Ä–∏ –∫–∞–∂–¥–æ–π —Å–µ–∫—Ü–∏–∏ —Å–æ–∑–¥–∞—ë–º Item[]
    //
    // –í—Å—ë –≤ –æ–¥–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ ‚Äî –µ—Å–ª–∏ —á—Ç–æ-—Ç–æ —É–ø–∞–¥—ë—Ç,
    // –Ω–∏—á–µ–≥–æ –Ω–µ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è (–∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å)
    // ========================================
    const specification = await prisma.specification.create({
      data: {
        title: structured.title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è',
        projectId,
        userId: req.userId,
        sections: {
          create: structured.sections.map((section, sIndex) => ({
            title: section.title,
            position: sIndex,
            items: {
              create: section.items.map((item, iIndex) => ({
                content: item.content,
                timeEstimate: item.timeEstimate || null,
                position: iIndex
              }))
            }
          }))
        }
      },
      // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–æ–∑–¥–∞–Ω–Ω–æ–µ –¢–ó —Å–æ –≤—Å–µ–º–∏ —Å–≤—è–∑—è–º–∏
      include: {
        sections: {
          orderBy: { position: 'asc' },
          include: {
            items: {
              orderBy: { position: 'asc' }
            }
          }
        }
      }
    })

    res.status(201).json(specification)
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –¢–ó:', error)
    res.status(500).json({ error: error.message })
  }
}

/**
 * GET /api/specifications/:id
 *
 * –ü–æ–ª—É—á–∏—Ç—å –¢–ó –ø–æ ID —Å —Å–µ–∫—Ü–∏—è–º–∏ –∏ –ø—É–Ω–∫—Ç–∞–º–∏
 */
async function getById(req, res) {
  try {
    const id = parseInt(req.params.id)

    const specification = await prisma.specification.findFirst({
      where: { id, userId: req.userId },
      include: {
        sections: {
          orderBy: { position: 'asc' },
          include: {
            items: {
              orderBy: { position: 'asc' }
            }
          }
        }
      }
    })

    if (!specification) {
      return res.status(404).json({ error: '–¢–ó –Ω–µ –Ω–∞–π–¥–µ–Ω–æ' })
    }

    res.json(specification)
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –¢–ó:', error)
    res.status(500).json({ error: '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞' })
  }
}

/**
 * GET /api/specifications
 *
 * –°–ø–∏—Å–æ–∫ –¢–ó —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
 */
async function getAll(req, res) {
  try {
    const specifications = await prisma.specification.findMany({
      where: { userId: req.userId },
      include: {
        sections: {
          orderBy: { position: 'asc' },
          include: {
            items: {
              orderBy: { position: 'asc' }
            }
          }
        },
        project: {
          select: { name: true }
        }
      },
      orderBy: { createdAt: 'desc' }
    })

    res.json(specifications)
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –¢–ó:', error)
    res.status(500).json({ error: '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞' })
  }
}

module.exports = { generate, getById, getAll }
```

### –®–∞–≥ 2: –†–æ—É—Ç—ã —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–π

–°–æ–∑–¥–∞–π `src/routes/specifications.js`:

```javascript
const express = require('express')
const { authenticate } = require('../middleware/auth')
const { generate, getById, getAll } = require('../controllers/specificationController')

const router = express.Router()

// –í—Å–µ —Ä–æ—É—Ç—ã –∑–∞—â–∏—â–µ–Ω—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π
router.use(authenticate)

router.post('/generate', generate)
router.get('/', getAll)
router.get('/:id', getById)

module.exports = router
```

### –®–∞–≥ 3: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –≤ index.js

–î–æ–±–∞–≤—å –≤ `src/index.js`:

```javascript
const specRoutes = require('./routes/specifications')

app.use('/api/specifications', specRoutes)
```

–ò—Ç–æ–≥–æ `src/index.js` –¥–æ–ª–∂–µ–Ω –≤—ã–≥–ª—è–¥–µ—Ç—å —Ç–∞–∫:

```javascript
const express = require('express')
const cors = require('cors')
require('dotenv').config()

const authRoutes = require('./routes/auth')
const aiRoutes = require('./routes/ai')
const specRoutes = require('./routes/specifications')

const app = express()
const PORT = process.env.PORT || 3000

app.use(cors({
  origin: 'http://localhost:5173',
  credentials: true
}))

app.use(express.json())

// –†–æ—É—Ç—ã
app.use('/api/auth', authRoutes)
app.use('/api/ai', aiRoutes)
app.use('/api/specifications', specRoutes)

app.get('/api/health', (req, res) => {
  res.json({ status: 'ok' })
})

app.listen(PORT, () => {
  console.log(`–°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω http://localhost:${PORT}`)
})
```

---

# –ß–ê–°–¢–¨ 13: –ó–ê–ì–†–£–ó–ö–ê –í–õ–û–ñ–ï–ù–ò–ô ‚¨ú

## –£—Ä–æ–∫ 13.1: Backend –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤ ‚¨ú

### –¢–µ–æ—Ä–∏—è

–í–ª–æ–∂–µ–Ω–∏—è –ø—Ä–∏–≤—è–∑—ã–≤–∞—é—Ç—Å—è –∫ –ø—É–Ω–∫—Ç–∞–º –¢–ó (Item).
–§–∞–π–ª—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –Ω–∞ –¥–∏—Å–∫ –≤ –ø–∞–ø–∫—É `uploads/`.
–í –ë–î —Ö—Ä–∞–Ω–∏—Ç—Å—è –ø—É—Ç—å, –∏–º—è, —Ç–∏–ø –∏ —Ä–∞–∑–º–µ—Ä.

### –®–∞–≥ 1: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ multer

–°–æ–∑–¥–∞–π `src/middleware/upload.js`:

```javascript
const multer = require('multer')
const path = require('path')
const fs = require('fs')

// ========================================
// –ü–∞–ø–∫–∞ –¥–ª—è –∑–∞–≥—Ä—É–∑–æ–∫
// –°–æ–∑–¥–∞—ë–º –µ—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
// ========================================
const uploadDir = path.join(__dirname, '../../uploads')
if (!fs.existsSync(uploadDir)) {
  fs.mkdirSync(uploadDir, { recursive: true })
}

// ========================================
// –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
//
// destination ‚Äî –∫—É–¥–∞ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å —Ñ–∞–π–ª—ã
// filename ‚Äî –∫–∞–∫ –∏–º–µ–Ω–æ–≤–∞—Ç—å —Ñ–∞–π–ª—ã
//
// –§–æ—Ä–º–∞—Ç –∏–º–µ–Ω–∏: timestamp-random-–æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ_–∏–º—è
// –≠—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –∏–º—ë–Ω
// ========================================
const storage = multer.diskStorage({
  destination: (req, file, cb) => {
    cb(null, uploadDir)
  },
  filename: (req, file, cb) => {
    const uniqueName = `${Date.now()}-${Math.round(Math.random() * 1000)}-${file.originalname}`
    cb(null, uniqueName)
  }
})

// ========================================
// –§–∏–ª—å—Ç—Ä —Ñ–∞–π–ª–æ–≤
//
// –†–∞–∑—Ä–µ—à–∞–µ–º: –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, PDF, –¥–æ–∫—É–º–µ–Ω—Ç—ã
// –ó–∞–ø—Ä–µ—â–∞–µ–º: –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–µ —Ñ–∞–π–ª—ã (.exe, .sh –∏ —Ç.–¥.)
// ========================================
const fileFilter = (req, file, cb) => {
  const allowed = [
    'image/jpeg', 'image/png', 'image/gif', 'image/webp',
    'application/pdf',
    'application/msword',
    'application/vnd.openxmlformats-officedocument.wordprocessingml.document'
  ]

  if (allowed.includes(file.mimetype)) {
    cb(null, true)
  } else {
    cb(new Error('–ù–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–π —Ç–∏–ø —Ñ–∞–π–ª–∞'), false)
  }
}

const upload = multer({
  storage,
  fileFilter,
  limits: {
    fileSize: 5 * 1024 * 1024  // 5 MB –º–∞–∫—Å–∏–º—É–º
  }
})

module.exports = upload
```

### –®–∞–≥ 2: –†–æ—É—Ç –≤–ª–æ–∂–µ–Ω–∏–π

–°–æ–∑–¥–∞–π `src/routes/attachments.js`:

```javascript
const express = require('express')
const { authenticate } = require('../middleware/auth')
const upload = require('../middleware/upload')
const prisma = require('../db')
const fs = require('fs')
const path = require('path')

const router = express.Router()

/**
 * POST /api/attachments/:itemId
 *
 * –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª –∏ –ø—Ä–∏–≤—è–∑–∞—Ç—å –∫ –ø—É–Ω–∫—Ç—É –¢–ó
 * –ü—Ä–∏–Ω–∏–º–∞–µ—Ç: multipart/form-data —Å –ø–æ–ª–µ–º "file"
 *
 * req.file ‚Äî –æ–±—ä–µ–∫—Ç –æ—Ç multer:
 *   .filename ‚Äî –∏–º—è –Ω–∞ –¥–∏—Å–∫–µ
 *   .originalname ‚Äî –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ –∏–º—è
 *   .mimetype ‚Äî MIME —Ç–∏–ø
 *   .size ‚Äî —Ä–∞–∑–º–µ—Ä –≤ –±–∞–π—Ç–∞—Ö
 *   .path ‚Äî –ø–æ–ª–Ω—ã–π –ø—É—Ç—å –Ω–∞ –¥–∏—Å–∫–µ
 */
router.post('/:itemId', authenticate, upload.single('file'), async (req, res) => {
  try {
    const itemId = parseInt(req.params.itemId)

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –ø—É–Ω–∫—Ç —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
    const item = await prisma.item.findFirst({
      where: { id: itemId },
      include: {
        section: {
          include: {
            specification: true
          }
        }
      }
    })

    if (!item || item.section.specification.userId !== req.userId) {
      return res.status(404).json({ error: '–ü—É–Ω–∫—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω' })
    }

    // –°–æ–∑–¥–∞—ë–º –∑–∞–ø–∏—Å—å –≤–ª–æ–∂–µ–Ω–∏—è –≤ –ë–î
    const attachment = await prisma.attachment.create({
      data: {
        filename: req.file.originalname,
        path: `/uploads/${req.file.filename}`,
        mimetype: req.file.mimetype,
        size: req.file.size,
        itemId
      }
    })

    res.status(201).json(attachment)
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', error)
    res.status(500).json({ error: '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞' })
  }
})

/**
 * DELETE /api/attachments/:id
 *
 * –£–¥–∞–ª–∏—Ç—å –≤–ª–æ–∂–µ–Ω–∏–µ: —Ñ–∞–π–ª —Å –¥–∏—Å–∫–∞ + –∑–∞–ø–∏—Å—å –∏–∑ –ë–î
 */
router.delete('/:id', authenticate, async (req, res) => {
  try {
    const attachment = await prisma.attachment.findUnique({
      where: { id: parseInt(req.params.id) },
      include: {
        item: {
          include: {
            section: {
              include: { specification: true }
            }
          }
        }
      }
    })

    if (!attachment || attachment.item.section.specification.userId !== req.userId) {
      return res.status(404).json({ error: '–í–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ' })
    }

    // –£–¥–∞–ª—è–µ–º —Ñ–∞–π–ª —Å –¥–∏—Å–∫–∞
    const filePath = path.join(__dirname, '../../', attachment.path)
    if (fs.existsSync(filePath)) {
      fs.unlinkSync(filePath)
    }

    // –£–¥–∞–ª—è–µ–º –∑–∞–ø–∏—Å—å –∏–∑ –ë–î
    await prisma.attachment.delete({
      where: { id: attachment.id }
    })

    res.json({ message: '–í–ª–æ–∂–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ' })
  } catch (error) {
    res.status(500).json({ error: '–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è' })
  }
})

module.exports = router
```

### –®–∞–≥ 3: –†–∞–∑–¥–∞—á–∞ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤

–í `src/index.js` –¥–æ–±–∞–≤—å:

```javascript
const path = require('path')

const attachmentRoutes = require('./routes/attachments')

// –†–∞–∑–¥–∞—á–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ –ø–æ URL /uploads/filename.jpg
app.use('/uploads', express.static(path.join(__dirname, '../uploads')))

app.use('/api/attachments', attachmentRoutes)
```

---

# –ß–ê–°–¢–¨ 14: DRAG & DROP –°–û–†–¢–ò–†–û–í–ö–ê ‚¨ú

## –£—Ä–æ–∫ 14.1: –ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–æ–≤ –∏ –ø—É–Ω–∫—Ç–æ–≤ ‚¨ú

### –®–∞–≥ 1: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏

```bash
cd frontend
npm install vuedraggable@next
```

`vuedraggable` ‚Äî –æ–±—ë—Ä—Ç–∫–∞ –Ω–∞–¥ SortableJS –¥–ª—è Vue 3. –ü–æ–∑–≤–æ–ª—è–µ—Ç –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞—Ç—å —ç–ª–µ–º–µ–Ω—Ç—ã –≤ —Å–ø–∏—Å–∫–µ.

### –®–∞–≥ 2: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ –¢–ó

–û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π —Ñ—Ä–∞–≥–º–µ–Ω—Ç –¥–ª—è `NewSpecificationPage.vue`:

```vue
<script setup>
import draggable from 'vuedraggable'
// ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∏–º–ø–æ—Ä—Ç—ã
</script>

<template>
  <!-- ... -->

  <!-- –†–∞–∑–¥–µ–ª—ã —Å Drag & Drop -->
  <!--
    draggable ‚Äî –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∏–∑ vuedraggable
    v-model ‚Äî –º–∞—Å—Å–∏–≤ –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç —Å–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è
    item-key ‚Äî —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–ª—é—á —ç–ª–µ–º–µ–Ω—Ç–∞
    handle ‚Äî CSS-—Å–µ–ª–µ–∫—Ç–æ—Ä –∑–∞ –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–Ω–æ —Ç—è–Ω—É—Ç—å
    ghost-class ‚Äî CSS-–∫–ª–∞—Å—Å –¥–ª—è "–ø—Ä–∏–∑—Ä–∞–∫–∞" –ø—Ä–∏ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–∏
    @end ‚Äî —Å–æ–±—ã—Ç–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è
  -->
  <draggable
    v-model="sections"
    item-key="title"
    handle=".drag-handle"
    ghost-class="opacity-30"
    @end="updatePositions"
  >
    <template #item="{ element: section, index: sIdx }">
      <div class="bg-white rounded-lg shadow p-6 mb-4">
        <div class="flex items-center gap-3 mb-4">
          <!-- –ò–∫–æ–Ω–∫–∞ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è -->
          <span class="drag-handle cursor-grab text-gray-400 hover:text-gray-600">
            &#x2630;
          </span>

          <input v-model="section.title" type="text"
            class="text-lg font-semibold border-b border-transparent hover:border-gray-300 focus:border-blue-500 outline-none flex-1" />

          <button @click="removeSection(sIdx)"
            class="text-red-400 hover:text-red-600 text-sm">
            –£–¥–∞–ª–∏—Ç—å
          </button>
        </div>

        <!-- –ü—É–Ω–∫—Ç—ã —Ä–∞–∑–¥–µ–ª–∞ ‚Äî —Ç–æ–∂–µ —Å Drag & Drop -->
        <draggable
          v-model="section.items"
          item-key="content"
          handle=".item-drag"
          ghost-class="opacity-30"
        >
          <template #item="{ element: item, index: iIdx }">
            <div class="flex gap-3 mb-3 items-start">
              <span class="item-drag cursor-grab text-gray-300 hover:text-gray-500 mt-2">
                &#x2630;
              </span>
              <span class="text-gray-400 mt-2 text-sm">{{ sIdx + 1 }}.{{ iIdx + 1 }}</span>
              <textarea v-model="item.content" rows="2"
                class="flex-1 border rounded px-3 py-2 text-sm"></textarea>
              <input v-model.number="item.timeEstimate" type="number"
                class="w-20 border rounded px-2 py-2 text-sm"
                placeholder="–º–∏–Ω" />
              <button @click="removeItem(sIdx, iIdx)"
                class="text-red-400 hover:text-red-600 mt-2">&times;</button>
            </div>
          </template>
        </draggable>

        <button @click="addItem(sIdx)"
          class="text-blue-500 hover:text-blue-700 text-sm">
          + –î–æ–±–∞–≤–∏—Ç—å –ø—É–Ω–∫—Ç
        </button>
      </div>
    </template>
  </draggable>

  <!-- ... -->
</template>
```

### –®–∞–≥ 3: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

–î–æ–±–∞–≤—å –≤ `specificationController.js`:

```javascript
/**
 * PUT /api/specifications/:id/positions
 *
 * –û–±–Ω–æ–≤–ª—è–µ—Ç –ø–æ–∑–∏—Ü–∏–∏ (–ø–æ—Ä—è–¥–æ–∫) —Ä–∞–∑–¥–µ–ª–æ–≤ –∏ –ø—É–Ω–∫—Ç–æ–≤ –ø–æ—Å–ª–µ drag & drop
 *
 * –¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:
 * { sections: [{ id: 1, position: 0, items: [{ id: 5, position: 0 }] }] }
 *
 * –ò—Å–ø–æ–ª—å–∑—É–µ–º transaction ‚Äî –≤—Å–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∞—Ç–æ–º–∞—Ä–Ω—ã:
 * –µ—Å–ª–∏ –æ–¥–Ω–æ —É–ø–∞–¥—ë—Ç, –≤—Å–µ –æ—Ç–∫–∞—Ç—è—Ç—Å—è
 */
async function updatePositions(req, res) {
  try {
    const { sections } = req.body

    await prisma.$transaction(
      sections.flatMap(section => [
        prisma.section.update({
          where: { id: section.id },
          data: { position: section.position }
        }),
        ...section.items.map(item =>
          prisma.item.update({
            where: { id: item.id },
            data: { position: item.position }
          })
        )
      ])
    )

    res.json({ message: '–ü–æ–∑–∏—Ü–∏–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã' })
  } catch (error) {
    res.status(500).json({ error: '–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è' })
  }
}
```

---

# –ß–ê–°–¢–¨ 15: –≠–ö–°–ü–û–†–¢ –í PDF (FRONTEND) ‚¨ú

## –£—Ä–æ–∫ 15.1: –ö–Ω–æ–ø–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞ (Frontend ‚Üí Backend) ‚¨ú

### –®–∞–≥ 1: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Puppeteer

```bash
cd backend
npm install puppeteer
```

### –®–∞–≥ 2: –†–æ—É—Ç –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞

–°–æ–∑–¥–∞–π `src/routes/export.js`:

```javascript
const express = require('express')
const { authenticate } = require('../middleware/auth')
const { generatePdf } = require('../services/pdfService')
const prisma = require('../db')

const router = express.Router()

/**
 * GET /api/export/pdf/:specificationId
 *
 * –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç PDF –∏–∑ –¢–ó –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫–∞–∫ —Ñ–∞–π–ª –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
 *
 * –ü–æ—Ç–æ–∫:
 * 1. –ó–∞–≥—Ä—É–∂–∞–µ–º –¢–ó –∏–∑ –ë–î —Å —Ä–∞–∑–¥–µ–ª–∞–º–∏ –∏ –ø—É–Ω–∫—Ç–∞–º–∏
 * 2. –ü–µ—Ä–µ–¥–∞—ë–º –≤ pdfService ‚Üí Puppeteer —Ä–µ–Ω–¥–µ—Ä–∏—Ç HTML –≤ PDF
 * 3. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–∫–∏ –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
 * 4. –û—Ç–ø—Ä–∞–≤–ª—è–µ–º PDF-–±—É—Ñ–µ—Ä –∫–ª–∏–µ–Ω—Ç—É
 *
 * Content-Type: application/pdf ‚Äî –±—Ä–∞—É–∑–µ—Ä –ø–æ–π–º—ë—Ç —á—Ç–æ —ç—Ç–æ PDF
 * Content-Disposition: attachment ‚Äî –±—Ä–∞—É–∑–µ—Ä —Å–∫–∞—á–∞–µ—Ç —Ñ–∞–π–ª –≤–º–µ—Å—Ç–æ –æ—Ç–∫—Ä—ã—Ç–∏—è
 */
router.get('/pdf/:specificationId', authenticate, async (req, res) => {
  try {
    const spec = await prisma.specification.findFirst({
      where: {
        id: parseInt(req.params.specificationId),
        userId: req.userId
      },
      include: {
        sections: {
          orderBy: { position: 'asc' },
          include: {
            items: {
              orderBy: { position: 'asc' }
            }
          }
        }
      }
    })

    if (!spec) {
      return res.status(404).json({ error: '–¢–ó –Ω–µ –Ω–∞–π–¥–µ–Ω–æ' })
    }

    const pdf = await generatePdf(spec)

    res.setHeader('Content-Type', 'application/pdf')
    res.setHeader('Content-Disposition', `attachment; filename="tz-${spec.id}.pdf"`)
    res.send(pdf)
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ PDF:', error)
    res.status(500).json({ error: '–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞' })
  }
})

module.exports = router
```

–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –≤ `index.js`:

```javascript
const exportRoutes = require('./routes/export')
app.use('/api/export', exportRoutes)
```

### –®–∞–≥ 3: –ö–Ω–æ–ø–∫–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ

–î–æ–±–∞–≤—å –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¢–ó:

```vue
<script setup>
import api from '../api'

async function downloadPdf(specId) {
  try {
    // ========================================
    // responseType: 'blob' ‚Äî –ø–æ–ª—É—á–∞–µ–º –±–∏–Ω–∞—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
    // –ë–µ–∑ —ç—Ç–æ–≥–æ axios –ø–æ–ø—ã—Ç–∞–µ—Ç—Å—è —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å PDF –∫–∞–∫ JSON
    // ========================================
    const response = await api.get(`/export/pdf/${specId}`, {
      responseType: 'blob'
    })

    // ========================================
    // –°–æ–∑–¥–∞—ë–º —Å—Å—ã–ª–∫—É –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è:
    // 1. URL.createObjectURL ‚Äî —Å–æ–∑–¥–∞—ë—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã–π URL –¥–ª—è Blob
    // 2. –°–æ–∑–¥–∞—ë–º –Ω–µ–≤–∏–¥–∏–º—ã–π <a> —Å –∞—Ç—Ä–∏–±—É—Ç–æ–º download
    // 3. –ü—Ä–æ–≥—Ä–∞–º–º–Ω–æ –∫–ª–∏–∫–∞–µ–º ‚Üí –±—Ä–∞—É–∑–µ—Ä —Å–∫–∞—á–∏–≤–∞–µ—Ç
    // 4. –£–±–∏—Ä–∞–µ–º –∑–∞ —Å–æ–±–æ–π (revokeObjectURL)
    // ========================================
    const url = URL.createObjectURL(response.data)
    const link = document.createElement('a')
    link.href = url
    link.download = `tz-${specId}.pdf`
    link.click()
    URL.revokeObjectURL(url)
  } catch (e) {
    alert('–û—à–∏–±–∫–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è PDF')
  }
}
</script>

<template>
  <button @click="downloadPdf(specification.id)"
    class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">
    –°–∫–∞—á–∞—Ç—å PDF
  </button>
</template>
```

---

# –ß–ê–°–¢–¨ 16: –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø –° BITRIX24 ‚¨ú

## –£—Ä–æ–∫ 16.1: –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á –≤ Bitrix24 ‚¨ú

### –¢–µ–æ—Ä–∏—è

Bitrix24 –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç REST API –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∑–∞–¥–∞—á–∞–º–∏.
–î–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –Ω—É–∂–µ–Ω **–≤–µ–±—Ö—É–∫** (webhook) ‚Äî URL —Å —Ç–æ–∫–µ–Ω–æ–º –¥–æ—Å—Ç—É–ø–∞.

### –®–∞–≥ 1: –°–æ–∑–¥–∞–Ω–∏–µ –≤–µ–±—Ö—É–∫–∞ –≤ Bitrix24

1. –í Bitrix24 –ø–µ—Ä–µ–π–¥–∏: –ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è ‚Üí –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞–º ‚Üí –î—Ä—É–≥–æ–µ ‚Üí –í—Ö–æ–¥—è—â–∏–π –≤–µ–±—Ö—É–∫
2. –í—ã–±–µ—Ä–∏ –ø—Ä–∞–≤–∞: `task` (–ó–∞–¥–∞—á–∏)
3. –°–∫–æ–ø–∏—Ä—É–π URL –≤–µ–±—Ö—É–∫–∞ (–≤–∏–¥–∞ `https://your-domain.bitrix24.ru/rest/1/abc123/`)
4. –î–æ–±–∞–≤—å –≤ `.env`:

```env
BITRIX24_WEBHOOK_URL=https://your-domain.bitrix24.ru/rest/1/abc123
```

### –®–∞–≥ 2: –°–µ—Ä–≤–∏—Å Bitrix24

–°–æ–∑–¥–∞–π `src/services/bitrixService.js`:

```javascript
/**
 * –°–µ—Ä–≤–∏—Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å Bitrix24
 *
 * Bitrix24 REST API:
 * - tasks.task.add ‚Äî —Å–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É
 * - tasks.task.list ‚Äî –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á
 *
 * –í–µ–±—Ö—É–∫ ‚Äî —ç—Ç–æ URL —Å –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–º —Ç–æ–∫–µ–Ω–æ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
 * –§–æ—Ä–º–∞—Ç: https://domain.bitrix24.ru/rest/{userId}/{secret}/
 */

const WEBHOOK_URL = process.env.BITRIX24_WEBHOOK_URL

/**
 * –°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É –≤ Bitrix24
 *
 * @param {Object} params
 * @param {string} params.title ‚Äî –Ω–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏
 * @param {string} params.description ‚Äî –æ–ø–∏—Å–∞–Ω–∏–µ (HTML)
 * @param {number} params.responsibleId ‚Äî ID –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è –≤ Bitrix24
 * @param {number|null} params.deadline ‚Äî –¥–µ–¥–ª–∞–π–Ω (ISO —Å—Ç—Ä–æ–∫–∞)
 * @returns {Object} ‚Äî –æ—Ç–≤–µ—Ç –æ—Ç Bitrix24 API
 *
 * Bitrix24 API: tasks.task.add
 * –ú–µ—Ç–æ–¥: POST
 * –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ fields –æ–±—ä–µ–∫—Ç–µ
 */
async function createTask({ title, description, responsibleId, deadline }) {
  const response = await fetch(`${WEBHOOK_URL}/tasks.task.add.json`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      fields: {
        TITLE: title,
        DESCRIPTION: description,
        RESPONSIBLE_ID: responsibleId,
        DEADLINE: deadline || undefined
      }
    })
  })

  const data = await response.json()

  if (data.error) {
    throw new Error(`Bitrix24: ${data.error_description}`)
  }

  return data.result
}

/**
 * –°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á–∏ –∏–∑ –¢–ó
 *
 * –ö–∞–∂–¥—ã–π –ø—É–Ω–∫—Ç –¢–ó ‚Üí –æ—Ç–¥–µ–ª—å–Ω–∞—è –∑–∞–¥–∞—á–∞ –≤ Bitrix24
 * –†–∞–∑–¥–µ–ª—ã ‚Üí –≥—Ä—É–ø–ø—ã –∑–∞–¥–∞—á (–ø–æ–¥–∑–∞–¥–∞—á–∏)
 *
 * @param {Object} specification ‚Äî –¢–ó —Å —Ä–∞–∑–¥–µ–ª–∞–º–∏ –∏ –ø—É–Ω–∫—Ç–∞–º–∏
 * @param {number} responsibleId ‚Äî ID –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è
 * @returns {Array} ‚Äî –º–∞—Å—Å–∏–≤ ID —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –∑–∞–¥–∞—á
 */
async function createTasksFromSpec(specification, responsibleId) {
  const createdTasks = []

  for (const section of specification.sections) {
    // –°–æ–∑–¥–∞—ë–º —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫—É—é –∑–∞–¥–∞—á—É –¥–ª—è —Ä–∞–∑–¥–µ–ª–∞
    const parentTask = await createTask({
      title: `[–¢–ó] ${specification.title} ‚Äî ${section.title}`,
      description: `–†–∞–∑–¥–µ–ª –¢–ó: ${section.title}`,
      responsibleId
    })

    createdTasks.push(parentTask)

    // –°–æ–∑–¥–∞—ë–º –ø–æ–¥–∑–∞–¥–∞—á–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—É–Ω–∫—Ç–∞
    for (const item of section.items) {
      const childTask = await fetch(`${WEBHOOK_URL}/tasks.task.add.json`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          fields: {
            TITLE: item.content.substring(0, 100),  // Bitrix –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –¥–ª–∏–Ω—É
            DESCRIPTION: item.content,
            RESPONSIBLE_ID: responsibleId,
            PARENT_ID: parentTask.task.id,  // –ü—Ä–∏–≤—è–∑–∫–∞ –∫ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–π –∑–∞–¥–∞—á–µ
            TIME_ESTIMATE: item.timeEstimate
              ? item.timeEstimate * 60  // Bitrix –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Å–µ–∫—É–Ω–¥—ã
              : undefined
          }
        })
      }).then(r => r.json())

      createdTasks.push(childTask.result)
    }
  }

  return createdTasks
}

module.exports = { createTask, createTasksFromSpec }
```

### –®–∞–≥ 3: –†–æ—É—Ç —ç–∫—Å–ø–æ—Ä—Ç–∞ –≤ Bitrix24

–°–æ–∑–¥–∞–π `src/routes/bitrix.js`:

```javascript
const express = require('express')
const { authenticate } = require('../middleware/auth')
const { createTasksFromSpec } = require('../services/bitrixService')
const prisma = require('../db')

const router = express.Router()

/**
 * POST /api/bitrix/export/:specificationId
 *
 * –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –¢–ó –≤ Bitrix24 –∫–∞–∫ –Ω–∞–±–æ—Ä –∑–∞–¥–∞—á
 *
 * –¢–µ–ª–æ: { responsibleId: 1 } ‚Äî ID –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è –≤ Bitrix24
 */
router.post('/export/:specificationId', authenticate, async (req, res) => {
  try {
    const { responsibleId } = req.body

    if (!responsibleId) {
      return res.status(400).json({ error: '–£–∫–∞–∂–∏—Ç–µ ID –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è' })
    }

    const spec = await prisma.specification.findFirst({
      where: {
        id: parseInt(req.params.specificationId),
        userId: req.userId
      },
      include: {
        sections: {
          orderBy: { position: 'asc' },
          include: {
            items: { orderBy: { position: 'asc' } }
          }
        }
      }
    })

    if (!spec) {
      return res.status(404).json({ error: '–¢–ó –Ω–µ –Ω–∞–π–¥–µ–Ω–æ' })
    }

    const tasks = await createTasksFromSpec(spec, responsibleId)

    res.json({
      message: `–°–æ–∑–¥–∞–Ω–æ ${tasks.length} –∑–∞–¥–∞—á –≤ Bitrix24`,
      tasks
    })
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ Bitrix24:', error)
    res.status(500).json({ error: error.message || '–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞ –≤ Bitrix24' })
  }
})

module.exports = router
```

–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –≤ `index.js`:

```javascript
const bitrixRoutes = require('./routes/bitrix')
app.use('/api/bitrix', bitrixRoutes)
```

---

# –ß–ê–°–¢–¨ 17: –£–î–ê–õ–Å–ù–ù–´–ô –î–û–°–¢–£–ü –ß–ï–†–ï–ó NGROK ‚úÖ

## –£—Ä–æ–∫ 17.1: –ß—Ç–æ —Ç–∞–∫–æ–µ ngrok –∏ –∑–∞—á–µ–º –æ–Ω –Ω—É–∂–µ–Ω ‚úÖ

### –¢–µ–æ—Ä–∏—è

–°–µ–π—á–∞—Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ `localhost` ‚Äî —ç—Ç–æ –∑–Ω–∞—á–∏—Ç, —á—Ç–æ –∑–∞–π—Ç–∏ –º–æ–∂–Ω–æ —Ç–æ–ª—å–∫–æ —Å —Ç–æ–≥–æ –∂–µ –ü–ö. –ù–æ —á—Ç–æ –µ—Å–ª–∏ —Ç—ã —Ö–æ—á–µ—à—å:
- –û—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å —Ç–µ–ª–µ—Ñ–æ–Ω–∞
- –†–∞–±–æ—Ç–∞—Ç—å —Å –¥—Ä—É–≥–æ–≥–æ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞ (–Ω–∞ —Ä–∞–±–æ—Ç–µ, —É –¥—Ä—É–≥–∞)
- –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∏–∑ –¥—Ä—É–≥–æ–π Wi-Fi —Å–µ—Ç–∏ –∏–ª–∏ —á–µ—Ä–µ–∑ –º–æ–±–∏–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä–Ω–µ—Ç

**–ü—Ä–æ–±–ª–µ–º–∞:** —Ç–≤–æ–π –¥–æ–º–∞—à–Ω–∏–π –ü–ö –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –∑–∞ —Ä–æ—É—Ç–µ—Ä–æ–º (NAT), —É –Ω–µ–≥–æ –Ω–µ—Ç –ø—É–±–ª–∏—á–Ω–æ–≥–æ IP. –£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –∏–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞ –Ω–µ –º–æ–≥—É—Ç –∫ –Ω–µ–º—É –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –Ω–∞–ø—Ä—è–º—É—é.

**–†–µ—à–µ–Ω–∏–µ: ngrok** ‚Äî —ç—Ç–æ —Å–µ—Ä–≤–∏—Å, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–∑–¥–∞—ë—Ç —Ç—É–Ω–Ω–µ–ª—å –º–µ–∂–¥—É –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–æ–º –∏ —Ç–≤–æ–∏–º localhost. –û–Ω –¥–∞—ë—Ç —Ç–µ–±–µ –ø—É–±–ª–∏—á–Ω—ã–π URL (–Ω–∞–ø—Ä–∏–º–µ—Ä `https://abc123.ngrok-free.app`), –∏ –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ —ç—Ç–æ—Ç URL –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –Ω–∞ —Ç–≤–æ–π –ü–ö.

```
–¢–µ–ª–µ—Ñ–æ–Ω/–î—Ä—É–≥–æ–π –ü–ö
       ‚Üì
https://abc123.ngrok-free.app    (–ø—É–±–ª–∏—á–Ω—ã–π URL –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ)
       ‚Üì
–°–µ—Ä–≤–µ—Ä—ã ngrok                    (–ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—é—Ç —Ç—Ä–∞—Ñ–∏–∫)
       ‚Üì
–¢–≤–æ–π –ü–ö ‚Üí localhost:3000         (backend + Ollama)
```

**–û—Ç–≤–µ—Ç –Ω–∞ –≥–ª–∞–≤–Ω—ã–π –≤–æ–ø—Ä–æ—Å: –¥–∞, —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–∑ –õ–Æ–ë–û–ô —Å–µ—Ç–∏** ‚Äî –¥—Ä—É–≥–æ–π Wi-Fi, –º–æ–±–∏–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä–Ω–µ—Ç, –∏–∑ –¥—Ä—É–≥–æ–≥–æ –≥–æ—Ä–æ–¥–∞. –ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–µ —É—Å–ª–æ–≤–∏–µ ‚Äî —Ç–≤–æ–π –¥–æ–º–∞—à–Ω–∏–π –ü–ö –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤–∫–ª—é—á—ë–Ω –∏ –ø–æ–¥–∫–ª—é—á—ë–Ω –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É.

---

## –£—Ä–æ–∫ 17.2: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ ngrok ‚úÖ

### –®–∞–≥ 1: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è

1. –ü–µ—Ä–µ–π–¥–∏ –Ω–∞ https://ngrok.com –∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Å—è (–±–µ—Å–ø–ª–∞—Ç–Ω–æ)
2. –ü–æ—Å–ª–µ –≤—Ö–æ–¥–∞ —Ç—ã –ø–æ–ø–∞–¥—ë—à—å –≤ Dashboard
3. –°–∫–æ–ø–∏—Ä—É–π —Å–≤–æ–π **Authtoken** (–Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ https://dashboard.ngrok.com/get-started/your-authtoken)

### –®–∞–≥ 2: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ ngrok

**Windows (—á–µ—Ä–µ–∑ Chocolatey):**
```bash
choco install ngrok
```

**–ò–ª–∏ —Å–∫–∞—á–∞–π –≤—Ä—É—á–Ω—É—é:**
1. –ü–µ—Ä–µ–π–¥–∏ –Ω–∞ https://ngrok.com/download
2. –°–∫–∞—á–∞–π ZIP –¥–ª—è Windows
3. –†–∞—Å–ø–∞–∫—É–π `ngrok.exe` –≤ —É–¥–æ–±–Ω—É—é –ø–∞–ø–∫—É (–Ω–∞–ø—Ä–∏–º–µ—Ä `C:\ngrok\`)
4. –î–æ–±–∞–≤—å —ç—Ç—É –ø–∞–ø–∫—É –≤ PATH (–∏–ª–∏ –∑–∞–ø—É—Å–∫–∞–π —á–µ—Ä–µ–∑ –ø–æ–ª–Ω—ã–π –ø—É—Ç—å)

**–ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏:**
```bash
ngrok version
```

### –®–∞–≥ 3: –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

–í—ã–ø–æ–ª–Ω–∏ –∫–æ–º–∞–Ω–¥—É (–≤—Å—Ç–∞–≤—å —Å–≤–æ–π —Ç–æ–∫–µ–Ω):

```bash
ngrok config add-authtoken –¢–í–û–ô_AUTHTOKEN
```

–≠—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –æ–¥–∏–Ω —Ä–∞–∑. –¢–æ–∫–µ–Ω —Å–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.

---

## –£—Ä–æ–∫ 17.3: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–ª—è —É–¥–∞–ª—ë–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ ‚úÖ

### –¢–µ–æ—Ä–∏—è

–ü–µ—Ä–µ–¥ —Ç–µ–º –∫–∞–∫ –æ—Ç–∫—Ä—ã–≤–∞—Ç—å —Ç—É–Ω–Ω–µ–ª—å, –Ω—É–∂–Ω–æ –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:

1. **Frontend** –¥–æ–ª–∂–µ–Ω –∑–Ω–∞—Ç—å –∞–¥—Ä–µ—Å backend. –°–µ–π—á–∞—Å –æ–Ω –æ–±—Ä–∞—â–∞–µ—Ç—Å—è –∫ `http://localhost:3000`, –Ω–æ —Å —Ç–µ–ª–µ—Ñ–æ–Ω–∞ —ç—Ç–æ—Ç –∞–¥—Ä–µ—Å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
2. **CORS** –Ω–∞ backend –¥–æ–ª–∂–µ–Ω —Ä–∞–∑—Ä–µ—à–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã —Å ngrok-–¥–æ–º–µ–Ω–∞
3. **Web Speech API** —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–∞ `localhost` –∏–ª–∏ `HTTPS`. Ngrok –¥–∞—ë—Ç HTTPS ‚Äî –∑–Ω–∞—á–∏—Ç —Ä–µ—á—å –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å

### –®–∞–≥ 1: –ù–∞—Å—Ç—Ä–æ–π Frontend –¥–ª—è —Ä–∞–±–æ—Ç—ã —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏

–í —Ñ–∞–π–ª–µ `frontend/vite.config.js` –¥–æ–±–∞–≤—å –Ω–∞—Å—Ç—Ä–æ–π–∫—É –ø—Ä–æ–∫—Å–∏, —á—Ç–æ–±—ã frontend –ø—Ä–æ–±—Ä–∞—Å—ã–≤–∞–ª API-–∑–∞–ø—Ä–æ—Å—ã –Ω–∞ backend:

```javascript
import { defineConfig } from 'vite'
import vue from '@vitejs/plugin-vue'

export default defineConfig({
  plugins: [vue()],
  server: {
    host: '0.0.0.0',  // –†–∞–∑—Ä–µ—à–∏—Ç—å –¥–æ—Å—Ç—É–ø –∏–∑–≤–Ω–µ (–Ω–µ —Ç–æ–ª—å–∫–æ localhost)
    allowedHosts: ['.ngrok-free.dev', '.ngrok.io'], // –†–∞–∑—Ä–µ—à–∏—Ç—å –∑–∞–ø—Ä–æ—Å—ã —á–µ—Ä–µ–∑ ngrok
    proxy: {
      '/api': {
        target: 'http://localhost:3000',
        changeOrigin: true
      }
    }
  }
})
```

> **`host: '0.0.0.0'`** ‚Äî –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é Vite —Å–ª—É—à–∞–µ—Ç —Ç–æ–ª—å–∫–æ localhost. –° —ç—Ç–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π –æ–Ω –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —Å –ª—é–±–æ–≥–æ –∞–¥—Ä–µ—Å–∞.

### –®–∞–≥ 2: –û–±–Ω–æ–≤–∏ API-–∫–ª–∏–µ–Ω—Ç –Ω–∞ frontend

–í —Ñ–∞–π–ª–µ `frontend/src/api/index.js` –∏–∑–º–µ–Ω–∏ `baseURL`, —á—Ç–æ–±—ã –æ–Ω —Ä–∞–±–æ—Ç–∞–ª –∏ –ª–æ–∫–∞–ª—å–Ω–æ, –∏ —á–µ—Ä–µ–∑ ngrok:

```javascript
import axios from 'axios'

const api = axios.create({
  baseURL: '/api'  // –û—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π –ø—É—Ç—å ‚Äî –∑–∞–ø—Ä–æ—Å—ã –ø–æ–π–¥—É—Ç –Ω–∞ —Ç–æ—Ç –∂–µ —Ö–æ—Å—Ç
})

// ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ (–∏–Ω—Ç–µ—Ä—Å–µ–ø—Ç–æ—Ä —Å —Ç–æ–∫–µ–Ω–æ–º) –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
```

> **–ü–æ—á–µ–º—É `/api` –≤–º–µ—Å—Ç–æ `http://localhost:3000/api`?**
> –ö–æ–≥–¥–∞ baseURL –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π, axios –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ —Ç–æ—Ç –∂–µ —Ö–æ—Å—Ç, –æ—Ç–∫—É–¥–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞. –õ–æ–∫–∞–ª—å–Ω–æ —ç—Ç–æ `localhost:5173` (Vite –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç –Ω–∞ `:3000`). –ß–µ—Ä–µ–∑ ngrok —ç—Ç–æ `https://abc123.ngrok-free.app` ‚Äî –∏ –∑–∞–ø—Ä–æ—Å—ã –≤—Å—ë —Ä–∞–≤–Ω–æ –¥–æ–π–¥—É—Ç –¥–æ backend.

### –®–∞–≥ 3: –û–±–Ω–æ–≤–∏ CORS –Ω–∞ backend

–í —Ñ–∞–π–ª–µ `backend/src/index.js` —Ä–∞–∑—Ä–µ—à–∏ –∑–∞–ø—Ä–æ—Å—ã —Å –ª—é–±—ã—Ö –¥–æ–º–µ–Ω–æ–≤ (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏):

```javascript
app.use(cors())  // –ë–µ–∑ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ ‚Äî —Ä–∞–∑—Ä–µ—à–∞–µ—Ç –≤—Å–µ –¥–æ–º–µ–Ω—ã
```

> –ï—Å–ª–∏ —É —Ç–µ–±—è —É–∂–µ `cors()` –±–µ–∑ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ ‚Äî –Ω–∏—á–µ–≥–æ –º–µ–Ω—è—Ç—å –Ω–µ –Ω—É–∂–Ω–æ.

---

## –£—Ä–æ–∫ 17.4: –ó–∞–ø—É—Å–∫ —Ç—É–Ω–Ω–µ–ª—è ‚úÖ

### –í–∞—Ä–∏–∞–Ω—Ç A: –ü—Ä–æ–∫—Å–∏—Ä–æ–≤–∞—Ç—å Frontend (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

–í —ç—Ç–æ–º –≤–∞—Ä–∏–∞–Ω—Ç–µ ngrok –ø—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ—Ç Vite dev server. Vite —Å–∞–º –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç API-–∑–∞–ø—Ä–æ—Å—ã –Ω–∞ backend. –û–¥–∏–Ω —Ç—É–Ω–Ω–µ–ª—å ‚Äî –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç.

**–®–∞–≥ 1:** –ó–∞–ø—É—Å—Ç–∏ –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã (–∫–∞–∂–¥—ã–π –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ):

```bash
# –¢–µ—Ä–º–∏–Ω–∞–ª 1: Ollama (–µ—Å–ª–∏ –Ω–µ –∑–∞–ø—É—â–µ–Ω–∞)
ollama serve

# –¢–µ—Ä–º–∏–Ω–∞–ª 2: Backend
cd backend
npm run dev

# –¢–µ—Ä–º–∏–Ω–∞–ª 3: Frontend
cd frontend
npm run dev
```

**–®–∞–≥ 2:** –û—Ç–∫—Ä–æ–π –µ—â—ë –æ–¥–∏–Ω —Ç–µ—Ä–º–∏–Ω–∞–ª –∏ –∑–∞–ø—É—Å—Ç–∏ ngrok:

```bash
ngrok http 5173
```

–¢—ã —É–≤–∏–¥–∏—à—å —á—Ç–æ-—Ç–æ –≤—Ä–æ–¥–µ:

```
Session Status    online
Forwarding        https://a1b2c3d4.ngrok-free.app -> http://localhost:5173
```

**–®–∞–≥ 3:** –û—Ç–∫—Ä–æ–π URL `https://a1b2c3d4.ngrok-free.app` –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ –∏–ª–∏ –¥—Ä—É–≥–æ–º –ü–ö. –ì–æ—Ç–æ–≤–æ!

### –í–∞—Ä–∏–∞–Ω—Ç B: –î–≤–∞ —Ç—É–Ω–Ω–µ–ª—è (–µ—Å–ª–∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—à—å –ø—Ä–æ–∫—Å–∏ Vite)

–ï—Å–ª–∏ –ø–æ –∫–∞–∫–æ–π-—Ç–æ –ø—Ä–∏—á–∏–Ω–µ —Ç—ã –Ω–µ —Ö–æ—á–µ—à—å –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ Vite:

```bash
# –¢–µ—Ä–º–∏–Ω–∞–ª 4: –¢—É–Ω–Ω–µ–ª—å –¥–ª—è backend
ngrok http 3000

# –¢–µ—Ä–º–∏–Ω–∞–ª 5: –¢—É–Ω–Ω–µ–ª—å –¥–ª—è frontend
ngrok http 5173
```

–¢–æ–≥–¥–∞ –≤ `frontend/src/api/index.js` –Ω—É–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –ø–æ–ª–Ω—ã–π URL backend-—Ç—É–Ω–Ω–µ–ª—è:

```javascript
const api = axios.create({
  baseURL: 'https://xyz789.ngrok-free.app/api'  // URL –∏–∑ ngrok –¥–ª—è backend
})
```

> –í–∞—Ä–∏–∞–Ω—Ç A –ø—Ä–æ—â–µ ‚Äî –æ–¥–∏–Ω —Ç—É–Ω–Ω–µ–ª—å –≤–º–µ—Å—Ç–æ –¥–≤—É—Ö.

---

## –£—Ä–æ–∫ 17.5: –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è ‚úÖ

### –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –ø–ª–∞–Ω ngrok

- URL **–º–µ–Ω—è–µ—Ç—Å—è** –ø—Ä–∏ –∫–∞–∂–¥–æ–º –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ ngrok (—Å–ª—É—á–∞–π–Ω—ã–π –ø–æ–¥–¥–æ–º–µ–Ω)
- –î–ª—è **–ø–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ URL** –Ω—É–∂–µ–Ω –ø–ª–∞—Ç–Ω—ã–π –ø–ª–∞–Ω ($8/–º–µ—Å) –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–æ–º–µ–Ω (ngrok –¥–∞—ë—Ç 1 –±–µ—Å–ø–ª–∞—Ç–Ω–æ)
- –ú–∞–∫—Å–∏–º—É–º **20 –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –≤ –º–∏–Ω—É—Ç—É** –Ω–∞ –±–µ—Å–ø–ª–∞—Ç–Ω–æ–º –ø–ª–∞–Ω–µ
- –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞—Ö–æ–¥–µ ngrok –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É-–ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ ("Visit Site") ‚Äî —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ, –Ω–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É

### –ü–æ–ª—É—á–∏—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–æ–º–µ–Ω

ngrok –¥–∞—ë—Ç –æ–¥–∏–Ω –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–æ–º–µ–Ω:

1. –ü–µ—Ä–µ–π–¥–∏ –≤ https://dashboard.ngrok.com/domains
2. –ù–∞–∂–º–∏ "New Domain" ‚Äî –ø–æ–ª—É—á–∏—à—å –¥–æ–º–µ–Ω –≤–∏–¥–∞ `–∫–æ–µ-—á—Ç–æ.ngrok-free.app`
3. –ó–∞–ø—É—Å–∫–∞–π ngrok —Å —ç—Ç–∏–º –¥–æ–º–µ–Ω–æ–º:

```bash
ngrok http --domain=—Ç–≤–æ–π-–¥–æ–º–µ–Ω.ngrok-free.app 5173
```

–¢–µ–ø–µ—Ä—å URL –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ.

### –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

| –í–æ–ø—Ä–æ—Å | –û—Ç–≤–µ—Ç |
|--------|-------|
| –†–∞–±–æ—Ç–∞–µ—Ç –∏–∑ –¥—Ä—É–≥–æ–π Wi-Fi? | –î–∞, –∏–∑ –ª—é–±–æ–π —Å–µ—Ç–∏ —Å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–æ–º |
| –†–∞–±–æ—Ç–∞–µ—Ç —Å –º–æ–±–∏–ª—å–Ω–æ–≥–æ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞? | –î–∞ |
| –†–∞–±–æ—Ç–∞–µ—Ç –∏–∑ –¥—Ä—É–≥–æ–≥–æ –≥–æ—Ä–æ–¥–∞/—Å—Ç—Ä–∞–Ω—ã? | –î–∞ |
| –ù—É–∂–µ–Ω –ª–∏ –±–µ–ª—ã–π IP? | –ù–µ—Ç, ngrok —Ä–µ—à–∞–µ—Ç —ç—Ç—É –ø—Ä–æ–±–ª–µ–º—É |
| –ü–ö –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤–∫–ª—é—á—ë–Ω? | –î–∞, –∏ backend, –∏ Ollama –¥–æ–ª–∂–Ω—ã —Ä–∞–±–æ—Ç–∞—Ç—å |
| –†–µ—á—å –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å? | –î–∞, ngrok –¥–∞—ë—Ç HTTPS, –∞ Web Speech API —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ HTTPS |
| –ë–µ–∑–æ–ø–∞—Å–Ω–æ –ª–∏ —ç—Ç–æ? | –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ ‚Äî –¥–∞. –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ –ª—É—á—à–µ VPS |

### –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã ngrok

- **Cloudflare Tunnel** ‚Äî –±–µ—Å–ø–ª–∞—Ç–Ω–æ, —Å—Ç–∞–±–∏–ª—å–Ω—ã–π URL, –Ω–æ —Å–ª–æ–∂–Ω–µ–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
- **Tailscale** ‚Äî VPN-—Å–µ—Ç—å –º–µ–∂–¥—É —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏, —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –ø—É–±–ª–∏—á–Ω–æ–≥–æ URL (–Ω—É–∂–Ω–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ –∫–∞–∂–¥–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ)
- **localhost.run** ‚Äî `ssh -R 80:localhost:5173 nokey@localhost.run` ‚Äî –±–µ–∑ —É—Å—Ç–∞–Ω–æ–≤–∫–∏, –Ω–æ –º–µ–Ω–µ–µ —Å—Ç–∞–±–∏–ª—å–Ω–æ

### –ü—Ä–æ–≤–µ—Ä–∫–∞

1. –ó–∞–ø—É—Å—Ç–∏ backend, frontend –∏ ngrok
2. –°–∫–æ–ø–∏—Ä—É–π ngrok URL
3. –û—Ç–∫—Ä–æ–π URL **—Å —Ç–µ–ª–µ—Ñ–æ–Ω–∞** (—á–µ—Ä–µ–∑ –º–æ–±–∏–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä–Ω–µ—Ç, –Ω–µ –¥–æ–º–∞—à–Ω–∏–π Wi-Fi!)
4. –ó–∞–ª–æ–≥–∏–Ω—å—Å—è –≤ —Å–≤–æ–π –∞–∫–∫–∞—É–Ω—Ç
5. –ü–æ–ø—Ä–æ–±—É–π –∑–∞–ø–∏—Å–∞—Ç—å –≥–æ–ª–æ—Å –∏ —Å–æ–∑–¥–∞—Ç—å –¢–ó
6. –£–±–µ–¥–∏—Å—å —á—Ç–æ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–∏–ª–∏—Å—å (–æ—Ç–∫—Ä–æ–π —Å –ü–ö ‚Äî –¢–ó –Ω–∞ –º–µ—Å—Ç–µ)

---

# –ß–ê–°–¢–¨ 18: –ê–î–ú–ò–ù-–ü–ê–ù–ï–õ–¨ ‚úÖ

## –£—Ä–æ–∫ 18.1: –ë—ç–∫–µ–Ω–¥ ‚Äî API –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ ‚úÖ

### –¢–µ–æ—Ä–∏—è

–£ –Ω–∞—Å —É–∂–µ –µ—Å—Ç—å –ø–æ–ª–µ `role` –≤ –º–æ–¥–µ–ª–∏ User (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `"manager"`) –∏ middleware `requireRole` –≤ `middleware/auth.js`. –û—Å—Ç–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å API-—ç–Ω–¥–ø–æ–∏–Ω—Ç—ã, –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É.

–ê–¥–º–∏–Ω —Å–º–æ–∂–µ—Ç:
- –í–∏–¥–µ—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –°–º–æ—Ç—Ä–µ—Ç—å –ø—Ä–æ–µ–∫—Ç—ã –ª—é–±–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –°–º–æ—Ç—Ä–µ—Ç—å –¢–ó –ª—é–±–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

> **–í–∞–∂–Ω–æ:** –æ–±—ã—á–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –ø—Ä–æ–µ–∫—Ç—ã –∏ –¢–ó (—Ñ–∏–ª—å—Ç—Ä `userId: req.userId`). –ê–¥–º–∏–Ω –≤–∏–¥–∏—Ç –≤—Å—ë ‚Äî –±–µ–∑ —Ñ–∏–ª—å—Ç—Ä–∞ –ø–æ userId.

### –®–∞–≥ 1: –°–æ–∑–¥–∞–π –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –∞–¥–º–∏–Ω–∞

–°–æ–∑–¥–∞–π —Ñ–∞–π–ª `backend/src/controllers/adminController.js`:

```javascript
const prisma = require('../db')

/**
 * GET /api/admin/users
 *
 * –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –ø—Ä–æ–µ–∫—Ç–æ–≤ –∏ –¢–ó
 */
async function getUsers(req, res) {
  try {
    const users = await prisma.user.findMany({
      select: {
        id: true,
        name: true,
        email: true,
        role: true,
        createdAt: true,
        _count: {
          select: {
            projects: true,
            specifications: true
          }
        }
      },
      orderBy: { createdAt: 'desc' }
    })

    res.json(users)
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:', error)
    res.status(500).json({ error: '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞' })
  }
}

/**
 * GET /api/admin/users/:id
 *
 * –î–µ—Ç–∞–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞–º–∏
 */
async function getUserById(req, res) {
  try {
    const id = parseInt(req.params.id)

    const user = await prisma.user.findUnique({
      where: { id },
      select: {
        id: true,
        name: true,
        email: true,
        role: true,
        createdAt: true,
        projects: {
          orderBy: { createdAt: 'desc' },
          include: {
            _count: {
              select: { specifications: true }
            }
          }
        }
      }
    })

    if (!user) {
      return res.status(404).json({ error: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω' })
    }

    res.json(user)
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', error)
    res.status(500).json({ error: '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞' })
  }
}

/**
 * GET /api/admin/users/:id/specifications
 *
 * –í—Å–µ –¢–ó –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å —Å–µ–∫—Ü–∏—è–º–∏ –∏ –ø—É–Ω–∫—Ç–∞–º–∏
 */
async function getUserSpecifications(req, res) {
  try {
    const userId = parseInt(req.params.id)

    const specifications = await prisma.specification.findMany({
      where: { userId },
      include: {
        project: {
          select: { name: true }
        },
        sections: {
          orderBy: { position: 'asc' },
          include: {
            items: {
              orderBy: { position: 'asc' }
            }
          }
        }
      },
      orderBy: { createdAt: 'desc' }
    })

    res.json(specifications)
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –¢–ó –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', error)
    res.status(500).json({ error: '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞' })
  }
}

/**
 * PATCH /api/admin/users/:id/role
 *
 * –ò–∑–º–µ–Ω–∏—Ç—å —Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
 * Body: { role: "admin" | "manager" | "executor" }
 */
async function changeRole(req, res) {
  try {
    const id = parseInt(req.params.id)
    const { role } = req.body

    const validRoles = ['admin', 'manager', 'executor']
    if (!validRoles.includes(role)) {
      return res.status(400).json({
        error: `–ù–µ–≤–∞–ª–∏–¥–Ω–∞—è —Ä–æ–ª—å. –î–æ–ø—É—Å—Ç–∏–º—ã–µ: ${validRoles.join(', ')}`
      })
    }

    // –ù–µ–ª—å–∑—è –º–µ–Ω—è—Ç—å —Ä–æ–ª—å —Å–∞–º–æ–º—É —Å–µ–±–µ
    if (id === req.userId) {
      return res.status(400).json({ error: '–ù–µ–ª—å–∑—è –º–µ–Ω—è—Ç—å —Å–≤–æ—é —Ä–æ–ª—å' })
    }

    const updated = await prisma.user.update({
      where: { id },
      select: { id: true, name: true, email: true, role: true }
    })

    res.json(updated)
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ —Å–º–µ–Ω—ã —Ä–æ–ª–∏:', error)
    res.status(500).json({ error: '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞' })
  }
}

module.exports = { getUsers, getUserById, getUserSpecifications, changeRole }
```

> **`_count`** ‚Äî —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ –ø–æ–ª–µ Prisma, –∫–æ—Ç–æ—Ä–æ–µ —Å—á–∏—Ç–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π –±–µ–∑ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∞–º–∏—Ö –¥–∞–Ω–Ω—ã—Ö. –≠—Ç–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–µ–µ, —á–µ–º –∑–∞–≥—Ä—É–∂–∞—Ç—å –≤—Å–µ –ø—Ä–æ–µ–∫—Ç—ã –∏ —Å—á–∏—Ç–∞—Ç—å `projects.length`.

> **`select`** –≤–º–µ—Å—Ç–æ `include` ‚Äî –º—ã —è–≤–Ω–æ –≤—ã–±–∏—Ä–∞–µ–º –ø–æ–ª—è, —á—Ç–æ–±—ã –ù–ï –æ—Ç–¥–∞–≤–∞—Ç—å –ø–∞—Ä–æ–ª—å (`password`) –≤ API.

### –®–∞–≥ 2: –°–æ–∑–¥–∞–π —Ä–æ—É—Ç—ã –∞–¥–º–∏–Ω–∞

–°–æ–∑–¥–∞–π —Ñ–∞–π–ª `backend/src/routes/admin.js`:

```javascript
const express = require('express')
const { authenticate, requireRole } = require('../middleware/auth')
const {
  getUsers,
  getUserById,
  getUserSpecifications,
  changeRole
} = require('../controllers/adminController')

const router = express.Router()

// –í—Å–µ —Ä–æ—É—Ç—ã: –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è + —Ç–æ–ª—å–∫–æ admin
router.use(authenticate)
router.use(requireRole('admin'))

router.get('/users', getUsers)
router.get('/users/:id', getUserById)
router.get('/users/:id/specifications', getUserSpecifications)
router.patch('/users/:id/role', changeRole)

module.exports = router
```

> **`router.use(requireRole('admin'))`** ‚Äî –≤—Å–µ —Ä–æ—É—Ç—ã –≤ —ç—Ç–æ–º —Ñ–∞–π–ª–µ –¥–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º —Å `role: "admin"`. –û—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—É—á–∞—Ç 403 "–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤".

### –®–∞–≥ 3: –ü–æ–¥–∫–ª—é—á–∏ —Ä–æ—É—Ç—ã –≤ index.js

–í —Ñ–∞–π–ª–µ `backend/src/index.js` –¥–æ–±–∞–≤—å:

```javascript
const adminRoutes = require('./routes/admin')

// ... –ø–æ—Å–ª–µ –æ—Å—Ç–∞–ª—å–Ω—ã—Ö app.use() ...
app.use('/api/admin', adminRoutes)
```

### –®–∞–≥ 4: –°–¥–µ–ª–∞–π —Å–µ–±—è –∞–¥–º–∏–Ω–æ–º

–ß–µ—Ä–µ–∑ Prisma Studio –∏–ª–∏ SQL-–∑–∞–ø—Ä–æ—Å –∏–∑–º–µ–Ω–∏ —Å–≤–æ—é —Ä–æ–ª—å:

```bash
npx prisma studio
```

–í —Ç–∞–±–ª–∏—Ü–µ `User` –Ω–∞–π–¥–∏ —Å–≤–æ—é –∑–∞–ø–∏—Å—å –∏ –∏–∑–º–µ–Ω–∏ `role` –Ω–∞ `admin`.

–ò–ª–∏ —á–µ—Ä–µ–∑ SQL:

```sql
UPDATE User SET role = 'admin' WHERE email = '—Ç–≤–æ–π@email.com';
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞

–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π —á–µ—Ä–µ–∑ Postman –∏–ª–∏ curl:

```bash
# –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–Ω—É–∂–µ–Ω —Ç–æ–∫–µ–Ω –∞–¥–º–∏–Ω–∞)
curl -H "Authorization: Bearer –¢–í–û–ô_–¢–û–ö–ï–ù" http://localhost:3000/api/admin/users

# –î–µ—Ç–∞–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –ø—Ä–æ–µ–∫—Ç–∞–º–∏
curl -H "Authorization: Bearer –¢–í–û–ô_–¢–û–ö–ï–ù" http://localhost:3000/api/admin/users/1

# –¢–ó –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
curl -H "Authorization: Bearer –¢–í–û–ô_–¢–û–ö–ï–ù" http://localhost:3000/api/admin/users/1/specifications
```

–ï—Å–ª–∏ –∑–∞–π—Ç–∏ —Å –æ–±—ã—á–Ω—ã–º —Ç–æ–∫–µ–Ω–æ–º (role: manager) ‚Äî –ø–æ–ª—É—á–∏—à—å 403.

---

## –£—Ä–æ–∫ 18.2: –§—Ä–æ–Ω—Ç–µ–Ω–¥ ‚Äî —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π ‚úÖ

### –¢–µ–æ—Ä–∏—è

–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –±—É–¥–µ—Ç —Å–æ—Å—Ç–æ—è—Ç—å –∏–∑ –¥–≤—É—Ö —Å—Ç—Ä–∞–Ω–∏—Ü:
1. **AdminUsersPage** ‚Äî —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –∏—Ö —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π
2. **AdminUserPage** ‚Äî –¥–µ—Ç–∞–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: –µ–≥–æ –ø—Ä–æ–µ–∫—Ç—ã –∏ –¢–ó

–î–æ—Å—Ç—É–ø –∫ –∞–¥–º–∏–Ω-—Å—Ç—Ä–∞–Ω–∏—Ü–∞–º –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ç–æ–ª—å–∫–æ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å `role: "admin"`. –ú—ã —Å–ø—Ä—è—á–µ–º —Å—Å—ã–ª–∫–∏ –≤ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –∏ –¥–æ–±–∞–≤–∏–º –ø—Ä–æ–≤–µ—Ä–∫—É –≤ —Ä–æ—É—Ç–µ—Ä–µ.

### –®–∞–≥ 1: –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

–°–æ–∑–¥–∞–π —Ñ–∞–π–ª `frontend/src/pages/AdminUsersPage.vue`:

```vue
<script setup>
import { ref, onMounted } from 'vue'
import api from '../api'

const users = ref([])
const loading = ref(true)
const error = ref('')

onMounted(async () => {
  try {
    const response = await api.get('/admin/users')
    users.value = response.data
  } catch (e) {
    error.value = e.response?.data?.error || '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏'
  } finally {
    loading.value = false
  }
})

// –¶–≤–µ—Ç–∞ —Ä–æ–ª–µ–π
const roleMap = {
  admin: { label: '–ê–¥–º–∏–Ω', color: 'bg-red-100 text-red-700' },
  manager: { label: '–ú–µ–Ω–µ–¥–∂–µ—Ä', color: 'bg-blue-100 text-blue-700' },
  executor: { label: '–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å', color: 'bg-green-100 text-green-700' }
}
</script>

<template>
  <div>
    <h1 class="text-xl sm:text-2xl font-bold mb-4 sm:mb-6">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</h1>

    <div v-if="loading" class="text-gray-500">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    <div v-else-if="error" class="bg-red-100 text-red-700 p-4 rounded">{{ error }}</div>

    <div v-else-if="users.length === 0" class="text-center py-12 text-gray-500">
      –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ–∫–∞ –Ω–µ—Ç
    </div>

    <div v-else class="space-y-3">
      <router-link v-for="user in users" :key="user.id"
        :to="`/admin/users/${user.id}`"
        class="block bg-white rounded-lg shadow p-4 sm:p-5 hover:shadow-md transition-shadow">

        <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-2">
          <div>
            <div class="flex items-center gap-2 mb-1">
              <h3 class="font-semibold">{{ user.name }}</h3>
              <span :class="['text-xs px-2 py-0.5 rounded-full',
                roleMap[user.role]?.color || 'bg-gray-200']">
                {{ roleMap[user.role]?.label || user.role }}
              </span>
            </div>
            <p class="text-sm text-gray-500">{{ user.email }}</p>
          </div>

          <div class="flex gap-4 text-sm text-gray-500">
            <span>{{ user._count.projects }} –ø—Ä–æ–µ–∫—Ç–æ–≤</span>
            <span>{{ user._count.specifications }} –¢–ó</span>
          </div>
        </div>

        <p class="text-xs text-gray-400 mt-2">
          –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω: {{ new Date(user.createdAt).toLocaleDateString('ru') }}
        </p>
      </router-link>
    </div>
  </div>
</template>
```

### –®–∞–≥ 2: –î–æ–±–∞–≤—å —Ä–æ—É—Ç

–í —Ñ–∞–π–ª–µ `frontend/src/router/index.js` –¥–æ–±–∞–≤—å —Ä–æ—É—Ç:

```javascript
{
  path: '/admin/users',
  component: () => import('../pages/AdminUsersPage.vue'),
  meta: { requiresAuth: true, requiresAdmin: true }
}
```

> **`meta: { requiresAdmin: true }`** ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ–º –º–µ—Ç–∞-–ø–æ–ª–µ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤ –≤ navigation guard.

### –®–∞–≥ 3: –î–æ–±–∞–≤—å –ø—Ä–æ–≤–µ—Ä–∫—É –ø—Ä–∞–≤ –≤ —Ä–æ—É—Ç–µ—Ä

–í —Ñ–∞–π–ª–µ `frontend/src/router/index.js` –æ–±–Ω–æ–≤–∏ `beforeEach` guard:

```javascript
router.beforeEach((to, from, next) => {
  const { token, user } = authStore

  // –ï—Å–ª–∏ –Ω—É–∂–Ω–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∏ –Ω–µ—Ç —Ç–æ–∫–µ–Ω–∞ ‚Äî –Ω–∞ –ª–æ–≥–∏–Ω
  if (to.meta.requiresAuth && !token) {
    return next('/login')
  }

  // –ï—Å–ª–∏ –Ω—É–∂–µ–Ω –∞–¥–º–∏–Ω –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–¥–º–∏–Ω ‚Äî –Ω–∞ –¥–∞—à–±–æ—Ä–¥
  if (to.meta.requiresAdmin && user?.role !== 'admin') {
    return next('/dashboard')
  }

  next()
})
```

### –®–∞–≥ 4: –î–æ–±–∞–≤—å —Å—Å—ã–ª–∫—É –≤ –Ω–∞–≤–∏–≥–∞—Ü–∏—é

–í —Ñ–∞–π–ª–µ `frontend/src/components/AppLayout.vue` –¥–æ–±–∞–≤—å —Å—Å—ã–ª–∫—É "–ê–¥–º–∏–Ω–∫–∞" —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤.

–í –¥–µ—Å–∫—Ç–æ–ø –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ (–≤–Ω—É—Ç—Ä–∏ `<div class="hidden md:flex gap-4">`):

```html
<router-link v-if="authStore.user?.role === 'admin'" to="/admin/users"
             class="text-gray-600 hover:text-blue-500 text-sm">
  –ê–¥–º–∏–Ω–∫–∞
</router-link>
```

–í –º–æ–±–∏–ª—å–Ω–æ–º –º–µ–Ω—é (–≤–Ω—É—Ç—Ä–∏ `<div v-if="menuOpen" ...>`):

```html
<router-link v-if="authStore.user?.role === 'admin'" to="/admin/users"
             @click="closeMenu"
             class="block text-gray-600 hover:text-blue-500">
  –ê–¥–º–∏–Ω–∫–∞
</router-link>
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞

1. –£–±–µ–¥–∏—Å—å —á—Ç–æ —Ç–≤–æ—è —Ä–æ–ª—å `admin` (Prisma Studio)
2. –ü–µ—Ä–µ–ª–æ–≥–∏–Ω—å—Å—è (—á—Ç–æ–±—ã —Ç–æ–∫–µ–Ω —Å–æ–¥–µ—Ä–∂–∞–ª –Ω–æ–≤—É—é —Ä–æ–ª—å)
3. –í –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –ø–æ—è–≤–∏—Ç—Å—è —Å—Å—ã–ª–∫–∞ "–ê–¥–º–∏–Ω–∫–∞"
4. –û—Ç–∫—Ä–æ–π ‚Äî —É–≤–∏–¥–∏—à—å —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –ø—Ä–æ–µ–∫—Ç–æ–≤ –∏ –¢–ó

---

## –£—Ä–æ–∫ 18.3: –§—Ä–æ–Ω—Ç–µ–Ω–¥ ‚Äî —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –∞–¥–º–∏–Ω–∞ ‚úÖ

### –¢–µ–æ—Ä–∏—è

–ü—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ —Å–ø–∏—Å–∫–∞ –∞–¥–º–∏–Ω –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å –¥–µ—Ç–∞–ª—è–º–∏: –ø—Ä–æ–µ–∫—Ç—ã –∏ –¢–ó —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –¢–∞–∫–∂–µ –º–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å —Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

### –®–∞–≥ 1: –°—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–µ—Ç–∞–ª–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

–°–æ–∑–¥–∞–π —Ñ–∞–π–ª `frontend/src/pages/AdminUserPage.vue`:

```vue
<script setup>
import { ref, onMounted } from 'vue'
import { useRoute } from 'vue-router'
import api from '../api'

const route = useRoute()
const user = ref(null)
const specs = ref([])
const loading = ref(true)
const error = ref('')

// –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –µ–≥–æ –¢–ó
onMounted(async () => {
  try {
    const [userRes, specsRes] = await Promise.all([
      api.get(`/admin/users/${route.params.id}`),
      api.get(`/admin/users/${route.params.id}/specifications`)
    ])
    user.value = userRes.data
    specs.value = specsRes.data
  } catch (e) {
    error.value = e.response?.data?.error || '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏'
  } finally {
    loading.value = false
  }
})

// –°–º–µ–Ω–∞ —Ä–æ–ª–∏
async function changeRole(newRole) {
  try {
    await api.patch(`/admin/users/${route.params.id}/role`, { role: newRole })
    user.value.role = newRole
  } catch (e) {
    error.value = e.response?.data?.error || '–û—à–∏–±–∫–∞ —Å–º–µ–Ω—ã —Ä–æ–ª–∏'
  }
}

// –¶–≤–µ—Ç–∞ —Ä–æ–ª–µ–π
const roleMap = {
  admin: { label: '–ê–¥–º–∏–Ω', color: 'bg-red-100 text-red-700' },
  manager: { label: '–ú–µ–Ω–µ–¥–∂–µ—Ä', color: 'bg-blue-100 text-blue-700' },
  executor: { label: '–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å', color: 'bg-green-100 text-green-700' }
}

function formatTime(minutes) {
  if (!minutes) return ''
  if (minutes < 60) return `${minutes} –º–∏–Ω`
  const h = Math.floor(minutes / 60)
  const m = minutes % 60
  return m ? `${h} —á ${m} –º–∏–Ω` : `${h} —á`
}
</script>

<template>
  <div class="max-w-4xl mx-auto">
    <div v-if="loading" class="text-center py-12 text-gray-500">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    <div v-else-if="error" class="bg-red-100 text-red-700 p-4 rounded">{{ error }}</div>

    <div v-else-if="user">
      <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è –Ω–∞–∑–∞–¥ -->
      <router-link to="/admin/users"
        class="text-blue-500 hover:text-blue-700 text-sm mb-4 inline-block">
        &larr; –í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
      </router-link>

      <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
      <div class="bg-white rounded-lg shadow p-4 sm:p-6 mb-6">
        <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-3">
          <div>
            <div class="flex items-center gap-2 mb-1">
              <h1 class="text-xl sm:text-2xl font-bold">{{ user.name }}</h1>
              <span :class="['text-xs px-2 py-0.5 rounded-full',
                roleMap[user.role]?.color || 'bg-gray-200']">
                {{ roleMap[user.role]?.label || user.role }}
              </span>
            </div>
            <p class="text-gray-500">{{ user.email }}</p>
            <p class="text-xs text-gray-400 mt-1">
              –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω: {{ new Date(user.createdAt).toLocaleDateString('ru') }}
            </p>
          </div>

          <!-- –°–º–µ–Ω–∞ —Ä–æ–ª–∏ -->
          <div class="flex flex-wrap gap-2">
            <button v-for="(info, role) in roleMap" :key="role"
              :disabled="user.role === role"
              @click="changeRole(role)"
              :class="['text-xs px-3 py-1.5 rounded', info.color,
                user.role === role ? 'opacity-50 cursor-default' : 'hover:opacity-80 cursor-pointer']">
              {{ info.label }}
            </button>
          </div>
        </div>
      </div>

      <!-- –ü—Ä–æ–µ–∫—Ç—ã -->
      <h2 class="text-lg font-semibold mb-3">
        –ü—Ä–æ–µ–∫—Ç—ã ({{ user.projects.length }})
      </h2>

      <div v-if="user.projects.length === 0"
        class="bg-white rounded-lg shadow p-6 text-center text-gray-500 mb-6">
        –ü—Ä–æ–µ–∫—Ç–æ–≤ –Ω–µ—Ç
      </div>

      <div v-else class="grid grid-cols-1 sm:grid-cols-2 gap-3 mb-6">
        <div v-for="project in user.projects" :key="project.id"
          class="bg-white rounded-lg shadow p-4">
          <h3 class="font-semibold">{{ project.name }}</h3>
          <p v-if="project.description" class="text-sm text-gray-500 mt-1">
            {{ project.description }}
          </p>
          <p class="text-xs text-gray-400 mt-2">
            {{ project._count.specifications }} –¢–ó &middot;
            {{ new Date(project.createdAt).toLocaleDateString('ru') }}
          </p>
        </div>
      </div>

      <!-- –¢–ó –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
      <h2 class="text-lg font-semibold mb-3">
        –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞–Ω–∏—è ({{ specs.length }})
      </h2>

      <div v-if="specs.length === 0"
        class="bg-white rounded-lg shadow p-6 text-center text-gray-500">
        –¢–ó –Ω–µ—Ç
      </div>

      <div v-else class="space-y-3">
        <div v-for="spec in specs" :key="spec.id"
          class="bg-white rounded-lg shadow p-4 sm:p-5">

          <div class="flex flex-col sm:flex-row justify-between items-start gap-2 mb-3">
            <div>
              <h3 class="font-semibold">{{ spec.title }}</h3>
              <p class="text-sm text-gray-400">
                –ü—Ä–æ–µ–∫—Ç: {{ spec.project?.name || '‚Äî' }} &middot;
                {{ spec.sections.length }} —Ä–∞–∑–¥–µ–ª–æ–≤ &middot;
                {{ new Date(spec.createdAt).toLocaleDateString('ru') }}
              </p>
            </div>
            <span class="text-sm text-gray-500">
              {{ formatTime(spec.sections.reduce((sum, s) =>
                sum + s.items.reduce((iSum, item) => iSum + (item.timeEstimate || 0), 0), 0)) }}
            </span>
          </div>

          <!-- –°–µ–∫—Ü–∏–∏ –∏ –ø—É–Ω–∫—Ç—ã (—Å–≤–æ—Ä–∞—á–∏–≤–∞–µ–º—ã–µ) -->
          <details v-for="(section, sIdx) in spec.sections" :key="section.id"
            class="border-t pt-2 mt-2">
            <summary class="cursor-pointer text-sm font-medium hover:text-blue-500">
              {{ sIdx + 1 }}. {{ section.title }}
              <span class="text-gray-400 font-normal">({{ section.items.length }} –ø—É–Ω–∫—Ç–æ–≤)</span>
            </summary>
            <div class="pl-4 mt-2 space-y-1">
              <div v-for="(item, iIdx) in section.items" :key="item.id"
                class="flex items-start gap-2 text-sm">
                <span class="text-gray-400 shrink-0">{{ sIdx + 1 }}.{{ iIdx + 1 }}</span>
                <span class="flex-1 break-words">{{ item.content }}</span>
                <span v-if="item.timeEstimate"
                  class="text-xs text-gray-500 bg-gray-100 px-2 py-0.5 rounded shrink-0">
                  {{ formatTime(item.timeEstimate) }}
                </span>
              </div>
            </div>
          </details>
        </div>
      </div>
    </div>
  </div>
</template>
```

> **`<details>` + `<summary>`** ‚Äî –Ω–∞—Ç–∏–≤–Ω—ã–π HTML –¥–ª—è —Å–≤–æ—Ä–∞—á–∏–≤–∞–µ–º—ã—Ö –±–ª–æ–∫–æ–≤. –ù–µ –Ω—É–∂–µ–Ω JavaScript ‚Äî –±—Ä–∞—É–∑–µ—Ä —Å–∞–º –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—Ç–∫—Ä—ã—Ç–∏–µ/–∑–∞–∫—Ä—ã—Ç–∏–µ. –£–¥–æ–±–Ω–æ –∫–æ–≥–¥–∞ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –º–Ω–æ–≥–æ —Å–µ–∫—Ü–∏–π.

> **`Promise.all`** ‚Äî –∑–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –µ–≥–æ –¢–ó –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ, –∞ –Ω–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ. –î–≤–∞ –∑–∞–ø—Ä–æ—Å–∞ –≤–º–µ—Å—Ç–æ –æ–¥–Ω–æ–≥–æ –ø–æ –æ—á–µ—Ä–µ–¥–∏ ‚Äî –±—ã—Å—Ç—Ä–µ–µ.

### –®–∞–≥ 2: –î–æ–±–∞–≤—å —Ä–æ—É—Ç

–í —Ñ–∞–π–ª–µ `frontend/src/router/index.js`:

```javascript
{
  path: '/admin/users/:id',
  component: () => import('../pages/AdminUserPage.vue'),
  meta: { requiresAuth: true, requiresAdmin: true }
}
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞

1. –û—Ç–∫—Ä–æ–π –ê–¥–º–∏–Ω–∫—É ‚Üí —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
2. –ö–ª–∏–∫–Ω–∏ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ‚Äî —É–≤–∏–¥–∏—à—å –µ–≥–æ –ø—Ä–æ–µ–∫—Ç—ã –∏ –¢–ó
3. –†–∞–∑–≤–µ—Ä–Ω–∏ —Å–µ–∫—Ü–∏—é –¢–ó (–∫–ª–∏–∫ –Ω–∞ –∑–∞–≥–æ–ª–æ–≤–æ–∫) ‚Äî —É–≤–∏–¥–∏—à—å –ø—É–Ω–∫—Ç—ã
4. –ü–æ–ø—Ä–æ–±—É–π —Å–º–µ–Ω–∏—Ç—å —Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∫–Ω–æ–ø–∫–∞–º–∏
5. –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ –æ–±—ã—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (manager) –Ω–µ –º–æ–∂–µ—Ç –æ—Ç–∫—Ä—ã—Ç—å /admin/users ‚Äî –µ–≥–æ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∏—Ç –Ω–∞ –¥–∞—à–±–æ—Ä–¥

---

# –ß–ê–°–¢–¨ 19: –ó–ê–ì–†–£–ó–ö–ê –î–û–ö–£–ú–ï–ù–¢–û–í –î–õ–Ø –ì–ï–ù–ï–†–ê–¶–ò–ò –¢–ó ‚úÖ

## –£—Ä–æ–∫ 19.1: –ë—ç–∫–µ–Ω–¥ ‚Äî –ø–∞—Ä—Å–∏–Ω–≥ .txt –∏ .docx —Ñ–∞–π–ª–æ–≤ ‚úÖ

### –¢–µ–æ—Ä–∏—è

–°–µ–π—á–∞—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –¢–ó —Ç–æ–ª—å–∫–æ –≥–æ–ª–æ—Å–æ–≤–æ–π —Ç–µ–∫—Å—Ç. –ù–æ —á–∞—Å—Ç–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –ø—Ä–∏—Ö–æ–¥—è—Ç –≤ –≤–∏–¥–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞ ‚Äî `.txt` –∏–ª–∏ `.docx` —Ñ–∞–π–ª –æ—Ç –∑–∞–∫–∞–∑—á–∏–∫–∞. –î–æ–±–∞–≤–∏–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç, –∏–∑–≤–ª–µ—á—å –∏–∑ –Ω–µ–≥–æ —Ç–µ–∫—Å—Ç –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ AI.

–ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö:
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–≥—Ä—É–∂–∞–µ—Ç .txt/.docx
       ‚Üì
Backend –∏–∑–≤–ª–µ–∫–∞–µ—Ç —Ç–µ–∫—Å—Ç –∏–∑ —Ñ–∞–π–ª–∞
       ‚Üì
–¢–µ–∫—Å—Ç –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥
       ‚Üì
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Ç–µ–∫—Å—Ç, –º–æ–∂–µ—Ç –µ–≥–æ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
       ‚Üì
–ù–∞–∂–∏–º–∞–µ—Ç "–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ AI" (–∫–∞–∫ –æ–±—ã—á–Ω–æ)
```

–î–ª—è —á—Ç–µ–Ω–∏—è `.docx` –∏—Å–ø–æ–ª—å–∑—É–µ–º –±–∏–±–ª–∏–æ—Ç–µ–∫—É `mammoth` ‚Äî –æ–Ω–∞ –∏–∑–≤–ª–µ–∫–∞–µ—Ç —Ç–µ–∫—Å—Ç –∏–∑ Word-–¥–æ–∫—É–º–µ–Ω—Ç–æ–≤.

### –®–∞–≥ 1: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
cd backend
npm install mammoth multer
```

- **mammoth** ‚Äî –∏–∑–≤–ª–µ–∫–∞–µ—Ç —Ç–µ–∫—Å—Ç –∏–∑ .docx —Ñ–∞–π–ª–æ–≤
- **multer** ‚Äî middleware –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤ (multipart/form-data)

> –ï—Å–ª–∏ `multer` —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω (–∏–∑ –ß–∞—Å—Ç–∏ 13) ‚Äî –ø–æ–≤—Ç–æ—Ä–Ω–æ —Å—Ç–∞–≤–∏—Ç—å –Ω–µ –Ω—É–∂–Ω–æ.

### –®–∞–≥ 2: Middleware –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

–°–æ–∑–¥–∞–π —Ñ–∞–π–ª `backend/src/middleware/uploadDoc.js`:

```javascript
const multer = require('multer')
const path = require('path')
const fs = require('fs')

// –ü–∞–ø–∫–∞ –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
const uploadDir = path.join(__dirname, '../../uploads/docs')
if (!fs.existsSync(uploadDir)) {
  fs.mkdirSync(uploadDir, { recursive: true })
}

const storage = multer.diskStorage({
  destination: (req, file, cb) => {
    cb(null, uploadDir)
  },
  filename: (req, file, cb) => {
    const uniqueName = `${Date.now()}-${Math.round(Math.random() * 1000)}-${file.originalname}`
    cb(null, uniqueName)
  }
})

// –†–∞–∑—Ä–µ—à–∞–µ–º —Ç–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã
const fileFilter = (req, file, cb) => {
  const allowed = [
    'text/plain',                                                          // .txt
    'application/msword',                                                   // .doc
    'application/vnd.openxmlformats-officedocument.wordprocessingml.document' // .docx
  ]

  if (allowed.includes(file.mimetype)) {
    cb(null, true)
  } else {
    cb(new Error('–î–æ–ø—É—Å—Ç–∏–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã: .txt, .doc, .docx'), false)
  }
}

const uploadDoc = multer({
  storage,
  fileFilter,
  limits: {
    fileSize: 10 * 1024 * 1024  // 10 MB –º–∞–∫—Å–∏–º—É–º
  }
})

module.exports = uploadDoc
```

> **–ü–æ—á–µ–º—É –æ—Ç–¥–µ–ª—å–Ω—ã–π middleware, –∞ –Ω–µ —Ç–æ—Ç –∂–µ —á—Ç–æ –¥–ª—è –≤–ª–æ–∂–µ–Ω–∏–π?** –£ –Ω–∏—Ö —Ä–∞–∑–Ω—ã–µ –ø–∞–ø–∫–∏, —Ä–∞–∑–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã —Ñ–∞–π–ª–æ–≤ –∏ —Ä–∞–∑–Ω—ã–µ –ª–∏–º–∏—Ç—ã. –ü—Ä–æ—â–µ –¥–µ—Ä–∂–∞—Ç—å —Ä–∞–∑–¥–µ–ª—å–Ω–æ.

### –®–∞–≥ 3: –°–µ—Ä–≤–∏—Å –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞

–°–æ–∑–¥–∞–π —Ñ–∞–π–ª `backend/src/services/documentService.js`:

```javascript
const fs = require('fs')
const mammoth = require('mammoth')
const path = require('path')

/**
 * –ò–∑–≤–ª–µ–∫–∞–µ—Ç —Ç–µ–∫—Å—Ç –∏–∑ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
 *
 * @param {string} filePath - –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É –Ω–∞ –¥–∏—Å–∫–µ
 * @param {string} mimetype - MIME-—Ç–∏–ø —Ñ–∞–π–ª–∞
 * @returns {string} –∏–∑–≤–ª–µ—á—ë–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç
 */
async function extractText(filePath, mimetype) {
  try {
    if (mimetype === 'text/plain') {
      // .txt ‚Äî –ø—Ä–æ—Å—Ç–æ —á–∏—Ç–∞–µ–º –∫–∞–∫ —Å—Ç—Ä–æ–∫—É
      return fs.readFileSync(filePath, 'utf-8')
    }

    if (
      mimetype === 'application/vnd.openxmlformats-officedocument.wordprocessingml.document' ||
      mimetype === 'application/msword'
    ) {
      // .docx / .doc ‚Äî –∏–∑–≤–ª–µ–∫–∞–µ–º —Ç–µ–∫—Å—Ç —á–µ—Ä–µ–∑ mammoth
      const result = await mammoth.extractRawText({ path: filePath })
      return result.value
    }

    throw new Error(`–ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç: ${mimetype}`)
  } finally {
    // –£–¥–∞–ª—è–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª –ø–æ—Å–ª–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è
    try {
      fs.unlinkSync(filePath)
    } catch (e) {
      console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞:', e)
    }
  }
}

module.exports = { extractText }
```

> **–ü–æ—á–µ–º—É —É–¥–∞–ª—è–µ–º —Ñ–∞–π–ª?** –ù–∞–º –Ω—É–∂–µ–Ω —Ç–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞. –°–∞–º —Ñ–∞–π–ª —Ö—Ä–∞–Ω–∏—Ç—å –Ω–µ –Ω—É–∂–Ω–æ ‚Äî –æ–Ω –±—ã–ª –Ω—É–∂–µ–Ω —Ç–æ–ª—å–∫–æ –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞. –≠—Ç–æ —ç–∫–æ–Ω–æ–º–∏—Ç –º–µ—Å—Ç–æ –Ω–∞ –¥–∏—Å–∫–µ.

> **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ:** `mammoth` —Ä–∞–±–æ—Ç–∞–µ—Ç —Å `.docx`. –°—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç `.doc` –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è —á–∞—Å—Ç–∏—á–Ω–æ. –ï—Å–ª–∏ –Ω—É–∂–Ω–∞ –ø–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ `.doc`, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `libreoffice` –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏, –Ω–æ —ç—Ç–æ —É—Å–ª–æ–∂–Ω—è–µ—Ç –ø—Ä–æ–µ–∫—Ç.

### –®–∞–≥ 4: API-—ç–Ω–¥–ø–æ–∏–Ω—Ç

–î–æ–±–∞–≤—å –≤ —Ñ–∞–π–ª `backend/src/controllers/specificationController.js`:

```javascript
const { extractText } = require('../services/documentService')

/**
 * POST /api/specifications/upload-doc
 *
 * –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç –∏ –∏–∑–≤–ª–µ—á—å –∏–∑ –Ω–µ–≥–æ —Ç–µ–∫—Å—Ç.
 * –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–∫—Å—Ç, –∫–æ—Ç–æ—Ä—ã–π —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –º–æ–∂–µ—Ç –ø–æ–∫–∞–∑–∞—Ç—å
 * –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –∏ –ø–æ—Ç–æ–º –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ AI-—Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ.
 */
async function uploadDocument(req, res) {
  try {
    if (!req.file) {
      return res.status(400).json({ error: '–§–∞–π–ª –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω' })
    }

    const text = await extractText(req.file.path, req.file.mimetype)

    if (!text || !text.trim()) {
      return res.status(400).json({ error: '–ù–µ —É–¥–∞–ª–æ—Å—å –∏–∑–≤–ª–µ—á—å —Ç–µ–∫—Å—Ç –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞' })
    }

    res.json({
      text: text.trim(),
      filename: req.file.originalname
    })
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞:', error)
    res.status(500).json({ error: error.message || '–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞' })
  }
}
```

–î–æ–±–∞–≤—å `uploadDocument` –≤ `module.exports`:

```javascript
module.exports = { generate, getById, getAll, update, uploadDocument }
```

### –®–∞–≥ 5: –†–æ—É—Ç

–í —Ñ–∞–π–ª–µ `backend/src/routes/specifications.js`:

```javascript
const uploadDoc = require('../middleware/uploadDoc')
const { generate, getById, getAll, update, uploadDocument } = require('../controllers/specificationController')

// ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ä–æ—É—Ç—ã ...
router.post('/upload-doc', uploadDoc.single('document'), uploadDocument)
```

> **`uploadDoc.single('document')`** ‚Äî –ø—Ä–∏–Ω–∏–º–∞–µ–º –æ–¥–∏–Ω —Ñ–∞–π–ª –∏–∑ –ø–æ–ª—è —Ñ–æ—Ä–º—ã —Å –∏–º–µ–Ω–µ–º `document`.

### –ü—Ä–æ–≤–µ—Ä–∫–∞

–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π —á–µ—Ä–µ–∑ Postman:
1. –ú–µ—Ç–æ–¥: POST
2. URL: `http://localhost:3000/api/specifications/upload-doc`
3. Header: `Authorization: Bearer –¢–í–û–ô_–¢–û–ö–ï–ù`
4. Body ‚Üí form-data ‚Üí –∫–ª—é—á `document` (—Ç–∏–ø File) ‚Üí –≤—ã–±–µ—Ä–∏ .txt –∏–ª–∏ .docx —Ñ–∞–π–ª
5. –í –æ—Ç–≤–µ—Ç–µ –¥–æ–ª–∂–µ–Ω –ø—Ä–∏–π—Ç–∏ `{ text: "...", filename: "..." }`

---

## –£—Ä–æ–∫ 19.2: –§—Ä–æ–Ω—Ç–µ–Ω–¥ ‚Äî –∑–∞–≥—Ä—É–∑–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –∑–∞–ø–∏—Å–∏ ‚úÖ

### –¢–µ–æ—Ä–∏—è

–î–æ–±–∞–≤–∏–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∑–∞–ø–∏—Å–∏ (`RecordPage`) –≤—Ç–æ—Ä—É—é –æ–ø—Ü–∏—é ‚Äî –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–º–æ–∂–µ—Ç:
1. –ó–∞–ø–∏—Å–∞—Ç—å –≥–æ–ª–æ—Å **–∏–ª–∏** –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª **–∏–ª–∏** —Å–¥–µ–ª–∞—Ç—å –∏ —Ç–æ –∏ –¥—Ä—É–≥–æ–µ
2. –¢–µ–∫—Å—Ç –∏–∑ –≥–æ–ª–æ—Å–∞ –∏ —Ç–µ–∫—Å—Ç –∏–∑ —Ñ–∞–π–ª–∞ –æ–±—ä–µ–¥–∏–Ω—è—Ç—Å—è
3. –†–µ–∑—É–ª—å—Ç–∞—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç—Å—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å–æ–∑–¥–∞–Ω–∏—è –¢–ó

### –®–∞–≥ 1: –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞

–°–æ–∑–¥–∞–π —Ñ–∞–π–ª `frontend/src/components/DocumentUploader.vue`:

```vue
<script setup>
import { ref } from 'vue'
import api from '../api'

const emit = defineEmits(['textExtracted'])

const file = ref(null)
const isUploading = ref(false)
const error = ref('')
const extractedFilename = ref('')

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞
function onFileChange(event) {
  const selected = event.target.files[0]
  if (!selected) return

  // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ (–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è)
  const allowedExtensions = ['.txt', '.doc', '.docx']
  const ext = selected.name.substring(selected.name.lastIndexOf('.')).toLowerCase()

  if (!allowedExtensions.includes(ext)) {
    error.value = `–ù–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–π —Ñ–æ—Ä–º–∞—Ç. –î–æ–ø—É—Å—Ç–∏–º—ã–µ: ${allowedExtensions.join(', ')}`
    file.value = null
    return
  }

  error.value = ''
  file.value = selected
}

// –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–∞–π–ª–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
async function upload() {
  if (!file.value) return

  isUploading.value = true
  error.value = ''

  try {
    // FormData ‚Äî —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –æ–±—ä–µ–∫—Ç –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–∞–π–ª–æ–≤
    // –ù—É–∂–µ–Ω –ø–æ—Ç–æ–º—É —á—Ç–æ JSON –Ω–µ —É–º–µ–µ—Ç –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –±–∏–Ω–∞—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
    const formData = new FormData()
    formData.append('document', file.value)

    const response = await api.post('/specifications/upload-doc', formData, {
      headers: { 'Content-Type': 'multipart/form-data' }
    })

    extractedFilename.value = response.data.filename
    emit('textExtracted', response.data.text)

    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—ã–±–æ—Ä —Ñ–∞–π–ª–∞
    file.value = null
  } catch (e) {
    error.value = e.response?.data?.error || '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞'
  } finally {
    isUploading.value = false
  }
}
</script>

<template>
  <div class="p-4 sm:p-6 max-w-2xl mx-auto">
    <h2 class="text-lg sm:text-xl font-bold mb-4">–ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç</h2>
    <p class="text-sm text-gray-500 mb-4">
      –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª —Å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º–∏ (.txt, .doc, .docx) ‚Äî —Ç–µ–∫—Å—Ç –±—É–¥–µ—Ç –∏–∑–≤–ª–µ—á—ë–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
    </p>

    <!-- –û—à–∏–±–∫–∞ -->
    <div v-if="error" class="bg-red-100 text-red-700 p-3 rounded mb-4 text-sm">
      {{ error }}
    </div>

    <!-- –£—Å–ø–µ—Ö -->
    <div v-if="extractedFilename" class="bg-green-100 text-green-700 p-3 rounded mb-4 text-sm">
      –¢–µ–∫—Å—Ç –∏–∑–≤–ª–µ—á—ë–Ω –∏–∑ —Ñ–∞–π–ª–∞ "{{ extractedFilename }}"
    </div>

    <!-- –í—ã–±–æ—Ä —Ñ–∞–π–ª–∞ -->
    <div class="flex flex-col sm:flex-row gap-3">
      <label class="flex-1">
        <input type="file"
          accept=".txt,.doc,.docx"
          @change="onFileChange"
          class="block w-full text-sm text-gray-500
            file:mr-4 file:py-2 file:px-4
            file:rounded file:border-0
            file:text-sm file:font-medium
            file:bg-blue-50 file:text-blue-700
            hover:file:bg-blue-100
            cursor-pointer" />
      </label>

      <button @click="upload"
        :disabled="!file || isUploading"
        class="px-4 py-2 rounded text-white text-sm font-medium
          bg-purple-500 hover:bg-purple-600
          disabled:opacity-50 disabled:cursor-not-allowed shrink-0">
        {{ isUploading ? '–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞...' : '–ó–∞–≥—Ä—É–∑–∏—Ç—å' }}
      </button>
    </div>

    <p class="text-xs text-gray-400 mt-2">
      –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 10 –ú–ë. –§–æ—Ä–º–∞—Ç—ã: .txt, .doc, .docx
    </p>
  </div>
</template>
```

> **`FormData`** ‚Äî –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –±—Ä–∞—É–∑–µ—Ä–Ω—ã–π –æ–±—ä–µ–∫—Ç –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–∞–π–ª–æ–≤. –û–±—ã—á–Ω—ã–π JSON –Ω–µ –º–æ–∂–µ—Ç –ø–µ—Ä–µ–¥–∞—Ç—å –±–∏–Ω–∞—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª–∞. `FormData` –∫–æ–¥–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ —Ñ–æ—Ä–º–∞—Ç `multipart/form-data`, –∫–æ—Ç–æ—Ä—ã–π —Å–µ—Ä–≤–µ—Ä (multer) —É–º–µ–µ—Ç —Ä–∞–∑–±–∏—Ä–∞—Ç—å.

### –®–∞–≥ 2: –û–±–Ω–æ–≤–∏ RecordPage ‚Äî –æ–±—ä–µ–¥–∏–Ω–∏ –≥–æ–ª–æ—Å –∏ –¥–æ–∫—É–º–µ–Ω—Ç

–û–±–Ω–æ–≤–∏ —Ñ–∞–π–ª `frontend/src/pages/RecordPage.vue`:

```vue
<script setup>
import { ref } from 'vue'
import { useRouter } from 'vue-router'
import SpeechRecorder from '../components/SpeechRecorder.vue'
import DocumentUploader from '../components/DocumentUploader.vue'

const router = useRouter()

// –¢–µ–∫—Å—Ç –∏–∑ –≥–æ–ª–æ—Å–∞ –∏ –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞ —Ö—Ä–∞–Ω—è—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ
const voiceText = ref('')
const docText = ref('')

// –ì–æ–ª–æ—Å –≥–æ—Ç–æ–≤
function onTranscriptReady(text) {
  voiceText.value = text
}

// –î–æ–∫—É–º–µ–Ω—Ç –æ–±—Ä–∞–±–æ—Ç–∞–Ω
function onTextExtracted(text) {
  docText.value = text
}

// –û–±—ä–µ–¥–∏–Ω–∏—Ç—å –∏ –ø–µ—Ä–µ–π—Ç–∏ –∫ —Å–æ–∑–¥–∞–Ω–∏—é –¢–ó
function proceed() {
  // –°–æ–±–∏—Ä–∞–µ–º —Ç–µ–∫—Å—Ç –∏–∑ –æ–±–æ–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
  const parts = []
  if (voiceText.value.trim()) parts.push(voiceText.value.trim())
  if (docText.value.trim()) parts.push(docText.value.trim())

  const combined = parts.join('\n\n')

  if (!combined) {
    alert('–ó–∞–ø–∏—à–∏—Ç–µ –≥–æ–ª–æ—Å –∏–ª–∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç')
    return
  }

  sessionStorage.setItem('voiceText', combined)
  router.push('/specifications/new')
}
</script>

<template>
  <div>
    <!-- –ì–æ–ª–æ—Å–æ–≤–æ–π –≤–≤–æ–¥ -->
    <SpeechRecorder @transcriptReady="onTranscriptReady" />

    <!-- –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å -->
    <div class="max-w-2xl mx-auto px-4 sm:px-6">
      <div class="flex items-center gap-4 my-2">
        <div class="flex-1 border-t border-gray-300"></div>
        <span class="text-sm text-gray-400">–∏–ª–∏</span>
        <div class="flex-1 border-t border-gray-300"></div>
      </div>
    </div>

    <!-- –ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞ -->
    <DocumentUploader @textExtracted="onTextExtracted" />

    <!-- –¢–µ–∫—Å—Ç –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞ (–ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä) -->
    <div v-if="docText" class="max-w-2xl mx-auto px-4 sm:px-6 mb-4">
      <div class="bg-white border rounded p-3 sm:p-4">
        <div class="flex justify-between items-center mb-2">
          <span class="text-sm font-medium">–¢–µ–∫—Å—Ç –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞:</span>
          <button @click="docText = ''" class="text-red-400 hover:text-red-600 text-xs">
            –£–±—Ä–∞—Ç—å
          </button>
        </div>
        <p class="text-sm text-gray-700 whitespace-pre-line max-h-40 overflow-y-auto">
          {{ docText }}
        </p>
      </div>
    </div>

    <!-- –ö–Ω–æ–ø–∫–∞ "–î–∞–ª–µ–µ" ‚Äî –µ—Å–ª–∏ –µ—Å—Ç—å —Ö–æ—Ç—å –∫–∞–∫–æ–π-—Ç–æ —Ç–µ–∫—Å—Ç -->
    <div v-if="voiceText || docText"
      class="max-w-2xl mx-auto px-4 sm:px-6 mb-6">
      <button @click="proceed"
        class="w-full py-3 rounded text-white font-medium
          bg-green-500 hover:bg-green-600 text-sm sm:text-base">
        –°–æ–∑–¥–∞—Ç—å –¢–ó
        <span v-if="voiceText && docText" class="text-green-200 ml-1">
          (–≥–æ–ª–æ—Å + –¥–æ–∫—É–º–µ–Ω—Ç)
        </span>
      </button>
    </div>
  </div>
</template>
```

> **–ó–∞—á–µ–º —Ö—Ä–∞–Ω–∏—Ç—å –≥–æ–ª–æ—Å –∏ –¥–æ–∫—É–º–µ–Ω—Ç –æ—Ç–¥–µ–ª—å–Ω–æ?** –ß—Ç–æ–±—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–≥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –∏—Å—Ç–æ—á–Ω–∏–∫ –∏–ª–∏ –æ–±–∞ —Å—Ä–∞–∑—É. –ü—Ä–∏ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–∏ —Ç–µ–∫—Å—Ç –∏–∑ –≥–æ–ª–æ—Å–∞ –∏–¥—ë—Ç –ø–µ—Ä–≤—ã–º, –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞ ‚Äî –≤—Ç–æ—Ä—ã–º, —Ä–∞–∑–¥–µ–ª—ë–Ω–Ω—ã–µ –ø—É—Å—Ç–æ–π —Å—Ç—Ä–æ–∫–æ–π.

> **`whitespace-pre-line`** ‚Äî CSS-—Å–≤–æ–π—Å—Ç–≤–æ, –∫–æ—Ç–æ—Ä–æ–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫ –∏–∑ —Ç–µ–∫—Å—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞. –ë–µ–∑ –Ω–µ–≥–æ –≤–µ—Å—å —Ç–µ–∫—Å—Ç —Å–ª–∏–ø–Ω–µ—Ç—Å—è –≤ –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É.

### –®–∞–≥ 3: –û–±–Ω–æ–≤–∏ SpeechRecorder

–°–µ–π—á–∞—Å –∫–Ω–æ–ø–∫–∞ "–°–æ–∑–¥–∞—Ç—å –¢–ó" –≤–Ω—É—Ç—Ä–∏ `SpeechRecorder` —Å–∞–º–∞ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É. –ù—É–∂–Ω–æ —É–±—Ä–∞—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Äî —Ç–µ–ø–µ—Ä—å `RecordPage` —É–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞–≤–∏–≥–∞—Ü–∏–µ–π.

–í `SpeechRecorder.vue` –∫–Ω–æ–ø–∫–∞ "–°–æ–∑–¥–∞—Ç—å –¢–ó" —É–∂–µ –≤—ã–∑—ã–≤–∞–µ—Ç `emit('transcriptReady', transcript.value)` ‚Äî —ç—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ. –ù–æ –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Ç–æ–ª—å–∫–æ –¥–æ–∫—É–º–µ–Ω—Ç (–±–µ–∑ –≥–æ–ª–æ—Å–∞), –∫–Ω–æ–ø–∫–∞ "–°–æ–∑–¥–∞—Ç—å –¢–ó" –Ω–µ –ø–æ—è–≤–∏—Ç—Å—è, –ø–æ—Ç–æ–º—É —á—Ç–æ `transcript` –ø—É—Å—Ç–æ–π. –ü–æ—ç—Ç–æ–º—É –º—ã –¥–æ–±–∞–≤–∏–ª–∏ –æ—Ç–¥–µ–ª—å–Ω—É—é –∫–Ω–æ–ø–∫—É "–°–æ–∑–¥–∞—Ç—å –¢–ó" –≤ `RecordPage` ‚Äî –æ–Ω–∞ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –∫–æ–≥–¥–∞ –µ—Å—Ç—å —Ö–æ—Ç—å –∫–∞–∫–æ–π-—Ç–æ —Ç–µ–∫—Å—Ç (–≥–æ–ª–æ—Å –∏/–∏–ª–∏ –¥–æ–∫—É–º–µ–Ω—Ç).

### –ü—Ä–æ–≤–µ—Ä–∫–∞

1. –û—Ç–∫—Ä–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—É "–ó–∞–ø–∏—Å–∞—Ç—å"
2. –ó–∞–≥—Ä—É–∑–∏ `.txt` –∏–ª–∏ `.docx` —Ñ–∞–π–ª ‚Üí —Ç–µ–∫—Å—Ç –ø–æ—è–≤–∏—Ç—Å—è –≤ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–µ
3. –ù–∞–∂–º–∏ "–°–æ–∑–¥–∞—Ç—å –¢–ó" ‚Üí —Ç–µ–∫—Å—Ç –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –ø–æ–ø–∞–¥—ë—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å–æ–∑–¥–∞–Ω–∏—è
4. –ü–æ–ø—Ä–æ–±—É–π: –∑–∞–ø–∏—à–∏ –≥–æ–ª–æ—Å + –∑–∞–≥—Ä—É–∑–∏ –¥–æ–∫—É–º–µ–Ω—Ç ‚Üí –Ω–∞–∂–º–∏ "–°–æ–∑–¥–∞—Ç—å –¢–ó" ‚Üí –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Å–æ–∑–¥–∞–Ω–∏—è –±—É–¥–µ—Ç –æ–±—ä–µ–¥–∏–Ω—ë–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç
5. –ù–∞–∂–º–∏ "–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ AI" ‚Üí AI –æ–±—Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–µ–∫—Å—Ç –∏–∑ –æ–±–æ–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤

---

# –ß–ê–°–¢–¨ 20: –í–´–ë–û–† CRM-–°–ò–°–¢–ï–ú–´ –î–õ–Ø –û–¶–ï–ù–ö–ò –¢–ó ‚úÖ

## –£—Ä–æ–∫ 20.1: –ë—ç–∫–µ–Ω–¥ ‚Äî CRM-–∫–æ–Ω—Ç–µ–∫—Å—Ç –≤ AI-–ø—Ä–æ–º–ø—Ç–µ ‚úÖ

### –¢–µ–æ—Ä–∏—è

–û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¢–ó —Å–∏–ª—å–Ω–æ –∑–∞–≤–∏—Å—è—Ç –æ—Ç –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–π –≤–µ–¥—ë—Ç—Å—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞. –°–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Ç–∞–ª–æ–≥–∞ –≤ Bitrix24 ‚Äî —ç—Ç–æ –æ–¥–Ω–æ, –∞ –≤ 1–°-–ë–∏—Ç—Ä–∏–∫—Å –∏–ª–∏ –≤ —Å–∞–º–æ–ø–∏—Å–Ω–æ–º —Ä–µ—à–µ–Ω–∏–∏ ‚Äî —Å–æ–≤—Å–µ–º –¥—Ä—É–≥–æ–µ. –ï—Å–ª–∏ AI –∑–Ω–∞–µ—Ç CRM-—Å–∏—Å—Ç–µ–º—É, –æ–Ω –¥–∞—Å—Ç –±–æ–ª–µ–µ —Ç–æ—á–Ω—ã–µ –æ—Ü–µ–Ω–∫–∏.

–ü–æ—Ç–æ–∫:
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç CRM (–Ω–∞–ø—Ä–∏–º–µ—Ä Bitrix24)
       ‚Üì
–§—Ä–æ–Ω—Ç–µ–Ω–¥ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç { text, crm: "Bitrix24" }
       ‚Üì
Backend –¥–æ–±–∞–≤–ª—è–µ—Ç CRM –≤ –ø—Ä–æ–º–ø—Ç –¥–ª—è AI
       ‚Üì
AI –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç –∑–∞–¥–∞—á–∏ —Å —É—á—ë—Ç–æ–º —Å–ø–µ—Ü–∏—Ñ–∏–∫–∏ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
```

### –®–∞–≥ 1: –°–ø–∏—Å–æ–∫ CRM-—Å–∏—Å—Ç–µ–º

–°–æ–∑–¥–∞–π —Ñ–∞–π–ª `backend/src/config/crmSystems.js`:

```javascript
/**
 * –°–ø–∏—Å–æ–∫ CRM-—Å–∏—Å—Ç–µ–º —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –¥–ª—è AI.
 *
 * description ‚Äî –∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã,
 * –∫–æ—Ç–æ—Ä–æ–µ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ –ø—Ä–æ–º–ø—Ç –¥–ª—è AI,
 * —á—Ç–æ–±—ã –æ–Ω –ø–æ–Ω–∏–º–∞–ª –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–∏ –æ—Ü–µ–Ω–∫–µ –∑–∞–¥–∞—á.
 */
const crmSystems = [
  {
    id: 'bitrix24',
    name: '–ë–∏—Ç—Ä–∏–∫—Å24',
    description: '–û–±–ª–∞—á–Ω–∞—è CRM-—Å–∏—Å—Ç–µ–º–∞ –ë–∏—Ç—Ä–∏–∫—Å24. –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —á–µ—Ä–µ–∑ REST API, –±–∏–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—Å—ã, CRM-—Ñ–æ—Ä–º—ã, —Ä–æ–±–æ—Ç—ã, –≤–µ–±—Ö—É–∫–∏. –ï—Å—Ç—å –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π.'
  },
  {
    id: '1c-bitrix',
    name: '1–°-–ë–∏—Ç—Ä–∏–∫—Å',
    description: 'CMS 1–°-–ë–∏—Ç—Ä–∏–∫—Å –¥–ª—è —Å–∞–π—Ç–æ–≤ –∏ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω–æ–≤. –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞ PHP, –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞, –∏–Ω—Ñ–æ–±–ª–æ–∫–∏, –º–æ–¥—É–ª–∏, API. –ù—É–∂–µ–Ω —Å–µ—Ä–≤–µ—Ä.'
  },
  {
    id: 'amocrm',
    name: 'amoCRM',
    description: '–û–±–ª–∞—á–Ω–∞—è CRM amoCRM. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ REST API –∏ –≤–∏–¥–∂–µ—Ç—ã. –§–æ–∫—É—Å –Ω–∞ –≤–æ—Ä–æ–Ω–∫–µ –ø—Ä–æ–¥–∞–∂, —Å–¥–µ–ª–∫–∞—Ö, –∫–æ–Ω—Ç–∞–∫—Ç–∞—Ö.'
  },
  {
    id: 'wordpress',
    name: 'WordPress',
    description: 'CMS WordPress. –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–∞–≥–∏–Ω–æ–≤ –∏ —Ç–µ–º –Ω–∞ PHP, REST API, —Ö—É–∫–∏ –∏ —Ñ–∏–ª—å—Ç—Ä—ã, WooCommerce –¥–ª—è e-commerce.'
  },
  {
    id: 'custom',
    name: '–°–∞–º–æ–ø–∏—Å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ',
    description: '–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —Å –Ω—É–ª—è. –°–≤–æ–±–æ–¥–Ω—ã–π –≤—ã–±–æ—Ä —Å—Ç–µ–∫–∞, –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã, –ë–î. –ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å, –Ω–æ –±–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é.'
  },
  {
    id: 'none',
    name: '–ù–µ —É–∫–∞–∑–∞–Ω–∞',
    description: null
  }
]

module.exports = crmSystems
```

> –≠—Ç–æ—Ç —Å–ø–∏—Å–æ–∫ –ª–µ–≥–∫–æ —Ä–∞—Å—à–∏—Ä—è—Ç—å ‚Äî –ø—Ä–æ—Å—Ç–æ –¥–æ–±–∞–≤—å –æ–±—ä–µ–∫—Ç —Å `id`, `name` –∏ `description`. –§—Ä–æ–Ω—Ç–µ–Ω–¥ –∏ –±—ç–∫–µ–Ω–¥ –ø–æ–¥—Ö–≤–∞—Ç—è—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

### –®–∞–≥ 2: API-—ç–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ CRM

–°–æ–∑–¥–∞–π —Ñ–∞–π–ª `backend/src/routes/crm.js`:

```javascript
const express = require('express')
const { authenticate } = require('../middleware/auth')
const crmSystems = require('../config/crmSystems')

const router = express.Router()

/**
 * GET /api/crm/systems
 *
 * –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö CRM-—Å–∏—Å—Ç–µ–º.
 * –§—Ä–æ–Ω—Ç–µ–Ω–¥ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –µ–≥–æ –¥–ª—è –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ —Å–ø–∏—Å–∫–∞.
 */
router.get('/systems', authenticate, (req, res) => {
  // –û—Ç–¥–∞—ë–º —Ç–æ–ª—å–∫–æ id –∏ name (description ‚Äî –¥–ª—è –ø—Ä–æ–º–ø—Ç–∞, –Ω–µ –¥–ª—è UI)
  const list = crmSystems.map(crm => ({
    id: crm.id,
    name: crm.name
  }))
  res.json(list)
})

module.exports = router
```

### –®–∞–≥ 3: –ü–æ–¥–∫–ª—é—á–∏ —Ä–æ—É—Ç –≤ index.js

–í —Ñ–∞–π–ª–µ `backend/src/index.js`:

```javascript
const crmRoutes = require('./routes/crm')

app.use('/api/crm', crmRoutes)
```

### –®–∞–≥ 4: –û–±–Ω–æ–≤–∏ AI-—Å–µ—Ä–≤–∏—Å ‚Äî –¥–æ–±–∞–≤—å CRM –≤ –ø—Ä–æ–º–ø—Ç

–í —Ñ–∞–π–ª–µ `backend/src/services/aiService.js` –∏–∑–º–µ–Ω–∏ —Å–∏–≥–Ω–∞—Ç—É—Ä—É —Ñ—É–Ω–∫—Ü–∏–∏ –∏ –ø—Ä–æ–º–ø—Ç:

```javascript
const crmSystems = require('../config/crmSystems')

/**
 * @param {string} text ‚Äî —Å—ã—Ä–æ–π —Ç–µ–∫—Å—Ç
 * @param {string} [crmId] ‚Äî ID –≤—ã–±—Ä–∞–Ω–Ω–æ–π CRM-—Å–∏—Å—Ç–µ–º—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
 */
async function structureText(text, crmId) {
    // –ù–∞—Ö–æ–¥–∏–º CRM –∏ —Ñ–æ—Ä–º–∏—Ä—É–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç
    const crm = crmId ? crmSystems.find(c => c.id === crmId) : null
    const crmContext = crm?.description
      ? `\n\n–ü–õ–ê–¢–§–û–†–ú–ê –†–ê–ó–†–ê–ë–û–¢–ö–ò: ${crm.name}\n${crm.description}\n–£—á–∏—Ç—ã–≤–∞–π —Å–ø–µ—Ü–∏—Ñ–∏–∫—É —ç—Ç–æ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã –ø—Ä–∏ –æ—Ü–µ–Ω–∫–µ –≤—Ä–µ–º–µ–Ω–∏ –∏ —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–µ –∑–∞–¥–∞—á. –ò—Å–ø–æ–ª—å–∑—É–π —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—é –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã –≥–¥–µ —É–º–µ—Å—Ç–Ω–æ.`
      : ''

    const prompt = `
    –¢—ã ‚Äî –æ–ø—ã—Ç–Ω—ã–π —Å–∏—Å—Ç–µ–º–Ω—ã–π –∞–Ω–∞–ª–∏—Ç–∏–∫. –¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî –ø—Ä–µ–≤—Ä–∞—Ç–∏—Ç—å —Å—ã—Ä–æ–π —Ç–µ–∫—Å—Ç (–∑–∞–ø–∏—Å—å —Ä–µ—á–∏ –∑–∞–∫–∞–∑—á–∏–∫–∞) –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ –Ω–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É.${crmContext}
            –ü–†–ê–í–ò–õ–ê:
            - –†–∞–∑–±–µ–π —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∑–∞–∫–∞–∑—á–∏–∫–∞ –Ω–∞ –ª–æ–≥–∏—á–µ—Å–∫–∏–µ —Ä–∞–∑–¥–µ–ª—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä: "–ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤", "–ö–æ—Ä–∑–∏–Ω–∞", "–û–ø–ª–∞—Ç–∞", "–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç")
            - –í –∫–∞–∂–¥–æ–º —Ä–∞–∑–¥–µ–ª–µ –≤—ã–¥–µ–ª–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∑–∞–¥–∞—á–∏ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞
            - –ö–∞–∂–¥–æ–π –∑–∞–¥–∞—á–µ –¥–∞–π –æ—Ü–µ–Ω–∫—É –≤—Ä–µ–º–µ–Ω–∏ –≤ –º–∏–Ω—É—Ç–∞—Ö (—Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—É—é –¥–ª—è junior/middle —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞)
            - –ü—Ä–∏–¥—É–º–∞–π –∫–æ—Ä–æ—Ç–∫–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –¢–ó, –æ—Ç—Ä–∞–∂–∞—é—â–µ–µ —Å—É—Ç—å –ø—Ä–æ–µ–∫—Ç–∞
            - –ù–ï –æ–ø–∏—Å—ã–≤–∞–π –ø—Ä–æ—Ü–µ—Å—Å –∞–Ω–∞–ª–∏–∑–∞, –æ–ø–∏—Å—ã–≤–∞–π –†–ï–ó–£–õ–¨–¢–ê–¢ ‚Äî —á—Ç–æ –Ω—É–∂–Ω–æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å
            - –û—Ç–≤–µ—á–∞–π –¢–û–õ–¨–ö–û –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ

            –í–µ—Ä–Ω–∏ –¢–û–õ–¨–ö–û –≤–∞–ª–∏–¥–Ω—ã–π JSON, –±–µ–∑ markdown-–æ–±—ë—Ä—Ç–∫–∏, –±–µ–∑ –ø–æ—è—Å–Ω–µ–Ω–∏–π –¥–æ –∏–ª–∏ –ø–æ—Å–ª–µ, —Å—Ç—Ä–æ–≥–æ –≤ —Ñ–æ—Ä–º–∞—Ç–µ:
            {
              "title": "–ù–∞–∑–≤–∞–Ω–∏–µ –¢–ó",
              "sections": [
                {
                  "title": "–ù–∞–∑–≤–∞–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–∞",
                  "items": [
                    {
                      "content": "–û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞",
                      "timeEstimate": 60
                    }
                  ]
                }
              ]
            }

            –¢–µ–∫—Å—Ç –æ—Ç –∑–∞–∫–∞–∑—á–∏–∫–∞:
${text}`

    // ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ (fetch –∫ Ollama) –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
```

> **–ó–∞—á–µ–º `crmContext` –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –ø–µ—Ä–µ–¥ –ü–†–ê–í–ò–õ–ê–ú–ò?** –ü–æ—Ç–æ–º—É —á—Ç–æ AI –æ–±—Ä–∞—â–∞–µ—Ç –±–æ–ª—å—à–µ –≤–Ω–∏–º–∞–Ω–∏—è –Ω–∞ –Ω–∞—á–∞–ª–æ –ø—Ä–æ–º–ø—Ç–∞. –ö–æ–Ω—Ç–µ–∫—Å—Ç –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã ‚Äî —ç—Ç–æ —Ä–∞–º–∫–∞, –≤ –∫–æ—Ç–æ—Ä–æ–π AI –¥–æ–ª–∂–µ–Ω –¥—É–º–∞—Ç—å. –ü—Ä–∞–≤–∏–ª–∞ ‚Äî —ç—Ç–æ —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞.

### –®–∞–≥ 5: –û–±–Ω–æ–≤–∏ —Ä–æ—É—Ç AI ‚Äî –ø—Ä–æ–∫–∏–Ω—å CRM

–í —Ñ–∞–π–ª–µ `backend/src/routes/ai.js`:

```javascript
router.post('/structure', authenticate, async (req, res) => {
  try {
    const { text, crm } = req.body
    if (!text || !text.trim()) {
      return res.status(400).json({
        error: '–¢–µ–∫—Å—Ç –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º'
      })
    }
    const structured = await structureText(text, crm)
    res.json(structured)
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ AI-—Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–∏—è:', error)
    res.status(500).json({ error: error.message })
  }
})
```

–ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ: `req.body` —Ç–µ–ø–µ—Ä—å –¥–µ—Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä—É–µ—Ç—Å—è –∫–∞–∫ `{ text, crm }`, –∏ `crm` –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –≤ `structureText`.

### –ü—Ä–æ–≤–µ—Ä–∫–∞

```bash
# –ë–µ–∑ CRM (–∫–∞–∫ —Ä–∞–Ω—å—à–µ)
curl -X POST http://localhost:3000/api/ai/structure \
  -H "Authorization: Bearer TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"text": "–ù—É–∂–µ–Ω –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω"}'

# –° CRM
curl -X POST http://localhost:3000/api/ai/structure \
  -H "Authorization: Bearer TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"text": "–ù—É–∂–µ–Ω –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω", "crm": "1c-bitrix"}'
```

–°—Ä–∞–≤–Ω–∏ –æ—Ç–≤–µ—Ç—ã ‚Äî —Å CRM –∑–∞–¥–∞—á–∏ –±—É–¥—É—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—é –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã (–∏–Ω—Ñ–æ–±–ª–æ–∫–∏, –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã, –º–æ–¥—É–ª–∏) –∏ –±–æ–ª–µ–µ —Ç–æ—á–Ω—ã–µ –æ—Ü–µ–Ω–∫–∏.

---

## –£—Ä–æ–∫ 20.2: –§—Ä–æ–Ω—Ç–µ–Ω–¥ ‚Äî –≤—ã–±–æ—Ä CRM –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Å–æ–∑–¥–∞–Ω–∏—è –¢–ó ‚úÖ

### –¢–µ–æ—Ä–∏—è

–î–æ–±–∞–≤–∏–º –≤—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫ CRM-—Å–∏—Å—Ç–µ–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å–æ–∑–¥–∞–Ω–∏—è –¢–ó (`NewSpecificationPage`). –í—ã–±—Ä–∞–Ω–Ω–∞—è CRM –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤–º–µ—Å—Ç–µ —Å —Ç–µ–∫—Å—Ç–æ–º –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ "–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ AI".

### –®–∞–≥ 1: –û–±–Ω–æ–≤–∏ NewSpecificationPage

–í —Ñ–∞–π–ª–µ `frontend/src/pages/NewSpecificationPage.vue`:

**–í `<script setup>`** –¥–æ–±–∞–≤—å –∑–∞–≥—Ä—É–∑–∫—É CRM –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é:

```javascript
const crmSystems = ref([])       // –°–ø–∏—Å–æ–∫ CRM-—Å–∏—Å—Ç–µ–º
const selectedCrm = ref('none')  // –í—ã–±—Ä–∞–Ω–Ω–∞—è CRM (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é "–ù–µ —É–∫–∞–∑–∞–Ω–∞")

onMounted(async () => {
  voiceText.value = sessionStorage.getItem('voiceText') || ''

  try {
    // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø—Ä–æ–µ–∫—Ç—ã –∏ CRM-—Å–∏—Å—Ç–µ–º—ã –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
    const [projectsRes, crmRes] = await Promise.all([
      api.get('/projects'),
      api.get('/crm/systems')
    ])
    projects.value = projectsRes.data
    crmSystems.value = crmRes.data
  } catch (e) {
    console.error(e)
  }
})
```

**–û–±–Ω–æ–≤–∏ —Ñ—É–Ω–∫—Ü–∏—é `structureWithAI`** ‚Äî –ø–µ—Ä–µ–¥–∞–π CRM:

```javascript
async function structureWithAI() {
  if (!voiceText.value.trim()) {
    error.value = '–í–≤–µ–¥–∏—Ç–µ –∏–ª–∏ –∑–∞–ø–∏—à–∏—Ç–µ —Ç–µ–∫—Å—Ç'
    return
  }

  isStructuring.value = true
  error.value = ''

  try {
    const response = await api.post('/ai/structure', {
      text: voiceText.value,
      crm: selectedCrm.value !== 'none' ? selectedCrm.value : undefined
    })
    sections.value = response.data.sections
  } catch (e) {
    error.value = e.response?.data?.error || '–û—à–∏–±–∫–∞ AI-—Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–∏—è'
  } finally {
    isStructuring.value = false
  }
}
```

**–í `<template>`** ‚Äî –¥–æ–±–∞–≤—å –≤—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫ –ø–æ—Å–ª–µ –ø–æ–ª—è "–ü—Ä–æ–µ–∫—Ç":

```html
<!-- –û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–ª—è -->
<div class="bg-white rounded-lg shadow p-6 mb-6 space-y-4">
  <div>
    <label class="block text-sm font-medium mb-1">–ù–∞–∑–≤–∞–Ω–∏–µ –¢–ó</label>
    <input v-model="title" type="text" class="w-full border rounded px-3 py-2"
           placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω–∞" />
  </div>

  <div>
    <label class="block text-sm font-medium mb-1">–ü—Ä–æ–µ–∫—Ç</label>
    <select v-model="projectId" class="w-full border rounded px-3 py-2">
      <option :value="null" disabled>–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç</option>
      <option v-for="p in projects" :key="p.id" :value="p.id">
        {{ p.name }}
      </option>
    </select>
  </div>

  <div>
    <label class="block text-sm font-medium mb-1">CRM / –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞</label>
    <select v-model="selectedCrm" class="w-full border rounded px-3 py-2">
      <option v-for="crm in crmSystems" :key="crm.id" :value="crm.id">
        {{ crm.name }}
      </option>
    </select>
    <p class="text-xs text-gray-400 mt-1">
      AI —É—á—Ç—ë—Ç —Å–ø–µ—Ü–∏—Ñ–∏–∫—É –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã –ø—Ä–∏ –æ—Ü–µ–Ω–∫–µ –∑–∞–¥–∞—á –∏ —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∞—Ö
    </p>
  </div>
</div>
```

### –®–∞–≥ 2: –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–π CRM –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –¢–ó (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ CRM –≤ –ë–î, –Ω—É–∂–Ω–æ:

1. –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ `crm` –≤ –º–æ–¥–µ–ª—å `Specification` –≤ `schema.prisma`:

```prisma
model Specification {
  id        Int      @id @default(autoincrement())
  title     String
  crm       String?  // ID CRM-—Å–∏—Å—Ç–µ–º—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
  status    String   @default("draft")
  // ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è
}
```

2. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é:

```bash
npx prisma migrate dev --name add-spec-crm
```

3. –ü–µ—Ä–µ–¥–∞–≤–∞—Ç—å `crm` –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –≤ `specificationController.js` ‚Üí `generate()`:

```javascript
const { text, projectId, crm } = req.body

// ... –≤ prisma.specification.create:
data: {
  title: structured.title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è',
  crm: crm || null,
  projectId,
  userId: req.userId,
  // ...
}
```

4. –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞ `SpecificationPage.vue`:

```html
<span v-if="spec.crm" class="text-xs bg-purple-100 text-purple-700 px-2 py-0.5 rounded-full">
  {{ spec.crm }}
</span>
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞

1. –û—Ç–∫—Ä–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å–æ–∑–¥–∞–Ω–∏—è –¢–ó
2. –í—ã–±–µ—Ä–∏ CRM (–Ω–∞–ø—Ä–∏–º–µ—Ä "–ë–∏—Ç—Ä–∏–∫—Å24")
3. –í–≤–µ–¥–∏ —Ç–µ–∫—Å—Ç –∏ –Ω–∞–∂–º–∏ "–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ AI"
4. –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ AI –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—é –≤—ã–±—Ä–∞–Ω–Ω–æ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
5. –ü–æ–ø—Ä–æ–±—É–π —Ç–æ –∂–µ —Å–∞–º–æ–µ —Å "–°–∞–º–æ–ø–∏—Å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ" ‚Äî –æ—Ü–µ–Ω–∫–∏ –≤—Ä–µ–º–µ–Ω–∏ –±—É–¥—É—Ç –¥—Ä—É–≥–∏–º–∏
6. –í—ã–±–µ—Ä–∏ "–ù–µ —É–∫–∞–∑–∞–Ω–∞" ‚Äî AI –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞–∫ —Ä–∞–Ω—å—à–µ, –±–µ–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö CRM

–ß—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é CRM ‚Äî –ø—Ä–æ—Å—Ç–æ –¥–æ–±–∞–≤—å –æ–±—ä–µ–∫—Ç –≤ `backend/src/config/crmSystems.js`:

```javascript
{
  id: 'megaplan',
  name: '–ú–µ–≥–∞–ø–ª–∞–Ω',
  description: 'CRM –ú–µ–≥–∞–ø–ª–∞–Ω. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∞–º–∏, —Å–¥–µ–ª–∫–∞–º–∏, –∫–ª–∏–µ–Ω—Ç–∞–º–∏. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ REST API.'
}
```

–§—Ä–æ–Ω—Ç–µ–Ω–¥ –ø–æ–¥—Ö–≤–∞—Ç–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ ‚Äî —Å–ø–∏—Å–æ–∫ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —Å —Å–µ—Ä–≤–µ—Ä–∞.

---

# –ß–ê–°–¢–¨ 21: –£–ü–†–ê–í–õ–ï–ù–ò–ï –ü–†–û–ú–ü–¢–ê–ú–ò –ò –ö–ê–°–¢–û–ú–ò–ó–ê–¶–ò–Ø AI ‚úÖ

## –£—Ä–æ–∫ 21.1: –ú–æ–¥–µ–ª—å Prompt –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

### –ó–∞—á–µ–º

–°–µ–π—á–∞—Å –ø—Ä–æ–º–ø—Ç –¥–ª—è AI –∑–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω –≤ `aiService.js`. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –º–æ–≥—É—Ç –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –ø–æ–¥ —Å–≤–æ–∏ –∑–∞–¥–∞—á–∏ ‚Äî –Ω–∞–ø—Ä–∏–º–µ—Ä, –æ–¥–∏–Ω —Ö–æ—á–µ—Ç –¢–ó –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π, –¥—Ä—É–≥–æ–π ‚Äî –¥–ª—è –≤–µ–±-—Å–∞–π—Ç–æ–≤. –î–æ–±–∞–≤–∏–º –º–æ–¥–µ–ª—å `Prompt` —á—Ç–æ–±—ã –∫–∞–∂–¥—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–≥ —Ö—Ä–∞–Ω–∏—Ç—å —Å–≤–æ–∏ –ø—Ä–æ–º–ø—Ç—ã.

### –®–∞–≥ 1: –î–æ–±–∞–≤–∏—Ç—å –º–æ–¥–µ–ª—å Prompt –≤ schema.prisma

–û—Ç–∫—Ä–æ–π `backend/prisma/schema.prisma` –∏ –¥–æ–±–∞–≤—å –Ω–æ–≤—É—é –º–æ–¥–µ–ª—å:

```prisma
// ========================================
// –ü—Ä–æ–º–ø—Ç—ã –¥–ª—è AI
// ========================================
model Prompt {
  id        Int      @id @default(autoincrement())
  title     String
  content   String   @db.Text
  isDefault Boolean  @default(false)
  userId    Int
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
```

**–ß—Ç–æ —Ç—É—Ç:**
- `title` ‚Äî –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä "–î–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π")
- `content` ‚Äî —Å–∞–º —Ç–µ–∫—Å—Ç –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è AI (—Ç–∏–ø `@db.Text` –¥–ª—è –¥–ª–∏–Ω–Ω—ã—Ö —Ç–µ–∫—Å—Ç–æ–≤)
- `isDefault` ‚Äî –ø–æ–º–µ—Ç–∫–∞ "–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é"
- `userId` ‚Äî –ø—Ä–∏–≤—è–∑–∫–∞ –∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é (—É –∫–∞–∂–¥–æ–≥–æ —Å–≤–æ–∏ –ø—Ä–æ–º–ø—Ç—ã)

### –®–∞–≥ 2: –î–æ–±–∞–≤–∏—Ç—å —Å–≤—è–∑—å –≤ –º–æ–¥–µ–ª—å User

–í –º–æ–¥–µ–ª–∏ `User` –¥–æ–±–∞–≤—å –ø–æ–ª–µ:

```prisma
model User {
  id Int @id @default(autoincrement())
  email String @unique
  password String
  name String
  role String @default("manager")
  createdAt DateTime @default(now())

  projects Project[]
  specifications Specification[]
  prompts Prompt[]              // ‚Üê –¥–æ–±–∞–≤–ª—è–µ–º —Å–≤—è–∑—å
}
```

### –®–∞–≥ 3: –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è

```bash
cd backend
npx prisma db push
```

Prisma —Å–æ–∑–¥–∞—Å—Ç —Ç–∞–±–ª–∏—Ü—É `Prompt` –≤ MySQL –∏ –æ–±–Ω–æ–≤–∏—Ç –∫–ª–∏–µ–Ω—Ç.

---

## –£—Ä–æ–∫ 21.2: Backend –ø—Ä–æ–º–ø—Ç–æ–≤

### –ó–∞—á–µ–º

–ù—É–∂–µ–Ω API –¥–ª—è CRUD –ø—Ä–æ–º–ø—Ç–æ–≤ –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –∫–∞—Å—Ç–æ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –¢–ó.

### –®–∞–≥ 1: –í—ã–Ω–µ—Å—Ç–∏ –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π –ø—Ä–æ–º–ø—Ç –≤ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—É

–û—Ç–∫—Ä–æ–π `backend/src/services/aiService.js` –∏ –≤—ã–Ω–µ—Å–∏ —Ç–µ–∫—Å—Ç –ø—Ä–æ–º–ø—Ç–∞ –∏–∑ —Ñ—É–Ω–∫—Ü–∏–∏ –≤ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—É:

```javascript
// ========================================
// –°–µ—Ä–≤–∏—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Ollama
//
// Ollama ‚Äî –ª–æ–∫–∞–ª—å–Ω—ã–π AI-—Å–µ—Ä–≤–µ—Ä
// –û–±—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑ HTTP API (REST)
// –≠–Ω–¥–ø–æ–∏–Ω—Ç: POST /api/generate
// ========================================

const OLLAMA_URL = process.env.OLLAMA_URL
const OLLAMA_MODEL = process.env.OLLAMA_MODEL

// ========================================
// –ü—Ä–æ–º–ø—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
//
// –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –≤—ã–±—Ä–∞–ª
// —Å–≤–æ–π –∫–∞—Å—Ç–æ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç
// ========================================
const DEFAULT_PROMPT = `–¢—ã ‚Äî –æ–ø—ã—Ç–Ω—ã–π —Å–∏—Å—Ç–µ–º–Ω—ã–π –∞–Ω–∞–ª–∏—Ç–∏–∫. –¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî –ø—Ä–µ–≤—Ä–∞—Ç–∏—Ç—å —Å—ã—Ä–æ–π —Ç–µ–∫—Å—Ç (–∑–∞–ø–∏—Å—å —Ä–µ—á–∏ –∑–∞–∫–∞–∑—á–∏–∫–∞) –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ –Ω–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É.
            –ü–†–ê–í–ò–õ–ê:
            - –†–∞–∑–±–µ–π —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∑–∞–∫–∞–∑—á–∏–∫–∞ –Ω–∞ –ª–æ–≥–∏—á–µ—Å–∫–∏–µ —Ä–∞–∑–¥–µ–ª—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä: "–ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤", "–ö–æ—Ä–∑–∏–Ω–∞", "–û–ø–ª–∞—Ç–∞", "–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç")
            - –í –∫–∞–∂–¥–æ–º —Ä–∞–∑–¥–µ–ª–µ –≤—ã–¥–µ–ª–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∑–∞–¥–∞—á–∏ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞
            - –ö–∞–∂–¥–æ–π –∑–∞–¥–∞—á–µ –¥–∞–π –æ—Ü–µ–Ω–∫—É –≤—Ä–µ–º–µ–Ω–∏ –≤ –º–∏–Ω—É—Ç–∞—Ö (—Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—É—é –¥–ª—è junior/middle —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞)
            - –ü—Ä–∏–¥—É–º–∞–π –∫–æ—Ä–æ—Ç–∫–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –¢–ó, –æ—Ç—Ä–∞–∂–∞—é—â–µ–µ —Å—É—Ç—å –ø—Ä–æ–µ–∫—Ç–∞
            - –ù–ï –æ–ø–∏—Å—ã–≤–∞–π –ø—Ä–æ—Ü–µ—Å—Å –∞–Ω–∞–ª–∏–∑–∞, –æ–ø–∏—Å—ã–≤–∞–π –†–ï–ó–£–õ–¨–¢–ê–¢ ‚Äî —á—Ç–æ –Ω—É–∂–Ω–æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å
            - –û—Ç–≤–µ—á–∞–π –¢–û–õ–¨–ö–û –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ

            –í–µ—Ä–Ω–∏ –¢–û–õ–¨–ö–û –≤–∞–ª–∏–¥–Ω—ã–π JSON, –±–µ–∑ markdown-–æ–±—ë—Ä—Ç–∫–∏, –±–µ–∑ –ø–æ—è—Å–Ω–µ–Ω–∏–π –¥–æ –∏–ª–∏ –ø–æ—Å–ª–µ, —Å—Ç—Ä–æ–≥–æ –≤ —Ñ–æ—Ä–º–∞—Ç–µ:
            {
              "title": "–ù–∞–∑–≤–∞–Ω–∏–µ –¢–ó",
              "sections": [
                {
                  "title": "–ù–∞–∑–≤–∞–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–∞",
                  "items": [
                    {
                      "content": "–û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞",
                      "timeEstimate": 60
                    }
                  ]
                }
              ]
            }`
```

### –®–∞–≥ 2: –ò–∑–º–µ–Ω–∏—Ç—å —Å–∏–≥–Ω–∞—Ç—É—Ä—É structureText

–¢–µ–ø–µ—Ä—å —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π `customPrompt`:

```javascript
async function structureText(text, customPrompt = null) {
    // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±—Ä–∞–ª —Å–≤–æ–π –ø—Ä–æ–º–ø—Ç ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ–≥–æ
    // –ò–Ω–∞—á–µ ‚Äî –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π –ø—Ä–æ–º–ø—Ç
    const basePrompt = customPrompt || DEFAULT_PROMPT

    const prompt = `${basePrompt}

            –¢–µ–∫—Å—Ç –æ—Ç –∑–∞–∫–∞–∑—á–∏–∫–∞:
${text}`

    // ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
}

module.exports = { structureText, DEFAULT_PROMPT }
```

**–ó–∞—á–µ–º —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å `DEFAULT_PROMPT`?** –ß—Ç–æ–±—ã —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –º–æ–≥ –ø–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—Å—Ç –¥–µ—Ñ–æ–ª—Ç–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞ –∫–∞–∫ —à–∞–±–ª–æ–Ω –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞.

### –®–∞–≥ 3: –°–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –ø—Ä–æ–º–ø—Ç–æ–≤

–°–æ–∑–¥–∞–π —Ñ–∞–π–ª `backend/src/controllers/promptController.js`:

```javascript
// ========================================
// –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –ø—Ä–æ–º–ø—Ç–æ–≤
//
// CRUD –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –ø—Ä–æ–º–ø—Ç–æ–≤ AI
// –ö–∞–∂–¥—ã–π –ø—Ä–æ–º–ø—Ç –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
// ========================================

const prisma = require('../db')
const { DEFAULT_PROMPT } = require('../services/aiService')

// ========================================
// GET /api/prompts
//
// –°–ø–∏—Å–æ–∫ –ø—Ä–æ–º–ø—Ç–æ–≤ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
// –ï—Å–ª–∏ –ø—Ä–æ–º–ø—Ç–æ–≤ –Ω–µ—Ç ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤
// (—Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –ø–æ–∫–∞–∂–µ—Ç –±–∞–Ω–Ω–µ—Ä "–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—ã–π –ø—Ä–æ–º–ø—Ç")
// ========================================
async function getAll(req, res) {
    try {
        const prompts = await prisma.prompt.findMany({
            where: { userId: req.userId },
            orderBy: { createdAt: 'desc' }
        })
        res.json(prompts)
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –ø—Ä–æ–º–ø—Ç–æ–≤:', error)
        res.status(500).json({ error: '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞' })
    }
}

// ========================================
// POST /api/prompts
//
// –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞
// –ï—Å–ª–∏ isDefault: true ‚Äî —Å–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥ —É –æ—Å—Ç–∞–ª—å–Ω—ã—Ö
// ========================================
async function create(req, res) {
    try {
        const { title, content, isDefault } = req.body

        if (!title || !title.trim()) {
            return res.status(400).json({ error: '–ù–∞–∑–≤–∞–Ω–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ' })
        }
        if (!content || !content.trim()) {
            return res.status(400).json({ error: '–¢–µ–∫—Å—Ç –ø—Ä–æ–º–ø—Ç–∞ –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω' })
        }

        // –ï—Å–ª–∏ –Ω–æ–≤—ã–π –ø—Ä–æ–º–ø—Ç ‚Äî –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, —Å–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥ —É –æ—Å—Ç–∞–ª—å–Ω—ã—Ö
        if (isDefault) {
            await prisma.prompt.updateMany({
                where: { userId: req.userId, isDefault: true },
                data: { isDefault: false }
            })
        }

        const prompt = await prisma.prompt.create({
            data: {
                title: title.trim(),
                content: content.trim(),
                isDefault: isDefault || false,
                userId: req.userId
            }
        })

        res.status(201).json(prompt)
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ–º–ø—Ç–∞:', error)
        res.status(500).json({ error: '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞' })
    }
}

// ========================================
// PUT /api/prompts/:id
//
// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞
// –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
// ========================================
async function update(req, res) {
    try {
        const id = parseInt(req.params.id)
        const { title, content, isDefault } = req.body

        const existing = await prisma.prompt.findFirst({
            where: { id, userId: req.userId }
        })
        if (!existing) {
            return res.status(404).json({ error: '–ü—Ä–æ–º–ø—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω' })
        }

        if (isDefault) {
            await prisma.prompt.updateMany({
                where: { userId: req.userId, isDefault: true },
                data: { isDefault: false }
            })
        }

        const prompt = await prisma.prompt.update({
            where: { id },
            data: {
                title: title?.trim() || existing.title,
                content: content?.trim() || existing.content,
                isDefault: isDefault !== undefined ? isDefault : existing.isDefault
            }
        })

        res.json(prompt)
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ–º–ø—Ç–∞:', error)
        res.status(500).json({ error: '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞' })
    }
}

// ========================================
// DELETE /api/prompts/:id
//
// –£–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞
// ========================================
async function remove(req, res) {
    try {
        const id = parseInt(req.params.id)

        const existing = await prisma.prompt.findFirst({
            where: { id, userId: req.userId }
        })
        if (!existing) {
            return res.status(404).json({ error: '–ü—Ä–æ–º–ø—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω' })
        }

        await prisma.prompt.delete({ where: { id } })
        res.json({ message: '–ü—Ä–æ–º–ø—Ç —É–¥–∞–ª—ë–Ω' })
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –ø—Ä–æ–º–ø—Ç–∞:', error)
        res.status(500).json({ error: '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞' })
    }
}

// ========================================
// GET /api/prompts/default-text
//
// –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–∫—Å—Ç –¥–µ—Ñ–æ–ª—Ç–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞ –∫–∞–∫ —à–∞–±–ª–æ–Ω
// ========================================
async function getDefaultText(req, res) {
    res.json({ content: DEFAULT_PROMPT })
}

module.exports = { getAll, create, update, remove, getDefaultText }
```

**–ö–ª—é—á–µ–≤–æ–π –º–æ–º–µ–Ω—Ç ‚Äî –ª–æ–≥–∏–∫–∞ `isDefault`:** –£ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –º–æ–∂–µ—Ç –±—ã—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –ø—Ä–æ–º–ø—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é. –ö–æ–≥–¥–∞ —Å—Ç–∞–≤–∏–º `isDefault: true` –Ω–æ–≤–æ–º—É –ø—Ä–æ–º–ø—Ç—É ‚Äî —Å–Ω–∞—á–∞–ª–∞ —Å–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥ —É –≤—Å–µ—Ö –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —á–µ—Ä–µ–∑ `updateMany`.

### –®–∞–≥ 4: –°–æ–∑–¥–∞—Ç—å —Ä–æ—É—Ç—ã –ø—Ä–æ–º–ø—Ç–æ–≤

–°–æ–∑–¥–∞–π —Ñ–∞–π–ª `backend/src/routes/prompts.js`:

```javascript
// ========================================
// –†–æ—É—Ç—ã –¥–ª—è –ø—Ä–æ–º–ø—Ç–æ–≤
//
// –í—Å–µ —Ä–æ—É—Ç—ã –∑–∞—â–∏—â–µ–Ω—ã middleware authenticate
// ========================================

const express = require('express')
const { authenticate } = require('../middleware/auth')
const { getAll, create, update, remove, getDefaultText } = require('../controllers/promptController')

const router = express.Router()

router.get('/default-text', authenticate, getDefaultText)
router.get('/', authenticate, getAll)
router.post('/', authenticate, create)
router.put('/:id', authenticate, update)
router.delete('/:id', authenticate, remove)

module.exports = router
```

**–í–∞–∂–Ω–æ:** —Ä–æ—É—Ç `/default-text` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –î–û `/:id`, –∏–Ω–∞—á–µ Express –ø–æ–¥—É–º–∞–µ—Ç —á—Ç–æ "default-text" ‚Äî —ç—Ç–æ id.

### –®–∞–≥ 5: –ü–æ–¥–∫–ª—é—á–∏—Ç—å —Ä–æ—É—Ç—ã –≤ index.js

–í `backend/src/index.js` –¥–æ–±–∞–≤—å:

```javascript
const promptRoutes = require('./routes/prompts')

// ... –ø–æ—Å–ª–µ –¥—Ä—É–≥–∏—Ö —Ä–æ—É—Ç–æ–≤:
app.use('/api/prompts', promptRoutes)
```

### –®–∞–≥ 6: –û–±–Ω–æ–≤–∏—Ç—å —Ä–æ—É—Ç AI-—Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–∏—è

–í `backend/src/routes/ai.js` —Ç–µ–ø–µ—Ä—å –ø—Ä–∏–Ω–∏–º–∞–µ–º `promptId`:

```javascript
const express = require('express')
const { authenticate } = require('../middleware/auth')
const { structureText } = require('../services/aiService')
const prisma = require('../db')

const router = express.Router()

router.post('/structure', authenticate, async (req,res) =>{
    try{
        const {text, promptId} = req.body
        if(!text || !text.trim()){
            return res.status(400).json({
                error: '–¢–µ–∫—Å—Ç –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º'
            })
        }

        // ========================================
        // –ï—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω promptId ‚Äî –∏—â–µ–º –∫–∞—Å—Ç–æ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç –≤ –ë–î
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –ø—Ä–æ–º–ø—Ç –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
        // ========================================
        let customPrompt = null
        if (promptId) {
            const prompt = await prisma.prompt.findFirst({
                where: { id: promptId, userId: req.userId }
            })
            if (prompt) {
                customPrompt = prompt.content
            }
        }

        const structured = await structureText(text, customPrompt)
        res.json(structured)
    }catch (error) {
        console.error('–û—à–∏–±–∫–∞ AI-—Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–∏—è:', error)
        res.status(500).json({ error: error.message })
    }
})
module.exports = router
```

### –®–∞–≥ 7: –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–π

–í `backend/src/controllers/specificationController.js` –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ –ø—Ä–∏–Ω–∏–º–∞–µ–º `promptId`:

```javascript
async function generate(req, res) {
    try{
        const {text, projectId, promptId} = req.body  // ‚Üê –¥–æ–±–∞–≤–∏–ª–∏ promptId

        // ... –≤–∞–ª–∏–¥–∞—Ü–∏—è text –∏ projectId ...

        // ========================================
        // –ï—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω promptId ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ–º –∫–∞—Å—Ç–æ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç
        // ========================================
        let customPrompt = null
        if (promptId) {
            const prompt = await prisma.prompt.findFirst({
                where: { id: promptId, userId: req.userId }
            })
            if (prompt) {
                customPrompt = prompt.content
            }
        }

        const structured = await structureText(text, customPrompt)  // ‚Üê –ø–µ—Ä–µ–¥–∞—ë–º –ø—Ä–æ–º–ø—Ç

        // ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
    }
}
```

---

## –£—Ä–æ–∫ 21.3: –°—Ç—Ä–∞–Ω–∏—Ü–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–º–ø—Ç–∞–º–∏

### –ó–∞—á–µ–º

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –Ω—É–∂–µ–Ω –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —É–¥–∞–ª–µ–Ω–∏—è –ø—Ä–æ–º–ø—Ç–æ–≤. –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Å—Ç—Ä–æ–∏—Ç—Å—è –ø–æ –ø–∞—Ç—Ç–µ—Ä–Ω—É `ProjectsPage.vue` ‚Äî —Å–ø–∏—Å–æ–∫ –∫–∞—Ä—Ç–æ—á–µ–∫ + –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ñ–æ—Ä–º—ã.

### –®–∞–≥ 1: –°–æ–∑–¥–∞—Ç—å PromptsPage.vue

–°–æ–∑–¥–∞–π —Ñ–∞–π–ª `frontend/src/pages/PromptsPage.vue`:

```vue
<script setup>
import { ref, onMounted } from "vue"
import api from "../api"

// ========================================
// –†–µ–∞–∫—Ç–∏–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
// ========================================
const prompts = ref([])         // –°–ø–∏—Å–æ–∫ –ø—Ä–æ–º–ø—Ç–æ–≤
const loading = ref(true)       // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞
const showForm = ref(false)     // –ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å —Ñ–æ—Ä–º—É
const editingId = ref(null)     // ID —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞ (null = —Å–æ–∑–¥–∞–Ω–∏–µ)
const formData = ref({          // –î–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã
  title: '',
  content: '',
  isDefault: false
})
const formError = ref('')

// ========================================
// –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–º–ø—Ç–æ–≤ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
// ========================================
onMounted(async () => {
  await loadPrompts()
})

async function loadPrompts() {
  loading.value = true
  try {
    const response = await api.get('/prompts')
    prompts.value = response.data
  } catch (e) {
    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ–º–ø—Ç–æ–≤:', e)
  } finally {
    loading.value = false
  }
}

// ========================================
// –û—Ç–∫—Ä—ã—Ç—å —Ñ–æ—Ä–º—É –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è
// –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π –ø—Ä–æ–º–ø—Ç –∫–∞–∫ —à–∞–±–ª–æ–Ω
// ========================================
async function openCreate() {
  editingId.value = null
  formError.value = ''

  try {
    const response = await api.get('/prompts/default-text')
    formData.value = {
      title: '',
      content: response.data.content,
      isDefault: prompts.value.length === 0
    }
  } catch (e) {
    formData.value = { title: '', content: '', isDefault: false }
  }

  showForm.value = true
}

// ========================================
// –û—Ç–∫—Ä—ã—Ç—å —Ñ–æ—Ä–º—É –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
// ========================================
function openEdit(prompt) {
  editingId.value = prompt.id
  formData.value = {
    title: prompt.title,
    content: prompt.content,
    isDefault: prompt.isDefault
  }
  formError.value = ''
  showForm.value = true
}

// ========================================
// –°–æ—Ö—Ä–∞–Ω–∏—Ç—å (—Å–æ–∑–¥–∞–Ω–∏–µ –∏–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ)
// ========================================
async function savePrompt() {
  if (!formData.value.title.trim()) {
    formError.value = '–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞'
    return
  }
  if (!formData.value.content.trim()) {
    formError.value = '–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –ø—Ä–æ–º–ø—Ç–∞'
    return
  }

  try {
    if (editingId.value) {
      await api.put(`/prompts/${editingId.value}`, formData.value)
    } else {
      await api.post('/prompts', formData.value)
    }
    showForm.value = false
    await loadPrompts()
  } catch (e) {
    formError.value = e.response?.data?.error || '–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è'
  }
}

// ========================================
// –°–¥–µ–ª–∞—Ç—å –ø—Ä–æ–º–ø—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
// ========================================
async function setDefault(id) {
  try {
    await api.put(`/prompts/${id}`, { isDefault: true })
    await loadPrompts()
  } catch (e) {
    console.error('–û—à–∏–±–∫–∞:', e)
  }
}

// ========================================
// –£–¥–∞–ª–µ–Ω–∏–µ —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º
// ========================================
async function deletePrompt(id) {
  if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –ø—Ä–æ–º–ø—Ç?')) return
  try {
    await api.delete(`/prompts/${id}`)
    await loadPrompts()
  } catch (e) {
    alert('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è')
  }
}

// ========================================
// –ü—Ä–µ–≤—å—é —Ç–µ–∫—Å—Ç–∞ –ø—Ä–æ–º–ø—Ç–∞ (–æ–±—Ä–µ–∑–∞–µ–º –¥–æ 150 —Å–∏–º–≤–æ–ª–æ–≤)
// ========================================
function preview(text) {
  return text.length > 150 ? text.substring(0, 150) + '...' : text
}
</script>

<template>
  <div>
    <div class="flex justify-between items-center mb-4 sm:mb-6">
      <h1 class="text-xl sm:text-2xl font-bold">–ü—Ä–æ–º–ø—Ç—ã</h1>
      <button @click="openCreate"
              class="bg-blue-500 text-white px-3 sm:px-4 py-2 rounded hover:bg-blue-600 text-sm sm:text-base">
        + –ù–æ–≤—ã–π –ø—Ä–æ–º–ø—Ç
      </button>
    </div>

    <!-- –§–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (–º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ) -->
    <div v-if="showForm" class="fixed inset-0 bg-black/50 flex items-end sm:items-center justify-center z-50">
      <div class="bg-white rounded-t-lg sm:rounded-lg p-6 w-full sm:max-w-lg max-h-[90vh] overflow-y-auto">
        <h2 class="text-xl font-bold mb-4">
          {{ editingId ? '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–º–ø—Ç' : '–ù–æ–≤—ã–π –ø—Ä–æ–º–ø—Ç' }}
        </h2>

        <div v-if="formError" class="bg-red-100 text-red-700 p-3 rounded mb-4">
          {{ formError }}
        </div>

        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium mb-1">–ù–∞–∑–≤–∞–Ω–∏–µ</label>
            <input v-model="formData.title" type="text"
                   class="w-full border rounded px-3 py-2"
                   placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ü—Ä–æ–º–ø—Ç –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π" />
          </div>

          <div>
            <label class="block text-sm font-medium mb-1">–¢–µ–∫—Å—Ç –ø—Ä–æ–º–ø—Ç–∞</label>
            <textarea v-model="formData.content" rows="10"
                      class="w-full border rounded px-3 py-2 text-sm font-mono"
                      placeholder="–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è AI..."></textarea>
            <p class="text-xs text-gray-400 mt-1">
              –¢–µ–∫—Å—Ç –∑–∞–∫–∞–∑—á–∏–∫–∞ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ–Ω–µ—Ü –ø—Ä–æ–º–ø—Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
            </p>
          </div>

          <div>
            <label class="flex items-center gap-2 cursor-pointer">
              <input v-model="formData.isDefault" type="checkbox" class="rounded" />
              <span class="text-sm">–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é</span>
            </label>
          </div>
        </div>

        <div class="flex gap-3 mt-6">
          <button @click="savePrompt"
                  class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
            –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
          </button>
          <button @click="showForm = false"
                  class="bg-gray-200 px-4 py-2 rounded hover:bg-gray-300">
            –û—Ç–º–µ–Ω–∞
          </button>
        </div>
      </div>
    </div>

    <!-- –ó–∞–≥—Ä—É–∑–∫–∞ -->
    <div v-if="loading" class="text-gray-500">–ó–∞–≥—Ä—É–∑–∫–∞...</div>

    <!-- –ü—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫ -->
    <div v-else-if="prompts.length === 0" class="text-center py-12">
      <div class="bg-white rounded-lg shadow p-8 max-w-md mx-auto">
        <h2 class="text-lg font-semibold mb-2">–ü—Ä–æ–º–ø—Ç–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</h2>
        <p class="text-gray-500 text-sm mb-4">
          –ü—Ä–æ–º–ø—Ç ‚Äî —ç—Ç–æ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è AI, –∫–æ—Ç–æ—Ä–∞—è –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∫–∞–∫ –±—É–¥–µ—Ç
          —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–æ –≤–∞—à–µ –¢–ó. –°–æ–∑–¥–∞–π—Ç–µ —Å–≤–æ–π –ø–µ—Ä–≤—ã–π –ø—Ä–æ–º–ø—Ç –∏–ª–∏
          –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —à–∞–±–ª–æ–Ω.
        </p>
        <button @click="openCreate"
                class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
          –°–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤—ã–π –ø—Ä–æ–º–ø—Ç
        </button>
      </div>
    </div>

    <!-- –°–ø–∏—Å–æ–∫ –ø—Ä–æ–º–ø—Ç–æ–≤ -->
    <div v-else class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
      <div v-for="prompt in prompts" :key="prompt.id"
           class="bg-white rounded-lg shadow p-5 hover:shadow-md transition-shadow">
        <div class="flex items-start justify-between mb-2">
          <h3 class="font-semibold text-lg">{{ prompt.title }}</h3>
          <span v-if="prompt.isDefault"
                class="bg-green-100 text-green-700 text-xs px-2 py-1 rounded-full shrink-0 ml-2">
            –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é
          </span>
        </div>

        <p class="text-gray-500 text-sm mb-4 font-mono">
          {{ preview(prompt.content) }}
        </p>

        <p class="text-xs text-gray-400 mb-4">
          –°–æ–∑–¥–∞–Ω: {{ new Date(prompt.createdAt).toLocaleDateString('ru') }}
        </p>

        <div class="flex flex-wrap gap-2">
          <button v-if="!prompt.isDefault" @click="setDefault(prompt.id)"
                  class="text-green-500 hover:text-green-700 text-sm">
            –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é
          </button>
          <button @click="openEdit(prompt)"
                  class="text-gray-500 hover:text-gray-700 text-sm">
            –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
          </button>
          <button @click="deletePrompt(prompt.id)"
                  class="text-red-500 hover:text-red-700 text-sm">
            –£–¥–∞–ª–∏—Ç—å
          </button>
        </div>
      </div>
    </div>
  </div>
</template>
```

**–ß—Ç–æ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–≥–æ:**
- `openCreate` –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Ç–µ–∫—Å—Ç –¥–µ—Ñ–æ–ª—Ç–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞ —Å —Å–µ—Ä–≤–µ—Ä–∞ (`/prompts/default-text`) ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –Ω–∞—á–∞—Ç—å —Å —à–∞–±–ª–æ–Ω–∞
- –ï—Å–ª–∏ –ø—Ä–æ–º–ø—Ç–æ–≤ –Ω–µ—Ç ‚Äî –ø–µ—Ä–≤—ã–π —Å–æ–∑–¥–∞—ë—Ç—Å—è —Å—Ä–∞–∑—É –∫–∞–∫ `isDefault`
- `preview()` –æ–±—Ä–µ–∑–∞–µ—Ç –¥–ª–∏–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç –ø—Ä–æ–º–ø—Ç–∞ –¥–æ 150 —Å–∏–º–≤–æ–ª–æ–≤ –¥–ª—è –∫–∞—Ä—Ç–æ—á–∫–∏
- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å `max-h-[90vh] overflow-y-auto` ‚Äî –ø—Ä–æ–º–ø—Ç –º–æ–∂–µ—Ç –±—ã—Ç—å –¥–ª–∏–Ω–Ω—ã–º, –Ω—É–∂–µ–Ω —Å–∫—Ä–æ–ª–ª

### –®–∞–≥ 2: –î–æ–±–∞–≤–∏—Ç—å —Ä–æ—É—Ç –≤ router/index.js

–í `frontend/src/router/index.js` –¥–æ–±–∞–≤—å –≤ –º–∞—Å—Å–∏–≤ `children`:

```javascript
{
    path: 'prompts',
    component: () => import('../pages/PromptsPage.vue')
},
```

### –®–∞–≥ 3: –î–æ–±–∞–≤–∏—Ç—å "–ü—Ä–æ–º–ø—Ç—ã" –≤ –Ω–∞–≤–∏–≥–∞—Ü–∏—é

–í `frontend/src/components/AppLayout.vue` –¥–æ–±–∞–≤—å —Å—Å—ã–ª–∫—É –≤ –¥–µ—Å–∫—Ç–æ–ø-–Ω–∞–≤–∏–≥–∞—Ü–∏—é:

```html
<!-- –î–µ—Å–∫—Ç–æ–ø –Ω–∞–≤–∏–≥–∞—Ü–∏—è -->
<div class="hidden md:flex gap-4">
  <router-link to="/dashboard" class="text-gray-600 hover:text-blue-500 text-sm">
    –î–∞—à–±–æ—Ä–¥
  </router-link>
  <router-link to="/projects" class="text-gray-600 hover:text-blue-500 text-sm">
    –ü—Ä–æ–µ–∫—Ç—ã
  </router-link>
  <router-link to="/prompts" class="text-gray-600 hover:text-blue-500 text-sm">
    –ü—Ä–æ–º–ø—Ç—ã
  </router-link>
  <router-link to="/record" class="text-gray-600 hover:text-blue-500 text-sm">
    –ó–∞–ø–∏—Å–∞—Ç—å
  </router-link>
</div>
```

–ò –≤ –º–æ–±–∏–ª—å–Ω–æ–µ –º–µ–Ω—é:

```html
<router-link to="/prompts" @click="closeMenu"
             class="block text-gray-600 hover:text-blue-500">
  –ü—Ä–æ–º–ø—Ç—ã
</router-link>
```

---

## –£—Ä–æ–∫ 21.4: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π –¢–ó

### –ó–∞—á–µ–º

–¢–µ–ø–µ—Ä—å –ø–æ–¥–∫–ª—é—á–∏–º –ø—Ä–æ–º–ø—Ç—ã –∫ –ø—Ä–æ—Ü–µ—Å—Å—É —Å–æ–∑–¥–∞–Ω–∏—è –¢–ó ‚Äî –¥–æ–±–∞–≤–∏–º —Å–µ–ª–µ–∫—Ç–æ—Ä –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ `NewSpecificationPage` –∏ –±–∞–Ω–Ω–µ—Ä –Ω–∞ –¥–∞—à–±–æ—Ä–¥ –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

### –®–∞–≥ 1: –î–æ–±–∞–≤–∏—Ç—å —Å–µ–ª–µ–∫—Ç–æ—Ä –ø—Ä–æ–º–ø—Ç–æ–≤ –≤ NewSpecificationPage

–í `frontend/src/pages/NewSpecificationPage.vue` –¥–æ–±–∞–≤—å –∑–∞–≥—Ä—É–∑–∫—É –ø—Ä–æ–º–ø—Ç–æ–≤:

```javascript
// –í —Å–µ–∫—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö
const prompts = ref([])             // –°–ø–∏—Å–æ–∫ –ø—Ä–æ–º–ø—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
const selectedPromptId = ref(null)  // –í—ã–±—Ä–∞–Ω–Ω—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è AI

// –í onMounted –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ–µ–∫—Ç–æ–≤:
try {
  const response = await api.get('/prompts')
  prompts.value = response.data
  // –í—ã–±–∏—Ä–∞–µ–º –ø—Ä–æ–º–ø—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
  const defaultPrompt = prompts.value.find(p => p.isDefault)
  if (defaultPrompt) {
    selectedPromptId.value = defaultPrompt.id
  }
} catch (e) {
  console.error(e)
}
```

–î–æ–±–∞–≤—å —Å–µ–ª–µ–∫—Ç–æ—Ä –≤ —à–∞–±–ª–æ–Ω –º–µ–∂–¥—É textarea –∏ –∫–Ω–æ–ø–∫–æ–π AI:

```html
<!-- –°–µ–ª–µ–∫—Ç–æ—Ä –ø—Ä–æ–º–ø—Ç–∞ -->
<div class="mt-3 flex flex-col sm:flex-row gap-3 items-stretch sm:items-center">
  <select v-model="selectedPromptId"
          class="border rounded px-3 py-2 text-sm flex-1 sm:max-w-xs">
    <option :value="null">–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø—Ä–æ–º–ø—Ç</option>
    <option v-for="p in prompts" :key="p.id" :value="p.id">
      {{ p.title }}
    </option>
  </select>

  <button @click="structureWithAI" :disabled="isStructuring"
          class="bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-600 disabled:opacity-50">
    {{ isStructuring ? 'AI –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç...' : '–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ AI' }}
  </button>
</div>
```

–ü–µ—Ä–µ–¥–∞–≤–∞–π `promptId` –≤ –æ–±–∞ –∑–∞–ø—Ä–æ—Å–∞:

```javascript
// –í structureWithAI:
const response = await api.post('/ai/structure', {
  text: voiceText.value,
  promptId: selectedPromptId.value
})

// –í save:
const response = await api.post('/specifications/generate', {
  text: voiceText.value,
  projectId: projectId.value,
  promptId: selectedPromptId.value
})
```

### –®–∞–≥ 2: –î–æ–±–∞–≤–∏—Ç—å –±–∞–Ω–Ω–µ—Ä –Ω–∞ DashboardPage

–í `frontend/src/pages/DashboardPage.vue` –¥–æ–±–∞–≤—å –ø—Ä–æ–≤–µ—Ä–∫—É –ø—Ä–æ–º–ø—Ç–æ–≤:

```vue
<script setup>
import { ref, onMounted } from 'vue'
import { authStore } from '../stores/auth'
import api from '../api'

// ========================================
// –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å—Ç—å –ª–∏ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø—Ä–æ–º–ø—Ç—ã
// –ï—Å–ª–∏ –Ω–µ—Ç ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –±–∞–Ω–Ω–µ—Ä
// ========================================
const hasPrompts = ref(true) // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–∫—Ä—ã–≤–∞–µ–º –±–∞–Ω–Ω–µ—Ä

onMounted(async () => {
  try {
    const response = await api.get('/prompts')
    hasPrompts.value = response.data.length > 0
  } catch (e) {
    console.error(e)
  }
})
</script>

<template>
  <div>
    <h1 class="text-2xl font-bold mb-6">
      –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {{ authStore.user?.name }}!
    </h1>

    <!-- –ë–∞–Ω–Ω–µ—Ä: –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –ø—Ä–æ–º–ø—Ç -->
    <div v-if="!hasPrompts"
         class="bg-blue-50 border border-blue-200 rounded-lg p-4 sm:p-6 mb-6">
      <h2 class="text-lg font-semibold text-blue-800 mb-2">–ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Å–≤–æ–π –ø—Ä–æ–º–ø—Ç –¥–ª—è AI</h2>
      <p class="text-blue-600 text-sm mb-3">
        –ü—Ä–æ–º–ø—Ç ‚Äî —ç—Ç–æ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∫–∞–∫ AI –±—É–¥–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞—Ç—å
        –≤–∞—à–∏ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞–Ω–∏—è. –°–æ–∑–¥–∞–π—Ç–µ —Å–≤–æ–π –ø—Ä–æ–º–ø—Ç –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —à–∞–±–ª–æ–Ω.
      </p>
      <router-link to="/prompts"
                   class="inline-block bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 text-sm">
        –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø—Ä–æ–º–ø—Ç—ã
      </router-link>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
      <router-link to="/projects"
                   class="bg-white p-6 rounded-lg shadow hover:shadow-md transition-shadow">
        <h2 class="text-lg font-semibold mb-2">–ü—Ä–æ–µ–∫—Ç—ã</h2>
        <p class="text-gray-500 text-sm">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞–º–∏ –∏ –∫–ª–∏–µ–Ω—Ç–∞–º–∏</p>
      </router-link>

      <router-link to="/prompts"
                   class="bg-white p-6 rounded-lg shadow hover:shadow-md transition-shadow">
        <h2 class="text-lg font-semibold mb-2">–ü—Ä–æ–º–ø—Ç—ã</h2>
        <p class="text-gray-500 text-sm">–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π –¥–ª—è AI</p>
      </router-link>
    </div>
  </div>
</template>
```

**–ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å:**
- `hasPrompts` ‚Äî –ø—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã, –µ—Å—Ç—å –ª–∏ –ø—Ä–æ–º–ø—Ç—ã
- –ë–∞–Ω–Ω–µ—Ä `v-if="!hasPrompts"` ‚Äî –≤–∏–¥–µ–Ω —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø—Ä–æ–º–ø—Ç–æ–≤ –Ω–µ—Ç
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–∞ "–ü—Ä–æ–º–ø—Ç—ã" –≤ —Å–µ—Ç–∫—É –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –¥–∞—à–±–æ—Ä–¥–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞

1. –ó–∞–ø—É—Å—Ç–∏ `npx prisma db push` –≤ backend ‚Äî –º–∏–≥—Ä–∞—Ü–∏—è –±–µ–∑ –æ—à–∏–±–æ–∫
2. –ó–∞–ø—É—Å—Ç–∏ backend `npm run dev` ‚Äî —Å–µ—Ä–≤–µ—Ä —Å—Ç–∞—Ä—Ç—É–µ—Ç
3. –ó–∞–ø—É—Å—Ç–∏ frontend `npm run dev` ‚Äî –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è
4. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ‚Üí –Ω–∞ –¥–∞—à–±–æ—Ä–¥–µ –≤–∏–¥–µ–Ω –±–∞–Ω–Ω–µ—Ä "–ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Å–≤–æ–π –ø—Ä–æ–º–ø—Ç –¥–ª—è AI"
5. –ü–µ—Ä–µ–π–¥–∏ –Ω–∞ `/prompts` ‚Üí —Å–æ–∑–¥–∞–π –ø—Ä–æ–º–ø—Ç —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º –∏ —Ç–µ–∫—Å—Ç–æ–º ‚Üí –±–∞–Ω–Ω–µ—Ä –Ω–∞ –¥–∞—à–±–æ—Ä–¥–µ –∏—Å—á–µ–∑–∞–µ—Ç
6. –°–æ–∑–¥–∞–π –¢–ó ‚Üí –≤–∏–¥–µ–Ω —Å–µ–ª–µ–∫—Ç–æ—Ä –ø—Ä–æ–º–ø—Ç–æ–≤ ‚Üí –≤—ã–±–µ—Ä–∏ —Å–≤–æ–π –ø—Ä–æ–º–ø—Ç ‚Üí AI –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –µ–≥–æ –≤–º–µ—Å—Ç–æ –¥–µ—Ñ–æ–ª—Ç–Ω–æ–≥–æ
7. –ü–æ–ø—Ä–æ–±—É–π "–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø—Ä–æ–º–ø—Ç" –≤ —Å–µ–ª–µ–∫—Ç–æ—Ä–µ ‚Äî AI —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ —Ä–∞–Ω—å—à–µ

---

# –ß–ê–°–¢–¨ 22: –≠–ö–°–ü–û–†–¢ –í DOC ‚úÖ

## –£—Ä–æ–∫ 22.1: Backend ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü–∏—è DOCX ‚úÖ

### –ó–∞—á–µ–º

PDF —Ö–æ—Ä–æ—à –¥–ª—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞, –Ω–æ –∑–∞–∫–∞–∑—á–∏–∫–∏ —á–∞—Å—Ç–æ —Ö–æ—Ç—è—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –¢–ó –≤ Word. –î–æ–±–∞–≤–∏–º —ç–∫—Å–ø–æ—Ä—Ç –≤ —Ñ–æ—Ä–º–∞—Ç `.docx` ‚Äî –µ–≥–æ –º–æ–∂–Ω–æ –æ—Ç–∫—Ä—ã—Ç—å –≤ Microsoft Word, Google Docs, LibreOffice.

### –®–∞–≥ 1: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ docx

```bash
cd backend
npm install docx
```

**–ß—Ç–æ —Å—Ç–∞–≤–∏–º:**
- `docx` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü–∏—è `.docx` —Ñ–∞–π–ª–æ–≤ –Ω–∞ —á–∏—Å—Ç–æ–º JavaScript, –±–µ–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –æ—Ç LibreOffice –∏–ª–∏ –¥—Ä—É–≥–∏—Ö –≤–Ω–µ—à–Ω–∏—Ö –ø—Ä–æ–≥—Ä–∞–º–º

### –®–∞–≥ 2: –°–æ–∑–¥–∞—Ç—å —Å–µ—Ä–≤–∏—Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ DOC

–°–æ–∑–¥–∞–π —Ñ–∞–π–ª `backend/src/services/docService.js`:

```javascript
// ========================================
// –°–µ—Ä–≤–∏—Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ DOCX
//
// –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ docx —Å–æ–∑–¥–∞—ë—Ç —Ñ–∞–π–ª—ã Word
// –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ ‚Äî –±–µ–∑ —à–∞–±–ª–æ–Ω–æ–≤ –∏ –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
//
// –°—Ç—Ä—É–∫—Ç—É—Ä–∞ DOCX:
// Document ‚Üí Section ‚Üí Paragraph/Table
// ========================================

const {
  Document, Packer, Paragraph, TextRun,
  HeadingLevel, AlignmentType, BorderStyle,
  Table, TableRow, TableCell, WidthType,
  ImageRun
} = require('docx')
const fs = require('fs')
const path = require('path')

/**
 * –ì–µ–Ω–µ—Ä–∞—Ü–∏—è DOCX –∏–∑ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏
 *
 * @param {Object} spec ‚Äî —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è —Å sections –∏ items
 * @param {boolean} includeImages ‚Äî –≤–∫–ª—é—á–∞—Ç—å –ª–∏ –ø—Ä–∏–∫—Ä–µ–ø–ª—ë–Ω–Ω—ã–µ —Å–∫—Ä–∏–Ω—à–æ—Ç—ã
 * @returns {Buffer} ‚Äî –±—É—Ñ–µ—Ä –≥–æ—Ç–æ–≤–æ–≥–æ .docx —Ñ–∞–π–ª–∞
 */
async function generateDoc(spec, includeImages = true) {

  // ========================================
  // –°–æ–±–∏—Ä–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞
  // –ö–∞–∂–¥—ã–π —ç–ª–µ–º–µ–Ω—Ç –º–∞—Å—Å–∏–≤–∞ ‚Äî –ø–∞—Ä–∞–≥—Ä–∞—Ñ –∏–ª–∏ —Ç–∞–±–ª–∏—Ü–∞
  // ========================================
  const children = []

  // ========================================
  // –ó–∞–≥–æ–ª–æ–≤–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞
  // ========================================
  children.push(
    new Paragraph({
      children: [
        new TextRun({
          text: spec.title || '–¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ',
          bold: true,
          size: 32,          // —Ä–∞–∑–º–µ—Ä –≤ half-points (32 = 16pt)
          font: 'Arial'
        })
      ],
      heading: HeadingLevel.TITLE,
      alignment: AlignmentType.CENTER,
      spacing: { after: 400 }
    })
  )

  // –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è
  children.push(
    new Paragraph({
      children: [
        new TextRun({
          text: `–î–∞—Ç–∞: ${new Date(spec.createdAt).toLocaleDateString('ru')}`,
          size: 20,
          color: '666666',
          font: 'Arial'
        })
      ],
      alignment: AlignmentType.RIGHT,
      spacing: { after: 400 }
    })
  )

  // ========================================
  // –†–∞–∑–¥–µ–ª—ã –∏ –ø—É–Ω–∫—Ç—ã
  // ========================================
  let totalMinutes = 0

  spec.sections.forEach((section, sectionIndex) => {
    // –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Ä–∞–∑–¥–µ–ª–∞
    children.push(
      new Paragraph({
        children: [
          new TextRun({
            text: `${sectionIndex + 1}. ${section.title}`,
            bold: true,
            size: 26,
            font: 'Arial'
          })
        ],
        heading: HeadingLevel.HEADING_1,
        spacing: { before: 300, after: 200 }
      })
    )

    // –ü—É–Ω–∫—Ç—ã —Ä–∞–∑–¥–µ–ª–∞
    section.items.forEach((item, itemIndex) => {
      const timeStr = item.timeEstimate
        ? ` [${item.timeEstimate} –º–∏–Ω]`
        : ''

      if (item.timeEstimate) {
        totalMinutes += item.timeEstimate
      }

      children.push(
        new Paragraph({
          children: [
            new TextRun({
              text: `${sectionIndex + 1}.${itemIndex + 1} `,
              bold: true,
              size: 22,
              font: 'Arial'
            }),
            new TextRun({
              text: item.content,
              size: 22,
              font: 'Arial'
            }),
            new TextRun({
              text: timeStr,
              size: 22,
              color: '0066CC',
              bold: true,
              font: 'Arial'
            })
          ],
          spacing: { after: 100 },
          indent: { left: 400 }
        })
      )

      // ========================================
      // –ü—Ä–∏–∫—Ä–µ–ø–ª—ë–Ω–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
      // –ß–∏—Ç–∞–µ–º —Ñ–∞–π–ª —Å –¥–∏—Å–∫–∞ –∏ –≤—Å—Ç–∞–≤–ª—è–µ–º –≤ –¥–æ–∫—É–º–µ–Ω—Ç
      // ========================================
      if (includeImages && item.attachments) {
        item.attachments.forEach(att => {
          if (att.mimetype && att.mimetype.startsWith('image/')) {
            const filePath = path.join(__dirname, '../../', att.path)
            if (fs.existsSync(filePath)) {
              const imageData = fs.readFileSync(filePath)
              children.push(
                new Paragraph({
                  children: [
                    new ImageRun({
                      data: imageData,
                      transformation: {
                        width: 500,
                        height: 300
                      },
                      type: att.mimetype === 'image/png' ? 'png' : 'jpg'
                    })
                  ],
                  spacing: { before: 100, after: 200 },
                  indent: { left: 400 }
                })
              )
            }
          }
        })
      }
    })
  })

  // ========================================
  // –ò—Ç–æ–≥–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Å –æ–±—â–∏–º –≤—Ä–µ–º–µ–Ω–µ–º
  // ========================================
  const hours = Math.floor(totalMinutes / 60)
  const mins = totalMinutes % 60
  const totalStr = hours > 0
    ? `${hours} —á ${mins} –º–∏–Ω`
    : `${totalMinutes} –º–∏–Ω`

  children.push(
    new Paragraph({
      children: [
        new TextRun({ text: '' })
      ],
      spacing: { before: 400 }
    })
  )

  children.push(
    new Table({
      rows: [
        new TableRow({
          children: [
            new TableCell({
              children: [
                new Paragraph({
                  children: [
                    new TextRun({
                      text: '–û–±—â–µ–µ –≤—Ä–µ–º—è:',
                      bold: true,
                      size: 24,
                      font: 'Arial'
                    })
                  ]
                })
              ],
              width: { size: 50, type: WidthType.PERCENTAGE }
            }),
            new TableCell({
              children: [
                new Paragraph({
                  children: [
                    new TextRun({
                      text: totalStr,
                      bold: true,
                      size: 24,
                      color: '0066CC',
                      font: 'Arial'
                    })
                  ],
                  alignment: AlignmentType.RIGHT
                })
              ],
              width: { size: 50, type: WidthType.PERCENTAGE }
            })
          ]
        })
      ],
      width: { size: 100, type: WidthType.PERCENTAGE }
    })
  )

  // ========================================
  // –°–æ–∑–¥–∞—ë–º –¥–æ–∫—É–º–µ–Ω—Ç
  // ========================================
  const doc = new Document({
    sections: [{
      children
    }]
  })

  // ========================================
  // Packer.toBuffer() ‚Äî —Å–µ—Ä–∏–∞–ª–∏–∑—É–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –≤ –±—É—Ñ–µ—Ä
  // –≠—Ç–æ—Ç –±—É—Ñ–µ—Ä –º–æ–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ —Ñ–∞–π–ª –∏–ª–∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç—É
  // ========================================
  const buffer = await Packer.toBuffer(doc)
  return buffer
}

module.exports = { generateDoc }
```

**–ö–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã:**
- `Packer.toBuffer()` ‚Äî –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç –æ–±—ä–µ–∫—Ç Document –≤ Buffer (–±–∏–Ω–∞—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ .docx)
- `ImageRun` ‚Äî –≤—Å—Ç–∞–≤–ª—è–µ—Ç –∫–∞—Ä—Ç–∏–Ω–∫—É –ø—Ä—è–º–æ –≤ –¥–æ–∫—É–º–µ–Ω—Ç, —á–∏—Ç–∞—è —Ñ–∞–π–ª —Å –¥–∏—Å–∫–∞
- –ù—É–º–µ—Ä–∞—Ü–∏—è `1.1`, `1.2`, `2.1` ‚Äî —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ
- –ò—Ç–æ–≥–æ–≤–æ–µ –≤—Ä–µ–º—è —Å—á–∏—Ç–∞–µ—Ç—Å—è —Å—É–º–º–æ–π `timeEstimate` –≤—Å–µ—Ö –ø—É–Ω–∫—Ç–æ–≤

### –®–∞–≥ 3: –î–æ–±–∞–≤–∏—Ç—å —Ä–æ—É—Ç —ç–∫—Å–ø–æ—Ä—Ç–∞ –≤ DOC

–û—Ç–∫—Ä–æ–π `backend/src/routes/export.js` –∏ –¥–æ–±–∞–≤—å –Ω–æ–≤—ã–π —Ä–æ—É—Ç:

```javascript
const { generateDoc } = require('../services/docService')

/**
 * GET /api/export/doc/:specificationId
 *
 * –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç DOCX –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
 *
 * Content-Type –¥–ª—è .docx ‚Äî –¥–ª–∏–Ω–Ω—ã–π MIME-—Ç–∏–ø –æ—Ç Microsoft
 * –ë—Ä–∞—É–∑–µ—Ä –ø–æ–π–º—ë—Ç —á—Ç–æ —ç—Ç–æ —Ñ–∞–π–ª Word –∏ –ø—Ä–µ–¥–ª–æ–∂–∏—Ç —Å–∫–∞—á–∞—Ç—å
 */
router.get('/doc/:specificationId', authenticate, async (req, res) => {
  try {
    const spec = await prisma.specification.findFirst({
      where: {
        id: parseInt(req.params.specificationId),
        userId: req.userId
      },
      include: {
        sections: {
          orderBy: { position: 'asc' },
          include: {
            items: {
              orderBy: { position: 'asc' },
              include: {
                attachments: true   // ‚Üê –≤–∫–ª—é—á–∞–µ–º –≤–ª–æ–∂–µ–Ω–∏—è –¥–ª—è –∫–∞—Ä—Ç–∏–Ω–æ–∫ –≤ DOC
              }
            }
          }
        }
      }
    })

    if (!spec) {
      return res.status(404).json({ error: '–¢–ó –Ω–µ –Ω–∞–π–¥–µ–Ω–æ' })
    }

    const buffer = await generateDoc(spec)

    res.setHeader('Content-Type',
      'application/vnd.openxmlformats-officedocument.wordprocessingml.document')
    res.setHeader('Content-Disposition',
      `attachment; filename="tz-${spec.id}.docx"`)
    res.send(buffer)
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ DOC:', error)
    res.status(500).json({ error: '–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞ –≤ DOC' })
  }
})
```

### –®–∞–≥ 4: –û–±–Ω–æ–≤–∏—Ç—å —Ä–æ—É—Ç PDF ‚Äî –¥–æ–±–∞–≤–∏—Ç—å –≤–∫–ª—é—á–µ–Ω–∏–µ –≤–ª–æ–∂–µ–Ω–∏–π

–û–±–Ω–æ–≤–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Ä–æ—É—Ç PDF –≤ —Ç–æ–º –∂–µ —Ñ–∞–π–ª–µ, —á—Ç–æ–±—ã —Ç–æ–∂–µ –ø–æ–¥–≥—Ä—É–∂–∞–ª attachments:

```javascript
router.get('/pdf/:specificationId', authenticate, async (req, res) => {
  try {
    const spec = await prisma.specification.findFirst({
      where: {
        id: parseInt(req.params.specificationId),
        userId: req.userId
      },
      include: {
        sections: {
          orderBy: { position: 'asc' },
          include: {
            items: {
              orderBy: { position: 'asc' },
              include: {
                attachments: true   // ‚Üê –¥–æ–±–∞–≤–ª—è–µ–º
              }
            }
          }
        }
      }
    })

    if (!spec) {
      return res.status(404).json({ error: '–¢–ó –Ω–µ –Ω–∞–π–¥–µ–Ω–æ' })
    }

    const pdf = await generatePdf(spec)

    res.setHeader('Content-Type', 'application/pdf')
    res.setHeader('Content-Disposition', `attachment; filename="tz-${spec.id}.pdf"`)
    res.send(pdf)
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ PDF:', error)
    res.status(500).json({ error: '–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞' })
  }
})
```

---

## –£—Ä–æ–∫ 22.2: Frontend ‚Äî —Å–µ–ª–µ–∫—Ç–æ—Ä —Ñ–æ—Ä–º–∞—Ç–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞ ‚úÖ

### –ó–∞—á–µ–º

–í–º–µ—Å—Ç–æ –æ–¥–Ω–æ–π –∫–Ω–æ–ø–∫–∏ "–°–∫–∞—á–∞—Ç—å PDF" –¥–æ–±–∞–≤–∏–º —Å–µ–ª–µ–∫—Ç–æ—Ä —Ñ–æ—Ä–º–∞—Ç–∞ (PDF / DOC). –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç —Ñ–æ—Ä–º–∞—Ç –∏ –Ω–∞–∂–∏–º–∞–µ—Ç "–°–∫–∞—á–∞—Ç—å".

### –®–∞–≥ 1: –û–±–Ω–æ–≤–∏—Ç—å SpecificationPage.vue

–í `frontend/src/pages/SpecificationPage.vue` –∑–∞–º–µ–Ω–∏ –∫–Ω–æ–ø–∫—É —Å–∫–∞—á–∏–≤–∞–Ω–∏—è:

```vue
<!-- –°–µ–ª–µ–∫—Ç–æ—Ä —ç–∫—Å–ø–æ—Ä—Ç–∞ -->
<div class="flex gap-2 items-center">
  <select v-model="exportFormat"
          class="border rounded px-3 py-2 text-sm">
    <option value="pdf">PDF</option>
    <option value="doc">DOC (Word)</option>
  </select>
  <button @click="downloadExport"
          :disabled="exporting"
          class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 disabled:opacity-50 text-sm">
    {{ exporting ? '–ì–µ–Ω–µ—Ä–∞—Ü–∏—è...' : '–°–∫–∞—á–∞—Ç—å' }}
  </button>
</div>
```

–í `<script setup>` –¥–æ–±–∞–≤—å:

```javascript
const exportFormat = ref('pdf')
const exporting = ref(false)

async function downloadExport() {
  exporting.value = true
  try {
    // ========================================
    // –§–æ—Ä–º–∞—Ç –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç URL –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ–∞–π–ª–∞
    // responseType: 'blob' ‚Äî –ø–æ–ª—É—á–∞–µ–º –±–∏–Ω–∞—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
    // ========================================
    const format = exportFormat.value
    const response = await api.get(`/export/${format}/${specification.value.id}`, {
      responseType: 'blob'
    })

    const extension = format === 'doc' ? 'docx' : 'pdf'
    const url = URL.createObjectURL(response.data)
    const link = document.createElement('a')
    link.href = url
    link.download = `tz-${specification.value.id}.${extension}`
    link.click()
    URL.revokeObjectURL(url)
  } catch (e) {
    alert('–û—à–∏–±–∫–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è')
  } finally {
    exporting.value = false
  }
}
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞

1. –û—Ç–∫—Ä–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—É –¢–ó —Å –ø—É–Ω–∫—Ç–∞–º–∏
2. –í—ã–±–µ—Ä–∏ —Ñ–æ—Ä–º–∞—Ç "DOC (Word)" ‚Üí –Ω–∞–∂–º–∏ "–°–∫–∞—á–∞—Ç—å"
3. –§–∞–π–ª `.docx` —Å–∫–∞—á–∏–≤–∞–µ—Ç—Å—è ‚Üí –æ—Ç–∫—Ä–æ–π –≤ Word/Google Docs ‚Äî —Ä–∞–∑–¥–µ–ª—ã, –ø—É–Ω–∫—Ç—ã, –≤—Ä–µ–º—è –Ω–∞ –º–µ—Å—Ç–µ
4. –í—ã–±–µ—Ä–∏ "PDF" ‚Üí —Å–∫–∞—á–∏–≤–∞–µ—Ç—Å—è PDF –∫–∞–∫ —Ä–∞–Ω—å—à–µ

---

# –ß–ê–°–¢–¨ 23: –ü–†–ò–ö–†–ï–ü–õ–ï–ù–ò–ï –°–ö–†–ò–ù–®–û–¢–û–í –ö –ü–£–ù–ö–¢–ê–ú –¢–ó ‚úÖ

## –£—Ä–æ–∫ 23.1: UI –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤ –∫ –ø—É–Ω–∫—Ç–∞–º

### –ó–∞—á–µ–º

–í –ß–∞—Å—Ç–∏ 13 –º—ã —Å–æ–∑–¥–∞–ª–∏ backend –¥–ª—è –≤–ª–æ–∂–µ–Ω–∏–π. –¢–µ–ø–µ—Ä—å –Ω—É–∂–µ–Ω —É–¥–æ–±–Ω—ã–π UI ‚Äî —á—Ç–æ–±—ã –∫ –∫–∞–∂–¥–æ–º—É –ø—É–Ω–∫—Ç—É –¢–ó –º–æ–∂–Ω–æ –±—ã–ª–æ –ø—Ä–∏–∫—Ä–µ–ø–∏—Ç—å —Å–∫—Ä–∏–Ω—à–æ—Ç—ã –ø—Ä—è–º–æ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞.

### –®–∞–≥ 1: –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤

–°–æ–∑–¥–∞–π `frontend/src/components/ItemAttachments.vue`:

```vue
<script setup>
import { ref } from 'vue'
import api from '../api'

// ========================================
// Props –∏ Events
//
// itemId ‚Äî ID –ø—É–Ω–∫—Ç–∞ –¢–ó
// attachments ‚Äî —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –≤–ª–æ–∂–µ–Ω–∏—è
// readonly ‚Äî —Ä–µ–∂–∏–º –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ (–±–µ–∑ –∑–∞–≥—Ä—É–∑–∫–∏/—É–¥–∞–ª–µ–Ω–∏—è)
// ========================================
const props = defineProps({
  itemId: { type: Number, required: true },
  attachments: { type: Array, default: () => [] },
  readonly: { type: Boolean, default: false }
})

const emit = defineEmits(['updated'])

const uploading = ref(false)
const dragover = ref(false)

// ========================================
// –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞
//
// FormData ‚Äî —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –æ–±—ä–µ–∫—Ç –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–∞–π–ª–æ–≤
// —á–µ—Ä–µ–∑ multipart/form-data (—Å—Ç–∞–Ω–¥–∞—Ä—Ç –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤)
// ========================================
async function uploadFile(file) {
  if (!file) return

  // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–∏–ø ‚Äî —Ç–æ–ª—å–∫–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
  if (!file.type.startsWith('image/')) {
    alert('–ú–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (PNG, JPG, GIF, WebP)')
    return
  }

  // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–º–µ—Ä ‚Äî –º–∞–∫—Å–∏–º—É–º 5 –ú–ë
  if (file.size > 5 * 1024 * 1024) {
    alert('–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π. –ú–∞–∫—Å–∏–º—É–º 5 –ú–ë')
    return
  }

  uploading.value = true
  try {
    const formData = new FormData()
    formData.append('file', file)

    await api.post(`/attachments/${props.itemId}`, formData, {
      headers: { 'Content-Type': 'multipart/form-data' }
    })

    emit('updated')  // –†–æ–¥–∏—Ç–µ–ª—å –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç –¥–∞–Ω–Ω—ã–µ
  } catch (e) {
    alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ' + (e.response?.data?.error || e.message))
  } finally {
    uploading.value = false
  }
}

// ========================================
// –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞ —á–µ—Ä–µ–∑ input
// ========================================
function onFileSelect(event) {
  const file = event.target.files[0]
  uploadFile(file)
  event.target.value = ''  // –°–±—Ä–æ—Å –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–æ–≥–æ –∂–µ —Ñ–∞–π–ª–∞
}

// ========================================
// Drag & Drop
//
// dragover ‚Äî –ø–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º –∑–æ–Ω—É –ø—Ä–∏ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–∏
// drop ‚Äî –ø–æ–ª—É—á–∞–µ–º —Ñ–∞–π–ª –∏–∑ —Å–æ–±—ã—Ç–∏—è
// preventDefault ‚Äî –∏–Ω–∞—á–µ –±—Ä–∞—É–∑–µ—Ä –æ—Ç–∫—Ä–æ–µ—Ç —Ñ–∞–π–ª
// ========================================
function onDragOver(e) {
  e.preventDefault()
  dragover.value = true
}

function onDragLeave() {
  dragover.value = false
}

function onDrop(e) {
  e.preventDefault()
  dragover.value = false
  const file = e.dataTransfer.files[0]
  uploadFile(file)
}

// ========================================
// –£–¥–∞–ª–µ–Ω–∏–µ –≤–ª–æ–∂–µ–Ω–∏—è
// ========================================
async function removeAttachment(attachmentId) {
  if (!confirm('–£–¥–∞–ª–∏—Ç—å —Å–∫—Ä–∏–Ω—à–æ—Ç?')) return
  try {
    await api.delete(`/attachments/${attachmentId}`)
    emit('updated')
  } catch (e) {
    alert('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è')
  }
}

// ========================================
// –ü–æ–ª–Ω—ã–π URL –∫–∞—Ä—Ç–∏–Ω–∫–∏
// Backend —Ä–∞–∑–¥–∞—ë—Ç —Ñ–∞–π–ª—ã –ø–æ /uploads/filename
// ========================================
function imageUrl(attachment) {
  const baseUrl = import.meta.env.VITE_API_URL || 'http://localhost:3000'
  return `${baseUrl}${attachment.path}`
}
</script>

<template>
  <div class="mt-2">
    <!-- –°–ø–∏—Å–æ–∫ –ø—Ä–∏–∫—Ä–µ–ø–ª—ë–Ω–Ω—ã—Ö —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤ -->
    <div v-if="attachments.length > 0" class="flex flex-wrap gap-2 mb-2">
      <div v-for="att in attachments" :key="att.id" class="relative group">
        <!-- –ú–∏–Ω–∏–∞—Ç—é—Ä–∞ -->
        <img v-if="att.mimetype?.startsWith('image/')"
             :src="imageUrl(att)"
             :alt="att.filename"
             class="w-24 h-24 object-cover rounded border cursor-pointer
                    hover:opacity-90 transition-opacity"
             @click="window.open(imageUrl(att), '_blank')" />

        <!-- –ö–Ω–æ–ø–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è (–≤–∏–¥–Ω–∞ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏) -->
        <button v-if="!readonly"
                @click="removeAttachment(att.id)"
                class="absolute -top-2 -right-2 bg-red-500 text-white
                       rounded-full w-5 h-5 text-xs flex items-center justify-center
                       opacity-0 group-hover:opacity-100 transition-opacity">
          x
        </button>
      </div>
    </div>

    <!-- –ó–æ–Ω–∞ –∑–∞–≥—Ä—É–∑–∫–∏ (drag & drop + –∫–Ω–æ–ø–∫–∞) -->
    <div v-if="!readonly"
         :class="[
           'border-2 border-dashed rounded p-3 text-center text-sm transition-colors',
           dragover ? 'border-blue-400 bg-blue-50' : 'border-gray-200 hover:border-gray-400'
         ]"
         @dragover="onDragOver"
         @dragleave="onDragLeave"
         @drop="onDrop">

      <div v-if="uploading" class="text-blue-500">
        –ó–∞–≥—Ä—É–∑–∫–∞...
      </div>
      <div v-else>
        <label class="cursor-pointer text-blue-500 hover:text-blue-700">
          –ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å —Å–∫—Ä–∏–Ω—à–æ—Ç
          <input type="file" accept="image/*" class="hidden" @change="onFileSelect" />
        </label>
        <span class="text-gray-400 ml-1">–∏–ª–∏ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Å—é–¥–∞</span>
      </div>
    </div>
  </div>
</template>
```

**–ß—Ç–æ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–≥–æ:**
- Drag & Drop –¥–ª—è —É–¥–æ–±–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ ‚Äî –ø–µ—Ä–µ—Ç–∞—â–∏–ª —Å–∫—Ä–∏–Ω—à–æ—Ç –Ω–∞ –ø—É–Ω–∫—Ç
- –ú–∏–Ω–∏–∞—Ç—é—Ä—ã 96x96px —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –æ—Ç–∫—Ä—ã—Ç—å –ø–æ–ª–Ω—ã–π —Ä–∞–∑–º–µ—Ä
- –ö–Ω–æ–ø–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –ø–æ—è–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ (–Ω–µ –º–µ—à–∞–µ—Ç –≤–∏–∑—É–∞–ª—å–Ω–æ)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∞ –∏ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ (–¥–æ –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä)

### –®–∞–≥ 2: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ SpecificationPage.vue

–í `frontend/src/pages/SpecificationPage.vue` –ø–æ–¥–∫–ª—é—á–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç:

```javascript
import ItemAttachments from '../components/ItemAttachments.vue'
```

–í —à–∞–±–ª–æ–Ω–µ, –≤–Ω—É—Ç—Ä–∏ —Ü–∏–∫–ª–∞ `v-for="item in section.items"`, –ø–æ—Å–ª–µ —Ç–µ–∫—Å—Ç–∞ –ø—É–Ω–∫—Ç–∞ –¥–æ–±–∞–≤—å:

```html
<!-- –°–∫—Ä–∏–Ω—à–æ—Ç—ã –ø—É–Ω–∫—Ç–∞ -->
<ItemAttachments
  :item-id="item.id"
  :attachments="item.attachments || []"
  :readonly="isSharedView"
  @updated="loadSpecification" />
```

### –®–∞–≥ 3: –û–±–Ω–æ–≤–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É –¢–ó ‚Äî –≤–∫–ª—é—á–∏—Ç—å attachments

–í —Ñ—É–Ω–∫—Ü–∏–∏ `loadSpecification` —É–±–µ–¥–∏—Å—å —á—Ç–æ backend –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤–ª–æ–∂–µ–Ω–∏—è:

```javascript
async function loadSpecification() {
  const response = await api.get(`/specifications/${specId}`)
  specification.value = response.data
}
```

–ù–∞ backend –≤ `specificationController.js` –æ–±–Ω–æ–≤–∏ `getById`:

```javascript
const spec = await prisma.specification.findFirst({
  where: { id, userId: req.userId },
  include: {
    sections: {
      orderBy: { position: 'asc' },
      include: {
        items: {
          orderBy: { position: 'asc' },
          include: {
            attachments: true   // ‚Üê –¥–æ–±–∞–≤–ª—è–µ–º
          }
        }
      }
    }
  }
})
```

### –®–∞–≥ 4: –í—Å—Ç–∞–≤–∫–∞ —á–µ—Ä–µ–∑ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞ (Ctrl+V)

–î–æ–±–∞–≤—å –≤ `ItemAttachments.vue` –æ–±—Ä–∞–±–æ—Ç–∫—É –≤—Å—Ç–∞–≤–∫–∏ –∏–∑ –±—É—Ñ–µ—Ä–∞ ‚Äî –æ—á–µ–Ω—å —É–¥–æ–±–Ω–æ –¥–ª—è —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤:

```javascript
import { onMounted, onUnmounted } from 'vue'

// ========================================
// –í—Å—Ç–∞–≤–∫–∞ –∏–∑ –±—É—Ñ–µ—Ä–∞ –æ–±–º–µ–Ω–∞ (Ctrl+V)
//
// clipboardData.items ‚Äî —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –±—É—Ñ–µ—Ä–∞
// getAsFile() ‚Äî –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç —ç–ª–µ–º–µ–Ω—Ç –±—É—Ñ–µ—Ä–∞ –≤ File
//
// –£–¥–æ–±–Ω–æ: —Å–¥–µ–ª–∞–ª —Å–∫—Ä–∏–Ω—à–æ—Ç (Win+Shift+S),
// –∫–ª–∏–∫–Ω—É–ª –Ω–∞ –∑–æ–Ω—É –ø—É–Ω–∫—Ç–∞, –Ω–∞–∂–∞–ª Ctrl+V
// ========================================
function onPaste(e) {
  const items = e.clipboardData?.items
  if (!items) return

  for (const item of items) {
    if (item.type.startsWith('image/')) {
      const file = item.getAsFile()
      if (file) {
        uploadFile(file)
        break
      }
    }
  }
}

onMounted(() => {
  document.addEventListener('paste', onPaste)
})

onUnmounted(() => {
  document.removeEventListener('paste', onPaste)
})
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞

1. –û—Ç–∫—Ä–æ–π –¢–ó —Å –ø—É–Ω–∫—Ç–∞–º–∏
2. –ü–æ–¥ –∫–∞–∂–¥—ã–º –ø—É–Ω–∫—Ç–æ–º –µ—Å—Ç—å –∑–æ–Ω–∞ "–ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å —Å–∫—Ä–∏–Ω—à–æ—Ç"
3. –ù–∞–∂–º–∏ –Ω–∞ –Ω–µ—ë ‚Üí –≤—ã–±–µ—Ä–∏ –∫–∞—Ä—Ç–∏–Ω–∫—É ‚Üí –æ–Ω–∞ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –∫–∞–∫ –º–∏–Ω–∏–∞—Ç—é—Ä–∞
4. –ü–µ—Ä–µ—Ç–∞—â–∏ –∫–∞—Ä—Ç–∏–Ω–∫—É –Ω–∞ –∑–æ–Ω—É ‚Üí –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
5. –°–¥–µ–ª–∞–π —Å–∫—Ä–∏–Ω—à–æ—Ç (Win+Shift+S), –Ω–∞–∂–º–∏ Ctrl+V ‚Üí —Å–∫—Ä–∏–Ω—à–æ—Ç –ø—Ä–∏–∫—Ä–µ–ø–ª—è–µ—Ç—Å—è
6. –ù–∞–≤–µ–¥–∏ –Ω–∞ –º–∏–Ω–∏–∞—Ç—é—Ä—É ‚Üí –ø–æ—è–≤–ª—è–µ—Ç—Å—è –∫—Ä–µ—Å—Ç–∏–∫ ‚Üí —É–¥–∞–ª–∏
7. –ù–∞–∂–º–∏ –Ω–∞ –º–∏–Ω–∏–∞—Ç—é—Ä—É ‚Üí –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø–æ–ª–Ω—ã–π —Ä–∞–∑–º–µ—Ä –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ

---

# –ß–ê–°–¢–¨ 24: –®–ê–†–ò–ù–ì –¢–ó –ò –°–û–í–ú–ï–°–¢–ù–û–ï –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–ï ‚¨ú

## –£—Ä–æ–∫ 24.1: –ú–æ–¥–µ–ª—å ShareLink ‚Äî —Å—Å—ã–ª–∫–∏ –¥–ª—è –æ–±—â–µ–≥–æ –¥–æ—Å—Ç—É–ø–∞

### –ó–∞—á–µ–º

–ú–µ–Ω–µ–¥–∂–µ—Ä —Å–æ–∑–¥–∞—ë—Ç –¢–ó –∏ —Ö–æ—á–µ—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å—Å—ã–ª–∫—É —Ä–µ–¥–∞–∫—Ç–æ—Ä—É (–¥–∏–∑–∞–π–Ω–µ—Ä—É, —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫—É). –†–µ–¥–∞–∫—Ç–æ—Ä –ø–æ —Å—Å—ã–ª–∫–µ –º–æ–∂–µ—Ç:
- –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –¢–ó
- –í–ø–∏—Å–∞—Ç—å —Å–≤–æ—ë –≤—Ä–µ–º—è –≤ –ø—É–Ω–∫—Ç—ã
- –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ –ø—É–Ω–∫—Ç—ã
- –û—Å—Ç–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π

–°–æ–∑–¥–∞—Ç–µ–ª—å –ø–æ—Ç–æ–º –≤–∏–¥–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏ —Å–æ–≥–ª–∞—Å–æ–≤—ã–≤–∞–µ—Ç –∏—Ö.

### –®–∞–≥ 1: –î–æ–±–∞–≤–∏—Ç—å –º–æ–¥–µ–ª–∏ –≤ schema.prisma

```prisma
// ========================================
// –°—Å—ã–ª–∫–∞ –¥–ª—è —à–∞—Ä–∏–Ω–≥–∞ –¢–ó
//
// token ‚Äî —É–Ω–∏–∫–∞–ª—å–Ω—ã–π —Ç–æ–∫–µ–Ω –≤ URL (UUID)
// role ‚Äî —á—Ç–æ –º–æ–∂–µ—Ç –¥–µ–ª–∞—Ç—å –ø–æ–ª—É—á–∞—Ç–µ–ª—å:
//   "viewer" ‚Äî —Ç–æ–ª—å–∫–æ –ø—Ä–æ—Å–º–æ—Ç—Ä
//   "editor" ‚Äî –º–æ–∂–µ—Ç –ø—Ä–µ–¥–ª–∞–≥–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
// ========================================
model ShareLink {
  id              Int           @id @default(autoincrement())
  token           String        @unique
  role            String        @default("viewer")   // viewer | editor
  specificationId Int
  specification   Specification @relation(fields: [specificationId], references: [id], onDelete: Cascade)
  createdById     Int
  createdBy       User          @relation(fields: [createdById], references: [id])
  expiresAt       DateTime?                          // null = –±–µ—Å—Å—Ä–æ—á–Ω–∞—è
  createdAt       DateTime      @default(now())
}

// ========================================
// –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –æ—Ç —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞
//
// –ö–æ–≥–¥–∞ —Ä–µ–¥–∞–∫—Ç–æ—Ä –º–µ–Ω—è–µ—Ç –≤—Ä–µ–º—è –∏–ª–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç –ø—É–Ω–∫—Ç ‚Äî
// —ç—Ç–æ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∫–∞–∫ "–ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ", –∞ –Ω–µ —Å—Ä–∞–∑—É –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è
//
// status:
//   "pending" ‚Äî –∂–¥—ë—Ç —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è
//   "approved" ‚Äî —Å–æ–∑–¥–∞—Ç–µ–ª—å –ø—Ä–∏–Ω—è–ª
//   "rejected" ‚Äî —Å–æ–∑–¥–∞—Ç–µ–ª—å –æ—Ç–∫–ª–æ–Ω–∏–ª
// ========================================
model Suggestion {
  id              Int           @id @default(autoincrement())
  type            String                             // "time_change" | "new_item" | "comment"
  itemId          Int?                               // –∫ –∫–∞–∫–æ–º—É –ø—É–Ω–∫—Ç—É (null –¥–ª—è new_item)
  item            Item?         @relation(fields: [itemId], references: [id], onDelete: Cascade)
  specificationId Int
  specification   Specification @relation(fields: [specificationId], references: [id], onDelete: Cascade)
  data            String        @db.Text             // JSON —Å –¥–∞–Ω–Ω—ã–º–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è
  status          String        @default("pending")  // pending | approved | rejected
  authorName      String                             // –∏–º—è —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞
  createdAt       DateTime      @default(now())
}
```

### –®–∞–≥ 2: –î–æ–±–∞–≤–∏—Ç—å —Å–≤—è–∑–∏ –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –º–æ–¥–µ–ª–∏

–í –º–æ–¥–µ–ª–∏ `Specification` –¥–æ–±–∞–≤—å:

```prisma
model Specification {
  // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è
  shareLinks  ShareLink[]
  suggestions Suggestion[]
}
```

–í –º–æ–¥–µ–ª–∏ `User` –¥–æ–±–∞–≤—å:

```prisma
model User {
  // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è
  shareLinks  ShareLink[]
}
```

–í –º–æ–¥–µ–ª–∏ `Item` –¥–æ–±–∞–≤—å:

```prisma
model Item {
  // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è
  suggestions Suggestion[]
}
```

### –®–∞–≥ 3: –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é

```bash
cd backend
npm install uuid
npx prisma db push
```

---

## –£—Ä–æ–∫ 24.2: Backend —à–∞—Ä–∏–Ω–≥–∞

### –®–∞–≥ 1: –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä —à–∞—Ä–∏–Ω–≥–∞

–°–æ–∑–¥–∞–π `backend/src/controllers/shareController.js`:

```javascript
// ========================================
// –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä —à–∞—Ä–∏–Ω–≥–∞ –¢–ó
//
// –°–æ–∑–¥–∞–Ω–∏–µ —Å—Å—ã–ª–æ–∫, –ø—Ä–æ—Å–º–æ—Ç—Ä –ø–æ —Ç–æ–∫–µ–Ω—É,
// –æ—Ç–ø—Ä–∞–≤–∫–∞ –∏ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π
// ========================================

const prisma = require('../db')
const { v4: uuidv4 } = require('uuid')

// ========================================
// POST /api/share
//
// –°–æ–∑–¥–∞—Ç—å —Å—Å—ã–ª–∫—É –¥–ª—è —à–∞—Ä–∏–Ω–≥–∞
// body: { specificationId, role, expiresInDays }
// ========================================
async function createLink(req, res) {
  try {
    const { specificationId, role, expiresInDays } = req.body

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –¢–ó –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
    const spec = await prisma.specification.findFirst({
      where: { id: specificationId, userId: req.userId }
    })
    if (!spec) {
      return res.status(404).json({ error: '–¢–ó –Ω–µ –Ω–∞–π–¥–µ–Ω–æ' })
    }

    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–π —Ç–æ–∫–µ–Ω
    const token = uuidv4()

    // –î–∞—Ç–∞ –∏—Å—Ç–µ—á–µ–Ω–∏—è (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
    let expiresAt = null
    if (expiresInDays) {
      expiresAt = new Date()
      expiresAt.setDate(expiresAt.getDate() + expiresInDays)
    }

    const link = await prisma.shareLink.create({
      data: {
        token,
        role: role || 'viewer',
        specificationId,
        createdById: req.userId,
        expiresAt
      }
    })

    res.status(201).json({
      ...link,
      url: `${req.protocol}://${req.get('host')}/shared/${token}`
    })
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Å—Å—ã–ª–∫–∏:', error)
    res.status(500).json({ error: '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞' })
  }
}

// ========================================
// GET /api/share/:token
//
// –ü–æ–ª—É—á–∏—Ç—å –¢–ó –ø–æ —Ç–æ–∫–µ–Ω—É (–±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏!)
// –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è —Å—Å—ã–ª–∫–∏
// ========================================
async function getByToken(req, res) {
  try {
    const { token } = req.params

    const link = await prisma.shareLink.findUnique({
      where: { token },
      include: {
        specification: {
          include: {
            sections: {
              orderBy: { position: 'asc' },
              include: {
                items: {
                  orderBy: { position: 'asc' },
                  include: {
                    attachments: true,
                    suggestions: {
                      where: { status: 'pending' }
                    }
                  }
                }
              }
            },
            suggestions: {
              orderBy: { createdAt: 'desc' }
            }
          }
        }
      }
    })

    if (!link) {
      return res.status(404).json({ error: '–°—Å—ã–ª–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞' })
    }

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è
    if (link.expiresAt && new Date() > link.expiresAt) {
      return res.status(410).json({ error: '–°—Å—ã–ª–∫–∞ –∏—Å—Ç–µ–∫–ª–∞' })
    }

    res.json({
      role: link.role,
      specification: link.specification
    })
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞:', error)
    res.status(500).json({ error: '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞' })
  }
}

// ========================================
// POST /api/share/:token/suggest
//
// –†–µ–¥–∞–∫—Ç–æ—Ä –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ
// –ù–µ —Ç—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (–ø–æ —Ç–æ–∫–µ–Ω—É)
//
// body: { type, itemId, data, authorName }
//
// type: "time_change" ‚Äî –∏–∑–º–µ–Ω–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏
//   data: { newTime: 120 }
//
// type: "new_item" ‚Äî –Ω–æ–≤—ã–π –ø—É–Ω–∫—Ç
//   data: { sectionId: 5, content: "...", timeEstimate: 60 }
//
// type: "comment" ‚Äî –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
//   data: { text: "–ù—É–∂–Ω–æ —É—Ç–æ—á–Ω–∏—Ç—å..." }
// ========================================
async function addSuggestion(req, res) {
  try {
    const { token } = req.params
    const { type, itemId, data, authorName } = req.body

    const link = await prisma.shareLink.findUnique({
      where: { token }
    })

    if (!link || link.role !== 'editor') {
      return res.status(403).json({ error: '–ù–µ—Ç –ø—Ä–∞–≤ –Ω–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ' })
    }

    if (link.expiresAt && new Date() > link.expiresAt) {
      return res.status(410).json({ error: '–°—Å—ã–ª–∫–∞ –∏—Å—Ç–µ–∫–ª–∞' })
    }

    const suggestion = await prisma.suggestion.create({
      data: {
        type,
        itemId: itemId || null,
        specificationId: link.specificationId,
        data: JSON.stringify(data),
        authorName: authorName || '–ê–Ω–æ–Ω–∏–º'
      }
    })

    res.status(201).json(suggestion)
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞:', error)
    res.status(500).json({ error: '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞' })
  }
}

// ========================================
// PUT /api/share/suggestions/:id
//
// –°–æ–∑–¥–∞—Ç–µ–ª—å –¢–ó —Å–æ–≥–ª–∞—Å–æ–≤—ã–≤–∞–µ—Ç –∏–ª–∏ –æ—Ç–∫–ª–æ–Ω—è–µ—Ç
// –¢—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏!
//
// body: { status: "approved" | "rejected" }
//
// –ï—Å–ª–∏ approved –∏ type="time_change" ‚Äî –æ–±–Ω–æ–≤–ª—è–µ–º timeEstimate
// –ï—Å–ª–∏ approved –∏ type="new_item" ‚Äî —Å–æ–∑–¥–∞—ë–º –Ω–æ–≤—ã–π Item
// ========================================
async function reviewSuggestion(req, res) {
  try {
    const id = parseInt(req.params.id)
    const { status } = req.body

    if (!['approved', 'rejected'].includes(status)) {
      return res.status(400).json({ error: '–°—Ç–∞—Ç—É—Å: approved –∏–ª–∏ rejected' })
    }

    const suggestion = await prisma.suggestion.findUnique({
      where: { id },
      include: {
        specification: true
      }
    })

    if (!suggestion || suggestion.specification.userId !== req.userId) {
      return res.status(404).json({ error: '–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ' })
    }

    // ========================================
    // –ï—Å–ª–∏ –æ–¥–æ–±—Ä–µ–Ω–æ ‚Äî –ø—Ä–∏–º–µ–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
    // ========================================
    const data = JSON.parse(suggestion.data)

    if (status === 'approved') {
      if (suggestion.type === 'time_change' && suggestion.itemId) {
        await prisma.item.update({
          where: { id: suggestion.itemId },
          data: { timeEstimate: data.newTime }
        })
      }

      if (suggestion.type === 'new_item') {
        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é ‚Äî –≤ –∫–æ–Ω–µ—Ü —Ä–∞–∑–¥–µ–ª–∞
        const lastItem = await prisma.item.findFirst({
          where: { sectionId: data.sectionId },
          orderBy: { position: 'desc' }
        })
        const position = lastItem ? lastItem.position + 1 : 0

        await prisma.item.create({
          data: {
            content: data.content,
            timeEstimate: data.timeEstimate || 0,
            position,
            sectionId: data.sectionId
          }
        })
      }
    }

    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è
    const updated = await prisma.suggestion.update({
      where: { id },
      data: { status }
    })

    res.json(updated)
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞:', error)
    res.status(500).json({ error: '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞' })
  }
}

// ========================================
// GET /api/share/links/:specificationId
//
// –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Å—Å—ã–ª–æ–∫ –¥–ª—è –¢–ó (–¥–ª—è —Å–æ–∑–¥–∞—Ç–µ–ª—è)
// ========================================
async function getLinks(req, res) {
  try {
    const specId = parseInt(req.params.specificationId)

    const links = await prisma.shareLink.findMany({
      where: {
        specificationId: specId,
        createdById: req.userId
      },
      orderBy: { createdAt: 'desc' }
    })

    res.json(links)
  } catch (error) {
    res.status(500).json({ error: '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞' })
  }
}

// ========================================
// DELETE /api/share/links/:id
//
// –£–¥–∞–ª–∏—Ç—å (–æ—Ç–æ–∑–≤–∞—Ç—å) —Å—Å—ã–ª–∫—É
// ========================================
async function deleteLink(req, res) {
  try {
    const id = parseInt(req.params.id)
    const link = await prisma.shareLink.findFirst({
      where: { id, createdById: req.userId }
    })

    if (!link) {
      return res.status(404).json({ error: '–°—Å—ã–ª–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞' })
    }

    await prisma.shareLink.delete({ where: { id } })
    res.json({ message: '–°—Å—ã–ª–∫–∞ —É–¥–∞–ª–µ–Ω–∞' })
  } catch (error) {
    res.status(500).json({ error: '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞' })
  }
}

module.exports = {
  createLink, getByToken, addSuggestion,
  reviewSuggestion, getLinks, deleteLink
}
```

### –®–∞–≥ 2: –†–æ—É—Ç—ã —à–∞—Ä–∏–Ω–≥–∞

–°–æ–∑–¥–∞–π `backend/src/routes/share.js`:

```javascript
const express = require('express')
const { authenticate } = require('../middleware/auth')
const {
  createLink, getByToken, addSuggestion,
  reviewSuggestion, getLinks, deleteLink
} = require('../controllers/shareController')

const router = express.Router()

// –ü—É–±–ª–∏—á–Ω—ã–µ —Ä–æ—É—Ç—ã (–±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ ‚Äî –ø–æ —Ç–æ–∫–µ–Ω—É)
router.get('/:token', getByToken)
router.post('/:token/suggest', addSuggestion)

// –ó–∞—â–∏—â—ë–Ω–Ω—ã–µ —Ä–æ—É—Ç—ã (–¥–ª—è —Å–æ–∑–¥–∞—Ç–µ–ª—è –¢–ó)
router.post('/', authenticate, createLink)
router.get('/links/:specificationId', authenticate, getLinks)
router.delete('/links/:id', authenticate, deleteLink)
router.put('/suggestions/:id', authenticate, reviewSuggestion)

module.exports = router
```

–ü–æ–¥–∫–ª—é—á–∏ –≤ `backend/src/index.js`:

```javascript
const shareRoutes = require('./routes/share')
app.use('/api/share', shareRoutes)
```

---

## –£—Ä–æ–∫ 24.3: Frontend ‚Äî –∫–Ω–æ–ø–∫–∞ "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è"

### –®–∞–≥ 1: –ö–æ–º–ø–æ–Ω–µ–Ω—Ç ShareDialog

–°–æ–∑–¥–∞–π `frontend/src/components/ShareDialog.vue`:

```vue
<script setup>
import { ref } from 'vue'
import api from '../api'

const props = defineProps({
  specificationId: { type: Number, required: true }
})

const emit = defineEmits(['close'])

const role = ref('viewer')
const expiresInDays = ref(0)    // 0 = –±–µ—Å—Å—Ä–æ—á–Ω–æ
const generatedUrl = ref('')
const links = ref([])
const loading = ref(true)
const copied = ref(false)

// ========================================
// –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å—Å—ã–ª–∫–∏
// ========================================
async function loadLinks() {
  try {
    const response = await api.get(`/share/links/${props.specificationId}`)
    links.value = response.data
  } catch (e) {
    console.error(e)
  } finally {
    loading.value = false
  }
}
loadLinks()

// ========================================
// –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Å—Å—ã–ª–∫—É
// ========================================
async function createLink() {
  try {
    const response = await api.post('/share', {
      specificationId: props.specificationId,
      role: role.value,
      expiresInDays: expiresInDays.value || null
    })

    // –§–æ—Ä–º–∏—Ä—É–µ–º URL –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
    const frontUrl = `${window.location.origin}/shared/${response.data.token}`
    generatedUrl.value = frontUrl

    await loadLinks()
  } catch (e) {
    alert('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Å—Å—ã–ª–∫–∏')
  }
}

// ========================================
// –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞
// ========================================
async function copyUrl() {
  await navigator.clipboard.writeText(generatedUrl.value)
  copied.value = true
  setTimeout(() => { copied.value = false }, 2000)
}

// ========================================
// –£–¥–∞–ª–∏—Ç—å —Å—Å—ã–ª–∫—É
// ========================================
async function deleteLink(id) {
  if (!confirm('–û—Ç–æ–∑–≤–∞—Ç—å —ç—Ç—É —Å—Å—ã–ª–∫—É?')) return
  await api.delete(`/share/links/${id}`)
  await loadLinks()
}

function roleLabel(r) {
  return r === 'editor' ? '–†–µ–¥–∞–∫—Ç–æ—Ä' : '–ü—Ä–æ—Å–º–æ—Ç—Ä'
}
</script>

<template>
  <div class="fixed inset-0 bg-black/50 flex items-center justify-center z-50">
    <div class="bg-white rounded-lg p-6 w-full max-w-lg max-h-[90vh] overflow-y-auto">
      <h2 class="text-xl font-bold mb-4">–ü–æ–¥–µ–ª–∏—Ç—å—Å—è –¢–ó</h2>

      <!-- –§–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Å—Å—ã–ª–∫–∏ -->
      <div class="space-y-3 mb-6">
        <div>
          <label class="block text-sm font-medium mb-1">–†–æ–ª—å –ø–æ–ª—É—á–∞—Ç–µ–ª—è</label>
          <select v-model="role" class="w-full border rounded px-3 py-2 text-sm">
            <option value="viewer">–¢–æ–ª—å–∫–æ –ø—Ä–æ—Å–º–æ—Ç—Ä</option>
            <option value="editor">–†–µ–¥–∞–∫—Ç–æ—Ä (–º–æ–∂–µ—Ç –ø—Ä–µ–¥–ª–∞–≥–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è)</option>
          </select>
        </div>

        <div>
          <label class="block text-sm font-medium mb-1">–°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è</label>
          <select v-model="expiresInDays" class="w-full border rounded px-3 py-2 text-sm">
            <option :value="0">–ë–µ—Å—Å—Ä–æ—á–Ω–æ</option>
            <option :value="1">1 –¥–µ–Ω—å</option>
            <option :value="7">7 –¥–Ω–µ–π</option>
            <option :value="30">30 –¥–Ω–µ–π</option>
          </select>
        </div>

        <button @click="createLink"
                class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 w-full">
          –°–æ–∑–¥–∞—Ç—å —Å—Å—ã–ª–∫—É
        </button>
      </div>

      <!-- –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Å—ã–ª–∫–∞ -->
      <div v-if="generatedUrl" class="bg-green-50 border border-green-200 rounded p-4 mb-6">
        <p class="text-sm text-green-800 mb-2">–°—Å—ã–ª–∫–∞ —Å–æ–∑–¥–∞–Ω–∞:</p>
        <div class="flex gap-2">
          <input :value="generatedUrl" readonly
                 class="flex-1 border rounded px-3 py-2 text-sm bg-white" />
          <button @click="copyUrl"
                  class="bg-green-500 text-white px-3 py-2 rounded text-sm hover:bg-green-600 shrink-0">
            {{ copied ? '–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!' : '–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å' }}
          </button>
        </div>
      </div>

      <!-- –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å—Å—ã–ª–∫–∏ -->
      <div v-if="links.length > 0">
        <h3 class="font-semibold text-sm mb-2">–ê–∫—Ç–∏–≤–Ω—ã–µ —Å—Å—ã–ª–∫–∏</h3>
        <div v-for="link in links" :key="link.id"
             class="flex items-center justify-between py-2 border-b last:border-0">
          <div>
            <span class="text-sm">{{ roleLabel(link.role) }}</span>
            <span v-if="link.expiresAt" class="text-xs text-gray-400 ml-2">
              –¥–æ {{ new Date(link.expiresAt).toLocaleDateString('ru') }}
            </span>
          </div>
          <button @click="deleteLink(link.id)"
                  class="text-red-500 text-sm hover:text-red-700">
            –û—Ç–æ–∑–≤–∞—Ç—å
          </button>
        </div>
      </div>

      <button @click="$emit('close')"
              class="mt-4 bg-gray-200 px-4 py-2 rounded hover:bg-gray-300 w-full">
        –ó–∞–∫—Ä—ã—Ç—å
      </button>
    </div>
  </div>
</template>
```

### –®–∞–≥ 2: –ö–Ω–æ–ø–∫–∞ "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è" –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –¢–ó

–í `SpecificationPage.vue` –¥–æ–±–∞–≤—å:

```javascript
import ShareDialog from '../components/ShareDialog.vue'

const showShareDialog = ref(false)
```

```html
<button @click="showShareDialog = true"
        class="bg-indigo-500 text-white px-4 py-2 rounded hover:bg-indigo-600 text-sm">
  –ü–æ–¥–µ–ª–∏—Ç—å—Å—è
</button>

<ShareDialog v-if="showShareDialog"
             :specification-id="specification.id"
             @close="showShareDialog = false" />
```

---

## –£—Ä–æ–∫ 24.4: –°—Ç—Ä–∞–Ω–∏—Ü–∞ SharedSpecificationPage

### –ó–∞—á–µ–º

–ö–æ–≥–¥–∞ –ø–æ–ª—É—á–∞—Ç–µ–ª—å –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –ø–æ —Å—Å—ã–ª–∫–µ `/shared/:token`, –æ–Ω –≤–∏–¥–∏—Ç –¢–ó. –ï—Å–ª–∏ –µ–≥–æ —Ä–æ–ª—å ‚Äî editor, –æ–Ω –º–æ–∂–µ—Ç –ø—Ä–µ–¥–ª–∞–≥–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è.

### –®–∞–≥ 1: –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É

–°–æ–∑–¥–∞–π `frontend/src/pages/SharedSpecificationPage.vue`:

```vue
<script setup>
import { ref, onMounted, computed } from 'vue'
import { useRoute } from 'vue-router'
import api from '../api'

const route = useRoute()
const token = route.params.token

const specification = ref(null)
const role = ref('viewer')
const loading = ref(true)
const error = ref('')
const authorName = ref('')

// ========================================
// –§–æ—Ä–º–∞ –Ω–æ–≤–æ–≥–æ –ø—É–Ω–∫—Ç–∞
// ========================================
const showAddItem = ref(false)
const addItemSectionId = ref(null)
const newItemContent = ref('')
const newItemTime = ref(0)

// ========================================
// –ó–∞–≥—Ä—É–∑–∫–∞ –¢–ó –ø–æ —Ç–æ–∫–µ–Ω—É (–±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏)
// ========================================
onMounted(async () => {
  try {
    // –ó–∞–ø—Ä–æ—Å –Ω–∞ /api/share/:token ‚Äî –ø—É–±–ª–∏—á–Ω—ã–π
    const response = await api.get(`/share/${token}`)
    specification.value = response.data.specification
    role.value = response.data.role
  } catch (e) {
    if (e.response?.status === 410) {
      error.value = '–°—Å—ã–ª–∫–∞ –∏—Å—Ç–µ–∫–ª–∞'
    } else {
      error.value = '–¢–ó –Ω–µ –Ω–∞–π–¥–µ–Ω–æ'
    }
  } finally {
    loading.value = false
  }
})

const isEditor = computed(() => role.value === 'editor')

// ========================================
// –û–±—â–µ–µ –≤—Ä–µ–º—è
// ========================================
const totalTime = computed(() => {
  if (!specification.value) return 0
  let total = 0
  specification.value.sections.forEach(s => {
    s.items.forEach(i => {
      total += i.timeEstimate || 0
    })
  })
  return total
})

function formatTime(minutes) {
  const h = Math.floor(minutes / 60)
  const m = minutes % 60
  return h > 0 ? `${h} —á ${m} –º–∏–Ω` : `${minutes} –º–∏–Ω`
}

// ========================================
// –ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏
// ========================================
async function suggestTimeChange(item) {
  const newTime = prompt(`–¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è: ${item.timeEstimate} –º–∏–Ω. –í–∞—à–∞ –æ—Ü–µ–Ω–∫–∞ (–º–∏–Ω):`)
  if (!newTime || isNaN(newTime)) return

  if (!authorName.value) {
    authorName.value = prompt('–í–∞—à–µ –∏–º—è:') || '–ê–Ω–æ–Ω–∏–º'
  }

  try {
    await api.post(`/share/${token}/suggest`, {
      type: 'time_change',
      itemId: item.id,
      data: { newTime: parseInt(newTime), oldTime: item.timeEstimate },
      authorName: authorName.value
    })
    alert('–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!')
  } catch (e) {
    alert('–û—à–∏–±–∫–∞: ' + (e.response?.data?.error || e.message))
  }
}

// ========================================
// –ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å –Ω–æ–≤—ã–π –ø—É–Ω–∫—Ç
// ========================================
function openAddItem(sectionId) {
  addItemSectionId.value = sectionId
  newItemContent.value = ''
  newItemTime.value = 60
  showAddItem.value = true
}

async function submitNewItem() {
  if (!newItemContent.value.trim()) return

  if (!authorName.value) {
    authorName.value = prompt('–í–∞—à–µ –∏–º—è:') || '–ê–Ω–æ–Ω–∏–º'
  }

  try {
    await api.post(`/share/${token}/suggest`, {
      type: 'new_item',
      data: {
        sectionId: addItemSectionId.value,
        content: newItemContent.value.trim(),
        timeEstimate: parseInt(newItemTime.value) || 0
      },
      authorName: authorName.value
    })
    showAddItem.value = false
    alert('–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ! –°–æ–∑–¥–∞—Ç–µ–ª—å –¢–ó —Ä–∞—Å—Å–º–æ—Ç—Ä–∏—Ç –µ–≥–æ.')
  } catch (e) {
    alert('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏')
  }
}
</script>

<template>
  <div class="min-h-screen bg-gray-50 p-4 sm:p-8">
    <div class="max-w-4xl mx-auto">

      <!-- –ó–∞–≥—Ä—É–∑–∫–∞ / –æ—à–∏–±–∫–∞ -->
      <div v-if="loading" class="text-center py-12 text-gray-500">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
      <div v-else-if="error" class="text-center py-12">
        <p class="text-red-500 text-lg">{{ error }}</p>
      </div>

      <!-- –¢–ó -->
      <div v-else-if="specification">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
        <div class="bg-white rounded-lg shadow p-6 mb-6">
          <div class="flex justify-between items-start">
            <h1 class="text-2xl font-bold">{{ specification.title }}</h1>
            <span :class="[
              'text-xs px-2 py-1 rounded-full',
              isEditor ? 'bg-blue-100 text-blue-700' : 'bg-gray-100 text-gray-600'
            ]">
              {{ isEditor ? '–†–µ–¥–∞–∫—Ç–æ—Ä' : '–ü—Ä–æ—Å–º–æ—Ç—Ä' }}
            </span>
          </div>
          <p class="text-gray-400 text-sm mt-2">
            –û–±—â–µ–µ –≤—Ä–µ–º—è: {{ formatTime(totalTime) }}
          </p>
        </div>

        <!-- –†–∞–∑–¥–µ–ª—ã -->
        <div v-for="(section, si) in specification.sections" :key="section.id"
             class="bg-white rounded-lg shadow p-6 mb-4">
          <h2 class="text-lg font-semibold mb-4">
            {{ si + 1 }}. {{ section.title }}
          </h2>

          <div v-for="(item, ii) in section.items" :key="item.id"
               class="flex items-start gap-3 py-3 border-b last:border-0">
            <span class="text-gray-400 text-sm shrink-0 mt-0.5">
              {{ si + 1 }}.{{ ii + 1 }}
            </span>
            <div class="flex-1">
              <p>{{ item.content }}</p>

              <!-- –°–∫—Ä–∏–Ω—à–æ—Ç—ã -->
              <div v-if="item.attachments?.length" class="flex flex-wrap gap-2 mt-2">
                <img v-for="att in item.attachments" :key="att.id"
                     v-show="att.mimetype?.startsWith('image/')"
                     :src="`${$api?.defaults?.baseURL || 'http://localhost:3000'}${att.path}`"
                     class="w-20 h-20 object-cover rounded border" />
              </div>

              <!-- –ü–æ–º–µ—Ç–∫–∏ –æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è—Ö -->
              <div v-if="item.suggestions?.length" class="mt-1">
                <span class="text-xs text-orange-500">
                  {{ item.suggestions.length }} –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π –æ–∂–∏–¥–∞–µ—Ç
                </span>
              </div>
            </div>
            <div class="text-right shrink-0">
              <span class="text-blue-500 text-sm font-medium">
                {{ item.timeEstimate }} –º–∏–Ω
              </span>
              <!-- –ö–Ω–æ–ø–∫–∞ –∏–∑–º–µ–Ω–∏—Ç—å –≤—Ä–µ–º—è (—Ç–æ–ª—å–∫–æ editor) -->
              <button v-if="isEditor" @click="suggestTimeChange(item)"
                      class="block text-xs text-gray-400 hover:text-blue-500 mt-1">
                –ò–∑–º–µ–Ω–∏—Ç—å
              </button>
            </div>
          </div>

          <!-- –ö–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–∏—Ç—å –ø—É–Ω–∫—Ç (—Ç–æ–ª—å–∫–æ editor) -->
          <button v-if="isEditor" @click="openAddItem(section.id)"
                  class="mt-3 text-sm text-blue-500 hover:text-blue-700">
            + –ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å –ø—É–Ω–∫—Ç
          </button>
        </div>
      </div>

      <!-- –ú–æ–¥–∞–ª–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø—É–Ω–∫—Ç–∞ -->
      <div v-if="showAddItem" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-6 w-full max-w-md">
          <h3 class="text-lg font-bold mb-4">–ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å –Ω–æ–≤—ã–π –ø—É–Ω–∫—Ç</h3>
          <div class="space-y-3">
            <div>
              <label class="block text-sm font-medium mb-1">–û–ø–∏—Å–∞–Ω–∏–µ</label>
              <textarea v-model="newItemContent" rows="3"
                        class="w-full border rounded px-3 py-2 text-sm"
                        placeholder="–ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å..."></textarea>
            </div>
            <div>
              <label class="block text-sm font-medium mb-1">–û—Ü–µ–Ω–∫–∞ (–º–∏–Ω)</label>
              <input v-model="newItemTime" type="number" min="0"
                     class="w-full border rounded px-3 py-2 text-sm" />
            </div>
          </div>
          <div class="flex gap-3 mt-4">
            <button @click="submitNewItem"
                    class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
              –û—Ç–ø—Ä–∞–≤–∏—Ç—å
            </button>
            <button @click="showAddItem = false"
                    class="bg-gray-200 px-4 py-2 rounded hover:bg-gray-300">
              –û—Ç–º–µ–Ω–∞
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>
```

### –®–∞–≥ 2: –†–æ—É—Ç –¥–ª—è shared-—Å—Ç—Ä–∞–Ω–∏—Ü—ã

–í `frontend/src/router/index.js` –¥–æ–±–∞–≤—å —Ä–æ—É—Ç –í–ù–ï `children` (–±–µ–∑ AppLayout):

```javascript
{
  path: '/shared/:token',
  component: () => import('../pages/SharedSpecificationPage.vue')
}
```

---

## –£—Ä–æ–∫ 24.5: –°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π

### –ó–∞—á–µ–º

–°–æ–∑–¥–∞—Ç–µ–ª—å –¢–ó –≤–∏–¥–∏—Ç –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –æ—Ç —Ä–µ–¥–∞–∫—Ç–æ—Ä–æ–≤ –∏ –º–æ–∂–µ—Ç –æ–¥–æ–±—Ä–∏—Ç—å –∏–ª–∏ –æ—Ç–∫–ª–æ–Ω–∏—Ç—å –∫–∞–∂–¥–æ–µ.

### –®–∞–≥ 1: –ö–æ–º–ø–æ–Ω–µ–Ω—Ç SuggestionsPanel

–°–æ–∑–¥–∞–π `frontend/src/components/SuggestionsPanel.vue`:

```vue
<script setup>
import { ref, onMounted } from 'vue'
import api from '../api'

const props = defineProps({
  specificationId: { type: Number, required: true }
})

const emit = defineEmits(['updated'])

const suggestions = ref([])
const loading = ref(true)

onMounted(async () => {
  await loadSuggestions()
})

async function loadSuggestions() {
  try {
    const response = await api.get(`/specifications/${props.specificationId}`)
    // –°–æ–±–∏—Ä–∞–µ–º –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –∏–∑ –≤—Å–µ—Ö –ø—É–Ω–∫—Ç–æ–≤
    suggestions.value = response.data.suggestions || []
  } catch (e) {
    console.error(e)
  } finally {
    loading.value = false
  }
}

// ========================================
// –û–¥–æ–±—Ä–∏—Ç—å –∏–ª–∏ –æ—Ç–∫–ª–æ–Ω–∏—Ç—å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ
// ========================================
async function review(id, status) {
  try {
    await api.put(`/share/suggestions/${id}`, { status })
    await loadSuggestions()
    emit('updated')
  } catch (e) {
    alert('–û—à–∏–±–∫–∞')
  }
}

function parseData(dataStr) {
  try {
    return JSON.parse(dataStr)
  } catch {
    return {}
  }
}

function typeLabel(type) {
  const labels = {
    time_change: '–ò–∑–º–µ–Ω–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏',
    new_item: '–ù–æ–≤—ã–π –ø—É–Ω–∫—Ç',
    comment: '–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π'
  }
  return labels[type] || type
}

function statusLabel(status) {
  const labels = {
    pending: '–û–∂–∏–¥–∞–µ—Ç',
    approved: '–û–¥–æ–±—Ä–µ–Ω–æ',
    rejected: '–û—Ç–∫–ª–æ–Ω–µ–Ω–æ'
  }
  return labels[status] || status
}

function statusColor(status) {
  const colors = {
    pending: 'bg-yellow-100 text-yellow-700',
    approved: 'bg-green-100 text-green-700',
    rejected: 'bg-red-100 text-red-700'
  }
  return colors[status] || ''
}
</script>

<template>
  <div class="bg-white rounded-lg shadow p-6">
    <h2 class="text-lg font-semibold mb-4">
      –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –æ—Ç —Ä–µ–¥–∞–∫—Ç–æ—Ä–æ–≤
      <span v-if="suggestions.filter(s => s.status === 'pending').length"
            class="bg-yellow-100 text-yellow-700 text-xs px-2 py-1 rounded-full ml-2">
        {{ suggestions.filter(s => s.status === 'pending').length }} –Ω–æ–≤—ã—Ö
      </span>
    </h2>

    <div v-if="loading" class="text-gray-400 text-sm">–ó–∞–≥—Ä—É–∑–∫–∞...</div>

    <div v-else-if="suggestions.length === 0" class="text-gray-400 text-sm">
      –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π –ø–æ–∫–∞ –Ω–µ—Ç
    </div>

    <div v-else class="space-y-3">
      <div v-for="s in suggestions" :key="s.id"
           class="border rounded p-4">
        <div class="flex items-center justify-between mb-2">
          <div class="flex items-center gap-2">
            <span class="text-sm font-medium">{{ s.authorName }}</span>
            <span class="text-xs text-gray-400">
              {{ new Date(s.createdAt).toLocaleDateString('ru') }}
            </span>
          </div>
          <span :class="['text-xs px-2 py-1 rounded-full', statusColor(s.status)]">
            {{ statusLabel(s.status) }}
          </span>
        </div>

        <p class="text-sm text-gray-600 mb-1">{{ typeLabel(s.type) }}</p>

        <!-- –î–µ—Ç–∞–ª–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è -->
        <div class="text-sm">
          <template v-if="s.type === 'time_change'">
            <p>
              –ë—ã–ª–æ: <strong>{{ parseData(s.data).oldTime }} –º–∏–Ω</strong> ‚Üí
              –ü—Ä–µ–¥–ª–∞–≥–∞–µ—Ç: <strong class="text-blue-600">{{ parseData(s.data).newTime }} –º–∏–Ω</strong>
            </p>
          </template>
          <template v-else-if="s.type === 'new_item'">
            <p class="bg-gray-50 p-2 rounded">{{ parseData(s.data).content }}</p>
            <p class="text-gray-400 mt-1">
              –í—Ä–µ–º—è: {{ parseData(s.data).timeEstimate }} –º–∏–Ω
            </p>
          </template>
          <template v-else-if="s.type === 'comment'">
            <p class="italic">{{ parseData(s.data).text }}</p>
          </template>
        </div>

        <!-- –ö–Ω–æ–ø–∫–∏ –æ–¥–æ–±—Ä–∏—Ç—å/–æ—Ç–∫–ª–æ–Ω–∏—Ç—å (—Ç–æ–ª—å–∫–æ –¥–ª—è pending) -->
        <div v-if="s.status === 'pending'" class="flex gap-2 mt-3">
          <button @click="review(s.id, 'approved')"
                  class="bg-green-500 text-white px-3 py-1 rounded text-sm hover:bg-green-600">
            –û–¥–æ–±—Ä–∏—Ç—å
          </button>
          <button @click="review(s.id, 'rejected')"
                  class="bg-red-500 text-white px-3 py-1 rounded text-sm hover:bg-red-600">
            –û—Ç–∫–ª–æ–Ω–∏—Ç—å
          </button>
        </div>
      </div>
    </div>
  </div>
</template>
```

### –®–∞–≥ 2: –î–æ–±–∞–≤–∏—Ç—å –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –¢–ó

–í `SpecificationPage.vue`:

```javascript
import SuggestionsPanel from '../components/SuggestionsPanel.vue'
```

```html
<!-- –ü–æ—Å–ª–µ —Ä–∞–∑–¥–µ–ª–æ–≤ –¢–ó -->
<SuggestionsPanel
  :specification-id="specification.id"
  @updated="loadSpecification" />
```

### –®–∞–≥ 3: –î–æ–±–∞–≤–∏—Ç—å suggestions –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–π

–í `specificationController.js` –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `getById` –¥–æ–±–∞–≤—å –≤–∫–ª—é—á–µ–Ω–∏–µ suggestions:

```javascript
const spec = await prisma.specification.findFirst({
  where: { id, userId: req.userId },
  include: {
    sections: {
      orderBy: { position: 'asc' },
      include: {
        items: {
          orderBy: { position: 'asc' },
          include: { attachments: true }
        }
      }
    },
    suggestions: {                    // ‚Üê –¥–æ–±–∞–≤–ª—è–µ–º
      orderBy: { createdAt: 'desc' }
    }
  }
})
```

### –®–∞–≥ 4: –≠–∫—Å–ø–æ—Ä—Ç –ø–æ—Å–ª–µ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è

–¢–µ–ø–µ—Ä—å –ø–æ–ª–Ω—ã–π —Ñ–ª–æ—É:
1. –ú–µ–Ω–µ–¥–∂–µ—Ä —Å–æ–∑–¥–∞—ë—Ç –¢–ó –∏ –Ω–∞–∂–∏–º–∞–µ—Ç "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è" ‚Üí –ø–æ–ª—É—á–∞–µ—Ç —Å—Å—ã–ª–∫—É —Å —Ä–æ–ª—å—é "–†–µ–¥–∞–∫—Ç–æ—Ä"
2. –†–µ–¥–∞–∫—Ç–æ—Ä –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Å—Å—ã–ª–∫—É ‚Üí –≤–∏–¥–∏—Ç –¢–ó ‚Üí –º–µ–Ω—è–µ—Ç –≤—Ä–µ–º—è, –¥–æ–±–∞–≤–ª—è–µ—Ç –ø—É–Ω–∫—Ç—ã
3. –ú–µ–Ω–µ–¥–∂–µ—Ä –≤–∏–¥–∏—Ç –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è ‚Üí –æ–¥–æ–±—Ä—è–µ—Ç –∏–ª–∏ –æ—Ç–∫–ª–æ–Ω—è–µ—Ç
4. –ü–æ—Å–ª–µ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è ‚Üí –≤—ã–±–∏—Ä–∞–µ—Ç —Ñ–æ—Ä–º–∞—Ç (PDF/DOC) –∏ —Å–∫–∞—á–∏–≤–∞–µ—Ç –∏—Ç–æ–≥–æ–≤—ã–π –¥–æ–∫—É–º–µ–Ω—Ç

### –ü—Ä–æ–≤–µ—Ä–∫–∞

1. –°–æ–∑–¥–∞–π –¢–ó —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Ä–∞–∑–¥–µ–ª–∞–º–∏ –∏ –ø—É–Ω–∫—Ç–∞–º–∏
2. –ù–∞–∂–º–∏ "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è" ‚Üí —Å–æ–∑–¥–∞–π —Å—Å—ã–ª–∫—É —Å —Ä–æ–ª—å—é "–†–µ–¥–∞–∫—Ç–æ—Ä"
3. –û—Ç–∫—Ä–æ–π —Å—Å—ã–ª–∫—É –≤ –¥—Ä—É–≥–æ–º –±—Ä–∞—É–∑–µ—Ä–µ (–∏–ª–∏ –≤ –ø—Ä–∏–≤–∞—Ç–Ω–æ–º —Ä–µ–∂–∏–º–µ)
4. –ù–∞–∂–º–∏ "–ò–∑–º–µ–Ω–∏—Ç—å" —É –≤—Ä–µ–º–µ–Ω–∏ ‚Üí –≤–≤–µ–¥–∏ –Ω–æ–≤–æ–µ –≤—Ä–µ–º—è ‚Üí "–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!"
5. –ù–∞–∂–º–∏ "–ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å –ø—É–Ω–∫—Ç" ‚Üí –∑–∞–ø–æ–ª–Ω–∏ ‚Üí –æ—Ç–ø—Ä–∞–≤—å
6. –í–µ—Ä–Ω–∏—Å—å –≤ –æ—Å–Ω–æ–≤–Ω–æ–π –±—Ä–∞—É–∑–µ—Ä ‚Üí –æ–±–Ω–æ–≤–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—É –¢–ó ‚Üí –≤–∏–¥–∏—à—å –ø–∞–Ω–µ–ª—å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π
7. –û–¥–æ–±—Ä–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ ‚Üí –≤—Ä–µ–º—è –ø—É–Ω–∫—Ç–∞ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å
8. –û–¥–æ–±—Ä–∏ –Ω–æ–≤—ã–π –ø—É–Ω–∫—Ç ‚Üí –æ–Ω –ø–æ—è–≤–∏–ª—Å—è –≤ —Ä–∞–∑–¥–µ–ª–µ
9. –°–∫–∞—á–∞–π –≤ PDF/DOC ‚Äî –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞ –º–µ—Å—Ç–µ

---

# –ß–ê–°–¢–¨ 25: –ò–ú–ü–û–†–¢ –ê–£–î–ò–û–§–ê–ô–õ–û–í –î–õ–Ø –†–ê–°–®–ò–§–†–û–í–ö–ò ‚¨ú

## –£—Ä–æ–∫ 25.1: Backend ‚Äî —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–≥–æ –∞—É–¥–∏–æ

### –ó–∞—á–µ–º

–°–µ–π—á–∞—Å –º–æ–∂–Ω–æ –∑–∞–ø–∏—Å–∞—Ç—å –≥–æ–ª–æ—Å —á–µ—Ä–µ–∑ –º–∏–∫—Ä–æ—Ñ–æ–Ω. –ù–æ –±—ã–≤–∞–µ—Ç —á—Ç–æ –∑–∞–ø–∏—Å—å —É–∂–µ –µ—Å—Ç—å ‚Äî –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏–∑ Telegram, –∑–∞–ø–∏—Å—å —Å–æ–≤–µ—â–∞–Ω–∏—è, –∞—É–¥–∏–æ–∑–∞–º–µ—Ç–∫–∞. –î–æ–±–∞–≤–∏–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∞—É–¥–∏–æ—Ñ–∞–π–ª –∏ –ø–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—Å—Ç.

### –®–∞–≥ 1: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
cd backend
npm install fluent-ffmpeg
```

–¢–∞–∫–∂–µ –Ω—É–∂–µ–Ω **FFmpeg** ‚Äî –∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä –∞—É–¥–∏–æ/–≤–∏–¥–µ–æ:

**Windows:**
1. –°–∫–∞—á–∞–π —Å https://ffmpeg.org/download.html (build –æ—Ç gyan.dev)
2. –†–∞—Å–ø–∞–∫—É–π –≤ `C:\ffmpeg`
3. –î–æ–±–∞–≤—å `C:\ffmpeg\bin` –≤ —Å–∏—Å—Ç–µ–º–Ω—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é PATH
4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏ —Ç–µ—Ä–º–∏–Ω–∞–ª
5. –ü—Ä–æ–≤–µ—Ä—å: `ffmpeg -version`

### –®–∞–≥ 2: Middleware –¥–ª—è –∞—É–¥–∏–æ—Ñ–∞–π–ª–æ–≤

–°–æ–∑–¥–∞–π `backend/src/middleware/audioUpload.js`:

```javascript
const multer = require('multer')
const path = require('path')
const fs = require('fs')

// ========================================
// –ü–∞–ø–∫–∞ –¥–ª—è –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –∞—É–¥–∏–æ
// ========================================
const audioDir = path.join(__dirname, '../../uploads/audio')
if (!fs.existsSync(audioDir)) {
  fs.mkdirSync(audioDir, { recursive: true })
}

const storage = multer.diskStorage({
  destination: (req, file, cb) => cb(null, audioDir),
  filename: (req, file, cb) => {
    const name = `${Date.now()}-${Math.round(Math.random() * 1000)}${path.extname(file.originalname)}`
    cb(null, name)
  }
})

// ========================================
// –†–∞–∑—Ä–µ—à—ë–Ω–Ω—ã–µ MIME-—Ç–∏–ø—ã –∞—É–¥–∏–æ
//
// audio/mpeg ‚Äî MP3
// audio/wav ‚Äî WAV
// audio/ogg ‚Äî OGG (Telegram –≥–æ–ª–æ—Å–æ–≤—ã–µ)
// audio/webm ‚Äî WebM (–∑–∞–ø–∏—Å—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ)
// audio/mp4 ‚Äî M4A (iPhone –∑–∞–ø–∏—Å–∏)
// audio/x-m4a ‚Äî M4A –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π MIME
// ========================================
const fileFilter = (req, file, cb) => {
  const allowed = [
    'audio/mpeg', 'audio/wav', 'audio/ogg',
    'audio/webm', 'audio/mp4', 'audio/x-m4a',
    'audio/flac', 'audio/aac'
  ]
  if (allowed.includes(file.mimetype)) {
    cb(null, true)
  } else {
    cb(new Error(`–ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç: ${file.mimetype}`), false)
  }
}

const audioUpload = multer({
  storage,
  fileFilter,
  limits: {
    fileSize: 50 * 1024 * 1024  // 50 –ú–ë –º–∞–∫—Å–∏–º—É–º
  }
})

module.exports = audioUpload
```

### –®–∞–≥ 3: –°–µ—Ä–≤–∏—Å —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∏ –∞—É–¥–∏–æ—Ñ–∞–π–ª–æ–≤

–°–æ–∑–¥–∞–π `backend/src/services/audioTranscriptionService.js`:

```javascript
// ========================================
// –°–µ—Ä–≤–∏—Å —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∏ –∞—É–¥–∏–æ—Ñ–∞–π–ª–æ–≤
//
// –ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã:
// 1. –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –∞—É–¥–∏–æ –≤ WAV (16kHz, mono) —á–µ—Ä–µ–∑ FFmpeg
// 2. –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ Whisper (–ª–æ–∫–∞–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å —á–µ—Ä–µ–∑ Ollama)
//    –∏–ª–∏ –≤ Google Speech API
//
// Whisper ‚Äî –º–æ–¥–µ–ª—å OpenAI –¥–ª—è —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è —Ä–µ—á–∏
// –†–∞–±–æ—Ç–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ —á–µ—Ä–µ–∑ Ollama, –±–µ—Å–ø–ª–∞—Ç–Ω–æ
// ========================================

const ffmpeg = require('fluent-ffmpeg')
const fs = require('fs')
const path = require('path')

/**
 * –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –∞—É–¥–∏–æ –≤ WAV —Ñ–æ—Ä–º–∞—Ç
 *
 * Whisper –ª—É—á—à–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å WAV 16kHz mono
 * FFmpeg –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –ª—é–±–æ–π —Ñ–æ—Ä–º–∞—Ç
 *
 * @param {string} inputPath ‚Äî –ø—É—Ç—å –∫ –∏—Å—Ö–æ–¥–Ω–æ–º—É —Ñ–∞–π–ª—É
 * @returns {string} ‚Äî –ø—É—Ç—å –∫ WAV —Ñ–∞–π–ª—É
 */
function convertToWav(inputPath) {
  return new Promise((resolve, reject) => {
    const outputPath = inputPath.replace(path.extname(inputPath), '.wav')

    ffmpeg(inputPath)
      .audioFrequency(16000)     // 16 –∫–ì—Ü ‚Äî —Å—Ç–∞–Ω–¥–∞—Ä—Ç –¥–ª—è speech recognition
      .audioChannels(1)          // mono ‚Äî –æ–¥–∏–Ω –∫–∞–Ω–∞–ª
      .audioCodec('pcm_s16le')   // 16-bit PCM ‚Äî –±–µ–∑ —Å–∂–∞—Ç–∏—è
      .output(outputPath)
      .on('end', () => resolve(outputPath))
      .on('error', reject)
      .run()
  })
}

/**
 * –†–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞ –∞—É–¥–∏–æ —á–µ—Ä–µ–∑ Whisper (Ollama)
 *
 * Ollama –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –º–æ–¥–µ–ª—å whisper –¥–ª—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏
 * –ï—Å–ª–∏ Whisper –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω ‚Äî —Ñ–æ–ª–±—ç–∫ –Ω–∞ Web Speech API
 *
 * @param {string} filePath ‚Äî –ø—É—Ç—å –∫ –∞—É–¥–∏–æ—Ñ–∞–π–ª—É
 * @returns {string} ‚Äî —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç
 */
async function transcribeAudio(filePath) {
  const wavPath = await convertToWav(filePath)

  try {
    // ========================================
    // –í–∞—Ä–∏–∞–Ω—Ç 1: Whisper —á–µ—Ä–µ–∑ Ollama
    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∞—É–¥–∏–æ –∫–∞–∫ base64
    // ========================================
    const audioBuffer = fs.readFileSync(wavPath)
    const base64Audio = audioBuffer.toString('base64')

    const OLLAMA_URL = process.env.OLLAMA_URL || 'http://localhost:11434'

    const response = await fetch(`${OLLAMA_URL}/api/generate`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        model: 'whisper',
        prompt: base64Audio,
        stream: false
      })
    })

    if (response.ok) {
      const data = await response.json()
      return data.response || ''
    }

    // ========================================
    // –í–∞—Ä–∏–∞–Ω—Ç 2: –§–æ–ª–±—ç–∫ ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –æ—à–∏–±–∫—É
    // –ù–∞ —Ñ—Ä–æ–Ω—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å
    // —Ç–µ–∫—Å—Ç –∏–∑ –¥—Ä—É–≥–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
    // ========================================
    throw new Error('Whisper –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω')

  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏:', error.message)
    throw new Error(
      '–ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∞—Ç—å –∞—É–¥–∏–æ. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ Whisper —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: ollama pull whisper'
    )
  } finally {
    // –£–¥–∞–ª—è–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π WAV
    if (fs.existsSync(wavPath) && wavPath !== filePath) {
      fs.unlinkSync(wavPath)
    }
  }
}

/**
 * –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∞—É–¥–∏–æ
 *
 * @param {string} filePath ‚Äî –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É
 * @returns {number} ‚Äî –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
 */
function getAudioDuration(filePath) {
  return new Promise((resolve, reject) => {
    ffmpeg.ffprobe(filePath, (err, metadata) => {
      if (err) return reject(err)
      resolve(Math.round(metadata.format.duration || 0))
    })
  })
}

module.exports = { transcribeAudio, getAudioDuration, convertToWav }
```

### –®–∞–≥ 4: –†–æ—É—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –∞—É–¥–∏–æ

–°–æ–∑–¥–∞–π `backend/src/routes/audioTranscription.js`:

```javascript
const express = require('express')
const { authenticate } = require('../middleware/auth')
const audioUpload = require('../middleware/audioUpload')
const { transcribeAudio, getAudioDuration } = require('../services/audioTranscriptionService')
const fs = require('fs')

const router = express.Router()

/**
 * POST /api/audio/transcribe
 *
 * –ó–∞–≥—Ä—É–∂–∞–µ—Ç –∞—É–¥–∏–æ—Ñ–∞–π–ª –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç
 *
 * –ü–æ—Ç–æ–∫:
 * 1. Multer —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ñ–∞–π–ª –Ω–∞ –¥–∏—Å–∫
 * 2. FFmpeg –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –≤ WAV
 * 3. Whisper —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤—ã–≤–∞–µ—Ç
 * 4. –£–¥–∞–ª—è–µ–º –∏—Å—Ö–æ–¥–Ω—ã–π —Ñ–∞–π–ª
 * 5. –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ç–µ–∫—Å—Ç
 */
router.post('/transcribe', authenticate, audioUpload.single('audio'), async (req, res) => {
  if (!req.file) {
    return res.status(400).json({ error: '–§–∞–π–ª –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω' })
  }

  try {
    // –ü–æ–ª—É—á–∞–µ–º –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–ª—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
    const duration = await getAudioDuration(req.file.path)

    // –†–∞—Å—à–∏—Ñ—Ä–æ–≤—ã–≤–∞–µ–º
    const text = await transcribeAudio(req.file.path)

    res.json({
      text,
      duration,
      filename: req.file.originalname
    })
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∏ –∞—É–¥–∏–æ:', error)
    res.status(500).json({ error: error.message })
  } finally {
    // –£–¥–∞–ª—è–µ–º –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–π —Ñ–∞–π–ª (–æ–Ω –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–µ–Ω)
    if (req.file && fs.existsSync(req.file.path)) {
      fs.unlinkSync(req.file.path)
    }
  }
})

module.exports = router
```

–ü–æ–¥–∫–ª—é—á–∏ –≤ `backend/src/index.js`:

```javascript
const audioRoutes = require('./routes/audioTranscription')
app.use('/api/audio', audioRoutes)
```

---

## –£—Ä–æ–∫ 25.2: Frontend ‚Äî –∫–Ω–æ–ø–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ –∞—É–¥–∏–æ

### –®–∞–≥ 1: –ö–æ–º–ø–æ–Ω–µ–Ω—Ç AudioImport

–°–æ–∑–¥–∞–π `frontend/src/components/AudioImport.vue`:

```vue
<script setup>
import { ref } from 'vue'
import api from '../api'

const emit = defineEmits(['transcribed'])

const file = ref(null)
const transcribing = ref(false)
const progress = ref('')
const dragover = ref(false)

// ========================================
// –î–æ–ø—É—Å—Ç–∏–º—ã–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
// ========================================
const acceptTypes = '.mp3,.wav,.ogg,.webm,.m4a,.flac,.aac'

function onFileSelect(event) {
  file.value = event.target.files[0]
  if (file.value) transcribe()
}

function onDrop(e) {
  e.preventDefault()
  dragover.value = false
  file.value = e.dataTransfer.files[0]
  if (file.value) transcribe()
}

async function transcribe() {
  if (!file.value) return

  transcribing.value = true
  progress.value = '–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞...'

  try {
    const formData = new FormData()
    formData.append('audio', file.value)

    progress.value = '–†–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞ –∞—É–¥–∏–æ (—ç—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –≤—Ä–µ–º—è)...'

    const response = await api.post('/audio/transcribe', formData, {
      headers: { 'Content-Type': 'multipart/form-data' },
      timeout: 300000  // 5 –º–∏–Ω—É—Ç —Ç–∞–π–º–∞—É—Ç –¥–ª—è –¥–ª–∏–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π
    })

    emit('transcribed', {
      text: response.data.text,
      duration: response.data.duration,
      filename: response.data.filename
    })

    progress.value = ''
    file.value = null
  } catch (e) {
    progress.value = ''
    alert('–û—à–∏–±–∫–∞ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∏: ' + (e.response?.data?.error || e.message))
  } finally {
    transcribing.value = false
  }
}

function formatSize(bytes) {
  if (bytes < 1024) return bytes + ' –ë'
  if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' –ö–ë'
  return (bytes / (1024 * 1024)).toFixed(1) + ' –ú–ë'
}
</script>

<template>
  <div>
    <!-- –ó–æ–Ω–∞ –∑–∞–≥—Ä—É–∑–∫–∏ -->
    <div :class="[
           'border-2 border-dashed rounded-lg p-6 text-center transition-colors',
           dragover ? 'border-blue-400 bg-blue-50' : 'border-gray-300 hover:border-gray-400'
         ]"
         @dragover.prevent="dragover = true"
         @dragleave="dragover = false"
         @drop="onDrop">

      <!-- –°—Ç–∞—Ç—É—Å —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∏ -->
      <div v-if="transcribing" class="space-y-2">
        <div class="animate-pulse text-blue-500 font-medium">
          {{ progress }}
        </div>
        <div v-if="file" class="text-sm text-gray-400">
          {{ file.name }} ({{ formatSize(file.size) }})
        </div>
      </div>

      <!-- –í—ã–±–æ—Ä —Ñ–∞–π–ª–∞ -->
      <div v-else>
        <p class="text-gray-500 mb-2">
          –ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –∞—É–¥–∏–æ—Ñ–∞–π–ª –∏–ª–∏
        </p>
        <label class="inline-block bg-gray-100 text-gray-700 px-4 py-2 rounded
                      cursor-pointer hover:bg-gray-200 transition-colors">
          –í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª
          <input type="file" :accept="acceptTypes" class="hidden" @change="onFileSelect" />
        </label>
        <p class="text-xs text-gray-400 mt-2">
          MP3, WAV, OGG, WebM, M4A, FLAC. –ú–∞–∫—Å–∏–º—É–º 50 –ú–ë
        </p>
      </div>
    </div>
  </div>
</template>
```

### –®–∞–≥ 2: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ NewSpecificationPage

–í `frontend/src/pages/NewSpecificationPage.vue` –¥–æ–±–∞–≤—å:

```javascript
import AudioImport from '../components/AudioImport.vue'
```

–í —à–∞–±–ª–æ–Ω, —Ä—è–¥–æ–º —Å –∫–Ω–æ–ø–∫–æ–π –∑–∞–ø–∏—Å–∏ –≥–æ–ª–æ—Å–∞:

```html
<!-- –¢–∞–±—ã: –∑–∞–ø–∏—Å—å / –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ -->
<div class="flex gap-2 mb-4">
  <button @click="inputMode = 'mic'"
          :class="['px-4 py-2 rounded text-sm', inputMode === 'mic' ? 'bg-blue-500 text-white' : 'bg-gray-100']">
    –ú–∏–∫—Ä–æ—Ñ–æ–Ω
  </button>
  <button @click="inputMode = 'file'"
          :class="['px-4 py-2 rounded text-sm', inputMode === 'file' ? 'bg-blue-500 text-white' : 'bg-gray-100']">
    –ó–∞–≥—Ä—É–∑–∏—Ç—å –∞—É–¥–∏–æ
  </button>
</div>

<!-- –†–µ–∂–∏–º –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞ -->
<div v-if="inputMode === 'mic'">
  <!-- –°—É—â–µ—Å—Ç–≤—É—é—â–∏–π SpeechRecorder -->
</div>

<!-- –†–µ–∂–∏–º –∑–∞–≥—Ä—É–∑–∫–∏ –∞—É–¥–∏–æ -->
<div v-if="inputMode === 'file'">
  <AudioImport @transcribed="onAudioTranscribed" />
</div>
```

–í `<script setup>`:

```javascript
const inputMode = ref('mic')  // 'mic' | 'file'

function onAudioTranscribed({ text, duration, filename }) {
  // –î–æ–±–∞–≤–ª—è–µ–º —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç –≤ –ø–æ–ª–µ
  voiceText.value = (voiceText.value ? voiceText.value + '\n\n' : '') + text
}
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞

1. –û—Ç–∫—Ä–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å–æ–∑–¥–∞–Ω–∏—è –¢–ó
2. –ü–µ—Ä–µ–∫–ª—é—á–∏—Å—å –Ω–∞ –≤–∫–ª–∞–¥–∫—É "–ó–∞–≥—Ä—É–∑–∏—Ç—å –∞—É–¥–∏–æ"
3. –í—ã–±–µ—Ä–∏ MP3/OGG —Ñ–∞–π–ª ‚Üí –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞
4. –ß–µ—Ä–µ–∑ –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –≤—Ä–µ–º—è —Ç–µ–∫—Å—Ç –ø–æ—è–≤–ª—è–µ—Ç—Å—è –≤ –ø–æ–ª–µ
5. –ù–∞–∂–º–∏ "–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ AI" ‚Äî —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –æ–±—ã—á–Ω–æ

---

# –ß–ê–°–¢–¨ 26: –°–ú–ï–ù–ê AI-–ú–û–î–ï–õ–ò –ù–ê –ë–û–õ–ï–ï –ú–û–©–ù–£–Æ ‚¨ú

## –£—Ä–æ–∫ 26.1: –í—ã–±–æ—Ä –º–æ–¥–µ–ª–∏ –ø–æ–¥ —Ç–≤–æ—ë –∂–µ–ª–µ–∑–æ

### –¢–≤–æ—ë –∂–µ–ª–µ–∑–æ

- CPU: Intel i5-14400F (10 —è–¥–µ—Ä, 2.5 –ì–ì—Ü)
- RAM: 32 –ì–ë
- GPU: NVIDIA RTX 5060 Ti 16 –ì–ë VRAM

### –ó–∞—á–µ–º –º–µ–Ω—è—Ç—å –º–æ–¥–µ–ª—å

–°–µ–π—á–∞—Å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `qwen2.5:7b` ‚Äî –æ–Ω–∞ —Ö–æ—Ä–æ—à–∞—è, –Ω–æ —Å —Ç–≤–æ–∏–º –∂–µ–ª–µ–∑–æ–º –º–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ–ª–µ–µ –º–æ—â–Ω—ã–µ –º–æ–¥–µ–ª–∏. –ë–æ–ª—å—à–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ = –ª—É—á—à–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞, —Ç–æ—á–Ω–µ–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ, –º–µ–Ω—å—à–µ –æ—à–∏–±–æ–∫ –≤ JSON.

### –ß—Ç–æ –º–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å

–° 16 –ì–ë VRAM –∏ 32 –ì–ë RAM –¥–æ—Å—Ç—É–ø–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ –º–æ–¥–µ–ª–∏:

| –ú–æ–¥–µ–ª—å | –†–∞–∑–º–µ—Ä | VRAM | –ö–∞—á–µ—Å—Ç–≤–æ —Ä—É—Å—Å–∫–æ–≥–æ | –°–∫–æ—Ä–æ—Å—Ç—å |
|--------|--------|------|-------------------|----------|
| `qwen2.5:7b` | 4.5 –ì–ë | ~5 –ì–ë | –•–æ—Ä–æ—à–µ–µ | –ë—ã—Å—Ç—Ä–æ |
| `qwen2.5:14b` | 8.5 –ì–ë | ~10 –ì–ë | –û—á–µ–Ω—å —Ö–æ—Ä–æ—à–µ–µ | –°—Ä–µ–¥–Ω–µ |
| `qwen2.5:32b-q4_K_M` | ~18 –ì–ë | ~14 –ì–ë | –û—Ç–ª–∏—á–Ω–æ–µ | –ú–µ–¥–ª–µ–Ω–Ω–µ–µ |
| `gemma3:12b` | 7 –ì–ë | ~9 –ì–ë | –•–æ—Ä–æ—à–µ–µ | –°—Ä–µ–¥–Ω–µ |
| `llama3.1:8b` | 4.7 –ì–ë | ~6 –ì–ë | –°—Ä–µ–¥–Ω–µ–µ | –ë—ã—Å—Ç—Ä–æ |
| `mistral:7b` | 4 –ì–ë | ~5 –ì–ë | –°—Ä–µ–¥–Ω–µ–µ | –ë—ã—Å—Ç—Ä–æ |
| `deepseek-r1:14b` | 8.5 –ì–ë | ~10 –ì–ë | –û—á–µ–Ω—å —Ö–æ—Ä–æ—à–µ–µ | –°—Ä–µ–¥–Ω–µ |

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** `qwen2.5:14b` ‚Äî –ª—É—á—à–∏–π –±–∞–ª–∞–Ω—Å –∫–∞—á–µ—Å—Ç–≤–∞ –∏ —Å–∫–æ—Ä–æ—Å—Ç–∏ –¥–ª—è —Ç–≤–æ–µ–≥–æ –∂–µ–ª–µ–∑–∞. –ï—Å–ª–∏ —Ö–æ—á–µ—à—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ –∏ –≥–æ—Ç–æ–≤ –ø–æ–¥–æ–∂–¥–∞—Ç—å ‚Äî `qwen2.5:32b-q4_K_M` (–∫–≤–∞–Ω—Ç–∏–∑–∞—Ü–∏—è q4 –ø–æ–º–µ—Å—Ç–∏—Ç—Å—è –≤ 16 –ì–ë VRAM).

### –®–∞–≥ 1: –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–æ–≤–æ–π –º–æ–¥–µ–ª–∏

```bash
# –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è ‚Äî –æ—Ç–ª–∏—á–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ, –±—ã—Å—Ç—Ä–∞—è –Ω–∞ RTX 5060 Ti
ollama pull qwen2.5:14b

# –ò–ª–∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ (–º–µ–¥–ª–µ–Ω–Ω–µ–µ, –Ω–æ –º–æ—â–Ω–µ–µ)
ollama pull qwen2.5:32b-q4_K_M
```

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–æ–¥–µ–ª–∏

```bash
# –¢–µ—Å—Ç–∏—Ä—É–µ–º –Ω–∞ —Ä—É—Å—Å–∫–æ–º —Ç–µ–∫—Å—Ç–µ
ollama run qwen2.5:14b "–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä—É–π —Å–ª–µ–¥—É—é—â–∏–π —Ç–µ–∫—Å—Ç –≤ JSON —Å –ø–æ–ª—è–º–∏ title –∏ items: –ù—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω —Å –∫–∞—Ç–∞–ª–æ–≥–æ–º —Ç–æ–≤–∞—Ä–æ–≤, –∫–æ—Ä–∑–∏–Ω–æ–π –∏ –æ–ø–ª–∞—Ç–æ–π —á–µ—Ä–µ–∑ Stripe"
```

–£–±–µ–¥–∏—Å—å —á—Ç–æ –º–æ–¥–µ–ª—å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤–∞–ª–∏–¥–Ω—ã–π JSON –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ.

### –®–∞–≥ 3: –û–±–Ω–æ–≤–∏—Ç—å .env

```env
OLLAMA_MODEL=qwen2.5:14b
```

–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏ backend ‚Äî –≤—Å—ë, –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–æ–≤—É—é –º–æ–¥–µ–ª—å.

---

## –£—Ä–æ–∫ 26.2: –°–µ–ª–µ–∫—Ç–æ—Ä –º–æ–¥–µ–ª–∏ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ

### –ó–∞—á–µ–º

–ü–æ–∑–≤–æ–ª–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≤—ã–±–∏—Ä–∞—Ç—å –º–æ–¥–µ–ª—å –ø—Ä—è–º–æ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ ‚Äî –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –∑–∞–¥–∞—á —Ä–∞–∑–Ω—ã–µ –º–æ–¥–µ–ª–∏. –ë—ã—Å—Ç—Ä–∞—è 7b –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö –¢–ó, –º–æ—â–Ω–∞—è 14b/32b –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö.

### –®–∞–≥ 1: –†–æ—É—Ç –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –º–æ–¥–µ–ª–µ–π

–î–æ–±–∞–≤—å –≤ `backend/src/routes/ai.js`:

```javascript
/**
 * GET /api/ai/models
 *
 * –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —É Ollama —Å–ø–∏—Å–æ–∫ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π
 * Ollama API: GET /api/tags
 */
router.get('/models', authenticate, async (req, res) => {
  try {
    const OLLAMA_URL = process.env.OLLAMA_URL || 'http://localhost:11434'

    const response = await fetch(`${OLLAMA_URL}/api/tags`)
    const data = await response.json()

    // ========================================
    // –§–∏–ª—å—Ç—Ä—É–µ–º –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º
    // data.models ‚Äî –º–∞—Å—Å–∏–≤ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π
    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ç–æ–ª—å–∫–æ –∏–º—è –∏ —Ä–∞–∑–º–µ—Ä
    // ========================================
    const models = (data.models || []).map(m => ({
      name: m.name,
      size: m.size,
      sizeFormatted: (m.size / (1024 * 1024 * 1024)).toFixed(1) + ' –ì–ë'
    }))

    // –ü–æ–º–µ—á–∞–µ–º —Ç–µ–∫—É—â—É—é –º–æ–¥–µ–ª—å
    const currentModel = process.env.OLLAMA_MODEL || 'qwen2.5:7b'

    res.json({
      models,
      current: currentModel
    })
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –º–æ–¥–µ–ª–µ–π:', error)
    res.status(500).json({ error: 'Ollama –Ω–µ –¥–æ—Å—Ç—É–ø–Ω–∞' })
  }
})
```

### –®–∞–≥ 2: –ü–µ—Ä–µ–¥–∞—á–∞ –º–æ–¥–µ–ª–∏ –≤ structureText

–û–±–Ω–æ–≤–∏ `backend/src/services/aiService.js`:

```javascript
/**
 * @param {string} text ‚Äî —Ç–µ–∫—Å—Ç –¥–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–∏—è
 * @param {string|null} customPrompt ‚Äî –∫–∞—Å—Ç–æ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç
 * @param {string|null} model ‚Äî –º–æ–¥–µ–ª—å Ollama (null = –∏–∑ .env)
 */
async function structureText(text, customPrompt = null, model = null) {
  const basePrompt = customPrompt || DEFAULT_PROMPT
  const useModel = model || OLLAMA_MODEL

  const prompt = `${basePrompt}

            –¢–µ–∫—Å—Ç –æ—Ç –∑–∞–∫–∞–∑—á–∏–∫–∞:
${text}`

  const response = await fetch(`${OLLAMA_URL}/api/generate`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      model: useModel,       // ‚Üê —Ç–µ–ø–µ—Ä—å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –º–æ–¥–µ–ª—å
      prompt,
      stream: false
    })
  })

  // ... –æ—Å—Ç–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
}
```

### –®–∞–≥ 3: –û–±–Ω–æ–≤–∏—Ç—å —Ä–æ—É—Ç AI-—Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–∏—è

–í `backend/src/routes/ai.js`:

```javascript
router.post('/structure', authenticate, async (req, res) => {
  try {
    const { text, promptId, model } = req.body   // ‚Üê –¥–æ–±–∞–≤–∏–ª–∏ model

    // ... –≤–∞–ª–∏–¥–∞—Ü–∏—è –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞ ...

    const structured = await structureText(text, customPrompt, model)
    res.json(structured)
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ AI-—Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–∏—è:', error)
    res.status(500).json({ error: error.message })
  }
})
```

### –®–∞–≥ 4: –°–µ–ª–µ–∫—Ç–æ—Ä –º–æ–¥–µ–ª–∏ –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ

–í `frontend/src/pages/NewSpecificationPage.vue` –¥–æ–±–∞–≤—å:

```javascript
const models = ref([])
const selectedModel = ref(null)

// –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –º–æ–¥–µ–ª–µ–π
onMounted(async () => {
  // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ ...

  try {
    const response = await api.get('/ai/models')
    models.value = response.data.models
    selectedModel.value = response.data.current
  } catch (e) {
    console.error('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –º–æ–¥–µ–ª–∏:', e)
  }
})
```

–í —à–∞–±–ª–æ–Ω, —Ä—è–¥–æ–º —Å —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–º –ø—Ä–æ–º–ø—Ç–æ–≤:

```html
<!-- –°–µ–ª–µ–∫—Ç–æ—Ä –º–æ–¥–µ–ª–∏ AI -->
<div class="mt-3 flex flex-col sm:flex-row gap-3 items-stretch sm:items-center flex-wrap">
  <select v-model="selectedPromptId"
          class="border rounded px-3 py-2 text-sm flex-1 sm:max-w-xs">
    <option :value="null">–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø—Ä–æ–º–ø—Ç</option>
    <option v-for="p in prompts" :key="p.id" :value="p.id">
      {{ p.title }}
    </option>
  </select>

  <!-- –í—ã–±–æ—Ä –º–æ–¥–µ–ª–∏ -->
  <select v-if="models.length > 1" v-model="selectedModel"
          class="border rounded px-3 py-2 text-sm sm:max-w-xs">
    <option v-for="m in models" :key="m.name" :value="m.name">
      {{ m.name }} ({{ m.sizeFormatted }})
    </option>
  </select>

  <button @click="structureWithAI" :disabled="isStructuring"
          class="bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-600 disabled:opacity-50">
    {{ isStructuring ? 'AI –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç...' : '–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ AI' }}
  </button>
</div>
```

–ü–µ—Ä–µ–¥–∞–≤–∞–π –º–æ–¥–µ–ª—å –≤ –∑–∞–ø—Ä–æ—Å—ã:

```javascript
// –í structureWithAI:
const response = await api.post('/ai/structure', {
  text: voiceText.value,
  promptId: selectedPromptId.value,
  model: selectedModel.value         // ‚Üê –¥–æ–±–∞–≤–ª—è–µ–º
})
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞

1. –£—Å—Ç–∞–Ω–æ–≤–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–æ–¥–µ–ª–µ–π: `ollama pull qwen2.5:14b`
2. –û—Ç–∫—Ä–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å–æ–∑–¥–∞–Ω–∏—è –¢–ó
3. –†—è–¥–æ–º —Å —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–º –ø—Ä–æ–º–ø—Ç–æ–≤ –ø–æ—è–≤–∏–ª—Å—è —Å–µ–ª–µ–∫—Ç–æ—Ä –º–æ–¥–µ–ª–∏
4. –í—ã–±–µ—Ä–∏ `qwen2.5:14b` ‚Üí —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä—É–π —Ç–µ–∫—Å—Ç ‚Üí —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ç–æ—á–Ω–µ–µ
5. –°—Ä–∞–≤–Ω–∏ —Å–∫–æ—Ä–æ—Å—Ç—å –∏ –∫–∞—á–µ—Å—Ç–≤–æ —Ä–∞–∑–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π

---

## –£—Ä–æ–∫ 26.3: GPU-—É—Å–∫–æ—Ä–µ–Ω–∏–µ Ollama –¥–ª—è RTX 5060 Ti

### –ó–∞—á–µ–º

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é Ollama —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç GPU –µ—Å–ª–∏ –æ–Ω –¥–æ—Å—Ç—É–ø–µ–Ω. –ù–æ —Å—Ç–æ–∏—Ç —É–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã.

### –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ GPU

```bash
# –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ Ollama –≤–∏–¥–∏—Ç GPU
ollama ps
```

–í –≤—ã–≤–æ–¥–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å `gpu` –≤ —Å—Ç–æ–ª–±—Ü–µ processor. –ï—Å–ª–∏ –≤–∏–¥–∏—à—å `cpu` ‚Äî –Ω—É–∂–Ω–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞.

### –®–∞–≥ 2: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ CUDA (–µ—Å–ª–∏ –µ—â—ë –Ω–µ—Ç)

RTX 5060 Ti —Ç—Ä–µ–±—É–µ—Ç CUDA 12.x:

1. –°–∫–∞—á–∞–π CUDA Toolkit —Å https://developer.nvidia.com/cuda-downloads
2. –£—Å—Ç–∞–Ω–æ–≤–∏ —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
3. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏ –∫–æ–º–ø—å—é—Ç–µ—Ä
4. –ü—Ä–æ–≤–µ—Ä—å: `nvidia-smi` ‚Äî –¥–æ–ª–∂–Ω–∞ –ø–æ–∫–∞–∑–∞—Ç—å GPU

### –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ Ollama

–°–æ–∑–¥–∞–π —Ñ–∞–π–ª –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è Ollama (Windows):

```
–°–∏—Å—Ç–µ–º–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ ‚Üí –ù–æ–≤–∞—è:
  –ò–º—è: OLLAMA_NUM_GPU
  –ó–Ω–∞—á–µ–Ω–∏–µ: 999
```

–≠—Ç–æ –≥–æ–≤–æ—Ä–∏—Ç Ollama –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Å–ª–æ–∏ GPU. –° 16 –ì–ë VRAM –º–æ–¥–µ–ª—å `qwen2.5:14b` –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–º–µ—Å—Ç–∏—Ç—Å—è –≤ –≤–∏–¥–µ–æ–ø–∞–º—è—Ç—å.

### –®–∞–≥ 4: –û–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

–û–±–Ω–æ–≤–∏ `aiService.js` ‚Äî –¥–æ–±–∞–≤—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –ª—É—á—à–µ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞:

```javascript
const response = await fetch(`${OLLAMA_URL}/api/generate`, {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    model: useModel,
    prompt,
    stream: false,
    options: {
      // ========================================
      // –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
      //
      // temperature: 0.3 ‚Äî –Ω–∏–∑–∫–∞—è "–∫—Ä–µ–∞—Ç–∏–≤–Ω–æ—Å—Ç—å"
      //   –î–ª—è JSON –Ω—É–∂–Ω—ã —Ç–æ—á–Ω—ã–µ, –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–µ –æ—Ç–≤–µ—Ç—ã
      //   0 = –ø–æ–ª–Ω–æ—Å—Ç—å—é –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π
      //   1 = –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ —Å–ª—É—á–∞–π–Ω—ã–π
      //
      // num_ctx: 8192 ‚Äî —Ä–∞–∑–º–µ—Ä –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
      //   –°–∫–æ–ª—å–∫–æ —Ç–æ–∫–µ–Ω–æ–≤ –º–æ–¥–µ–ª—å "–ø–æ–º–Ω–∏—Ç"
      //   8192 –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ –¢–ó
      //   –° 16 –ì–ë VRAM –º–æ–∂–Ω–æ –∏ 16384
      //
      // num_predict: 4096 ‚Äî –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –æ—Ç–≤–µ—Ç–∞
      //   –î–ª—è –±–æ–ª—å—à–∏—Ö –¢–ó –Ω—É–∂–Ω–æ –±–æ–ª—å—à–µ —Ç–æ–∫–µ–Ω–æ–≤
      // ========================================
      temperature: 0.3,
      num_ctx: 8192,
      num_predict: 4096
    }
  })
})
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞

1. –ó–∞–ø—É—Å—Ç–∏ `nvidia-smi` ‚Äî GPU –≤–∏–¥–Ω–∞
2. –ó–∞–ø—É—Å—Ç–∏ `ollama ps` ‚Äî –º–æ–¥–µ–ª—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç GPU
3. –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä—É–π —Ç–µ–∫—Å—Ç —á–µ—Ä–µ–∑ AI ‚Äî —Å–∫–æ—Ä–æ—Å—Ç—å –≤—ã—à–µ —á–µ–º –Ω–∞ CPU
4. `qwen2.5:14b` –Ω–∞ RTX 5060 Ti –¥–æ–ª–∂–Ω–∞ –≤—ã–¥–∞–≤–∞—Ç—å ~20-40 —Ç–æ–∫–µ–Ω–æ–≤/—Å–µ–∫

---

# –ò–¢–û–ì–û–í–ê–Ø –°–¢–†–£–ö–¢–£–†–ê –ü–†–û–ï–ö–¢–ê

```
task_generator/
‚îú‚îÄ‚îÄ backend/
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ index.js                    # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ Express
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ db.js                       # Prisma Client
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ controllers/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ authController.js       # –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è, –ª–æ–≥–∏–Ω
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ projectController.js    # CRUD –ø—Ä–æ–µ–∫—Ç–æ–≤
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ specificationController.js  # CRUD –¢–ó
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ promptController.js        # CRUD –ø—Ä–æ–º–ø—Ç–æ–≤ AI
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ shareController.js         # –®–∞—Ä–∏–Ω–≥ –¢–ó + –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ middleware/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.js                 # JWT –ø—Ä–æ–≤–µ—Ä–∫–∞ + —Ä–æ–ª–∏
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ upload.js               # Multer –¥–ª—è —Ñ–∞–π–ª–æ–≤
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ audioUpload.js          # Multer –¥–ª—è –∞—É–¥–∏–æ—Ñ–∞–π–ª–æ–≤
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ routes/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.js                 # /api/auth/*
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ projects.js             # /api/projects/*
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ai.js                   # /api/ai/*
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ transcription.js        # /api/transcription
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ audioTranscription.js   # /api/audio/*
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ attachments.js          # /api/attachments/*
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ export.js               # /api/export/* (PDF + DOC)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ share.js                # /api/share/*
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ bitrix.js               # /api/bitrix/*
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ prompts.js             # /api/prompts/*
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ services/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ aiService.js            # Ollama AI
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ pdfService.js           # Puppeteer PDF
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ docService.js           # DOCX –≥–µ–Ω–µ—Ä–∞—Ü–∏—è
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ audioTranscriptionService.js # Whisper —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ transcriptionService.js # Google Speech
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ bitrixService.js        # Bitrix24 API
‚îÇ   ‚îú‚îÄ‚îÄ prisma/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ schema.prisma              # –°—Ö–µ–º–∞ –ë–î
‚îÇ   ‚îú‚îÄ‚îÄ uploads/                       # –ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ audio/                     # –í—Ä–µ–º–µ–Ω–Ω—ã–µ –∞—É–¥–∏–æ—Ñ–∞–π–ª—ã
‚îÇ   ‚îú‚îÄ‚îÄ credentials/                   # API –∫–ª—é—á–∏ (–≤ .gitignore!)
‚îÇ   ‚îú‚îÄ‚îÄ .env
‚îÇ   ‚îî‚îÄ‚îÄ package.json
‚îÇ
‚îú‚îÄ‚îÄ frontend/
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ main.js                    # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ Vue
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ App.vue                    # –ö–æ—Ä–Ω–µ–≤–æ–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ style.css                  # TailwindCSS
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.js               # Axios HTTP –∫–ª–∏–µ–Ω—Ç
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ router/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.js               # Vue Router
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ stores/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ auth.js                # –°—Ç–æ—Ä –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ composables/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useSpeechRecognition.js   # Web Speech API
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ useServerTranscription.js # Google Cloud Speech
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AppLayout.vue           # –ù–∞–≤–∏–≥–∞—Ü–∏—è + layout
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ LoginForm.vue           # –§–æ—Ä–º–∞ –≤—Ö–æ–¥–∞
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ SpeechRecorder.vue      # –ó–∞–ø–∏—Å—å –≥–æ–ª–æ—Å–∞
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ItemAttachments.vue     # –°–∫—Ä–∏–Ω—à–æ—Ç—ã –∫ –ø—É–Ω–∫—Ç–∞–º –¢–ó
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ShareDialog.vue         # –î–∏–∞–ª–æ–≥ —à–∞—Ä–∏–Ω–≥–∞ –¢–ó
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ SuggestionsPanel.vue    # –ü–∞–Ω–µ–ª—å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ AudioImport.vue         # –ò–º–ø–æ—Ä—Ç –∞—É–¥–∏–æ—Ñ–∞–π–ª–æ–≤
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ pages/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ LoginPage.vue           # –°—Ç—Ä–∞–Ω–∏—Ü–∞ –≤—Ö–æ–¥–∞
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ RegisterPage.vue        # –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ DashboardPage.vue       # –î–∞—à–±–æ—Ä–¥
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ ProjectsPage.vue        # –°–ø–∏—Å–æ–∫ –ø—Ä–æ–µ–∫—Ç–æ–≤
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ PromptsPage.vue         # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞–º–∏ AI
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ RecordPage.vue          # –ó–∞–ø–∏—Å—å –≥–æ–ª–æ—Å–∞
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ NewSpecificationPage.vue # –°–æ–∑–¥–∞–Ω–∏–µ –¢–ó
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ SpecificationPage.vue   # –ü—Ä–æ—Å–º–æ—Ç—Ä –¢–ó
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ SharedSpecificationPage.vue # –ü—Ä–æ—Å–º–æ—Ç—Ä –ø–æ —Å—Å—ã–ª–∫–µ
‚îÇ   ‚îú‚îÄ‚îÄ tailwind.config.js
‚îÇ   ‚îú‚îÄ‚îÄ postcss.config.js
‚îÇ   ‚îú‚îÄ‚îÄ vite.config.js
‚îÇ   ‚îî‚îÄ‚îÄ package.json
‚îÇ
‚îú‚îÄ‚îÄ CLAUDE.md
‚îú‚îÄ‚îÄ COURSE.md
‚îî‚îÄ‚îÄ todo.md
```

---

# –ü–û–õ–ï–ó–ù–´–ï –ö–û–ú–ê–ù–î–´

```bash
# Backend
cd backend
npm run dev              # –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
npx prisma studio        # GUI –¥–ª—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
npx prisma db push       # –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ö–µ–º—ã

# Frontend
cd frontend
npm run dev              # –ó–∞–ø—É—Å–∫ dev —Å–µ—Ä–≤–µ—Ä–∞
npm run build            # –°–±–æ—Ä–∫–∞ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
```

---

# –ü–û–†–Ø–î–û–ö –†–ï–ê–õ–ò–ó–ê–¶–ò–ò (–†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–Ø)

1. –ò—Å–ø—Ä–∞–≤–∏—Ç—å –±–∞–≥–∏ –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º –∫–æ–¥–µ (–ß–∞—Å—Ç—å 8.1 ‚Äî –∞–≤—Ç–æ-–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫)
2. –î–æ–±–∞–≤–∏—Ç—å Vue Router –∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã (–ß–∞—Å—Ç—å 9)
3. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å backend CRUD –ø—Ä–æ–µ–∫—Ç–æ–≤ –∏ –¢–ó (–ß–∞—Å—Ç–∏ 4-5 –∏–∑ –∫–æ–¥–∞)
4. –°–æ–∑–¥–∞—Ç—å UI –ø—Ä–æ–µ–∫—Ç–æ–≤ (–ß–∞—Å—Ç—å 10)
5. –°–æ–∑–¥–∞—Ç—å UI –¢–ó (–ß–∞—Å—Ç—å 11)
6. –ü–æ–¥–∫–ª—é—á–∏—Ç—å AI-—Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ (–ß–∞—Å—Ç—å 12)
7. –î–æ–±–∞–≤–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É —Ñ–∞–π–ª–æ–≤ (–ß–∞—Å—Ç—å 13)
8. –î–æ–±–∞–≤–∏—Ç—å Drag & Drop (–ß–∞—Å—Ç—å 14)
9. –î–æ–±–∞–≤–∏—Ç—å PDF-—ç–∫—Å–ø–æ—Ä—Ç (–ß–∞—Å—Ç—å 15)
10. –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å Bitrix24 (–ß–∞—Å—Ç—å 16)
11. –£–¥–∞–ª—ë–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø —á–µ—Ä–µ–∑ ngrok (–ß–∞—Å—Ç—å 17)
12. –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å (–ß–∞—Å—Ç—å 18)
13. –ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –¢–ó (–ß–∞—Å—Ç—å 19)
14. –í—ã–±–æ—Ä CRM-—Å–∏—Å—Ç–µ–º—ã –¥–ª—è –æ—Ü–µ–Ω–∫–∏ –¢–ó (–ß–∞—Å—Ç—å 20)
15. –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: —Å–µ—Ä–≤–µ—Ä–Ω–∞—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è (–ß–∞—Å—Ç—å 8.2)
16. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞–º–∏ –∏ –∫–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è AI (–ß–∞—Å—Ç—å 21)
17. –≠–∫—Å–ø–æ—Ä—Ç –≤ DOC (–ß–∞—Å—Ç—å 22)
18. –ü—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–∏–µ —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤ –∫ –ø—É–Ω–∫—Ç–∞–º –¢–ó (–ß–∞—Å—Ç—å 23)
19. –®–∞—Ä–∏–Ω–≥ –¢–ó –∏ —Å–æ–≤–º–µ—Å—Ç–Ω–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (–ß–∞—Å—Ç—å 24)
20. –ò–º–ø–æ—Ä—Ç –∞—É–¥–∏–æ—Ñ–∞–π–ª–æ–≤ –¥–ª—è —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∏ (–ß–∞—Å—Ç—å 25)
21. –°–º–µ–Ω–∞ AI-–º–æ–¥–µ–ª–∏ –Ω–∞ –±–æ–ª–µ–µ –º–æ—â–Ω—É—é (–ß–∞—Å—Ç—å 26)
